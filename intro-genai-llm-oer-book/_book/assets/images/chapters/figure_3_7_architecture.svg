<svg viewBox="0 0 900 800" xmlns="http://www.w3.org/2000/svg">
  <!-- Title -->
  <text x="450" y="30" font-size="18" font-weight="bold" text-anchor="middle" fill="#2c3e50">
    Integrated Model Selection &amp; Prompt Engineering Architecture
  </text>
  
  <!-- User Query Input -->
  <rect x="350" y="60" width="200" height="50" fill="#3498db" stroke="#2c3e50" stroke-width="2" rx="5"/>
  <text x="450" y="80" font-size="13" font-weight="bold" text-anchor="middle" fill="white">
    User Query
  </text>
  <text x="450" y="98" font-size="11" text-anchor="middle" fill="white">
    "Compare these research papers..."
  </text>
  
  <!-- Arrow down -->
  <path d="M 450 110 L 450 140" stroke="#2c3e50" stroke-width="3" marker-end="url(#arrow)"/>
  
  <!-- Query Analysis Layer (Chapter 2) -->
  <rect x="50" y="150" width="800" height="100" fill="#e8f4f8" stroke="#2196f3" stroke-width="3" rx="5"/>
  <text x="450" y="175" font-size="14" font-weight="bold" text-anchor="middle" fill="#1976d2">
    Layer 1: Query Analysis (Chapter 2)
  </text>
  
  <g transform="translate(70, 190)">
    <rect x="0" y="0" width="180" height="45" fill="#fff" stroke="#2196f3" stroke-width="1" rx="3"/>
    <text x="90" y="15" font-size="11" font-weight="bold" text-anchor="middle" fill="#2c3e50">Complexity Scoring</text>
    <text x="90" y="32" font-size="10" text-anchor="middle" fill="#666">Score: 8/10 (Complex)</text>
    
    <rect x="200" y="0" width="180" height="45" fill="#fff" stroke="#2196f3" stroke-width="1" rx="3"/>
    <text x="290" y="15" font-size="11" font-weight="bold" text-anchor="middle" fill="#2c3e50">Type Classification</text>
    <text x="290" y="32" font-size="10" text-anchor="middle" fill="#666">Type: Comparative Analysis</text>
    
    <rect x="400" y="0" width="180" height="45" fill="#fff" stroke="#2196f3" stroke-width="1" rx="3"/>
    <text x="490" y="15" font-size="11" font-weight="bold" text-anchor="middle" fill="#2c3e50">Domain Detection</text>
    <text x="490" y="32" font-size="10" text-anchor="middle" fill="#666">Domain: Academic Research</text>
    
    <rect x="600" y="0" width="180" height="45" fill="#fff" stroke="#2196f3" stroke-width="1" rx="3"/>
    <text x="690" y="15" font-size="11" font-weight="bold" text-anchor="middle" fill="#2c3e50">Requirements</text>
    <text x="690" y="32" font-size="10" text-anchor="middle" fill="#666">CoT + Citations Needed</text>
  </g>
  
  <!-- Split into two parallel paths -->
  <path d="M 450 250 L 450 280" stroke="#2c3e50" stroke-width="3"/>
  <path d="M 450 280 L 200 280" stroke="#2c3e50" stroke-width="3" marker-end="url(#arrow)"/>
  <path d="M 450 280 L 700 280" stroke="#2c3e50" stroke-width="3" marker-end="url(#arrow)"/>
  
  <!-- Left Path: Model Selection (Chapter 2) -->
  <rect x="50" y="290" width="300" height="180" fill="#fff3e0" stroke="#ff9800" stroke-width="3" rx="5"/>
  <text x="200" y="315" font-size="14" font-weight="bold" text-anchor="middle" fill="#f57c00">
    Model Selection (Ch 2)
  </text>
  
  <g transform="translate(70, 330)">
    <text x="0" y="0" font-size="11" font-weight="bold" fill="#2c3e50">Based on Complexity (8/10):</text>
    
    <rect x="0" y="10" width="260" height="30" fill="#ffebee" stroke="#e74c3c" stroke-width="1" rx="3"/>
    <text x="10" y="28" font-size="10" fill="#2c3e50">❌ Haiku - Too simple for this task</text>
    
    <rect x="0" y="45" width="260" height="30" fill="#fff9e6" stroke="#ffc107" stroke-width="1" rx="3"/>
    <text x="10" y="63" font-size="10" fill="#2c3e50">⚠ Sonnet - May struggle with nuance</text>
    
    <rect x="0" y="80" width="260" height="30" fill="#e6ffe6" stroke="#27ae60" stroke-width="2" rx="3"/>
    <text x="10" y="98" font-size="10" font-weight="bold" fill="#1e7e34">✓ Opus/GPT-4 - Optimal choice</text>
    
    <text x="0" y="130" font-size="10" fill="#666">
      <tspan x="0" dy="0">• Cost: ~$0.025/query</tspan>
      <tspan x="0" dy="12">• Latency: 6-8 seconds</tspan>
      <tspan x="0" dy="12">• Quality: Premium</tspan>
    </text>
  </g>
  
  <!-- Right Path: Prompt Engineering (Chapter 3) -->
  <rect x="550" y="290" width="300" height="180" fill="#f3e5f5" stroke="#9c27b0" stroke-width="3" rx="5"/>
  <text x="700" y="315" font-size="14" font-weight="bold" text-anchor="middle" fill="#7b1fa2">
    Prompt Engineering (Ch 3)
  </text>
  
  <g transform="translate(570, 330)">
    <text x="0" y="0" font-size="11" font-weight="bold" fill="#2c3e50">Template Selection:</text>
    
    <rect x="0" y="10" width="260" height="30" fill="#e6ffe6" stroke="#27ae60" stroke-width="2" rx="3"/>
    <text x="10" y="28" font-size="10" font-weight="bold" fill="#1e7e34">✓ Comparative Analysis Template</text>
    
    <text x="0" y="55" font-size="10" fill="#2c3e50">
      <tspan x="0" dy="0" font-weight="bold">Enhancements:</tspan>
      <tspan x="0" dy="14">✓ Few-shot: 3 example comparisons</tspan>
      <tspan x="0" dy="12">✓ Chain-of-Thought: Enabled</tspan>
      <tspan x="0" dy="12">✓ Citations: Required</tspan>
      <tspan x="0" dy="12">✓ Format: Structured matrix</tspan>
      <tspan x="0" dy="12">✓ Safety: Injection filters active</tspan>
    </text>
  </g>
  
  <!-- Paths converge -->
  <path d="M 200 470 L 200 500" stroke="#2c3e50" stroke-width="3"/>
  <path d="M 700 470 L 700 500" stroke="#2c3e50" stroke-width="3"/>
  <path d="M 200 500 L 450 500" stroke="#2c3e50" stroke-width="3" marker-end="url(#arrow)"/>
  <path d="M 700 500 L 450 500" stroke="#2c3e50" stroke-width="3" marker-end="url(#arrow)"/>
  
  <!-- Combined Layer: Final Prompt Construction -->
  <rect x="150" y="510" width="600" height="90" fill="#d4edda" stroke="#28a745" stroke-width="3" rx="5"/>
  <text x="450" y="535" font-size="14" font-weight="bold" text-anchor="middle" fill="#1e7e34">
    Layer 2: Final Prompt Construction
  </text>
  
  <rect x="170" y="545" width="560" height="45" fill="#fff" stroke="#28a745" stroke-width="1" rx="3"/>
  <text x="180" y="562" font-size="9" fill="#2c3e50">
    <tspan x="180" dy="0">System Prompt: Comparative analysis role + safety rules</tspan>
    <tspan x="180" dy="12">Few-Shot Examples: 3 similar research comparisons</tspan>
    <tspan x="180" dy="12">User Query: [sanitized input with delimiters]</tspan>
    <tspan x="180" dy="12">CoT Trigger: "Let's analyze step-by-step: methodology, findings, limitations..."</tspan>
  </text>
  
  <!-- Arrow down -->
  <path d="M 450 600 L 450 630" stroke="#2c3e50" stroke-width="3" marker-end="url(#arrow)"/>
  
  <!-- Generation Layer -->
  <rect x="250" y="640" width="400" height="60" fill="#fff9e6" stroke="#ffc107" stroke-width="3" rx="5"/>
  <text x="450" y="665" font-size="14" font-weight="bold" text-anchor="middle" fill="#f57c00">
    Layer 3: Response Generation
  </text>
  <text x="450" y="688" font-size="11" text-anchor="middle" fill="#2c3e50">
    Claude 3 Opus generates structured comparison using optimized prompt
  </text>
  
  <!-- Arrow down -->
  <path d="M 450 700 L 450 730" stroke="#2c3e50" stroke-width="3" marker-end="url(#arrow)"/>
  
  <!-- Evaluation Layer -->
  <rect x="50" y="740" width="800" height="50" fill="#e8f4f8" stroke="#2196f3" stroke-width="3" rx="5"/>
  <text x="450" y="765" font-size="14" font-weight="bold" text-anchor="middle" fill="#1976d2">
    Layer 4: Evaluation &amp; Learning
  </text>
  
  <g transform="translate(70, 770)">
    <text x="0" y="0" font-size="10" fill="#2c3e50">
      Track: Template success rate | Model performance | Cost efficiency | User satisfaction
    </text>
    <text x="520" y="0" font-size="10" font-weight="bold" fill="#27ae60">
      → Feed insights back to improve both model selection and prompt templates
    </text>
  </g>
  
  <!-- Feedback loops -->
  <path d="M 800 765 Q 870 600, 870 340 Q 870 280, 850 265" 
        stroke="#9c27b0" stroke-width="2" fill="none" 
        marker-end="url(#arrowPurple)" stroke-dasharray="5,5"/>
  <text x="860" y="500" font-size="10" font-weight="bold" fill="#9c27b0" transform="rotate(270, 860, 500)">
    Continuous Improvement Loop
  </text>
  
  <!-- Key Benefits Box -->
  <rect x="30" y="20" width="280" height="100" fill="#fff" stroke="#27ae60" stroke-width="2" rx="5"/>
  <text x="170" y="40" font-size="12" font-weight="bold" text-anchor="middle" fill="#27ae60">
    Integrated Benefits
  </text>
  <text x="40" y="60" font-size="9" fill="#2c3e50">
    <tspan x="40" dy="0">✓ Right model for task complexity</tspan>
    <tspan x="40" dy="12">✓ Optimal prompt for query type</tspan>
    <tspan x="40" dy="12">✓ Cost efficiency (avoid overspending)</tspan>
    <tspan x="40" dy="12">✓ Quality assurance (both layers optimized)</tspan>
    <tspan x="40" dy="12">✓ Continuous learning from performance data</tspan>
  </text>
  
  <!-- Arrow markers -->
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#2c3e50"/>
    </marker>
    <marker id="arrowPurple" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#9c27b0"/>
    </marker>
  </defs>
</svg>
