<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>7&nbsp; Chapter 6: Randomized Algorithms - The Power of Controlled Chaos ‚Äì Advanced Computational Algorithms</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../chapters/05-Dynamic-Programming.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-9b98f18118eee809be1c051eb5cc78e4.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/01-introduction.html">Core Concepts</a></li><li class="breadcrumb-item"><a href="../chapters/06-Randomized-Algorithms.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Chapter 6: Randomized Algorithms - The Power of Controlled Chaos</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Advanced Computational Algorithms</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Preface</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Advanced Computational Algorithms</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Core Concepts</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/01-introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Advanced Algorithms: A Journey Through Computational Problem Solving</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/02-Divide-and-Conquer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Advanced Algorithms: A Journey Through Computational Problem Solving</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/03-Data-Structures-for-Efficiency.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Chapter 3: Data Structures for Efficiency</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/04-Greedy-Algorithms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Chapter 4: Greedy Algorithms - When Local Optimality Leads to Global Solutions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/05-Dynamic-Programming.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Advanced Algorithms: A Journey Through Computational Problem Solving</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/06-Randomized-Algorithms.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Chapter 6: Randomized Algorithms - The Power of Controlled Chaos</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#when-dice-make-better-decisions" id="toc-when-dice-make-better-decisions" class="nav-link active" data-scroll-target="#when-dice-make-better-decisions"><span class="header-section-number">7.1</span> When Dice Make Better Decisions</a></li>
  <li><a href="#introduction-embracing-uncertainty-for-certainty" id="toc-introduction-embracing-uncertainty-for-certainty" class="nav-link" data-scroll-target="#introduction-embracing-uncertainty-for-certainty"><span class="header-section-number">7.2</span> Introduction: Embracing Uncertainty for Certainty</a>
  <ul class="collapse">
  <li><a href="#the-paradox-of-random-success" id="toc-the-paradox-of-random-success" class="nav-link" data-scroll-target="#the-paradox-of-random-success"><span class="header-section-number">7.2.1</span> The Paradox of Random Success</a></li>
  <li><a href="#why-randomness" id="toc-why-randomness" class="nav-link" data-scroll-target="#why-randomness"><span class="header-section-number">7.2.2</span> Why Randomness?</a></li>
  <li><a href="#real-world-impact" id="toc-real-world-impact" class="nav-link" data-scroll-target="#real-world-impact"><span class="header-section-number">7.2.3</span> Real-World Impact</a></li>
  <li><a href="#chapter-roadmap" id="toc-chapter-roadmap" class="nav-link" data-scroll-target="#chapter-roadmap"><span class="header-section-number">7.2.4</span> Chapter Roadmap</a></li>
  </ul></li>
  <li><a href="#section-6.1-fundamentals-of-randomized-algorithms" id="toc-section-6.1-fundamentals-of-randomized-algorithms" class="nav-link" data-scroll-target="#section-6.1-fundamentals-of-randomized-algorithms"><span class="header-section-number">7.3</span> Section 6.1: Fundamentals of Randomized Algorithms</a>
  <ul class="collapse">
  <li><a href="#understanding-randomness-in-computing" id="toc-understanding-randomness-in-computing" class="nav-link" data-scroll-target="#understanding-randomness-in-computing"><span class="header-section-number">7.3.1</span> Understanding Randomness in Computing</a></li>
  <li><a href="#two-flavors-of-randomized-algorithms" id="toc-two-flavors-of-randomized-algorithms" class="nav-link" data-scroll-target="#two-flavors-of-randomized-algorithms"><span class="header-section-number">7.3.2</span> Two Flavors of Randomized Algorithms</a></li>
  <li><a href="#why-do-we-accept-uncertainty" id="toc-why-do-we-accept-uncertainty" class="nav-link" data-scroll-target="#why-do-we-accept-uncertainty"><span class="header-section-number">7.3.3</span> Why Do We Accept Uncertainty?</a></li>
  </ul></li>
  <li><a href="#section-6.2-randomized-quicksort---learning-from-card-shuffling" id="toc-section-6.2-randomized-quicksort---learning-from-card-shuffling" class="nav-link" data-scroll-target="#section-6.2-randomized-quicksort---learning-from-card-shuffling"><span class="header-section-number">7.4</span> Section 6.2: Randomized QuickSort - Learning from Card Shuffling</a>
  <ul class="collapse">
  <li><a href="#the-problem-with-regular-quicksort" id="toc-the-problem-with-regular-quicksort" class="nav-link" data-scroll-target="#the-problem-with-regular-quicksort"><span class="header-section-number">7.4.1</span> The Problem with Regular QuickSort</a></li>
  <li><a href="#enter-randomized-quicksort-the-magic-of-random-pivots" id="toc-enter-randomized-quicksort-the-magic-of-random-pivots" class="nav-link" data-scroll-target="#enter-randomized-quicksort-the-magic-of-random-pivots"><span class="header-section-number">7.4.2</span> Enter Randomized QuickSort: The Magic of Random Pivots</a></li>
  <li><a href="#monte-carlo-algorithms-the-speed-accuracy-tradeoff" id="toc-monte-carlo-algorithms-the-speed-accuracy-tradeoff" class="nav-link" data-scroll-target="#monte-carlo-algorithms-the-speed-accuracy-tradeoff"><span class="header-section-number">7.4.3</span> Monte Carlo Algorithms: The Speed-Accuracy Tradeoff</a></li>
  <li><a href="#understanding-probability-in-randomized-algorithms" id="toc-understanding-probability-in-randomized-algorithms" class="nav-link" data-scroll-target="#understanding-probability-in-randomized-algorithms"><span class="header-section-number">7.4.4</span> Understanding Probability in Randomized Algorithms</a></li>
  <li><a href="#understanding-probability-in-randomized-algorithms-1" id="toc-understanding-probability-in-randomized-algorithms-1" class="nav-link" data-scroll-target="#understanding-probability-in-randomized-algorithms-1"><span class="header-section-number">7.4.5</span> Understanding Probability in Randomized Algorithms</a></li>
  </ul></li>
  <li><a href="#section-6.3-randomized-selection---finding-needles-in-haystacks" id="toc-section-6.3-randomized-selection---finding-needles-in-haystacks" class="nav-link" data-scroll-target="#section-6.3-randomized-selection---finding-needles-in-haystacks"><span class="header-section-number">7.5</span> Section 6.3: Randomized Selection - Finding Needles in Haystacks</a>
  <ul class="collapse">
  <li><a href="#the-selection-problem" id="toc-the-selection-problem" class="nav-link" data-scroll-target="#the-selection-problem"><span class="header-section-number">7.5.1</span> The Selection Problem</a></li>
  <li><a href="#the-naive-approach" id="toc-the-naive-approach" class="nav-link" data-scroll-target="#the-naive-approach"><span class="header-section-number">7.5.2</span> The Naive Approach</a></li>
  <li><a href="#quickselect-the-randomized-solution" id="toc-quickselect-the-randomized-solution" class="nav-link" data-scroll-target="#quickselect-the-randomized-solution"><span class="header-section-number">7.5.3</span> QuickSelect: The Randomized Solution</a></li>
  </ul></li>
  <li><a href="#section-6.4-hash-functions-and-randomization" id="toc-section-6.4-hash-functions-and-randomization" class="nav-link" data-scroll-target="#section-6.4-hash-functions-and-randomization"><span class="header-section-number">7.6</span> Section 6.4: Hash Functions and Randomization</a>
  <ul class="collapse">
  <li><a href="#understanding-hash-tables-first" id="toc-understanding-hash-tables-first" class="nav-link" data-scroll-target="#understanding-hash-tables-first"><span class="header-section-number">7.6.1</span> Understanding Hash Tables First</a></li>
  <li><a href="#universal-hashing-randomization-to-the-rescue" id="toc-universal-hashing-randomization-to-the-rescue" class="nav-link" data-scroll-target="#universal-hashing-randomization-to-the-rescue"><span class="header-section-number">7.6.2</span> Universal Hashing: Randomization to the Rescue</a></li>
  <li><a href="#bloom-filters-space-efficient-membership-testing" id="toc-bloom-filters-space-efficient-membership-testing" class="nav-link" data-scroll-target="#bloom-filters-space-efficient-membership-testing"><span class="header-section-number">7.6.3</span> Bloom Filters: Space-Efficient Membership Testing</a></li>
  </ul></li>
  <li><a href="#section-6.5-streaming-algorithms---processing-infinite-data" id="toc-section-6.5-streaming-algorithms---processing-infinite-data" class="nav-link" data-scroll-target="#section-6.5-streaming-algorithms---processing-infinite-data"><span class="header-section-number">7.7</span> Section 6.5: Streaming Algorithms - Processing Infinite Data</a>
  <ul class="collapse">
  <li><a href="#the-streaming-challenge" id="toc-the-streaming-challenge" class="nav-link" data-scroll-target="#the-streaming-challenge"><span class="header-section-number">7.7.1</span> The Streaming Challenge</a></li>
  <li><a href="#reservoir-sampling-fair-sampling-from-streams" id="toc-reservoir-sampling-fair-sampling-from-streams" class="nav-link" data-scroll-target="#reservoir-sampling-fair-sampling-from-streams"><span class="header-section-number">7.7.2</span> Reservoir Sampling: Fair Sampling from Streams</a></li>
  <li><a href="#count-min-sketch-frequency-estimation" id="toc-count-min-sketch-frequency-estimation" class="nav-link" data-scroll-target="#count-min-sketch-frequency-estimation"><span class="header-section-number">7.7.3</span> Count-Min Sketch: Frequency Estimation</a></li>
  <li><a href="#hyperloglog-counting-unique-elements" id="toc-hyperloglog-counting-unique-elements" class="nav-link" data-scroll-target="#hyperloglog-counting-unique-elements"><span class="header-section-number">7.7.4</span> HyperLogLog: Counting Unique Elements</a></li>
  </ul></li>
  <li><a href="#this-algorithm-is-so-elegant-and-powerful-that-its-used-by-redis-google-bigquery-and-many-other-systems" id="toc-this-algorithm-is-so-elegant-and-powerful-that-its-used-by-redis-google-bigquery-and-many-other-systems" class="nav-link" data-scroll-target="#this-algorithm-is-so-elegant-and-powerful-that-its-used-by-redis-google-bigquery-and-many-other-systems"><span class="header-section-number">7.8</span> This algorithm is so elegant and powerful that it‚Äôs used by Redis, Google BigQuery, and many other systems!</a></li>
  <li><a href="#section-6.6-analyzing-randomized-algorithms" id="toc-section-6.6-analyzing-randomized-algorithms" class="nav-link" data-scroll-target="#section-6.6-analyzing-randomized-algorithms"><span class="header-section-number">7.9</span> Section 6.6: Analyzing Randomized Algorithms</a>
  <ul class="collapse">
  <li><a href="#understanding-performance-through-probability" id="toc-understanding-performance-through-probability" class="nav-link" data-scroll-target="#understanding-performance-through-probability"><span class="header-section-number">7.9.1</span> Understanding Performance Through Probability</a></li>
  <li><a href="#concentration-inequalities-why-randomized-algorithms-dont-get-unlucky" id="toc-concentration-inequalities-why-randomized-algorithms-dont-get-unlucky" class="nav-link" data-scroll-target="#concentration-inequalities-why-randomized-algorithms-dont-get-unlucky"><span class="header-section-number">7.9.2</span> Concentration Inequalities: Why Randomized Algorithms Don‚Äôt Get Unlucky</a></li>
  </ul></li>
  <li><a href="#section-6.7-advanced-randomized-algorithms" id="toc-section-6.7-advanced-randomized-algorithms" class="nav-link" data-scroll-target="#section-6.7-advanced-randomized-algorithms"><span class="header-section-number">7.10</span> Section 6.7: Advanced Randomized Algorithms</a>
  <ul class="collapse">
  <li><a href="#kargers-min-cut-algorithm-finding-bottlenecks" id="toc-kargers-min-cut-algorithm-finding-bottlenecks" class="nav-link" data-scroll-target="#kargers-min-cut-algorithm-finding-bottlenecks"><span class="header-section-number">7.10.1</span> Karger‚Äôs Min-Cut Algorithm: Finding Bottlenecks</a></li>
  <li><a href="#monte-carlo-integration-using-randomness-for-math" id="toc-monte-carlo-integration-using-randomness-for-math" class="nav-link" data-scroll-target="#monte-carlo-integration-using-randomness-for-math"><span class="header-section-number">7.10.2</span> Monte Carlo Integration: Using Randomness for Math</a></li>
  </ul></li>
  <li><a href="#section-6.8-real-world-applications" id="toc-section-6.8-real-world-applications" class="nav-link" data-scroll-target="#section-6.8-real-world-applications"><span class="header-section-number">7.11</span> Section 6.8: Real-World Applications</a>
  <ul class="collapse">
  <li><a href="#load-balancing-with-randomization" id="toc-load-balancing-with-randomization" class="nav-link" data-scroll-target="#load-balancing-with-randomization"><span class="header-section-number">7.11.1</span> Load Balancing with Randomization</a></li>
  <li><a href="#ab-testing-with-statistical-significance" id="toc-ab-testing-with-statistical-significance" class="nav-link" data-scroll-target="#ab-testing-with-statistical-significance"><span class="header-section-number">7.11.2</span> A/B Testing with Statistical Significance</a></li>
  </ul></li>
  <li><a href="#summary-the-power-of-controlled-randomness" id="toc-summary-the-power-of-controlled-randomness" class="nav-link" data-scroll-target="#summary-the-power-of-controlled-randomness"><span class="header-section-number">7.12</span> Summary: The Power of Controlled Randomness</a>
  <ul class="collapse">
  <li><a href="#key-takeaways" id="toc-key-takeaways" class="nav-link" data-scroll-target="#key-takeaways"><span class="header-section-number">7.12.1</span> Key Takeaways</a></li>
  <li><a href="#when-to-use-randomization" id="toc-when-to-use-randomization" class="nav-link" data-scroll-target="#when-to-use-randomization"><span class="header-section-number">7.12.2</span> When to Use Randomization</a></li>
  <li><a href="#final-thought" id="toc-final-thought" class="nav-link" data-scroll-target="#final-thought"><span class="header-section-number">7.12.3</span> Final Thought</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/01-introduction.html">Core Concepts</a></li><li class="breadcrumb-item"><a href="../chapters/06-Randomized-Algorithms.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Chapter 6: Randomized Algorithms - The Power of Controlled Chaos</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Chapter 6: Randomized Algorithms - The Power of Controlled Chaos</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="when-dice-make-better-decisions" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="when-dice-make-better-decisions"><span class="header-section-number">7.1</span> When Dice Make Better Decisions</h2>
<p><em>‚ÄúGod does not play dice with the universe.‚Äù - Einstein</em><br>
<em>‚ÄúBut randomized algorithms do, and they win.‚Äù - Computer Scientists</em></p>
<hr>
</section>
<section id="introduction-embracing-uncertainty-for-certainty" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="introduction-embracing-uncertainty-for-certainty"><span class="header-section-number">7.2</span> Introduction: Embracing Uncertainty for Certainty</h2>
<p>Imagine you‚Äôre at a party with 30 people. What are the odds that two people share the same birthday?</p>
<p>Your intuition might say it‚Äôs unlikely‚Äîafter all, there are 365 days in a year. But mathematics says otherwise: the probability is over 70%! This counterintuitive result, known as the <strong>Birthday Paradox</strong>, illustrates a fundamental principle of randomized algorithms: <strong>probability often defies intuition, and we can exploit this to our advantage</strong>.</p>
<section id="the-paradox-of-random-success" class="level3" data-number="7.2.1">
<h3 data-number="7.2.1" class="anchored" data-anchor-id="the-paradox-of-random-success"><span class="header-section-number">7.2.1</span> The Paradox of Random Success</h3>
<p>Consider this seemingly impossible scenario: - You need to check if two files are identical - The files are on different continents (network latency is huge) - The files are massive (terabytes)</p>
<p><strong>Deterministic approach</strong>: Send entire file across network‚Äîtakes hours, costs fortune.</p>
<p><strong>Randomized approach</strong>: 1. Pick 100 random positions 2. Compare bytes at those positions 3. If all match, declare ‚Äúprobably identical‚Äù with 99.999‚Ä¶% confidence 4. Takes seconds, costs pennies!</p>
<p>This is the magic of randomized algorithms: <strong>trading absolute certainty for near-certainty with massive efficiency gains</strong>.</p>
</section>
<section id="why-randomness" class="level3" data-number="7.2.2">
<h3 data-number="7.2.2" class="anchored" data-anchor-id="why-randomness"><span class="header-section-number">7.2.2</span> Why Randomness?</h3>
<p>Randomized algorithms offer unique advantages:</p>
<ol type="1">
<li><strong>Simplicity</strong>: Often much simpler than deterministic alternatives</li>
<li><strong>Speed</strong>: Expected running time frequently beats worst-case deterministic</li>
<li><strong>Robustness</strong>: No pathological inputs (adversary can‚Äôt predict random choices)</li>
<li><strong>Impossibility Breaking</strong>: Solve problems with no deterministic solution</li>
<li><strong>Load Balancing</strong>: Natural distribution of work</li>
<li><strong>Symmetry Breaking</strong>: Resolve ties and deadlocks elegantly</li>
</ol>
</section>
<section id="real-world-impact" class="level3" data-number="7.2.3">
<h3 data-number="7.2.3" class="anchored" data-anchor-id="real-world-impact"><span class="header-section-number">7.2.3</span> Real-World Impact</h3>
<p>Randomized algorithms power critical systems:</p>
<p><strong>Internet Security</strong>: - <strong>RSA Encryption</strong>: Randomized primality testing - <strong>TLS/SSL</strong>: Random nonces prevent replay attacks - <strong>Password Hashing</strong>: Random salts defeat rainbow tables</p>
<p><strong>Big Data</strong>: - <strong>MinHash</strong>: Find similar documents in billions - <strong>HyperLogLog</strong>: Count distinct elements in streams - <strong>Bloom Filters</strong>: Space-efficient membership testing</p>
<p><strong>Machine Learning</strong>: - <strong>Stochastic Gradient Descent</strong>: Random sampling speeds training - <strong>Random Forests</strong>: Random feature selection improves accuracy - <strong>Monte Carlo Tree Search</strong>: Game-playing AI (AlphaGo)</p>
<p><strong>Distributed Systems</strong>: - <strong>Consistent Hashing</strong>: Random node placement - <strong>Gossip Protocols</strong>: Random peer selection - <strong>Byzantine Consensus</strong>: Random leader election</p>
</section>
<section id="chapter-roadmap" class="level3" data-number="7.2.4">
<h3 data-number="7.2.4" class="anchored" data-anchor-id="chapter-roadmap"><span class="header-section-number">7.2.4</span> Chapter Roadmap</h3>
<p>We‚Äôll master the art and science of randomized algorithms:</p>
<ul>
<li><strong>Section 6.1</strong>: Fundamentals - Las Vegas vs Monte Carlo algorithms</li>
<li><strong>Section 6.2</strong>: Randomized QuickSort and selection algorithms</li>
<li><strong>Section 6.3</strong>: Probabilistic analysis and concentration inequalities</li>
<li><strong>Section 6.4</strong>: Hash functions and fingerprinting techniques</li>
<li><strong>Section 6.5</strong>: Advanced algorithms - MinCut, primality testing</li>
<li><strong>Section 6.6</strong>: Streaming algorithms and sketching</li>
<li><strong>Section 6.7</strong>: Project - Comprehensive randomized algorithm library</li>
</ul>
<hr>
</section>
</section>
<section id="section-6.1-fundamentals-of-randomized-algorithms" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="section-6.1-fundamentals-of-randomized-algorithms"><span class="header-section-number">7.3</span> Section 6.1: Fundamentals of Randomized Algorithms</h2>
<section id="understanding-randomness-in-computing" class="level3" data-number="7.3.1">
<h3 data-number="7.3.1" class="anchored" data-anchor-id="understanding-randomness-in-computing"><span class="header-section-number">7.3.1</span> Understanding Randomness in Computing</h3>
<p>Before we dive into specific algorithms, let‚Äôs understand what we mean by ‚Äúrandomized algorithms‚Äù and why adding randomness‚Äîseemingly making things less predictable‚Äîactually makes algorithms better.</p>
<section id="a-simple-example-finding-your-friend-in-a-crowd" class="level4" data-number="7.3.1.1">
<h4 data-number="7.3.1.1" class="anchored" data-anchor-id="a-simple-example-finding-your-friend-in-a-crowd"><span class="header-section-number">7.3.1.1</span> A Simple Example: Finding Your Friend in a Crowd</h4>
<p>Imagine you‚Äôre looking for your friend in a massive stadium with 50,000 people. You have two strategies:</p>
<p><strong>Strategy 1 (Deterministic):</strong> Start at Section A, Row 1, Seat 1. Check every seat in order. - <strong>Worst case:</strong> Your friend is in the last seat‚Äîyou check all 50,000 seats! - <strong>Problem:</strong> If someone knew your strategy, they could always put your friend in the worst spot.</p>
<p><strong>Strategy 2 (Randomized):</strong> Pick random sections and rows to check. - <strong>Expected case:</strong> On average, you‚Äôll find them after checking half the seats (25,000). - <strong>Key insight:</strong> No one can force a worst case‚Äîevery arrangement is equally likely to be good or bad!</p>
<p>This is the power of randomization: <strong>it eliminates predictable worst cases</strong>.</p>
</section>
</section>
<section id="two-flavors-of-randomized-algorithms" class="level3" data-number="7.3.2">
<h3 data-number="7.3.2" class="anchored" data-anchor-id="two-flavors-of-randomized-algorithms"><span class="header-section-number">7.3.2</span> Two Flavors of Randomized Algorithms</h3>
<p>Randomized algorithms come in two main types, named after famous gambling cities (appropriately enough!):</p>
<section id="las-vegas-algorithms-always-right-sometimes-slow" class="level4" data-number="7.3.2.1">
<h4 data-number="7.3.2.1" class="anchored" data-anchor-id="las-vegas-algorithms-always-right-sometimes-slow"><span class="header-section-number">7.3.2.1</span> Las Vegas Algorithms: ‚ÄúAlways Right, Sometimes Slow‚Äù</h4>
<p><strong>The Guarantee:</strong> These algorithms ALWAYS give you the correct answer, but the time they take is random.</p>
<p><strong>Real-Life Analogy:</strong> Think of shuffling a deck of cards to find all the aces. You‚Äôll always find all four aces eventually (correctness guaranteed), but sometimes you‚Äôll get lucky and find them quickly, other times it takes longer.</p>
<p><strong>Characteristics:</strong> - ‚úÖ Output is always correct - ‚è±Ô∏è Running time varies (we analyze expected/average time) - üîç Can verify the answer is correct - üìä No error probability‚Äîonly time varies</p>
<p><strong>Example - Finding a Restaurant:</strong> You‚Äôre in a new city looking for a good restaurant. You randomly walk around until you find one with good reviews. You‚Äôll definitely find one (correct), but it might take 5 minutes or 50 minutes (random time).</p>
</section>
<section id="monte-carlo-algorithms-always-fast-usually-right" class="level4" data-number="7.3.2.2">
<h4 data-number="7.3.2.2" class="anchored" data-anchor-id="monte-carlo-algorithms-always-fast-usually-right"><span class="header-section-number">7.3.2.2</span> Monte Carlo Algorithms: ‚ÄúAlways Fast, Usually Right‚Äù</h4>
<p><strong>The Guarantee:</strong> These algorithms ALWAYS finish quickly, but might occasionally give a wrong answer.</p>
<p><strong>Real-Life Analogy:</strong> A medical test that takes exactly 5 minutes. It correctly identifies illness 99% of the time, but has a 1% false positive/negative rate. The test always takes 5 minutes (fixed time), but might be wrong (small error probability).</p>
<p><strong>Characteristics:</strong> - ‚è±Ô∏è Running time is fixed and predictable - ‚ö†Ô∏è Might give wrong answer (with small probability) - ‚ùì Cannot always verify if answer is correct - üìä Has bounded error probability</p>
<p><strong>Example - Opinion Polling:</strong> Instead of asking all 300 million Americans their opinion (correct but slow), you ask 1,000 random people (fast but might be slightly wrong). The poll takes exactly one day (fixed time) but has a 3% margin of error (probability of being off).</p>
</section>
</section>
<section id="why-do-we-accept-uncertainty" class="level3" data-number="7.3.3">
<h3 data-number="7.3.3" class="anchored" data-anchor-id="why-do-we-accept-uncertainty"><span class="header-section-number">7.3.3</span> Why Do We Accept Uncertainty?</h3>
<p>You might wonder: ‚ÄúWhy would I want an algorithm that might be wrong?‚Äù Here‚Äôs why:</p>
<ol type="1">
<li><p><strong>Massive Speed Improvements:</strong> A Monte Carlo algorithm might run in 1 second with 99.9999% accuracy, while a deterministic algorithm takes 1 hour for 100% accuracy.</p></li>
<li><p><strong>Good Enough is Perfect:</strong> If a medical test is 99.99% accurate, is it worth waiting 10x longer for 100%?</p></li>
<li><p><strong>We Can Boost Accuracy:</strong> Run the algorithm multiple times! If error rate is 1%, running it 10 times gives error rate of 0.1^10 = 0.0000000001%!</p></li>
<li><p><strong>Real World is Uncertain:</strong> Your computer already has random hardware failures (cosmic rays flip bits!). If hardware has a 10^-15 error rate, why demand 0% error from algorithms?</p></li>
</ol>
<hr>
</section>
</section>
<section id="section-6.2-randomized-quicksort---learning-from-card-shuffling" class="level2" data-number="7.4">
<h2 data-number="7.4" class="anchored" data-anchor-id="section-6.2-randomized-quicksort---learning-from-card-shuffling"><span class="header-section-number">7.4</span> Section 6.2: Randomized QuickSort - Learning from Card Shuffling</h2>
<section id="the-problem-with-regular-quicksort" class="level3" data-number="7.4.1">
<h3 data-number="7.4.1" class="anchored" data-anchor-id="the-problem-with-regular-quicksort"><span class="header-section-number">7.4.1</span> The Problem with Regular QuickSort</h3>
<p>Before we see how randomization helps, let‚Äôs understand the problem it solves.</p>
<section id="regular-quicksort-the-predictable-approach" class="level4" data-number="7.4.1.1">
<h4 data-number="7.4.1.1" class="anchored" data-anchor-id="regular-quicksort-the-predictable-approach"><span class="header-section-number">7.4.1.1</span> Regular QuickSort: The Predictable Approach</h4>
<p>Imagine you‚Äôre organizing a deck of 52 cards by number. Regular QuickSort works like this:</p>
<ol type="1">
<li><strong>Pick the first card as the ‚Äúpivot‚Äù</strong> (say it‚Äôs a 7)</li>
<li><strong>Divide into two piles:</strong>
<ul>
<li>Left pile: All cards less than 7</li>
<li>Right pile: All cards greater than 7</li>
</ul></li>
<li><strong>Recursively sort each pile</strong></li>
<li><strong>Combine:</strong> Left pile + 7 + Right pile = Sorted!</li>
</ol>
<p><strong>The Fatal Flaw:</strong> What if the cards are already sorted? - First pivot: Ace (1) ‚Üí Left pile: empty, Right pile: 51 cards - Next pivot: 2 ‚Üí Left pile: empty, Right pile: 50 cards - And so on‚Ä¶</p>
<p>We get the most unbalanced splits possible! This is like trying to balance a see-saw with all the kids on one side.</p>
<p><strong>Time complexity:</strong> O(n¬≤) - absolutely terrible for large datasets!</p>
</section>
</section>
<section id="enter-randomized-quicksort-the-magic-of-random-pivots" class="level3" data-number="7.4.2">
<h3 data-number="7.4.2" class="anchored" data-anchor-id="enter-randomized-quicksort-the-magic-of-random-pivots"><span class="header-section-number">7.4.2</span> Enter Randomized QuickSort: The Magic of Random Pivots</h3>
<p>The solution is beautifully simple: <strong>pick a random card as the pivot!</strong></p>
<section id="why-random-pivots-save-the-day" class="level4" data-number="7.4.2.1">
<h4 data-number="7.4.2.1" class="anchored" data-anchor-id="why-random-pivots-save-the-day"><span class="header-section-number">7.4.2.1</span> Why Random Pivots Save the Day</h4>
<p>Let‚Äôs understand this with an analogy:</p>
<p><strong>Scenario:</strong> You‚Äôre dividing 100 students into two groups for a game.</p>
<p><strong>Bad approach (deterministic):</strong> Always pick the shortest student as the divider. - If students line up by height (worst case), you get groups of 0 and 99!</p>
<p><strong>Good approach (randomized):</strong> Pick a random student as the divider. - Sometimes you get 20 vs 80 (not great) - Sometimes you get 45 vs 55 (pretty good!)<br>
- Sometimes you get 50 vs 50 (perfect!) - <strong>On average:</strong> You get reasonably balanced groups</p>
<p><strong>The Mathematical Magic:</strong> - Probability of picking a ‚Äúgood‚Äù pivot (between 25th and 75th percentile): 50% - With good pivots, we get balanced splits - Expected number of times we split: O(log n) - Total expected work: O(n log n) - MUCH better!</p>
</section>
<section id="step-by-step-example" class="level4" data-number="7.4.2.2">
<h4 data-number="7.4.2.2" class="anchored" data-anchor-id="step-by-step-example"><span class="header-section-number">7.4.2.2</span> Step-by-Step Example</h4>
<p>Let‚Äôs sort the array [3, 7, 1, 9, 2, 5] using randomized QuickSort:</p>
<p><strong>Step 1:</strong> Pick random pivot - Randomly choose position 3 ‚Üí pivot = 9 - Partition: [3, 7, 1, 2, 5] | 9 | [ ] - Left has 5 elements, right has 0 (not great, but okay)</p>
<p><strong>Step 2:</strong> Recursively sort left [3, 7, 1, 2, 5] - Random pivot: position 2 ‚Üí pivot = 7 - Partition: [3, 1, 2, 5] | 7 | [ ]</p>
<p><strong>Step 3:</strong> Sort [3, 1, 2, 5] - Random pivot: position 1 ‚Üí pivot = 3 - Partition: [1, 2] | 3 | [5] - Nice balanced split!</p>
<p><strong>Step 4:</strong> Sort [1, 2] - Random pivot: 2 - Partition: [1] | 2 | [ ]</p>
<p><strong>Final result:</strong> [1, 2, 3, 5, 7, 9]</p>
<p>Notice how even with one bad split (step 1), we still got good overall performance because other splits were balanced!</p>
</section>
<section id="the-implementation" class="level4" data-number="7.4.2.3">
<h4 data-number="7.4.2.3" class="anchored" data-anchor-id="the-implementation"><span class="header-section-number">7.4.2.3</span> The Implementation</h4>
<p>Now that we understand WHY it works, here‚Äôs the code:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> randomized_quicksort(arr):</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Las Vegas algorithm: Always sorts correctly.</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Expected O(n log n), worst case O(n¬≤) but rare.</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(arr) <span class="op">&lt;=</span> <span class="dv">1</span>:</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> arr</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The KEY INNOVATION: Pick a random pivot instead of first/last element</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    pivot <span class="op">=</span> arr[random.randint(<span class="dv">0</span>, <span class="bu">len</span>(arr) <span class="op">-</span> <span class="dv">1</span>)]</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Partition around pivot (same as regular QuickSort)</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    left <span class="op">=</span> [x <span class="cf">for</span> x <span class="kw">in</span> arr <span class="cf">if</span> x <span class="op">&lt;</span> pivot]</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    middle <span class="op">=</span> [x <span class="cf">for</span> x <span class="kw">in</span> arr <span class="cf">if</span> x <span class="op">==</span> pivot]  <span class="co"># Handle duplicates</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    right <span class="op">=</span> [x <span class="cf">for</span> x <span class="kw">in</span> arr <span class="cf">if</span> x <span class="op">&gt;</span> pivot]</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Recursively sort and combine</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> randomized_quicksort(left) <span class="op">+</span> middle <span class="op">+</span> randomized_quicksort(right)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="why-this-simple-change-is-so-powerful" class="level4" data-number="7.4.2.4">
<h4 data-number="7.4.2.4" class="anchored" data-anchor-id="why-this-simple-change-is-so-powerful"><span class="header-section-number">7.4.2.4</span> Why This Simple Change Is So Powerful</h4>
<p><strong>Mathematical Insight:</strong> - With n elements, there are n possible pivots - A ‚Äúgood‚Äù pivot lands between the 25th and 75th percentile - Probability of good pivot = 50% (half the elements are good!) - Expected depth of recursion ‚âà 2 log‚ÇÇ n (since we get good pivots half the time) - Total expected comparisons ‚âà 2n ln n ‚âà 1.39n log‚ÇÇ n</p>
<p><strong>Practical Impact:</strong> - Sorting 1 million items: - Worst case (deterministic): 1 trillion comparisons - Expected (randomized): 20 million comparisons - That‚Äôs 50,000 times faster!</p>
</section>
</section>
<section id="monte-carlo-algorithms-the-speed-accuracy-tradeoff" class="level3" data-number="7.4.3">
<h3 data-number="7.4.3" class="anchored" data-anchor-id="monte-carlo-algorithms-the-speed-accuracy-tradeoff"><span class="header-section-number">7.4.3</span> Monte Carlo Algorithms: The Speed-Accuracy Tradeoff</h3>
<p>Now let‚Äôs explore Monte Carlo algorithms, which trade a tiny bit of accuracy for massive speed gains.</p>
<section id="primality-testing-is-this-number-prime" class="level4" data-number="7.4.3.1">
<h4 data-number="7.4.3.1" class="anchored" data-anchor-id="primality-testing-is-this-number-prime"><span class="header-section-number">7.4.3.1</span> Primality Testing: Is This Number Prime?</h4>
<p><strong>The Challenge:</strong> Checking if a huge number (say, 100 digits) is prime.</p>
<p><strong>Naive Approach:</strong> Try dividing by all numbers up to ‚àön - For a 100-digit number, that‚Äôs 10^50 divisions - Would take longer than the age of the universe!</p>
<p><strong>Monte Carlo Solution:</strong> Miller-Rabin Test - Takes only ~1000 operations - Might incorrectly say a composite number is prime - BUT: Error probability &lt; 0.0000000001% - Good enough for cryptography!</p>
</section>
<section id="how-miller-rabin-works-intuitive-explanation" class="level4" data-number="7.4.3.2">
<h4 data-number="7.4.3.2" class="anchored" data-anchor-id="how-miller-rabin-works-intuitive-explanation"><span class="header-section-number">7.4.3.2</span> How Miller-Rabin Works (Intuitive Explanation)</h4>
<p>Think of it like a ‚Äúprime number detector‚Äù test:</p>
<ol type="1">
<li><p><strong>The Fermat Test Foundation:</strong></p>
<ul>
<li>If n is prime, then for any a: a^(n-1) ‚â° 1 (mod n)</li>
<li>This is like saying: ‚ÄúPrime numbers have a special mathematical fingerprint‚Äù</li>
</ul></li>
<li><p><strong>The Problem:</strong> Some composite numbers (liars) also pass this test!</p></li>
<li><p><strong>The Miller-Rabin Improvement:</strong></p>
<ul>
<li>Uses a more sophisticated test that catches most liars</li>
<li>Tests multiple random values</li>
<li>Each test catches at least 75% of liars</li>
<li>After k tests, probability of being fooled ‚â§ (1/4)^k</li>
</ul></li>
</ol>
<p><strong>Analogy:</strong> It‚Äôs like having a counterfeit bill detector: - One test might miss 25% of fakes - Two tests miss only 6.25% of fakes<br>
- Ten tests miss only 0.0000001% of fakes - Good enough for practical use!</p>
<p>Let‚Äôs implement this powerful algorithm:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> miller_rabin_primality(n, k<span class="op">=</span><span class="dv">10</span>):</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Monte Carlo algorithm: Tests if n is prime.</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Error probability ‚â§ (1/4)^k</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">    With k=10: Error ‚â§ 0.0000001%</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co">        n: Number to test</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co">        k: Number of rounds (higher = more accurate)</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co">        False if definitely composite</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co">        True if probably prime</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Handle simple cases</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> n <span class="op">&lt;</span> <span class="dv">2</span>:</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> n <span class="op">==</span> <span class="dv">2</span> <span class="kw">or</span> n <span class="op">==</span> <span class="dv">3</span>:</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">True</span>  <span class="co"># 2 and 3 are prime</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> n <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span>  <span class="co"># Even numbers (except 2) aren't prime</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Express n-1 as 2^r * d (where d is odd)</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># This is the mathematical setup for the test</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>    r, d <span class="op">=</span> <span class="dv">0</span>, n <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> d <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>        r <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>        d <span class="op">//=</span> <span class="dv">2</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Run k rounds of testing</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> random</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(k):</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Pick a random "witness" number</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>        a <span class="op">=</span> random.randrange(<span class="dv">2</span>, n <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Compute a^d mod n</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> <span class="bu">pow</span>(a, d, n)</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Check if this witness proves n is composite</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> x <span class="op">==</span> <span class="dv">1</span> <span class="kw">or</span> x <span class="op">==</span> n <span class="op">-</span> <span class="dv">1</span>:</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span>  <span class="co"># This witness doesn't prove anything</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Square x repeatedly (r-1 times)</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(r <span class="op">-</span> <span class="dv">1</span>):</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>            x <span class="op">=</span> <span class="bu">pow</span>(x, <span class="dv">2</span>, n)</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> x <span class="op">==</span> n <span class="op">-</span> <span class="dv">1</span>:</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span>  <span class="co"># This witness doesn't prove composite</span></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>            <span class="co"># If we never got n-1, then n is definitely composite</span></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Passed all tests - probably prime!</span></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">True</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="understanding-probability-in-randomized-algorithms" class="level3" data-number="7.4.4">
<h3 data-number="7.4.4" class="anchored" data-anchor-id="understanding-probability-in-randomized-algorithms"><span class="header-section-number">7.4.4</span> Understanding Probability in Randomized Algorithms</h3>
</section>
<section id="understanding-probability-in-randomized-algorithms-1" class="level3" data-number="7.4.5">
<h3 data-number="7.4.5" class="anchored" data-anchor-id="understanding-probability-in-randomized-algorithms-1"><span class="header-section-number">7.4.5</span> Understanding Probability in Randomized Algorithms</h3>
<p>Before we go further, let‚Äôs understand key probability concepts using everyday examples.</p>
<section id="expected-value-your-average-outcome" class="level4" data-number="7.4.5.1">
<h4 data-number="7.4.5.1" class="anchored" data-anchor-id="expected-value-your-average-outcome"><span class="header-section-number">7.4.5.1</span> Expected Value: Your ‚ÄúAverage‚Äù Outcome</h4>
<p><strong>Concept:</strong> Expected value is what you‚Äôd get ‚Äúon average‚Äù if you repeated something many times.</p>
<p><strong>Real-World Example - Rolling a Die:</strong> - Possible outcomes: 1, 2, 3, 4, 5, 6 - Each has probability 1/6 - Expected value = 1√ó(1/6) + 2√ó(1/6) + 3√ó(1/6) + 4√ó(1/6) + 5√ó(1/6) + 6√ó(1/6) = 3.5</p>
<p>You can‚Äôt actually roll 3.5, but if you roll many times and average, you‚Äôll get close to 3.5!</p>
<p><strong>Algorithm Example - Searching:</strong> - Linear search in array of n elements - Best case: 1 comparison (element is first) - Worst case: n comparisons (element is last) - Expected case: (n+1)/2 comparisons (on average, halfway through)</p>
</section>
<section id="the-birthday-paradox-when-intuition-fails" class="level4" data-number="7.4.5.2">
<h4 data-number="7.4.5.2" class="anchored" data-anchor-id="the-birthday-paradox-when-intuition-fails"><span class="header-section-number">7.4.5.2</span> The Birthday Paradox: When Intuition Fails</h4>
<p>This famous paradox shows why we need math, not intuition, for probabilities.</p>
<p><strong>The Question:</strong> In a room of 23 people, what‚Äôs the probability that two share a birthday?</p>
<p><strong>Intuitive (Wrong) Answer:</strong> - ‚Äú23 out of 365 days ‚âà 6%? Very unlikely!‚Äù</p>
<p><strong>Actual (Surprising) Answer:</strong> - Probability &gt; 50%! - With 50 people: &gt; 97% - With 100 people: &gt; 99.99999%</p>
<p><strong>Why Our Intuition Is Wrong:</strong> We think about one person matching another specific person. But we should think about ANY pair matching! - With 23 people, there are 253 possible pairs - Each pair has a small chance of matching - But with 253 chances, it adds up quickly!</p>
<p><strong>Algorithm Application - Hash Collisions:</strong> This same principle explains why hash tables have collisions sooner than expected!</p>
<p>Let‚Äôs see this in action:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> birthday_paradox_simulation(n_people<span class="op">=</span><span class="dv">23</span>, n_days<span class="op">=</span><span class="dv">365</span>, trials<span class="op">=</span><span class="dv">10000</span>):</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Simulate the birthday paradox to verify probability.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">    This demonstrates how randomized events can be analyzed.</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> random</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    collisions <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(trials):</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>        birthdays <span class="op">=</span> []</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(n_people):</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>            birthday <span class="op">=</span> random.randint(<span class="dv">1</span>, n_days)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> birthday <span class="kw">in</span> birthdays:</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>                collisions <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span>  <span class="co"># Found a match!</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>            birthdays.append(birthday)</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    probability <span class="op">=</span> collisions <span class="op">/</span> trials</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"With </span><span class="sc">{</span>n_people<span class="sc">}</span><span class="ss"> people:"</span>)</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Simulated probability of shared birthday: </span><span class="sc">{</span>probability<span class="sc">:.2%}</span><span class="ss">"</span>)</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Theoretical probability: ~50.7%"</span>)</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> probability</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Try it out!</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a><span class="co"># birthday_paradox_simulation(23)  # Should be close to 50%</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a><span class="co"># birthday_paradox_simulation(50)  # Should be close to 97%</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="amplification-making-algorithms-more-reliable" class="level4" data-number="7.4.5.3">
<h4 data-number="7.4.5.3" class="anchored" data-anchor-id="amplification-making-algorithms-more-reliable"><span class="header-section-number">7.4.5.3</span> Amplification: Making Algorithms More Reliable</h4>
<p><strong>The Problem:</strong> Your Monte Carlo algorithm is 90% accurate. Not good enough?</p>
<p><strong>The Solution:</strong> Run it multiple times and vote!</p>
<p><strong>Analogy - Medical Testing:</strong> - One test: 90% accurate - Two tests agreeing: 99% accurate - Three tests agreeing: 99.9% accurate</p>
<p><strong>How It Works Mathematically:</strong> If error probability = p, and we run k independent trials: - Taking majority vote - Error probability ‚â§ p^(k/2) (approximately)</p>
<p><strong>Example:</strong></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> amplify_accuracy(monte_carlo_func, input_data, desired_accuracy<span class="op">=</span><span class="fl">0.99</span>):</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Boost accuracy by running algorithm multiple times.</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">    This is like getting multiple medical opinions!</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate how many runs we need</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    single_accuracy <span class="op">=</span> <span class="fl">0.9</span>  <span class="co"># Assume 90% accurate</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    single_error <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> single_accuracy</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># To get 99% accuracy, we need error &lt; 0.01</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># With majority voting: error ‚âà single_error^(k/2)</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># So: 0.01 ‚â• 0.1^(k/2)</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Therefore: k ‚â• 2 * log(0.01) / log(0.1) ‚âà 4</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> math</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    k <span class="op">=</span> math.ceil(<span class="dv">2</span> <span class="op">*</span> math.log(<span class="dv">1</span> <span class="op">-</span> desired_accuracy) <span class="op">/</span> math.log(single_error))</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Run k times and take majority</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> []</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(k):</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>        results.append(monte_carlo_func(input_data))</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return most common result</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> collections <span class="im">import</span> Counter</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    most_common <span class="op">=</span> Counter(results).most_common(<span class="dv">1</span>)[<span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> most_common</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<hr>
</section>
</section>
</section>
<section id="section-6.3-randomized-selection---finding-needles-in-haystacks" class="level2" data-number="7.5">
<h2 data-number="7.5" class="anchored" data-anchor-id="section-6.3-randomized-selection---finding-needles-in-haystacks"><span class="header-section-number">7.5</span> Section 6.3: Randomized Selection - Finding Needles in Haystacks</h2>
<section id="the-selection-problem" class="level3" data-number="7.5.1">
<h3 data-number="7.5.1" class="anchored" data-anchor-id="the-selection-problem"><span class="header-section-number">7.5.1</span> The Selection Problem</h3>
<p><strong>Goal:</strong> Find the kth smallest element in an unsorted array.</p>
<p><strong>Examples:</strong> - Find the median (k = n/2) - Find the 90th percentile (k = 0.9n) - Find the third smallest (k = 3)</p>
</section>
<section id="the-naive-approach" class="level3" data-number="7.5.2">
<h3 data-number="7.5.2" class="anchored" data-anchor-id="the-naive-approach"><span class="header-section-number">7.5.2</span> The Naive Approach</h3>
<p><strong>Method 1: Sort then Select</strong> - Sort the entire array: O(n log n) - Return element at position k: O(1) - Total: O(n log n)</p>
<p><strong>Problem:</strong> We‚Äôre doing too much work! We sort everything when we only need one element.</p>
<p><strong>Analogy:</strong> It‚Äôs like organizing your entire bookshelf alphabetically just to find the 10th book. Wasteful!</p>
</section>
<section id="quickselect-the-randomized-solution" class="level3" data-number="7.5.3">
<h3 data-number="7.5.3" class="anchored" data-anchor-id="quickselect-the-randomized-solution"><span class="header-section-number">7.5.3</span> QuickSelect: The Randomized Solution</h3>
<p><strong>Key Insight:</strong> We can use QuickSort‚Äôs partitioning idea but only recurse on ONE side!</p>
<section id="how-quickselect-works" class="level4" data-number="7.5.3.1">
<h4 data-number="7.5.3.1" class="anchored" data-anchor-id="how-quickselect-works"><span class="header-section-number">7.5.3.1</span> How QuickSelect Works</h4>
<p>Imagine finding the 30th tallest person in a group of 100:</p>
<ol type="1">
<li><p><strong>Pick a random person as ‚Äúpivot‚Äù</strong> (say they‚Äôre 5‚Äô10‚Äù)</p></li>
<li><p><strong>Divide into two groups:</strong></p>
<ul>
<li>Shorter than 5‚Äô10‚Äù: 45 people</li>
<li>Taller than 5‚Äô10‚Äù: 54 people</li>
</ul></li>
<li><p><strong>Determine which group to search:</strong></p>
<ul>
<li>We want the 30th tallest</li>
<li>There are 54 people taller than pivot</li>
<li>So the 30th tallest is in the ‚Äútaller‚Äù group</li>
<li>It‚Äôs the 30th person in that group</li>
</ul></li>
<li><p><strong>Recursively search just that group</strong></p>
<ul>
<li>We‚Äôve eliminated 46 people from consideration!</li>
</ul></li>
<li><p><strong>Keep going until we find our target</strong></p></li>
</ol>
</section>
<section id="why-its-fast" class="level4" data-number="7.5.3.2">
<h4 data-number="7.5.3.2" class="anchored" data-anchor-id="why-its-fast"><span class="header-section-number">7.5.3.2</span> Why It‚Äôs Fast</h4>
<ul>
<li>Each partition cuts the problem roughly in half (on average)</li>
<li>We only recurse on one side (unlike QuickSort which does both)</li>
<li>Expected comparisons: n + n/2 + n/4 + ‚Ä¶ = 2n = O(n)</li>
</ul>
<p>That‚Äôs linear time! Much better than O(n log n) for sorting.</p>
</section>
<section id="the-implementation-1" class="level4" data-number="7.5.3.3">
<h4 data-number="7.5.3.3" class="anchored" data-anchor-id="the-implementation-1"><span class="header-section-number">7.5.3.3</span> The Implementation</h4>
<div class="sourceCode" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> quickselect(arr, k):</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Find the kth smallest element (0-indexed).</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Las Vegas algorithm: Always returns correct answer.</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co">    Expected time: O(n)</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co">    Worst case: O(n¬≤) but very rare with random pivots</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co">    Example:</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co">        arr = [3, 7, 1, 9, 2, 5]</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co">        quickselect(arr, 2) returns 3 (the 3rd smallest element)</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(arr) <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> arr[<span class="dv">0</span>]</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Random pivot is the key!</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    pivot <span class="op">=</span> arr[random.randint(<span class="dv">0</span>, <span class="bu">len</span>(arr) <span class="op">-</span> <span class="dv">1</span>)]</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Partition into three groups</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    smaller <span class="op">=</span> [x <span class="cf">for</span> x <span class="kw">in</span> arr <span class="cf">if</span> x <span class="op">&lt;</span> pivot]</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    equal <span class="op">=</span> [x <span class="cf">for</span> x <span class="kw">in</span> arr <span class="cf">if</span> x <span class="op">==</span> pivot]</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    larger <span class="op">=</span> [x <span class="cf">for</span> x <span class="kw">in</span> arr <span class="cf">if</span> x <span class="op">&gt;</span> pivot]</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Determine which group contains our target</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> k <span class="op">&lt;</span> <span class="bu">len</span>(smaller):</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># kth smallest is in the 'smaller' group</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> quickselect(smaller, k)</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> k <span class="op">&lt;</span> <span class="bu">len</span>(smaller) <span class="op">+</span> <span class="bu">len</span>(equal):</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># kth smallest is the pivot</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> pivot</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>        <span class="co"># kth smallest is in the 'larger' group</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Adjust k to be relative to the larger group</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> quickselect(larger, k <span class="op">-</span> <span class="bu">len</span>(smaller) <span class="op">-</span> <span class="bu">len</span>(equal))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="practical-applications-of-quickselect" class="level4" data-number="7.5.3.4">
<h4 data-number="7.5.3.4" class="anchored" data-anchor-id="practical-applications-of-quickselect"><span class="header-section-number">7.5.3.4</span> Practical Applications of QuickSelect</h4>
<ol type="1">
<li><strong>Finding Medians in Data Analysis</strong>
<ul>
<li>Dataset: Customer purchase amounts</li>
<li>Need: Find median purchase (not affected by billionaire outliers)</li>
<li>QuickSelect: O(n) vs Sorting: O(n log n)</li>
</ul></li>
<li><strong>Percentile Calculations</strong>
<ul>
<li>Finding 95th percentile response time in web servers</li>
<li>Identifying top 10% performers without sorting everyone</li>
</ul></li>
<li><strong>Statistical Sampling</strong>
<ul>
<li>Quickly finding quartiles for box plots</li>
<li>Real-time analytics on streaming data</li>
</ul></li>
</ol>
<hr>
</section>
</section>
</section>
<section id="section-6.4-hash-functions-and-randomization" class="level2" data-number="7.6">
<h2 data-number="7.6" class="anchored" data-anchor-id="section-6.4-hash-functions-and-randomization"><span class="header-section-number">7.6</span> Section 6.4: Hash Functions and Randomization</h2>
<section id="understanding-hash-tables-first" class="level3" data-number="7.6.1">
<h3 data-number="7.6.1" class="anchored" data-anchor-id="understanding-hash-tables-first"><span class="header-section-number">7.6.1</span> Understanding Hash Tables First</h3>
<p>Before diving into universal hashing, let‚Äôs understand why randomization helps with hash tables.</p>
<section id="the-hash-table-dream" class="level4" data-number="7.6.1.1">
<h4 data-number="7.6.1.1" class="anchored" data-anchor-id="the-hash-table-dream"><span class="header-section-number">7.6.1.1</span> The Hash Table Dream</h4>
<p>Imagine you‚Äôre building a library catalog system: - <strong>Goal:</strong> Find any book instantly by its ISBN - <strong>Naive approach:</strong> Check every book (slow!) - <strong>Array approach:</strong> Use ISBN as array index (wastes massive space!) - <strong>Hash table approach:</strong> Transform ISBN into small array index</p>
</section>
<section id="the-problem-collisions" class="level4" data-number="7.6.1.2">
<h4 data-number="7.6.1.2" class="anchored" data-anchor-id="the-problem-collisions"><span class="header-section-number">7.6.1.2</span> The Problem: Collisions</h4>
<p><strong>Scenario:</strong> Two different books map to the same shelf location!</p>
<p>This is like two different people having the same locker combination. What do we do?</p>
<p><strong>Deterministic Problem:</strong> If an attacker knows your hash function, they can deliberately cause collisions: - Send 1000 items that all hash to the same bucket - Your O(1) lookup becomes O(n) - disaster!</p>
</section>
</section>
<section id="universal-hashing-randomization-to-the-rescue" class="level3" data-number="7.6.2">
<h3 data-number="7.6.2" class="anchored" data-anchor-id="universal-hashing-randomization-to-the-rescue"><span class="header-section-number">7.6.2</span> Universal Hashing: Randomization to the Rescue</h3>
<p><strong>The Solution:</strong> Pick a random hash function from a family of functions!</p>
<p><strong>Analogy:</strong> - Instead of always using the same locker assignment rule - Randomly choose from 100 different assignment rules - Attacker can‚Äôt predict which rule you‚Äôll use - Can‚Äôt deliberately cause collisions!</p>
<section id="what-makes-a-hash-family-universal" class="level4" data-number="7.6.2.1">
<h4 data-number="7.6.2.1" class="anchored" data-anchor-id="what-makes-a-hash-family-universal"><span class="header-section-number">7.6.2.1</span> What Makes a Hash Family ‚ÄúUniversal‚Äù?</h4>
<p>A family of hash functions is universal if: - For any two different keys x and y - Probability that h(x) = h(y) ‚â§ 1/m - Where m is the table size</p>
<p><strong>In Simple Terms:</strong> The chance of any two items colliding is as small as if we assigned them random locations!</p>
</section>
<section id="the-carter-wegman-construction" class="level4" data-number="7.6.2.2">
<h4 data-number="7.6.2.2" class="anchored" data-anchor-id="the-carter-wegman-construction"><span class="header-section-number">7.6.2.2</span> The Carter-Wegman Construction</h4>
<p>One elegant universal hash family:</p>
<pre><code>h(x) = ((ax + b) mod p) mod m</code></pre>
<p>Where: - p is a prime number larger than your universe - a is randomly chosen from {1, 2, ‚Ä¶, p-1} - b is randomly chosen from {0, 1, ‚Ä¶, p-1} - m is your table size</p>
<p>Let‚Äôs implement this:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> UniversalHashTable:</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Hash table using universal hashing for guaranteed performance.</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">    This prevents adversarial attacks on hash table performance!</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, initial_size<span class="op">=</span><span class="dv">16</span>):</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.size <span class="op">=</span> <span class="va">self</span>._next_prime(initial_size)</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.prime <span class="op">=</span> <span class="va">self</span>._next_prime(<span class="dv">2</span><span class="op">**</span><span class="dv">32</span>)  <span class="co"># Large prime</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Randomly select hash function parameters</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.a <span class="op">=</span> random.randint(<span class="dv">1</span>, <span class="va">self</span>.prime <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.b <span class="op">=</span> random.randint(<span class="dv">0</span>, <span class="va">self</span>.prime <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Initialize empty buckets</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.buckets <span class="op">=</span> [[] <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.size)]</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.num_items <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Selected hash function: h(x) = ((</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>a<span class="sc">}</span><span class="ss">*x + </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>b<span class="sc">}</span><span class="ss">) mod </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>prime<span class="sc">}</span><span class="ss">) mod </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>size<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _next_prime(<span class="va">self</span>, n):</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Find the next prime number &gt;= n."""</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>        <span class="kw">def</span> is_prime(num):</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> num <span class="op">&lt;</span> <span class="dv">2</span>:</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2</span>, <span class="bu">int</span>(num<span class="op">**</span><span class="fl">0.5</span>) <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> num <span class="op">%</span> i <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="kw">not</span> is_prime(n):</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>            n <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> n</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _hash(<span class="va">self</span>, key):</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a><span class="co">        Universal hash function.</span></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a><span class="co">        Probability of collision for any two keys ‚â§ 1/size</span></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Convert key to integer if needed</span></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">isinstance</span>(key, <span class="bu">str</span>):</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>            key <span class="op">=</span> <span class="bu">sum</span>(<span class="bu">ord</span>(c) <span class="op">*</span> (<span class="dv">31</span><span class="op">**</span>i) <span class="cf">for</span> i, c <span class="kw">in</span> <span class="bu">enumerate</span>(key))</span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Apply universal hash function</span></span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> ((<span class="va">self</span>.a <span class="op">*</span> key <span class="op">+</span> <span class="va">self</span>.b) <span class="op">%</span> <span class="va">self</span>.prime) <span class="op">%</span> <span class="va">self</span>.size</span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> insert(<span class="va">self</span>, key, value):</span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Insert key-value pair."""</span></span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>        bucket_index <span class="op">=</span> <span class="va">self</span>._hash(key)</span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>        bucket <span class="op">=</span> <span class="va">self</span>.buckets[bucket_index]</span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Check if key already exists</span></span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, (k, v) <span class="kw">in</span> <span class="bu">enumerate</span>(bucket):</span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> k <span class="op">==</span> key:</span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a>                bucket[i] <span class="op">=</span> (key, value)  <span class="co"># Update</span></span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span></span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add new key-value pair</span></span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a>        bucket.append((key, value))</span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.num_items <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Resize if load factor too high</span></span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.num_items <span class="op">&gt;</span> <span class="va">self</span>.size <span class="op">*</span> <span class="fl">0.75</span>:</span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._resize()</span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get(<span class="va">self</span>, key):</span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Retrieve value for key."""</span></span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a>        bucket_index <span class="op">=</span> <span class="va">self</span>._hash(key)</span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a>        bucket <span class="op">=</span> <span class="va">self</span>.buckets[bucket_index]</span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-74"><a href="#cb7-74" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> k, v <span class="kw">in</span> bucket:</span>
<span id="cb7-75"><a href="#cb7-75" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> k <span class="op">==</span> key:</span>
<span id="cb7-76"><a href="#cb7-76" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> v</span>
<span id="cb7-77"><a href="#cb7-77" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-78"><a href="#cb7-78" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">KeyError</span>(<span class="ss">f"Key '</span><span class="sc">{</span>key<span class="sc">}</span><span class="ss">' not found"</span>)</span>
<span id="cb7-79"><a href="#cb7-79" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-80"><a href="#cb7-80" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _resize(<span class="va">self</span>):</span>
<span id="cb7-81"><a href="#cb7-81" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb7-82"><a href="#cb7-82" aria-hidden="true" tabindex="-1"></a><span class="co">        Resize table and rehash with new random function.</span></span>
<span id="cb7-83"><a href="#cb7-83" aria-hidden="true" tabindex="-1"></a><span class="co">        This maintains the universal hashing guarantee!</span></span>
<span id="cb7-84"><a href="#cb7-84" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb7-85"><a href="#cb7-85" aria-hidden="true" tabindex="-1"></a>        old_buckets <span class="op">=</span> <span class="va">self</span>.buckets</span>
<span id="cb7-86"><a href="#cb7-86" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-87"><a href="#cb7-87" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Double size and pick new hash function</span></span>
<span id="cb7-88"><a href="#cb7-88" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.size <span class="op">=</span> <span class="va">self</span>._next_prime(<span class="va">self</span>.size <span class="op">*</span> <span class="dv">2</span>)</span>
<span id="cb7-89"><a href="#cb7-89" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.a <span class="op">=</span> random.randint(<span class="dv">1</span>, <span class="va">self</span>.prime <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb7-90"><a href="#cb7-90" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.b <span class="op">=</span> random.randint(<span class="dv">0</span>, <span class="va">self</span>.prime <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb7-91"><a href="#cb7-91" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.buckets <span class="op">=</span> [[] <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.size)]</span>
<span id="cb7-92"><a href="#cb7-92" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.num_items <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb7-93"><a href="#cb7-93" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-94"><a href="#cb7-94" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Rehash all items</span></span>
<span id="cb7-95"><a href="#cb7-95" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> bucket <span class="kw">in</span> old_buckets:</span>
<span id="cb7-96"><a href="#cb7-96" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> key, value <span class="kw">in</span> bucket:</span>
<span id="cb7-97"><a href="#cb7-97" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.insert(key, value)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="bloom-filters-space-efficient-membership-testing" class="level3" data-number="7.6.3">
<h3 data-number="7.6.3" class="anchored" data-anchor-id="bloom-filters-space-efficient-membership-testing"><span class="header-section-number">7.6.3</span> Bloom Filters: Space-Efficient Membership Testing</h3>
<section id="the-problem" class="level4" data-number="7.6.3.1">
<h4 data-number="7.6.3.1" class="anchored" data-anchor-id="the-problem"><span class="header-section-number">7.6.3.1</span> The Problem</h4>
<p>You‚Äôre building a web crawler that shouldn‚Äôt visit the same URL twice: - Billions of URLs to track - Storing all URLs in a set would take terabytes of RAM - Need a space-efficient solution</p>
</section>
<section id="the-bloom-filter-solution" class="level4" data-number="7.6.3.2">
<h4 data-number="7.6.3.2" class="anchored" data-anchor-id="the-bloom-filter-solution"><span class="header-section-number">7.6.3.2</span> The Bloom Filter Solution</h4>
<p><strong>Trade-off:</strong> Use WAY less space, but accept small false positive rate.</p>
<p><strong>How it works:</strong> 1. Create a bit array (like a row of light switches) 2. Use multiple hash functions 3. To add item: Turn on bits at positions given by hash functions 4. To check item: See if all corresponding bits are on</p>
<p><strong>The Catch:</strong> - Can have false positives (say item is present when it‚Äôs not) - NEVER has false negatives (if it says item is absent, it definitely is)</p>
<p><strong>Real-World Analogy:</strong> It‚Äôs like a bouncer with a partial guest list: - If your name‚Äôs not on the list, you‚Äôre definitely not invited (no false negatives) - If your name IS on the list, you‚Äôre probably invited (small chance of error)</p>
</section>
<section id="understanding-bloom-filter-parameters" class="level4" data-number="7.6.3.3">
<h4 data-number="7.6.3.3" class="anchored" data-anchor-id="understanding-bloom-filter-parameters"><span class="header-section-number">7.6.3.3</span> Understanding Bloom Filter Parameters</h4>
<p>The math behind optimal Bloom filter parameters: - <strong>m</strong> = number of bits - <strong>n</strong> = expected number of items - <strong>k</strong> = number of hash functions - <strong>p</strong> = false positive probability</p>
<p><strong>Optimal formulas:</strong> - Bits needed: m = -n √ó ln(p) / (ln(2)¬≤) - Hash functions: k = (m/n) √ó ln(2)</p>
<p><strong>Example:</strong> To track 1 million URLs with 1% false positive rate: - Need only 9.6 bits per item = 1.2 MB total! - Compare to storing actual URLs: ~50 bytes per URL = 50 MB - That‚Äôs 40√ó space savings!</p>
<p>Let‚Äôs implement it:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> BloomFilter:</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Space-efficient probabilistic data structure for membership testing.</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co">    Use case: "Have I seen this before?" when storing everything is too expensive.</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, expected_items<span class="op">=</span><span class="dv">1000000</span>, false_positive_rate<span class="op">=</span><span class="fl">0.01</span>):</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="co">        Initialize Bloom filter with optimal parameters.</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="co">        Args:</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="co">            expected_items: How many items you expect to add</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="co">            false_positive_rate: Acceptable error rate (e.g., 0.01 = 1%)</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate optimal size and number of hash functions</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.m <span class="op">=</span> <span class="va">self</span>._optimal_bit_size(expected_items, false_positive_rate)</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.k <span class="op">=</span> <span class="va">self</span>._optimal_hash_count(<span class="va">self</span>.m, expected_items)</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Initialize bit array (using list of booleans for clarity)</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.bits <span class="op">=</span> [<span class="va">False</span>] <span class="op">*</span> <span class="va">self</span>.m</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.items_added <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Bloom Filter initialized:"</span>)</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  Expected items: </span><span class="sc">{</span>expected_items<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  False positive rate: </span><span class="sc">{</span>false_positive_rate<span class="sc">:.1%}</span><span class="ss">"</span>)</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  Bits needed: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>m<span class="sc">:,}</span><span class="ss"> (</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>m<span class="op">/</span><span class="dv">8</span><span class="op">/</span><span class="dv">1024</span><span class="sc">:.1f}</span><span class="ss"> KB)"</span>)</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  Hash functions: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>k<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  Bits per item: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>m<span class="op">/</span>expected_items<span class="sc">:.1f}</span><span class="ss">"</span>)</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _optimal_bit_size(<span class="va">self</span>, n, p):</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a><span class="co">        Calculate optimal number of bits.</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a><span class="co">        Formula: m = -n √ó ln(p) / (ln(2)¬≤)</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">int</span>(<span class="op">-</span>n <span class="op">*</span> math.log(p) <span class="op">/</span> (math.log(<span class="dv">2</span>) <span class="op">**</span> <span class="dv">2</span>))</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _optimal_hash_count(<span class="va">self</span>, m, n):</span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a><span class="co">        Calculate optimal number of hash functions.</span></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a><span class="co">        Formula: k = (m/n) √ó ln(2)</span></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">max</span>(<span class="dv">1</span>, <span class="bu">int</span>(m <span class="op">/</span> n <span class="op">*</span> math.log(<span class="dv">2</span>)))</span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _hash(<span class="va">self</span>, item, seed):</span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a><span class="co">        Generate hash with different seed for each hash function.</span></span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a><span class="co">        In practice, you'd use MurmurHash or similar.</span></span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Simple hash for demonstration</span></span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>        <span class="im">import</span> hashlib</span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>item<span class="sc">}{</span>seed<span class="sc">}</span><span class="ss">"</span>.encode(<span class="st">'utf-8'</span>)</span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>        hash_hex <span class="op">=</span> hashlib.md5(data).hexdigest()</span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">int</span>(hash_hex, <span class="dv">16</span>) <span class="op">%</span> <span class="va">self</span>.m</span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> add(<span class="va">self</span>, item):</span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a><span class="co">        Add item to the filter.</span></span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a><span class="co">        Sets k bits to True.</span></span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.k):</span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a>            bit_index <span class="op">=</span> <span class="va">self</span>._hash(item, i)</span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.bits[bit_index] <span class="op">=</span> <span class="va">True</span></span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.items_added <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> might_contain(<span class="va">self</span>, item):</span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a><span class="co">        Check if item might be in the set.</span></span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns:</span></span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a><span class="co">            True: Item MIGHT be in the set (or false positive)</span></span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a><span class="co">            False: Item is DEFINITELY NOT in the set</span></span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.k):</span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a>            bit_index <span class="op">=</span> <span class="va">self</span>._hash(item, i)</span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.bits[bit_index]:</span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">False</span>  <span class="co"># Definitely not in set</span></span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">True</span>  <span class="co"># Might be in set</span></span>
<span id="cb8-84"><a href="#cb8-84" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-85"><a href="#cb8-85" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> current_false_positive_rate(<span class="va">self</span>):</span>
<span id="cb8-86"><a href="#cb8-86" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb8-87"><a href="#cb8-87" aria-hidden="true" tabindex="-1"></a><span class="co">        Calculate current false positive probability.</span></span>
<span id="cb8-88"><a href="#cb8-88" aria-hidden="true" tabindex="-1"></a><span class="co">        Formula: (1 - e^(-kn/m))^k</span></span>
<span id="cb8-89"><a href="#cb8-89" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb8-90"><a href="#cb8-90" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.items_added <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb8-91"><a href="#cb8-91" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="dv">0</span></span>
<span id="cb8-92"><a href="#cb8-92" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-93"><a href="#cb8-93" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Probability that a bit is still 0</span></span>
<span id="cb8-94"><a href="#cb8-94" aria-hidden="true" tabindex="-1"></a>        prob_zero <span class="op">=</span> math.exp(<span class="op">-</span><span class="va">self</span>.k <span class="op">*</span> <span class="va">self</span>.items_added <span class="op">/</span> <span class="va">self</span>.m)</span>
<span id="cb8-95"><a href="#cb8-95" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-96"><a href="#cb8-96" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Probability of false positive</span></span>
<span id="cb8-97"><a href="#cb8-97" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (<span class="dv">1</span> <span class="op">-</span> prob_zero) <span class="op">**</span> <span class="va">self</span>.k</span>
<span id="cb8-98"><a href="#cb8-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-99"><a href="#cb8-99" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage showing space efficiency</span></span>
<span id="cb8-100"><a href="#cb8-100" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> bloom_filter_demo():</span>
<span id="cb8-101"><a href="#cb8-101" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Demonstrate Bloom filter efficiency."""</span></span>
<span id="cb8-102"><a href="#cb8-102" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-103"><a href="#cb8-103" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Track 10 million URLs with 0.1% false positive rate</span></span>
<span id="cb8-104"><a href="#cb8-104" aria-hidden="true" tabindex="-1"></a>    bloom <span class="op">=</span> BloomFilter(expected_items<span class="op">=</span><span class="dv">10_000_000</span>, false_positive_rate<span class="op">=</span><span class="fl">0.001</span>)</span>
<span id="cb8-105"><a href="#cb8-105" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-106"><a href="#cb8-106" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add some URLs</span></span>
<span id="cb8-107"><a href="#cb8-107" aria-hidden="true" tabindex="-1"></a>    urls_visited <span class="op">=</span> [</span>
<span id="cb8-108"><a href="#cb8-108" aria-hidden="true" tabindex="-1"></a>        <span class="st">"https://example.com"</span>,</span>
<span id="cb8-109"><a href="#cb8-109" aria-hidden="true" tabindex="-1"></a>        <span class="st">"https://google.com"</span>, </span>
<span id="cb8-110"><a href="#cb8-110" aria-hidden="true" tabindex="-1"></a>        <span class="st">"https://github.com"</span></span>
<span id="cb8-111"><a href="#cb8-111" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb8-112"><a href="#cb8-112" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-113"><a href="#cb8-113" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> url <span class="kw">in</span> urls_visited:</span>
<span id="cb8-114"><a href="#cb8-114" aria-hidden="true" tabindex="-1"></a>        bloom.add(url)</span>
<span id="cb8-115"><a href="#cb8-115" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-116"><a href="#cb8-116" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check membership</span></span>
<span id="cb8-117"><a href="#cb8-117" aria-hidden="true" tabindex="-1"></a>    test_urls <span class="op">=</span> [</span>
<span id="cb8-118"><a href="#cb8-118" aria-hidden="true" tabindex="-1"></a>        <span class="st">"https://example.com"</span>,  <span class="co"># Should be found</span></span>
<span id="cb8-119"><a href="#cb8-119" aria-hidden="true" tabindex="-1"></a>        <span class="st">"https://facebook.com"</span>  <span class="co"># Should not be found</span></span>
<span id="cb8-120"><a href="#cb8-120" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb8-121"><a href="#cb8-121" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-122"><a href="#cb8-122" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> url <span class="kw">in</span> test_urls:</span>
<span id="cb8-123"><a href="#cb8-123" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> bloom.might_contain(url):</span>
<span id="cb8-124"><a href="#cb8-124" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"‚úì </span><span class="sc">{</span>url<span class="sc">}</span><span class="ss"> might have been visited"</span>)</span>
<span id="cb8-125"><a href="#cb8-125" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb8-126"><a href="#cb8-126" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"‚úó </span><span class="sc">{</span>url<span class="sc">}</span><span class="ss"> definitely not visited"</span>)</span>
<span id="cb8-127"><a href="#cb8-127" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-128"><a href="#cb8-128" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compare space usage</span></span>
<span id="cb8-129"><a href="#cb8-129" aria-hidden="true" tabindex="-1"></a>    actual_storage <span class="op">=</span> <span class="bu">len</span>(urls_visited) <span class="op">*</span> <span class="dv">50</span>  <span class="co"># ~50 bytes per URL</span></span>
<span id="cb8-130"><a href="#cb8-130" aria-hidden="true" tabindex="-1"></a>    bloom_storage <span class="op">=</span> bloom.m <span class="op">/</span> <span class="dv">8</span>  <span class="co"># bits to bytes</span></span>
<span id="cb8-131"><a href="#cb8-131" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-132"><a href="#cb8-132" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Space comparison for </span><span class="sc">{</span><span class="bu">len</span>(urls_visited)<span class="sc">}</span><span class="ss"> URLs:"</span>)</span>
<span id="cb8-133"><a href="#cb8-133" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Storing actual URLs: </span><span class="sc">{</span>actual_storage<span class="sc">}</span><span class="ss"> bytes"</span>)</span>
<span id="cb8-134"><a href="#cb8-134" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Bloom filter: </span><span class="sc">{</span>bloom_storage<span class="sc">:.0f}</span><span class="ss"> bytes"</span>)</span>
<span id="cb8-135"><a href="#cb8-135" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Space saved: </span><span class="sc">{</span>(<span class="dv">1</span> <span class="op">-</span> bloom_storage<span class="op">/</span>actual_storage)<span class="op">*</span><span class="dv">100</span><span class="sc">:.1f}</span><span class="ss">%"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<hr>
</section>
</section>
</section>
<section id="section-6.5-streaming-algorithms---processing-infinite-data" class="level2" data-number="7.7">
<h2 data-number="7.7" class="anchored" data-anchor-id="section-6.5-streaming-algorithms---processing-infinite-data"><span class="header-section-number">7.7</span> Section 6.5: Streaming Algorithms - Processing Infinite Data</h2>
<section id="the-streaming-challenge" class="level3" data-number="7.7.1">
<h3 data-number="7.7.1" class="anchored" data-anchor-id="the-streaming-challenge"><span class="header-section-number">7.7.1</span> The Streaming Challenge</h3>
<p>Imagine you‚Äôre monitoring Twitter: - 500 million tweets per day - Can‚Äôt store everything in memory - Need real-time statistics - Data arrives continuously</p>
<p><strong>The Constraint:</strong> You can only make ONE PASS through the data!</p>
</section>
<section id="reservoir-sampling-fair-sampling-from-streams" class="level3" data-number="7.7.2">
<h3 data-number="7.7.2" class="anchored" data-anchor-id="reservoir-sampling-fair-sampling-from-streams"><span class="header-section-number">7.7.2</span> Reservoir Sampling: Fair Sampling from Streams</h3>
<section id="the-problem-1" class="level4" data-number="7.7.2.1">
<h4 data-number="7.7.2.1" class="anchored" data-anchor-id="the-problem-1"><span class="header-section-number">7.7.2.1</span> The Problem</h4>
<p>You want to maintain a random sample of tweets, but you don‚Äôt know how many total tweets there will be!</p>
</section>
<section id="the-solution-reservoir-sampling" class="level4" data-number="7.7.2.2">
<h4 data-number="7.7.2.2" class="anchored" data-anchor-id="the-solution-reservoir-sampling"><span class="header-section-number">7.7.2.2</span> The Solution: Reservoir Sampling</h4>
<p><strong>Analogy:</strong> Imagine you‚Äôre at a parade and want to photograph 10 random floats: - You don‚Äôt know how many floats there will be - You can only keep 10 photos in your camera - You want each float to have equal chance of being photographed</p>
<p><strong>The Algorithm:</strong> 1. Keep first k items in your ‚Äúreservoir‚Äù 2. For item n (where n &gt; k): - With probability k/n, include it - If including, randomly replace one existing item 3. Magic: This gives uniform probability to all items!</p>
</section>
<section id="why-it-works-intuitive-explanation" class="level4" data-number="7.7.2.3">
<h4 data-number="7.7.2.3" class="anchored" data-anchor-id="why-it-works-intuitive-explanation"><span class="header-section-number">7.7.2.3</span> Why It Works (Intuitive Explanation)</h4>
<p>For any item to be in the final sample: - It needs to be selected when it arrives - It needs to survive all future replacements</p>
<p><strong>Math Magic:</strong> - Probability item i is in final sample = k/N (where N is total items) - This is exactly uniform sampling!</p>
<p>Let‚Äôs implement it:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ReservoirSampler:</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Maintain a uniform random sample from a stream of unknown size.</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Applications:</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co">    - Sampling tweets for sentiment analysis</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co">    - Random sampling from database queries</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co">    - A/B testing with streaming data</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, sample_size<span class="op">=</span><span class="dv">100</span>):</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co">        Initialize reservoir.</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="co">        Args:</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="co">            sample_size: Number of items to maintain in sample</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.k <span class="op">=</span> sample_size</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.reservoir <span class="op">=</span> []</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.items_seen <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> add(<span class="va">self</span>, item):</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a><span class="co">        Process new item from stream.</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a><span class="co">        Maintains uniform probability for all items seen so far.</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.items_seen <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(<span class="va">self</span>.reservoir) <span class="op">&lt;</span> <span class="va">self</span>.k:</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Haven't filled reservoir yet</span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.reservoir.append(item)</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Randomly decide whether to include this item</span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Probability = k / items_seen</span></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>            j <span class="op">=</span> random.randint(<span class="dv">1</span>, <span class="va">self</span>.items_seen)</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> j <span class="op">&lt;=</span> <span class="va">self</span>.k:</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Include this item, replace random existing item</span></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>                replace_index <span class="op">=</span> random.randint(<span class="dv">0</span>, <span class="va">self</span>.k <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.reservoir[replace_index] <span class="op">=</span> item</span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_sample(<span class="va">self</span>):</span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Get current random sample."""</span></span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.reservoir.copy()</span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> sample_probability(<span class="va">self</span>):</span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a><span class="co">        Probability that any specific item is in the sample.</span></span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a><span class="co">        Should be k/n for uniform sampling.</span></span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.items_seen <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="dv">0</span></span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">min</span>(<span class="fl">1.0</span>, <span class="va">self</span>.k <span class="op">/</span> <span class="va">self</span>.items_seen)</span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Demonstration</span></span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> reservoir_sampling_demo():</span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a><span class="co">    Demonstrate that reservoir sampling is truly uniform.</span></span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a>    sampler <span class="op">=</span> ReservoirSampler(sample_size<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Stream of 1000 items</span></span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a>    stream <span class="op">=</span> <span class="bu">range</span>(<span class="dv">1000</span>)</span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> item <span class="kw">in</span> stream:</span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a>        sampler.add(item)</span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a>    sample <span class="op">=</span> sampler.get_sample()</span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Random sample of 10 from 1000 items: </span><span class="sc">{</span><span class="bu">sorted</span>(sample)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Each item had probability </span><span class="sc">{</span>sampler<span class="sc">.</span>sample_probability()<span class="sc">:.1%}</span><span class="ss"> of being selected"</span>)</span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Verify uniformity with multiple runs</span></span>
<span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a>    counts <span class="op">=</span> {}</span>
<span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10000</span>):</span>
<span id="cb9-79"><a href="#cb9-79" aria-hidden="true" tabindex="-1"></a>        sampler <span class="op">=</span> ReservoirSampler(sample_size<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb9-80"><a href="#cb9-80" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> item <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>):</span>
<span id="cb9-81"><a href="#cb9-81" aria-hidden="true" tabindex="-1"></a>            sampler.add(item)</span>
<span id="cb9-82"><a href="#cb9-82" aria-hidden="true" tabindex="-1"></a>        selected <span class="op">=</span> sampler.get_sample()[<span class="dv">0</span>]</span>
<span id="cb9-83"><a href="#cb9-83" aria-hidden="true" tabindex="-1"></a>        counts[selected] <span class="op">=</span> counts.get(selected, <span class="dv">0</span>) <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb9-84"><a href="#cb9-84" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-85"><a href="#cb9-85" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Uniformity test (should be ~1000 each):"</span>)</span>
<span id="cb9-86"><a href="#cb9-86" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> item <span class="kw">in</span> <span class="bu">sorted</span>(counts.keys()):</span>
<span id="cb9-87"><a href="#cb9-87" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  Item </span><span class="sc">{</span>item<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>counts[item]<span class="sc">}</span><span class="ss"> times"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="count-min-sketch-frequency-estimation" class="level3" data-number="7.7.3">
<h3 data-number="7.7.3" class="anchored" data-anchor-id="count-min-sketch-frequency-estimation"><span class="header-section-number">7.7.3</span> Count-Min Sketch: Frequency Estimation</h3>
<section id="the-problem-2" class="level4" data-number="7.7.3.1">
<h4 data-number="7.7.3.1" class="anchored" data-anchor-id="the-problem-2"><span class="header-section-number">7.7.3.1</span> The Problem</h4>
<p>Count how many times each hashtag appears in Twitter: - Millions of different hashtags - Can‚Äôt maintain counter for each - Need approximate counts</p>
</section>
<section id="the-solution-count-min-sketch" class="level4" data-number="7.7.3.2">
<h4 data-number="7.7.3.2" class="anchored" data-anchor-id="the-solution-count-min-sketch"><span class="header-section-number">7.7.3.2</span> The Solution: Count-Min Sketch</h4>
<p><strong>Intuition:</strong> - Use multiple small hash tables instead of one huge one - Each hashtag increments one counter in each table - Take minimum across tables (reduces overestimation from collisions)</p>
<p><strong>Why ‚ÄúCount-Min‚Äù?</strong> - We COUNT in multiple tables - Take the MINimum to reduce error from hash collisions</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CountMinSketch:</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Estimate frequencies in data streams with limited memory.</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Guarantees: Estimate ‚â• True Count (never underestimates)</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co">                Estimate ‚â§ True Count + Œµ√óN with probability 1-Œ¥</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, epsilon<span class="op">=</span><span class="fl">0.01</span>, delta<span class="op">=</span><span class="fl">0.01</span>):</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co">        Initialize Count-Min Sketch.</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co">        Args:</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="co">            epsilon: Error bound (e.g., 0.01 = within 1% of stream size)</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="co">            delta: Failure probability (e.g., 0.01 = 99% confidence)</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate dimensions</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.width <span class="op">=</span> <span class="bu">int</span>(math.ceil(math.e <span class="op">/</span> epsilon))</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.depth <span class="op">=</span> <span class="bu">int</span>(math.ceil(math.log(<span class="dv">1</span> <span class="op">/</span> delta)))</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Initialize counter tables</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.tables <span class="op">=</span> [[<span class="dv">0</span>] <span class="op">*</span> <span class="va">self</span>.width <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.depth)]</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Random hash functions (simplified - use better hashes in production)</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.hash_params <span class="op">=</span> []</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.depth):</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>            a <span class="op">=</span> random.randint(<span class="dv">1</span>, <span class="dv">2</span><span class="op">**</span><span class="dv">31</span> <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>            b <span class="op">=</span> random.randint(<span class="dv">0</span>, <span class="dv">2</span><span class="op">**</span><span class="dv">31</span> <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.hash_params.append((a, b))</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Count-Min Sketch initialized:"</span>)</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  Width: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>width<span class="sc">}</span><span class="ss"> (controls accuracy)"</span>)</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  Depth: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>depth<span class="sc">}</span><span class="ss"> (controls confidence)"</span>)</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  Total memory: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>width <span class="op">*</span> <span class="va">self</span><span class="sc">.</span>depth<span class="sc">}</span><span class="ss"> counters"</span>)</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _hash(<span class="va">self</span>, item, table_index):</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Hash item for specific table."""</span></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>        a, b <span class="op">=</span> <span class="va">self</span>.hash_params[table_index]</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Convert item to integer</span></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">isinstance</span>(item, <span class="bu">str</span>):</span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>            item_hash <span class="op">=</span> <span class="bu">hash</span>(item)</span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>            item_hash <span class="op">=</span> item</span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Universal hash function</span></span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> ((a <span class="op">*</span> item_hash <span class="op">+</span> b) <span class="op">%</span> (<span class="dv">2</span><span class="op">**</span><span class="dv">31</span> <span class="op">-</span> <span class="dv">1</span>)) <span class="op">%</span> <span class="va">self</span>.width</span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> add(<span class="va">self</span>, item, count<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a><span class="co">        Add occurrences of item.</span></span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.depth):</span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>            j <span class="op">=</span> <span class="va">self</span>._hash(item, i)</span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.tables[i][j] <span class="op">+=</span> count</span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> estimate(<span class="va">self</span>, item):</span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a><span class="co">        Estimate count for item.</span></span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns minimum across all tables (reduces overestimation).</span></span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a>        estimates <span class="op">=</span> []</span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.depth):</span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a>            j <span class="op">=</span> <span class="va">self</span>._hash(item, i)</span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a>            estimates.append(<span class="va">self</span>.tables[i][j])</span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">min</span>(estimates)</span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a><span class="co"># Example: Tracking word frequencies in text stream</span></span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> count_min_demo():</span>
<span id="cb10-72"><a href="#cb10-72" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb10-73"><a href="#cb10-73" aria-hidden="true" tabindex="-1"></a><span class="co">    Demonstrate Count-Min Sketch for word frequency.</span></span>
<span id="cb10-74"><a href="#cb10-74" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb10-75"><a href="#cb10-75" aria-hidden="true" tabindex="-1"></a>    sketch <span class="op">=</span> CountMinSketch(epsilon<span class="op">=</span><span class="fl">0.001</span>, delta<span class="op">=</span><span class="fl">0.01</span>)</span>
<span id="cb10-76"><a href="#cb10-76" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-77"><a href="#cb10-77" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Simulate text stream</span></span>
<span id="cb10-78"><a href="#cb10-78" aria-hidden="true" tabindex="-1"></a>    text_stream <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb10-79"><a href="#cb10-79" aria-hidden="true" tabindex="-1"></a><span class="st">    the quick brown fox jumps over the lazy dog</span></span>
<span id="cb10-80"><a href="#cb10-80" aria-hidden="true" tabindex="-1"></a><span class="st">    the fox was quick and the dog was lazy</span></span>
<span id="cb10-81"><a href="#cb10-81" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span> <span class="op">*</span> <span class="dv">100</span>  <span class="co"># Repeat for volume</span></span>
<span id="cb10-82"><a href="#cb10-82" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-83"><a href="#cb10-83" aria-hidden="true" tabindex="-1"></a>    words <span class="op">=</span> text_stream.lower().split()</span>
<span id="cb10-84"><a href="#cb10-84" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-85"><a href="#cb10-85" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add words to sketch</span></span>
<span id="cb10-86"><a href="#cb10-86" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> word <span class="kw">in</span> words:</span>
<span id="cb10-87"><a href="#cb10-87" aria-hidden="true" tabindex="-1"></a>        sketch.add(word)</span>
<span id="cb10-88"><a href="#cb10-88" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-89"><a href="#cb10-89" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check frequencies</span></span>
<span id="cb10-90"><a href="#cb10-90" aria-hidden="true" tabindex="-1"></a>    test_words <span class="op">=</span> [<span class="st">"the"</span>, <span class="st">"fox"</span>, <span class="st">"dog"</span>, <span class="st">"cat"</span>]</span>
<span id="cb10-91"><a href="#cb10-91" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-92"><a href="#cb10-92" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Word frequency estimates:"</span>)</span>
<span id="cb10-93"><a href="#cb10-93" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> word <span class="kw">in</span> test_words:</span>
<span id="cb10-94"><a href="#cb10-94" aria-hidden="true" tabindex="-1"></a>        true_count <span class="op">=</span> words.count(word)</span>
<span id="cb10-95"><a href="#cb10-95" aria-hidden="true" tabindex="-1"></a>        estimate <span class="op">=</span> sketch.estimate(word)</span>
<span id="cb10-96"><a href="#cb10-96" aria-hidden="true" tabindex="-1"></a>        error <span class="op">=</span> estimate <span class="op">-</span> true_count</span>
<span id="cb10-97"><a href="#cb10-97" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  '</span><span class="sc">{</span>word<span class="sc">}</span><span class="ss">': true=</span><span class="sc">{</span>true_count<span class="sc">}</span><span class="ss">, estimate=</span><span class="sc">{</span>estimate<span class="sc">}</span><span class="ss">, error=</span><span class="sc">{</span>error<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="hyperloglog-counting-unique-elements" class="level3" data-number="7.7.4">
<h3 data-number="7.7.4" class="anchored" data-anchor-id="hyperloglog-counting-unique-elements"><span class="header-section-number">7.7.4</span> HyperLogLog: Counting Unique Elements</h3>
<section id="the-problem-3" class="level4" data-number="7.7.4.1">
<h4 data-number="7.7.4.1" class="anchored" data-anchor-id="the-problem-3"><span class="header-section-number">7.7.4.1</span> The Problem</h4>
<p>Count unique users visiting your website: - Billions of visits - Same users visit multiple times - Can‚Äôt store all user IDs</p>
</section>
<section id="the-hyperloglog-magic" class="level4" data-number="7.7.4.2">
<h4 data-number="7.7.4.2" class="anchored" data-anchor-id="the-hyperloglog-magic"><span class="header-section-number">7.7.4.2</span> The HyperLogLog Magic</h4>
<p><strong>Key Insight:</strong> - In random bit strings, rare patterns indicate large sets - Like inferring crowd size from the rarest jersey number you see</p>
<p><strong>Intuition:</strong> - If you flip coins, getting 10 heads in a row is rare - If you see this pattern, you probably flipped LOTS of coins - HyperLogLog uses this principle with hash functions</p>
<p><strong>Amazing Properties:</strong> - Count billions of unique items - Using only ~16KB of memory! - Error rate ~2%</p>
</section>
</section>
</section>
<section id="this-algorithm-is-so-elegant-and-powerful-that-its-used-by-redis-google-bigquery-and-many-other-systems" class="level2" data-number="7.8">
<h2 data-number="7.8" class="anchored" data-anchor-id="this-algorithm-is-so-elegant-and-powerful-that-its-used-by-redis-google-bigquery-and-many-other-systems"><span class="header-section-number">7.8</span> This algorithm is so elegant and powerful that it‚Äôs used by Redis, Google BigQuery, and many other systems!</h2>
</section>
<section id="section-6.6-analyzing-randomized-algorithms" class="level2" data-number="7.9">
<h2 data-number="7.9" class="anchored" data-anchor-id="section-6.6-analyzing-randomized-algorithms"><span class="header-section-number">7.9</span> Section 6.6: Analyzing Randomized Algorithms</h2>
<section id="understanding-performance-through-probability" class="level3" data-number="7.9.1">
<h3 data-number="7.9.1" class="anchored" data-anchor-id="understanding-performance-through-probability"><span class="header-section-number">7.9.1</span> Understanding Performance Through Probability</h3>
<p>When we analyze randomized algorithms, we can‚Äôt just say ‚Äúit takes X steps‚Äù because X is now random! Instead, we need to understand the probability distribution of running times.</p>
<section id="expected-value-the-average-case" class="level4" data-number="7.9.1.1">
<h4 data-number="7.9.1.1" class="anchored" data-anchor-id="expected-value-the-average-case"><span class="header-section-number">7.9.1.1</span> Expected Value: The Average Case</h4>
<p><strong>Definition:</strong> If an algorithm has different possible running times, the expected value is the average, weighted by probability.</p>
<p><strong>Example - Finding an Item in Random Position:</strong></p>
<pre><code>Array has 4 slots: [_, _, _, _]
Item could be in position: 1, 2, 3, or 4 (each with probability 1/4)
Comparisons needed: 1, 2, 3, or 4

Expected comparisons = 1√ó(1/4) + 2√ó(1/4) + 3√ó(1/4) + 4√ó(1/4) = 2.5</code></pre>
</section>
<section id="high-probability-bounds" class="level4" data-number="7.9.1.2">
<h4 data-number="7.9.1.2" class="anchored" data-anchor-id="high-probability-bounds"><span class="header-section-number">7.9.1.2</span> High Probability Bounds</h4>
<p>‚ÄúExpected‚Äù performance is nice, but what if we get unlucky? We want stronger guarantees!</p>
<p><strong>High Probability Statement:</strong> ‚ÄúThe algorithm finishes in O(n log n) time with probability ‚â• 1 - 1/n¬≤‚Äù</p>
<p><strong>What this means:</strong> - For n = 1000: Fails less than once in a million runs - For n = 1,000,000: Fails less than once in a trillion runs - As input grows, failure becomes astronomically unlikely!</p>
</section>
</section>
<section id="concentration-inequalities-why-randomized-algorithms-dont-get-unlucky" class="level3" data-number="7.9.2">
<h3 data-number="7.9.2" class="anchored" data-anchor-id="concentration-inequalities-why-randomized-algorithms-dont-get-unlucky"><span class="header-section-number">7.9.2</span> Concentration Inequalities: Why Randomized Algorithms Don‚Äôt Get Unlucky</h3>
<p>These mathematical tools prove that random events cluster around their expected values.</p>
<section id="markovs-inequality-the-weakest-bound" class="level4" data-number="7.9.2.1">
<h4 data-number="7.9.2.1" class="anchored" data-anchor-id="markovs-inequality-the-weakest-bound"><span class="header-section-number">7.9.2.1</span> Markov‚Äôs Inequality: The Weakest Bound</h4>
<p><strong>Statement:</strong> For non-negative random variable X: P(X ‚â• k √ó E[X]) ‚â§ 1/k</p>
<p><strong>In Plain English:</strong> ‚ÄúThe probability of being k times worse than expected is at most 1/k‚Äù</p>
<p><strong>Example:</strong> If QuickSort expects 100 comparisons: - P(‚â• 1000 comparisons) ‚â§ 1/10 = 10% - P(‚â• 10000 comparisons) ‚â§ 1/100 = 1%</p>
</section>
<section id="chernoff-bounds-much-stronger-guarantees" class="level4" data-number="7.9.2.2">
<h4 data-number="7.9.2.2" class="anchored" data-anchor-id="chernoff-bounds-much-stronger-guarantees"><span class="header-section-number">7.9.2.2</span> Chernoff Bounds: Much Stronger Guarantees</h4>
<p>For sums of independent random events, we get exponentially decreasing failure probability!</p>
<p><strong>Example - Coin Flips:</strong> Flip 1000 fair coins. Expected heads = 500. - Probability of ‚â• 600 heads ‚âà 0.0000000002% - Probability of ‚â• 700 heads ‚âà 10^-88 (essentially impossible!)</p>
<p>This is why randomized algorithms are reliable despite using randomness!</p>
<p>Let‚Äôs see these principles in action:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> RandomizedAnalysis:</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Tools for analyzing and demonstrating randomized algorithm behavior.</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> analyze_quicksort_concentration(n<span class="op">=</span><span class="dv">1000</span>, trials<span class="op">=</span><span class="dv">1000</span>):</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="co">        Demonstrate that QuickSort concentrates around expected time.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">def</span> count_comparisons_quicksort(arr):</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>            <span class="co">"""Count comparisons in randomized QuickSort."""</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(arr) <span class="op">&lt;=</span> <span class="dv">1</span>:</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="dv">0</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>            pivot <span class="op">=</span> arr[random.randint(<span class="dv">0</span>, <span class="bu">len</span>(arr) <span class="op">-</span> <span class="dv">1</span>)]</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>            comparisons <span class="op">=</span> <span class="bu">len</span>(arr) <span class="op">-</span> <span class="dv">1</span>  <span class="co"># Compare all elements to pivot</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>            left <span class="op">=</span> [x <span class="cf">for</span> x <span class="kw">in</span> arr <span class="cf">if</span> x <span class="op">&lt;</span> pivot]</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>            right <span class="op">=</span> [x <span class="cf">for</span> x <span class="kw">in</span> arr <span class="cf">if</span> x <span class="op">&gt;</span> pivot]</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Recursively count comparisons</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> comparisons <span class="op">+</span> count_comparisons_quicksort(left) <span class="op">+</span> count_comparisons_quicksort(right)</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Run many trials</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>        comparison_counts <span class="op">=</span> []</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(trials):</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>            arr <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(n))</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>            random.shuffle(arr)</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>            comparisons <span class="op">=</span> count_comparisons_quicksort(arr)</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>            comparison_counts.append(comparisons)</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate statistics</span></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>        expected <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> n <span class="op">*</span> math.log(n)  <span class="co"># Theoretical expectation</span></span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>        actual_mean <span class="op">=</span> <span class="bu">sum</span>(comparison_counts) <span class="op">/</span> trials</span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Count how many are far from expected</span></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>        far_from_expected <span class="op">=</span> <span class="bu">sum</span>(<span class="dv">1</span> <span class="cf">for</span> c <span class="kw">in</span> comparison_counts </span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>                               <span class="cf">if</span> <span class="bu">abs</span>(c <span class="op">-</span> expected) <span class="op">&gt;</span> <span class="fl">0.5</span> <span class="op">*</span> expected)</span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"QuickSort Analysis (n=</span><span class="sc">{</span>n<span class="sc">}</span><span class="ss">, trials=</span><span class="sc">{</span>trials<span class="sc">}</span><span class="ss">):"</span>)</span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  Theoretical expected: </span><span class="sc">{</span>expected<span class="sc">:.0f}</span><span class="ss">"</span>)</span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  Actual average: </span><span class="sc">{</span>actual_mean<span class="sc">:.0f}</span><span class="ss">"</span>)</span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  Min comparisons: </span><span class="sc">{</span><span class="bu">min</span>(comparison_counts)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  Max comparisons: </span><span class="sc">{</span><span class="bu">max</span>(comparison_counts)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  Runs &gt;50% from expected: </span><span class="sc">{</span>far_from_expected<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>trials<span class="sc">}</span><span class="ss"> = </span><span class="sc">{</span>far_from_expected<span class="op">/</span>trials<span class="sc">:.1%}</span><span class="ss">"</span>)</span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  Conclusion: QuickSort strongly concentrates around expected value!"</span>)</span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> comparison_counts</span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> demonstrate_amplification():</span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a><span class="co">        Show how repetition reduces error probability.</span></span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb12-60"><a href="#cb12-60" aria-hidden="true" tabindex="-1"></a>        <span class="kw">def</span> unreliable_prime_test(n):</span>
<span id="cb12-61"><a href="#cb12-61" aria-hidden="true" tabindex="-1"></a>            <span class="co">"""</span></span>
<span id="cb12-62"><a href="#cb12-62" aria-hidden="true" tabindex="-1"></a><span class="co">            Fake primality test that's right 75% of the time.</span></span>
<span id="cb12-63"><a href="#cb12-63" aria-hidden="true" tabindex="-1"></a><span class="co">            (For demonstration only!)</span></span>
<span id="cb12-64"><a href="#cb12-64" aria-hidden="true" tabindex="-1"></a><span class="co">            """</span></span>
<span id="cb12-65"><a href="#cb12-65" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> n <span class="op">&lt;</span> <span class="dv">2</span>:</span>
<span id="cb12-66"><a href="#cb12-66" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb12-67"><a href="#cb12-67" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> n <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb12-68"><a href="#cb12-68" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb12-69"><a href="#cb12-69" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb12-70"><a href="#cb12-70" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Simulate 75% accuracy</span></span>
<span id="cb12-71"><a href="#cb12-71" aria-hidden="true" tabindex="-1"></a>            true_answer <span class="op">=</span> <span class="bu">all</span>(n <span class="op">%</span> i <span class="op">!=</span> <span class="dv">0</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2</span>, <span class="bu">min</span>(<span class="bu">int</span>(n<span class="op">**</span><span class="fl">0.5</span>) <span class="op">+</span> <span class="dv">1</span>, <span class="dv">100</span>)))</span>
<span id="cb12-72"><a href="#cb12-72" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> random.random() <span class="op">&lt;</span> <span class="fl">0.75</span>:</span>
<span id="cb12-73"><a href="#cb12-73" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> true_answer</span>
<span id="cb12-74"><a href="#cb12-74" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb12-75"><a href="#cb12-75" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="kw">not</span> true_answer  <span class="co"># Wrong answer</span></span>
<span id="cb12-76"><a href="#cb12-76" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb12-77"><a href="#cb12-77" aria-hidden="true" tabindex="-1"></a>        <span class="kw">def</span> amplified_prime_test(n, k<span class="op">=</span><span class="dv">10</span>):</span>
<span id="cb12-78"><a href="#cb12-78" aria-hidden="true" tabindex="-1"></a>            <span class="co">"""Run test k times and take majority vote."""</span></span>
<span id="cb12-79"><a href="#cb12-79" aria-hidden="true" tabindex="-1"></a>            votes <span class="op">=</span> [unreliable_prime_test(n) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(k)]</span>
<span id="cb12-80"><a href="#cb12-80" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="bu">sum</span>(votes) <span class="op">&gt;</span> k <span class="op">//</span> <span class="dv">2</span></span>
<span id="cb12-81"><a href="#cb12-81" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb12-82"><a href="#cb12-82" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Test on known primes and composites</span></span>
<span id="cb12-83"><a href="#cb12-83" aria-hidden="true" tabindex="-1"></a>        test_numbers <span class="op">=</span> [<span class="dv">17</span>, <span class="dv">18</span>, <span class="dv">19</span>, <span class="dv">20</span>, <span class="dv">23</span>, <span class="dv">24</span>, <span class="dv">29</span>, <span class="dv">30</span>]</span>
<span id="cb12-84"><a href="#cb12-84" aria-hidden="true" tabindex="-1"></a>        true_answers <span class="op">=</span> [<span class="va">True</span>, <span class="va">False</span>, <span class="va">True</span>, <span class="va">False</span>, <span class="va">True</span>, <span class="va">False</span>, <span class="va">True</span>, <span class="va">False</span>]</span>
<span id="cb12-85"><a href="#cb12-85" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb12-86"><a href="#cb12-86" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Single test accuracy</span></span>
<span id="cb12-87"><a href="#cb12-87" aria-hidden="true" tabindex="-1"></a>        single_correct <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb12-88"><a href="#cb12-88" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> num, truth <span class="kw">in</span> <span class="bu">zip</span>(test_numbers, true_answers):</span>
<span id="cb12-89"><a href="#cb12-89" aria-hidden="true" tabindex="-1"></a>            correct_count <span class="op">=</span> <span class="bu">sum</span>(unreliable_prime_test(num) <span class="op">==</span> truth </span>
<span id="cb12-90"><a href="#cb12-90" aria-hidden="true" tabindex="-1"></a>                               <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1000</span>))</span>
<span id="cb12-91"><a href="#cb12-91" aria-hidden="true" tabindex="-1"></a>            single_correct <span class="op">+=</span> correct_count</span>
<span id="cb12-92"><a href="#cb12-92" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb12-93"><a href="#cb12-93" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Amplified test accuracy</span></span>
<span id="cb12-94"><a href="#cb12-94" aria-hidden="true" tabindex="-1"></a>        amplified_correct <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb12-95"><a href="#cb12-95" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> num, truth <span class="kw">in</span> <span class="bu">zip</span>(test_numbers, true_answers):</span>
<span id="cb12-96"><a href="#cb12-96" aria-hidden="true" tabindex="-1"></a>            correct_count <span class="op">=</span> <span class="bu">sum</span>(amplified_prime_test(num, k<span class="op">=</span><span class="dv">10</span>) <span class="op">==</span> truth </span>
<span id="cb12-97"><a href="#cb12-97" aria-hidden="true" tabindex="-1"></a>                               <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1000</span>))</span>
<span id="cb12-98"><a href="#cb12-98" aria-hidden="true" tabindex="-1"></a>            amplified_correct <span class="op">+=</span> correct_count</span>
<span id="cb12-99"><a href="#cb12-99" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb12-100"><a href="#cb12-100" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Error Amplification Demo:"</span>)</span>
<span id="cb12-101"><a href="#cb12-101" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  Single test accuracy: </span><span class="sc">{</span>single_correct<span class="op">/</span><span class="dv">8000</span><span class="sc">:.1%}</span><span class="ss">"</span>)</span>
<span id="cb12-102"><a href="#cb12-102" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  Amplified (10 runs) accuracy: </span><span class="sc">{</span>amplified_correct<span class="op">/</span><span class="dv">8000</span><span class="sc">:.1%}</span><span class="ss">"</span>)</span>
<span id="cb12-103"><a href="#cb12-103" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  Improvement: </span><span class="sc">{</span>(amplified_correct<span class="op">-</span>single_correct)<span class="op">/</span>single_correct<span class="sc">:.1%}</span><span class="ss">"</span>)</span>
<span id="cb12-104"><a href="#cb12-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-105"><a href="#cb12-105" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the demonstrations</span></span>
<span id="cb12-106"><a href="#cb12-106" aria-hidden="true" tabindex="-1"></a>analyzer <span class="op">=</span> RandomizedAnalysis()</span>
<span id="cb12-107"><a href="#cb12-107" aria-hidden="true" tabindex="-1"></a><span class="co"># analyzer.analyze_quicksort_concentration()</span></span>
<span id="cb12-108"><a href="#cb12-108" aria-hidden="true" tabindex="-1"></a><span class="co"># analyzer.demonstrate_amplification()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<hr>
</section>
</section>
</section>
<section id="section-6.7-advanced-randomized-algorithms" class="level2" data-number="7.10">
<h2 data-number="7.10" class="anchored" data-anchor-id="section-6.7-advanced-randomized-algorithms"><span class="header-section-number">7.10</span> Section 6.7: Advanced Randomized Algorithms</h2>
<section id="kargers-min-cut-algorithm-finding-bottlenecks" class="level3" data-number="7.10.1">
<h3 data-number="7.10.1" class="anchored" data-anchor-id="kargers-min-cut-algorithm-finding-bottlenecks"><span class="header-section-number">7.10.1</span> Karger‚Äôs Min-Cut Algorithm: Finding Bottlenecks</h3>
<section id="the-problem-4" class="level4" data-number="7.10.1.1">
<h4 data-number="7.10.1.1" class="anchored" data-anchor-id="the-problem-4"><span class="header-section-number">7.10.1.1</span> The Problem</h4>
<p>Find the minimum cut in a network - the smallest number of connections that, if removed, would split the network into two parts.</p>
<p><strong>Real-World Applications:</strong> - Finding weakest points in internet infrastructure - Identifying community boundaries in social networks - Circuit design and reliability analysis</p>
</section>
<section id="the-elegant-randomized-solution" class="level4" data-number="7.10.1.2">
<h4 data-number="7.10.1.2" class="anchored" data-anchor-id="the-elegant-randomized-solution"><span class="header-section-number">7.10.1.2</span> The Elegant Randomized Solution</h4>
<p><strong>Karger‚Äôs Algorithm:</strong> 1. Pick a random edge 2. ‚ÄúContract‚Äù it (merge the two endpoints into one node) 3. Repeat until only 2 nodes remain 4. Count edges between them</p>
<p><strong>Why It Works (Intuition):</strong> - Min-cut edges are ‚Äúrare‚Äù (there are few of them) - Random edge is unlikely to be in min-cut - If we avoid min-cut edges, we find the min-cut!</p>
<p><strong>Success Probability:</strong> - Single run: ‚â• 2/n¬≤ (seems small!) - But run n¬≤ log n times: Success probability &gt; 1 - 1/n - Multiple runs find the true min-cut with high probability</p>
<p>Let‚Äôs implement this beautiful algorithm:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> copy</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> KargerMinCut:</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Randomized algorithm for finding minimum cut in a graph.</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Simple, elegant, and probabilistically correct!</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, graph):</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co">        Initialize with graph represented as adjacency list.</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="co">        Example graph:</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="co">        {</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="co">            'A': ['B', 'C', 'D'],</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="co">            'B': ['A', 'C'],</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="co">            'C': ['A', 'B', 'D'],</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a><span class="co">            'D': ['A', 'C']</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a><span class="co">        }</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.original_graph <span class="op">=</span> graph</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> contract_edge(<span class="va">self</span>, graph, u, v):</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a><span class="co">        Contract edge (u,v) - merge v into u.</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a><span class="co">        This is like combining two cities into a metropolis!</span></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a><span class="co">        All of v's connections become u's connections.</span></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add v's edges to u</span></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> neighbor <span class="kw">in</span> graph[v]:</span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> neighbor <span class="op">!=</span> u:  <span class="co"># Skip self-loops</span></span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>                graph[u].append(neighbor)</span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Update the neighbor's connections</span></span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>                graph[neighbor] <span class="op">=</span> [u <span class="cf">if</span> x <span class="op">==</span> v <span class="cf">else</span> x <span class="cf">for</span> x <span class="kw">in</span> graph[neighbor]]</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Remove v from graph</span></span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>        <span class="kw">del</span> graph[v]</span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Remove any self-loops created</span></span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>        graph[u] <span class="op">=</span> [x <span class="cf">for</span> x <span class="kw">in</span> graph[u] <span class="cf">if</span> x <span class="op">!=</span> u]</span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> single_min_cut_trial(<span class="va">self</span>):</span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a><span class="co">        One trial of Karger's algorithm.</span></span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns the cut size found (might not be minimum!).</span></span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Make a copy since we'll modify the graph</span></span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>        graph <span class="op">=</span> copy.deepcopy(<span class="va">self</span>.original_graph)</span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>        vertices <span class="op">=</span> <span class="bu">list</span>(graph.keys())</span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Contract down to 2 nodes</span></span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="bu">len</span>(vertices) <span class="op">&gt;</span> <span class="dv">2</span>:</span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Pick random edge</span></span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a>            u <span class="op">=</span> random.choice(vertices)</span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> graph[u]:  <span class="co"># No edges from u</span></span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a>                vertices.remove(u)</span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a>            v <span class="op">=</span> random.choice(graph[u])</span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb13-63"><a href="#cb13-63" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Contract this edge</span></span>
<span id="cb13-64"><a href="#cb13-64" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.contract_edge(graph, u, v)</span>
<span id="cb13-65"><a href="#cb13-65" aria-hidden="true" tabindex="-1"></a>            vertices.remove(v)</span>
<span id="cb13-66"><a href="#cb13-66" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-67"><a href="#cb13-67" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Count edges between final two nodes</span></span>
<span id="cb13-68"><a href="#cb13-68" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(graph) <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb13-69"><a href="#cb13-69" aria-hidden="true" tabindex="-1"></a>            remaining <span class="op">=</span> <span class="bu">list</span>(graph.keys())</span>
<span id="cb13-70"><a href="#cb13-70" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="bu">len</span>(graph[remaining[<span class="dv">0</span>]])</span>
<span id="cb13-71"><a href="#cb13-71" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">float</span>(<span class="st">'inf'</span>)</span>
<span id="cb13-72"><a href="#cb13-72" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-73"><a href="#cb13-73" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> find_min_cut(<span class="va">self</span>, confidence<span class="op">=</span><span class="fl">0.99</span>):</span>
<span id="cb13-74"><a href="#cb13-74" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb13-75"><a href="#cb13-75" aria-hidden="true" tabindex="-1"></a><span class="co">        Find minimum cut with high probability.</span></span>
<span id="cb13-76"><a href="#cb13-76" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb13-77"><a href="#cb13-77" aria-hidden="true" tabindex="-1"></a><span class="co">        Args:</span></span>
<span id="cb13-78"><a href="#cb13-78" aria-hidden="true" tabindex="-1"></a><span class="co">            confidence: Desired probability of success (e.g., 0.99 = 99%)</span></span>
<span id="cb13-79"><a href="#cb13-79" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb13-80"><a href="#cb13-80" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns:</span></span>
<span id="cb13-81"><a href="#cb13-81" aria-hidden="true" tabindex="-1"></a><span class="co">            Minimum cut size found</span></span>
<span id="cb13-82"><a href="#cb13-82" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb13-83"><a href="#cb13-83" aria-hidden="true" tabindex="-1"></a>        n <span class="op">=</span> <span class="bu">len</span>(<span class="va">self</span>.original_graph)</span>
<span id="cb13-84"><a href="#cb13-84" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-85"><a href="#cb13-85" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate trials needed for desired confidence</span></span>
<span id="cb13-86"><a href="#cb13-86" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Probability of success in one trial ‚â• 2/(n¬≤)</span></span>
<span id="cb13-87"><a href="#cb13-87" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Probability of failure in k trials ‚â§ (1 - 2/n¬≤)^k</span></span>
<span id="cb13-88"><a href="#cb13-88" aria-hidden="true" tabindex="-1"></a>        <span class="co"># We want this ‚â§ 1 - confidence</span></span>
<span id="cb13-89"><a href="#cb13-89" aria-hidden="true" tabindex="-1"></a>        <span class="im">import</span> math</span>
<span id="cb13-90"><a href="#cb13-90" aria-hidden="true" tabindex="-1"></a>        single_success_prob <span class="op">=</span> <span class="dv">2</span> <span class="op">/</span> (n <span class="op">*</span> (n <span class="op">-</span> <span class="dv">1</span>))</span>
<span id="cb13-91"><a href="#cb13-91" aria-hidden="true" tabindex="-1"></a>        trials_needed <span class="op">=</span> <span class="bu">int</span>(math.log(<span class="dv">1</span> <span class="op">-</span> confidence) <span class="op">/</span> math.log(<span class="dv">1</span> <span class="op">-</span> single_success_prob))</span>
<span id="cb13-92"><a href="#cb13-92" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-93"><a href="#cb13-93" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Running </span><span class="sc">{</span>trials_needed<span class="sc">}</span><span class="ss"> trials for </span><span class="sc">{</span>confidence<span class="sc">:.1%}</span><span class="ss"> confidence..."</span>)</span>
<span id="cb13-94"><a href="#cb13-94" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-95"><a href="#cb13-95" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Run multiple trials</span></span>
<span id="cb13-96"><a href="#cb13-96" aria-hidden="true" tabindex="-1"></a>        min_cut <span class="op">=</span> <span class="bu">float</span>(<span class="st">'inf'</span>)</span>
<span id="cb13-97"><a href="#cb13-97" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> trial <span class="kw">in</span> <span class="bu">range</span>(trials_needed):</span>
<span id="cb13-98"><a href="#cb13-98" aria-hidden="true" tabindex="-1"></a>            cut_size <span class="op">=</span> <span class="va">self</span>.single_min_cut_trial()</span>
<span id="cb13-99"><a href="#cb13-99" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> cut_size <span class="op">&lt;</span> min_cut:</span>
<span id="cb13-100"><a href="#cb13-100" aria-hidden="true" tabindex="-1"></a>                min_cut <span class="op">=</span> cut_size</span>
<span id="cb13-101"><a href="#cb13-101" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f"  Trial </span><span class="sc">{</span>trial<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">: Found cut of size </span><span class="sc">{</span>cut_size<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb13-102"><a href="#cb13-102" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-103"><a href="#cb13-103" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> min_cut</span>
<span id="cb13-104"><a href="#cb13-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-105"><a href="#cb13-105" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage</span></span>
<span id="cb13-106"><a href="#cb13-106" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> karger_demo():</span>
<span id="cb13-107"><a href="#cb13-107" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb13-108"><a href="#cb13-108" aria-hidden="true" tabindex="-1"></a><span class="co">    Demonstrate Karger's algorithm on a simple graph.</span></span>
<span id="cb13-109"><a href="#cb13-109" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb13-110"><a href="#cb13-110" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a simple graph with known min-cut</span></span>
<span id="cb13-111"><a href="#cb13-111" aria-hidden="true" tabindex="-1"></a>    graph <span class="op">=</span> {</span>
<span id="cb13-112"><a href="#cb13-112" aria-hidden="true" tabindex="-1"></a>        <span class="st">'A'</span>: [<span class="st">'B'</span>, <span class="st">'C'</span>, <span class="st">'D'</span>],</span>
<span id="cb13-113"><a href="#cb13-113" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B'</span>: [<span class="st">'A'</span>, <span class="st">'C'</span>, <span class="st">'E'</span>],</span>
<span id="cb13-114"><a href="#cb13-114" aria-hidden="true" tabindex="-1"></a>        <span class="st">'C'</span>: [<span class="st">'A'</span>, <span class="st">'B'</span>, <span class="st">'D'</span>, <span class="st">'E'</span>],</span>
<span id="cb13-115"><a href="#cb13-115" aria-hidden="true" tabindex="-1"></a>        <span class="st">'D'</span>: [<span class="st">'A'</span>, <span class="st">'C'</span>, <span class="st">'E'</span>, <span class="st">'F'</span>],</span>
<span id="cb13-116"><a href="#cb13-116" aria-hidden="true" tabindex="-1"></a>        <span class="st">'E'</span>: [<span class="st">'B'</span>, <span class="st">'C'</span>, <span class="st">'D'</span>, <span class="st">'F'</span>],</span>
<span id="cb13-117"><a href="#cb13-117" aria-hidden="true" tabindex="-1"></a>        <span class="st">'F'</span>: [<span class="st">'D'</span>, <span class="st">'E'</span>]</span>
<span id="cb13-118"><a href="#cb13-118" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb13-119"><a href="#cb13-119" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-120"><a href="#cb13-120" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Graph structure:"</span>)</span>
<span id="cb13-121"><a href="#cb13-121" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"  A---B"</span>)</span>
<span id="cb13-122"><a href="#cb13-122" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"  |</span><span class="ch">\\</span><span class="st">  |</span><span class="ch">\\</span><span class="st">"</span>)</span>
<span id="cb13-123"><a href="#cb13-123" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"  | </span><span class="ch">\\</span><span class="st"> | E"</span>)</span>
<span id="cb13-124"><a href="#cb13-124" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"  |  </span><span class="ch">\\</span><span class="st">|/|"</span>)</span>
<span id="cb13-125"><a href="#cb13-125" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"  C---D-F"</span>)</span>
<span id="cb13-126"><a href="#cb13-126" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">The min-cut is 2 (cut edges D-F and E-F to separate F)"</span>)</span>
<span id="cb13-127"><a href="#cb13-127" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-128"><a href="#cb13-128" aria-hidden="true" tabindex="-1"></a>    karger <span class="op">=</span> KargerMinCut(graph)</span>
<span id="cb13-129"><a href="#cb13-129" aria-hidden="true" tabindex="-1"></a>    min_cut <span class="op">=</span> karger.find_min_cut(confidence<span class="op">=</span><span class="fl">0.99</span>)</span>
<span id="cb13-130"><a href="#cb13-130" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-131"><a href="#cb13-131" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Karger's algorithm found min-cut: </span><span class="sc">{</span>min_cut<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="monte-carlo-integration-using-randomness-for-math" class="level3" data-number="7.10.2">
<h3 data-number="7.10.2" class="anchored" data-anchor-id="monte-carlo-integration-using-randomness-for-math"><span class="header-section-number">7.10.2</span> Monte Carlo Integration: Using Randomness for Math</h3>
<section id="the-problem-5" class="level4" data-number="7.10.2.1">
<h4 data-number="7.10.2.1" class="anchored" data-anchor-id="the-problem-5"><span class="header-section-number">7.10.2.1</span> The Problem</h4>
<p>Calculate the area under a complex curve or the value of œÄ.</p>
<p><strong>Traditional Approach:</strong> Complex calculus, might be impossible for some functions!</p>
<p><strong>Monte Carlo Approach:</strong> Throw random darts and count how many land under the curve!</p>
</section>
<section id="estimating-œÄ-with-random-points" class="level4" data-number="7.10.2.2">
<h4 data-number="7.10.2.2" class="anchored" data-anchor-id="estimating-œÄ-with-random-points"><span class="header-section-number">7.10.2.2</span> Estimating œÄ with Random Points</h4>
<p><strong>The Setup:</strong> - Square from -1 to 1 (area = 4) - Circle of radius 1 inside (area = œÄ) - Ratio of circle to square = œÄ/4</p>
<p><strong>The Algorithm:</strong> 1. Throw random points in the square 2. Count how many land in the circle 3. œÄ ‚âà 4 √ó (points in circle) / (total points)</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> estimate_pi(num_samples<span class="op">=</span><span class="dv">1000000</span>):</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Estimate œÄ using Monte Carlo simulation.</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co">    This is like throwing darts at a circular dartboard</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co">    inside a square frame!</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    inside_circle <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(num_samples):</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Random point in square [-1, 1] √ó [-1, 1]</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> random.uniform(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>        y <span class="op">=</span> random.uniform(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Check if point is inside unit circle</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> x<span class="op">*</span>x <span class="op">+</span> y<span class="op">*</span>y <span class="op">&lt;=</span> <span class="dv">1</span>:</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>            inside_circle <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Estimate œÄ</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>    pi_estimate <span class="op">=</span> <span class="dv">4</span> <span class="op">*</span> inside_circle <span class="op">/</span> num_samples</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate statistics</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>    actual_pi <span class="op">=</span> math.pi</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>    error <span class="op">=</span> <span class="bu">abs</span>(pi_estimate <span class="op">-</span> actual_pi)</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>    relative_error <span class="op">=</span> error <span class="op">/</span> actual_pi <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Monte Carlo œÄ Estimation:"</span>)</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Samples: </span><span class="sc">{</span>num_samples<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Points in circle: </span><span class="sc">{</span>inside_circle<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Estimate: </span><span class="sc">{</span>pi_estimate<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Actual œÄ: </span><span class="sc">{</span>actual_pi<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Error: </span><span class="sc">{</span>error<span class="sc">:.6f}</span><span class="ss"> (</span><span class="sc">{</span>relative_error<span class="sc">:.3f}</span><span class="ss">%)"</span>)</span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate theoretical standard error</span></span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> math.pi <span class="op">/</span> <span class="dv">4</span>  <span class="co"># True probability</span></span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>    std_error <span class="op">=</span> <span class="dv">4</span> <span class="op">*</span> math.sqrt(p <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> p) <span class="op">/</span> num_samples)</span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Theoretical std error: </span><span class="sc">{</span>std_error<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pi_estimate</span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Try with different sample sizes to see convergence</span></span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> monte_carlo_convergence_demo():</span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Show how estimate improves with more samples."""</span></span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>    sample_sizes <span class="op">=</span> [<span class="dv">100</span>, <span class="dv">1000</span>, <span class="dv">10000</span>, <span class="dv">100000</span>, <span class="dv">1000000</span>]</span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Monte Carlo Convergence:"</span>)</span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> n <span class="kw">in</span> sample_sizes:</span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Suppress detailed output</span></span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a>        inside <span class="op">=</span> <span class="bu">sum</span>(random.uniform(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>)<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> random.uniform(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>)<span class="op">**</span><span class="dv">2</span> <span class="op">&lt;=</span> <span class="dv">1</span> </span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(n))</span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a>        estimate <span class="op">=</span> <span class="dv">4</span> <span class="op">*</span> inside <span class="op">/</span> n</span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a>        error <span class="op">=</span> <span class="bu">abs</span>(estimate <span class="op">-</span> math.pi)</span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  n=</span><span class="sc">{</span>n<span class="sc">:&gt;8,}</span><span class="ss">: œÄ‚âà</span><span class="sc">{</span>estimate<span class="sc">:.4f}</span><span class="ss">, error=</span><span class="sc">{</span>error<span class="sc">:.4f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<hr>
</section>
</section>
</section>
<section id="section-6.8-real-world-applications" class="level2" data-number="7.11">
<h2 data-number="7.11" class="anchored" data-anchor-id="section-6.8-real-world-applications"><span class="header-section-number">7.11</span> Section 6.8: Real-World Applications</h2>
<section id="load-balancing-with-randomization" class="level3" data-number="7.11.1">
<h3 data-number="7.11.1" class="anchored" data-anchor-id="load-balancing-with-randomization"><span class="header-section-number">7.11.1</span> Load Balancing with Randomization</h3>
<section id="the-problem-6" class="level4" data-number="7.11.1.1">
<h4 data-number="7.11.1.1" class="anchored" data-anchor-id="the-problem-6"><span class="header-section-number">7.11.1.1</span> The Problem</h4>
<p>You have 1000 servers and millions of requests. How do you distribute load fairly?</p>
<p><strong>Deterministic Approach:</strong> Round-robin, but if some requests are heavier, servers become imbalanced!</p>
<p><strong>Randomized Solution: Power of Two Choices</strong></p>
<ol type="1">
<li>Pick TWO random servers</li>
<li>Send request to the less loaded one</li>
<li>This simple change dramatically improves balance!</li>
</ol>
<p><strong>Why It Works:</strong> - Random choice alone: Maximum load ‚âà log n / log log n - Power of two choices: Maximum load ‚âà log log n (MUCH better!)</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> LoadBalancer:</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Demonstrate different load balancing strategies.</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, num_servers<span class="op">=</span><span class="dv">100</span>):</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.num_servers <span class="op">=</span> num_servers</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.loads <span class="op">=</span> [<span class="dv">0</span>] <span class="op">*</span> num_servers</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> random_assignment(<span class="va">self</span>, num_requests<span class="op">=</span><span class="dv">10000</span>):</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Pure random assignment."""</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.loads <span class="op">=</span> [<span class="dv">0</span>] <span class="op">*</span> <span class="va">self</span>.num_servers</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(num_requests):</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>            server <span class="op">=</span> random.randint(<span class="dv">0</span>, <span class="va">self</span>.num_servers <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.loads[server] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">max</span>(<span class="va">self</span>.loads)</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> power_of_two_choices(<span class="va">self</span>, num_requests<span class="op">=</span><span class="dv">10000</span>):</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Pick two random servers, use less loaded."""</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.loads <span class="op">=</span> [<span class="dv">0</span>] <span class="op">*</span> <span class="va">self</span>.num_servers</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(num_requests):</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Pick two random servers</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>            server1 <span class="op">=</span> random.randint(<span class="dv">0</span>, <span class="va">self</span>.num_servers <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>            server2 <span class="op">=</span> random.randint(<span class="dv">0</span>, <span class="va">self</span>.num_servers <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Choose less loaded</span></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.loads[server1] <span class="op">&lt;=</span> <span class="va">self</span>.loads[server2]:</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.loads[server1] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.loads[server2] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">max</span>(<span class="va">self</span>.loads)</span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> compare_strategies(<span class="va">self</span>):</span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Compare load balancing strategies."""</span></span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>        random_max <span class="op">=</span> <span class="va">self</span>.random_assignment()</span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>        two_choices_max <span class="op">=</span> <span class="va">self</span>.power_of_two_choices()</span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Load Balancing Comparison (</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>num_servers<span class="sc">}</span><span class="ss"> servers, 10000 requests):"</span>)</span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  Random assignment:"</span>)</span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"    Max load: </span><span class="sc">{</span>random_max<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"    Expected: ~</span><span class="sc">{</span><span class="dv">10000</span><span class="op">/</span><span class="va">self</span><span class="sc">.</span>num_servers <span class="op">+</span> <span class="dv">3</span><span class="op">*</span>math<span class="sc">.</span>sqrt(<span class="dv">10000</span><span class="op">/</span><span class="va">self</span>.num_servers)<span class="sc">:.0f}</span><span class="ss">"</span>)</span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  Power of two choices:"</span>)</span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"    Max load: </span><span class="sc">{</span>two_choices_max<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"    Improvement: </span><span class="sc">{</span>random_max<span class="op">/</span>two_choices_max<span class="sc">:.1f}</span><span class="ss">x better!"</span>)</span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Demo</span></span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a>balancer <span class="op">=</span> LoadBalancer(<span class="dv">100</span>)</span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a>balancer.compare_strategies()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="ab-testing-with-statistical-significance" class="level3" data-number="7.11.2">
<h3 data-number="7.11.2" class="anchored" data-anchor-id="ab-testing-with-statistical-significance"><span class="header-section-number">7.11.2</span> A/B Testing with Statistical Significance</h3>
<p>In web development and product design, randomized experiments help make data-driven decisions.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ABTest:</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Simple A/B testing framework with statistical significance.</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, name<span class="op">=</span><span class="st">"Experiment"</span>):</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.name <span class="op">=</span> name</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.group_a <span class="op">=</span> {<span class="st">'visitors'</span>: <span class="dv">0</span>, <span class="st">'conversions'</span>: <span class="dv">0</span>}</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.group_b <span class="op">=</span> {<span class="st">'visitors'</span>: <span class="dv">0</span>, <span class="st">'conversions'</span>: <span class="dv">0</span>}</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> assign_visitor(<span class="va">self</span>):</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Randomly assign visitor to group A or B."""</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> random.random() <span class="op">&lt;</span> <span class="fl">0.5</span>:</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.group_a[<span class="st">'visitors'</span>] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">'A'</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.group_b[<span class="st">'visitors'</span>] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">'B'</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> record_conversion(<span class="va">self</span>, group):</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Record a conversion for the specified group."""</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> group <span class="op">==</span> <span class="st">'A'</span>:</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.group_a[<span class="st">'conversions'</span>] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.group_b[<span class="st">'conversions'</span>] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> analyze_results(<span class="va">self</span>):</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a><span class="co">        Calculate statistical significance of results.</span></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a><span class="co">        Using normal approximation to binomial.</span></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate conversion rates</span></span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>        rate_a <span class="op">=</span> <span class="va">self</span>.group_a[<span class="st">'conversions'</span>] <span class="op">/</span> <span class="bu">max</span>(<span class="va">self</span>.group_a[<span class="st">'visitors'</span>], <span class="dv">1</span>)</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>        rate_b <span class="op">=</span> <span class="va">self</span>.group_b[<span class="st">'conversions'</span>] <span class="op">/</span> <span class="bu">max</span>(<span class="va">self</span>.group_b[<span class="st">'visitors'</span>], <span class="dv">1</span>)</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>        n_a <span class="op">=</span> <span class="va">self</span>.group_a[<span class="st">'visitors'</span>]</span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>        n_b <span class="op">=</span> <span class="va">self</span>.group_b[<span class="st">'visitors'</span>]</span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> n_a <span class="op">&lt;</span> <span class="dv">100</span> <span class="kw">or</span> n_b <span class="op">&lt;</span> <span class="dv">100</span>:</span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Need more data! (A: </span><span class="sc">{</span>n_a<span class="sc">}</span><span class="ss"> visitors, B: </span><span class="sc">{</span>n_b<span class="sc">}</span><span class="ss"> visitors)"</span>)</span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Pooled conversion rate for variance calculation</span></span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a>        pooled_rate <span class="op">=</span> (<span class="va">self</span>.group_a[<span class="st">'conversions'</span>] <span class="op">+</span> <span class="va">self</span>.group_b[<span class="st">'conversions'</span>]) <span class="op">/</span> (n_a <span class="op">+</span> n_b)</span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Standard error</span></span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a>        se <span class="op">=</span> math.sqrt(pooled_rate <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> pooled_rate) <span class="op">*</span> (<span class="dv">1</span><span class="op">/</span>n_a <span class="op">+</span> <span class="dv">1</span><span class="op">/</span>n_b))</span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Z-score</span></span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a>        z <span class="op">=</span> (rate_b <span class="op">-</span> rate_a) <span class="op">/</span> se <span class="cf">if</span> se <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a>        <span class="co"># P-value (two-tailed test)</span></span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Using approximation for normal CDF</span></span>
<span id="cb16-54"><a href="#cb16-54" aria-hidden="true" tabindex="-1"></a>        p_value <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> <span class="va">self</span>._normal_cdf(<span class="bu">abs</span>(z)))</span>
<span id="cb16-55"><a href="#cb16-55" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-56"><a href="#cb16-56" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">A/B Test Results: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>name<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb16-57"><a href="#cb16-57" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  Group A: </span><span class="sc">{</span>rate_a<span class="sc">:.2%}</span><span class="ss"> conversion (</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>group_a[<span class="st">'conversions'</span>]<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>n_a<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb16-58"><a href="#cb16-58" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  Group B: </span><span class="sc">{</span>rate_b<span class="sc">:.2%}</span><span class="ss"> conversion (</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>group_b[<span class="st">'conversions'</span>]<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>n_b<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb16-59"><a href="#cb16-59" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  Relative improvement: </span><span class="sc">{</span>((rate_b<span class="op">/</span>rate_a <span class="op">-</span> <span class="dv">1</span>) <span class="op">*</span> <span class="dv">100</span>)<span class="sc">:.1f}</span><span class="ss">%"</span>)</span>
<span id="cb16-60"><a href="#cb16-60" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  Z-score: </span><span class="sc">{</span>z<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb16-61"><a href="#cb16-61" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  P-value: </span><span class="sc">{</span>p_value<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb16-62"><a href="#cb16-62" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-63"><a href="#cb16-63" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> p_value <span class="op">&lt;</span> <span class="fl">0.05</span>:</span>
<span id="cb16-64"><a href="#cb16-64" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"  Result: STATISTICALLY SIGNIFICANT! (p &lt; 0.05)"</span>)</span>
<span id="cb16-65"><a href="#cb16-65" aria-hidden="true" tabindex="-1"></a>            winner <span class="op">=</span> <span class="st">'B'</span> <span class="cf">if</span> rate_b <span class="op">&gt;</span> rate_a <span class="cf">else</span> <span class="st">'A'</span></span>
<span id="cb16-66"><a href="#cb16-66" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"  Winner: Group </span><span class="sc">{</span>winner<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb16-67"><a href="#cb16-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb16-68"><a href="#cb16-68" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"  Result: Not statistically significant (need more data)"</span>)</span>
<span id="cb16-69"><a href="#cb16-69" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-70"><a href="#cb16-70" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _normal_cdf(<span class="va">self</span>, z):</span>
<span id="cb16-71"><a href="#cb16-71" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Approximate normal CDF using error function."""</span></span>
<span id="cb16-72"><a href="#cb16-72" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="fl">0.5</span> <span class="op">*</span> (<span class="dv">1</span> <span class="op">+</span> math.erf(z <span class="op">/</span> math.sqrt(<span class="dv">2</span>)))</span>
<span id="cb16-73"><a href="#cb16-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-74"><a href="#cb16-74" aria-hidden="true" tabindex="-1"></a><span class="co"># Demo A/B test</span></span>
<span id="cb16-75"><a href="#cb16-75" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ab_test_demo():</span>
<span id="cb16-76"><a href="#cb16-76" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb16-77"><a href="#cb16-77" aria-hidden="true" tabindex="-1"></a><span class="co">    Simulate an A/B test with different conversion rates.</span></span>
<span id="cb16-78"><a href="#cb16-78" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb16-79"><a href="#cb16-79" aria-hidden="true" tabindex="-1"></a>    test <span class="op">=</span> ABTest(<span class="st">"Button Color Test"</span>)</span>
<span id="cb16-80"><a href="#cb16-80" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-81"><a href="#cb16-81" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Simulate visitors</span></span>
<span id="cb16-82"><a href="#cb16-82" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Group A (blue button): 10% conversion</span></span>
<span id="cb16-83"><a href="#cb16-83" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Group B (green button): 12% conversion (20% better!)</span></span>
<span id="cb16-84"><a href="#cb16-84" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-85"><a href="#cb16-85" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5000</span>):</span>
<span id="cb16-86"><a href="#cb16-86" aria-hidden="true" tabindex="-1"></a>        group <span class="op">=</span> test.assign_visitor()</span>
<span id="cb16-87"><a href="#cb16-87" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-88"><a href="#cb16-88" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Simulate conversion based on group</span></span>
<span id="cb16-89"><a href="#cb16-89" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> group <span class="op">==</span> <span class="st">'A'</span>:</span>
<span id="cb16-90"><a href="#cb16-90" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> random.random() <span class="op">&lt;</span> <span class="fl">0.10</span>:  <span class="co"># 10% conversion</span></span>
<span id="cb16-91"><a href="#cb16-91" aria-hidden="true" tabindex="-1"></a>                test.record_conversion(<span class="st">'A'</span>)</span>
<span id="cb16-92"><a href="#cb16-92" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb16-93"><a href="#cb16-93" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> random.random() <span class="op">&lt;</span> <span class="fl">0.12</span>:  <span class="co"># 12% conversion</span></span>
<span id="cb16-94"><a href="#cb16-94" aria-hidden="true" tabindex="-1"></a>                test.record_conversion(<span class="st">'B'</span>)</span>
<span id="cb16-95"><a href="#cb16-95" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-96"><a href="#cb16-96" aria-hidden="true" tabindex="-1"></a>    test.analyze_results()</span>
<span id="cb16-97"><a href="#cb16-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-98"><a href="#cb16-98" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the demo</span></span>
<span id="cb16-99"><a href="#cb16-99" aria-hidden="true" tabindex="-1"></a><span class="co"># ab_test_demo()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<hr>
</section>
</section>
<section id="summary-the-power-of-controlled-randomness" class="level2" data-number="7.12">
<h2 data-number="7.12" class="anchored" data-anchor-id="summary-the-power-of-controlled-randomness"><span class="header-section-number">7.12</span> Summary: The Power of Controlled Randomness</h2>
<section id="key-takeaways" class="level3" data-number="7.12.1">
<h3 data-number="7.12.1" class="anchored" data-anchor-id="key-takeaways"><span class="header-section-number">7.12.1</span> Key Takeaways</h3>
<ol type="1">
<li><strong>Randomization Eliminates Worst Cases</strong>
<ul>
<li>No adversary can force bad performance</li>
<li>Every input becomes ‚Äúaverage case‚Äù</li>
</ul></li>
<li><strong>Two Types of Randomized Algorithms</strong>
<ul>
<li><strong>Las Vegas:</strong> Always correct, random time</li>
<li><strong>Monte Carlo:</strong> Fixed time, probably correct</li>
</ul></li>
<li><strong>Probability Concentrates</strong>
<ul>
<li>Random events cluster around expectations</li>
<li>Bad luck is exponentially unlikely</li>
<li>Multiple runs boost confidence</li>
</ul></li>
<li><strong>Simplicity and Elegance</strong>
<ul>
<li>Randomized algorithms are often simpler</li>
<li>Easier to implement and understand</li>
<li>Natural parallelization</li>
</ul></li>
<li><strong>Real-World Impact</strong>
<ul>
<li>Used in databases, networks, security</li>
<li>Powers big data analytics</li>
<li>Essential for modern computing</li>
</ul></li>
</ol>
</section>
<section id="when-to-use-randomization" class="level3" data-number="7.12.2">
<h3 data-number="7.12.2" class="anchored" data-anchor-id="when-to-use-randomization"><span class="header-section-number">7.12.2</span> When to Use Randomization</h3>
<p>‚úÖ <strong>Use When:</strong> - Worst-case is much worse than average - Need simple, practical solution - Dealing with massive data - Want to prevent adversarial inputs - Small error probability is acceptable</p>
<p>‚ùå <strong>Avoid When:</strong> - Absolute correctness required - Need reproducible results - Limited random number generation - Real-time guarantees essential</p>
</section>
<section id="final-thought" class="level3" data-number="7.12.3">
<h3 data-number="7.12.3" class="anchored" data-anchor-id="final-thought"><span class="header-section-number">7.12.3</span> Final Thought</h3>
<p><em>‚ÄúIn the face of complexity, randomness is often our best strategy.‚Äù</em></p>
<p>Randomized algorithms show us that embracing uncertainty can lead to more certain outcomes. By giving up a tiny bit of determinism, we gain massive improvements in simplicity, speed, and robustness.</p>
<p>Next chapter, we‚Äôll explore the limits of computation itself with NP-Completeness!</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "Óßã";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../chapters/05-Dynamic-Programming.html" class="pagination-link" aria-label="Advanced Algorithms: A Journey Through Computational Problem Solving">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Advanced Algorithms: A Journey Through Computational Problem Solving</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->




</body></html>