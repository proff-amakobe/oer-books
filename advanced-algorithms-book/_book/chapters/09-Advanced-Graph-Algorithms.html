<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>10&nbsp; Chapter 9: Advanced Graph Algorithms - Making Things Flow – Advanced Computational Algorithms</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../chapters/10-String-Processing-Algorithms.html" rel="next">
<link href="../chapters/08-Approximation-Algorithms.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-9b98f18118eee809be1c051eb5cc78e4.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/09-Advanced-Graph-Algorithms.html">Part IV: Advanced Topics</a></li><li class="breadcrumb-item"><a href="../chapters/09-Advanced-Graph-Algorithms.html"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Chapter 9: Advanced Graph Algorithms - Making Things Flow</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Advanced Computational Algorithms</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Preface</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Advanced Computational Algorithms</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Part 1: Foundations</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/01-introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Advanced Algorithms: A Journey Through Computational Problem Solving</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/02-Divide-and-Conquer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Advanced Algorithms: A Journey Through Computational Problem Solving</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Part II: Core Techniques</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/03-Data-Structures-for-Efficiency.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Chapter 3: Data Structures for Efficiency</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/04-Greedy-Algorithms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Chapter 4: Greedy Algorithms - When Local Optimality Leads to Global Solutions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/05-Dynamic-Programming.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Advanced Algorithms: A Journey Through Computational Problem Solving</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/06-Randomized-Algorithms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Chapter 6: Randomized Algorithms - The Power of Controlled Chaos</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Part III: Complexity and Hard Problems</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/07-Computational-Complexity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Chapter 7: Computational Complexity &amp; NP-Completeness - The Limits of Computing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/08-Approximation-Algorithms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Chapter 8: Approximation Algorithms - When “Good Enough” is Perfect</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Part IV: Advanced Topics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/09-Advanced-Graph-Algorithms.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Chapter 9: Advanced Graph Algorithms - Making Things Flow</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/10-String-Processing-Algorithms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Chapter 10: String Algorithms - Finding Needles in Haystacks at Light Speed</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/11-Numerical-Algorithms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Chapter 11: Matrix &amp; Numerical Algorithms - When Math Meets Speed</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/12-Advanced-Data-Structures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Chapter 12: Advanced Data Structures - When Arrays and Trees Aren’t Enough</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Part V: Applications and Professional Practice</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/13-Research-Industry-Applications.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Chapter 13: Research and Industry Applications - Where Algorithms Meet Reality</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/14-Project-Development.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Chapter 14: Project Development &amp; Presentation Prep - Bringing It All Together</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/15-Final-Presentations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Chapter 15: Final Presentations &amp; Submission - Showcasing Your Mastery</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction-the-universal-language-of-flow" id="toc-introduction-the-universal-language-of-flow" class="nav-link active" data-scroll-target="#introduction-the-universal-language-of-flow"><span class="header-section-number">10.1</span> 9.1 Introduction: The Universal Language of Flow</a></li>
  <li><a href="#network-flow-the-big-picture" id="toc-network-flow-the-big-picture" class="nav-link" data-scroll-target="#network-flow-the-big-picture"><span class="header-section-number">10.2</span> 9.2 Network Flow: The Big Picture</a>
  <ul class="collapse">
  <li><a href="#what-is-a-flow-network" id="toc-what-is-a-flow-network" class="nav-link" data-scroll-target="#what-is-a-flow-network"><span class="header-section-number">10.2.1</span> 9.2.1 What is a Flow Network?</a></li>
  <li><a href="#the-two-sacred-rules-of-flow" id="toc-the-two-sacred-rules-of-flow" class="nav-link" data-scroll-target="#the-two-sacred-rules-of-flow"><span class="header-section-number">10.2.2</span> 9.2.2 The Two Sacred Rules of Flow</a></li>
  <li><a href="#a-simple-example" id="toc-a-simple-example" class="nav-link" data-scroll-target="#a-simple-example"><span class="header-section-number">10.2.3</span> 9.2.3 A Simple Example</a></li>
  <li><a href="#the-genius-idea-the-residual-network" id="toc-the-genius-idea-the-residual-network" class="nav-link" data-scroll-target="#the-genius-idea-the-residual-network"><span class="header-section-number">10.2.4</span> 9.2.4 The Genius Idea: The Residual Network</a></li>
  </ul></li>
  <li><a href="#the-max-flow-min-cut-theorem-one-of-css-greatest-hits" id="toc-the-max-flow-min-cut-theorem-one-of-css-greatest-hits" class="nav-link" data-scroll-target="#the-max-flow-min-cut-theorem-one-of-css-greatest-hits"><span class="header-section-number">10.3</span> 9.3 The Max-Flow Min-Cut Theorem: One of CS’s Greatest Hits</a>
  <ul class="collapse">
  <li><a href="#whats-a-cut" id="toc-whats-a-cut" class="nav-link" data-scroll-target="#whats-a-cut"><span class="header-section-number">10.3.1</span> 9.3.1 What’s a Cut?</a></li>
  <li><a href="#the-theorem-that-changes-everything" id="toc-the-theorem-that-changes-everything" class="nav-link" data-scroll-target="#the-theorem-that-changes-everything"><span class="header-section-number">10.3.2</span> 9.3.2 The Theorem That Changes Everything</a></li>
  <li><a href="#finding-the-min-cut-its-free" id="toc-finding-the-min-cut-its-free" class="nav-link" data-scroll-target="#finding-the-min-cut-its-free"><span class="header-section-number">10.3.3</span> 9.3.3 Finding the Min Cut (It’s Free!)</a></li>
  </ul></li>
  <li><a href="#ford-fulkerson-the-classic-algorithm" id="toc-ford-fulkerson-the-classic-algorithm" class="nav-link" data-scroll-target="#ford-fulkerson-the-classic-algorithm"><span class="header-section-number">10.4</span> 9.4 Ford-Fulkerson: The Classic Algorithm</a>
  <ul class="collapse">
  <li><a href="#the-basic-idea" id="toc-the-basic-idea" class="nav-link" data-scroll-target="#the-basic-idea"><span class="header-section-number">10.4.1</span> 9.4.1 The Basic Idea</a></li>
  <li><a href="#lets-trace-through-an-example-step-by-step" id="toc-lets-trace-through-an-example-step-by-step" class="nav-link" data-scroll-target="#lets-trace-through-an-example-step-by-step"><span class="header-section-number">10.4.2</span> 9.4.2 Let’s Trace Through an Example Step by Step</a></li>
  <li><a href="#edmonds-karp-making-it-actually-fast" id="toc-edmonds-karp-making-it-actually-fast" class="nav-link" data-scroll-target="#edmonds-karp-making-it-actually-fast"><span class="header-section-number">10.4.3</span> 9.4.3 Edmonds-Karp: Making It Actually Fast</a></li>
  <li><a href="#why-bfs-makes-all-the-difference" id="toc-why-bfs-makes-all-the-difference" class="nav-link" data-scroll-target="#why-bfs-makes-all-the-difference"><span class="header-section-number">10.4.4</span> 9.4.4 Why BFS Makes All the Difference</a></li>
  </ul></li>
  <li><a href="#push-relabel-the-modern-approach" id="toc-push-relabel-the-modern-approach" class="nav-link" data-scroll-target="#push-relabel-the-modern-approach"><span class="header-section-number">10.5</span> 9.5 Push-Relabel: The Modern Approach</a>
  <ul class="collapse">
  <li><a href="#a-completely-different-philosophy" id="toc-a-completely-different-philosophy" class="nav-link" data-scroll-target="#a-completely-different-philosophy"><span class="header-section-number">10.5.1</span> 9.5.1 A Completely Different Philosophy</a></li>
  <li><a href="#the-key-concepts" id="toc-the-key-concepts" class="nav-link" data-scroll-target="#the-key-concepts"><span class="header-section-number">10.5.2</span> 9.5.2 The Key Concepts</a></li>
  <li><a href="#the-algorithm" id="toc-the-algorithm" class="nav-link" data-scroll-target="#the-algorithm"><span class="header-section-number">10.5.3</span> 9.5.3 The Algorithm</a></li>
  <li><a href="#why-does-this-work" id="toc-why-does-this-work" class="nav-link" data-scroll-target="#why-does-this-work"><span class="header-section-number">10.5.4</span> 9.5.4 Why Does This Work?</a></li>
  <li><a href="#which-algorithm-should-you-use" id="toc-which-algorithm-should-you-use" class="nav-link" data-scroll-target="#which-algorithm-should-you-use"><span class="header-section-number">10.5.5</span> 9.5.5 Which Algorithm Should You Use?</a></li>
  </ul></li>
  <li><a href="#bipartite-matching-when-flow-solves-romance" id="toc-bipartite-matching-when-flow-solves-romance" class="nav-link" data-scroll-target="#bipartite-matching-when-flow-solves-romance"><span class="header-section-number">10.6</span> 9.6 Bipartite Matching: When Flow Solves Romance</a>
  <ul class="collapse">
  <li><a href="#the-matching-problem" id="toc-the-matching-problem" class="nav-link" data-scroll-target="#the-matching-problem"><span class="header-section-number">10.6.1</span> 9.6.1 The Matching Problem</a></li>
  <li><a href="#the-flow-network-trick" id="toc-the-flow-network-trick" class="nav-link" data-scroll-target="#the-flow-network-trick"><span class="header-section-number">10.6.2</span> 9.6.2 The Flow Network Trick</a></li>
  <li><a href="#implementation" id="toc-implementation" class="nav-link" data-scroll-target="#implementation"><span class="header-section-number">10.6.3</span> 9.6.3 Implementation</a></li>
  <li><a href="#halls-marriage-theorem" id="toc-halls-marriage-theorem" class="nav-link" data-scroll-target="#halls-marriage-theorem"><span class="header-section-number">10.6.4</span> 9.6.4 Hall’s Marriage Theorem</a></li>
  </ul></li>
  <li><a href="#minimum-cost-flow-optimizing-while-flowing" id="toc-minimum-cost-flow-optimizing-while-flowing" class="nav-link" data-scroll-target="#minimum-cost-flow-optimizing-while-flowing"><span class="header-section-number">10.7</span> 9.7 Minimum Cost Flow: Optimizing While Flowing</a>
  <ul class="collapse">
  <li><a href="#the-problem" id="toc-the-problem" class="nav-link" data-scroll-target="#the-problem"><span class="header-section-number">10.7.1</span> 9.7.1 The Problem</a></li>
  <li><a href="#the-setup" id="toc-the-setup" class="nav-link" data-scroll-target="#the-setup"><span class="header-section-number">10.7.2</span> 9.7.2 The Setup</a></li>
  <li><a href="#successive-shortest-paths-algorithm" id="toc-successive-shortest-paths-algorithm" class="nav-link" data-scroll-target="#successive-shortest-paths-algorithm"><span class="header-section-number">10.7.3</span> 9.7.3 Successive Shortest Paths Algorithm</a></li>
  <li><a href="#implementation-1" id="toc-implementation-1" class="nav-link" data-scroll-target="#implementation-1"><span class="header-section-number">10.7.4</span> 9.7.4 Implementation</a></li>
  <li><a href="#cycle-canceling-algorithm" id="toc-cycle-canceling-algorithm" class="nav-link" data-scroll-target="#cycle-canceling-algorithm"><span class="header-section-number">10.7.5</span> 9.7.5 Cycle-Canceling Algorithm</a></li>
  </ul></li>
  <li><a href="#real-world-applications" id="toc-real-world-applications" class="nav-link" data-scroll-target="#real-world-applications"><span class="header-section-number">10.8</span> 9.8 Real-World Applications</a>
  <ul class="collapse">
  <li><a href="#image-segmentation" id="toc-image-segmentation" class="nav-link" data-scroll-target="#image-segmentation"><span class="header-section-number">10.8.1</span> 9.8.1 Image Segmentation</a></li>
  <li><a href="#airline-scheduling" id="toc-airline-scheduling" class="nav-link" data-scroll-target="#airline-scheduling"><span class="header-section-number">10.8.2</span> 9.8.2 Airline Scheduling</a></li>
  <li><a href="#network-reliability" id="toc-network-reliability" class="nav-link" data-scroll-target="#network-reliability"><span class="header-section-number">10.8.3</span> 9.8.3 Network Reliability</a></li>
  <li><a href="#project-selection" id="toc-project-selection" class="nav-link" data-scroll-target="#project-selection"><span class="header-section-number">10.8.4</span> 9.8.4 Project Selection</a></li>
  <li><a href="#baseball-elimination" id="toc-baseball-elimination" class="nav-link" data-scroll-target="#baseball-elimination"><span class="header-section-number">10.8.5</span> 9.8.5 Baseball Elimination</a></li>
  </ul></li>
  <li><a href="#chapter-project-universal-flow-network-solver" id="toc-chapter-project-universal-flow-network-solver" class="nav-link" data-scroll-target="#chapter-project-universal-flow-network-solver"><span class="header-section-number">10.9</span> 9.9 Chapter Project: Universal Flow Network Solver</a>
  <ul class="collapse">
  <li><a href="#project-specification" id="toc-project-specification" class="nav-link" data-scroll-target="#project-specification"><span class="header-section-number">10.9.1</span> 9.9.1 Project Specification</a></li>
  <li><a href="#architecture" id="toc-architecture" class="nav-link" data-scroll-target="#architecture"><span class="header-section-number">10.9.2</span> 9.9.2 Architecture</a></li>
  <li><a href="#core-network-class" id="toc-core-network-class" class="nav-link" data-scroll-target="#core-network-class"><span class="header-section-number">10.9.3</span> 9.9.3 Core Network Class</a></li>
  <li><a href="#algorithm-interface" id="toc-algorithm-interface" class="nav-link" data-scroll-target="#algorithm-interface"><span class="header-section-number">10.9.4</span> 9.9.4 Algorithm Interface</a></li>
  <li><a href="#application-matching-solver" id="toc-application-matching-solver" class="nav-link" data-scroll-target="#application-matching-solver"><span class="header-section-number">10.9.5</span> 9.9.5 Application: Matching Solver</a></li>
  <li><a href="#visualization-module" id="toc-visualization-module" class="nav-link" data-scroll-target="#visualization-module"><span class="header-section-number">10.9.6</span> 9.9.6 Visualization Module</a></li>
  <li><a href="#command-line-interface" id="toc-command-line-interface" class="nav-link" data-scroll-target="#command-line-interface"><span class="header-section-number">10.9.7</span> 9.9.7 Command-Line Interface</a></li>
  <li><a href="#testing-suite" id="toc-testing-suite" class="nav-link" data-scroll-target="#testing-suite"><span class="header-section-number">10.9.8</span> 9.9.8 Testing Suite</a></li>
  </ul></li>
  <li><a href="#summary-and-key-takeaways" id="toc-summary-and-key-takeaways" class="nav-link" data-scroll-target="#summary-and-key-takeaways"><span class="header-section-number">10.10</span> 9.10 Summary and Key Takeaways</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">10.11</span> 9.11 Exercises</a>
  <ul class="collapse">
  <li><a href="#warm-up-problems" id="toc-warm-up-problems" class="nav-link" data-scroll-target="#warm-up-problems"><span class="header-section-number">10.11.1</span> Warm-Up Problems</a></li>
  <li><a href="#implementation-challenges" id="toc-implementation-challenges" class="nav-link" data-scroll-target="#implementation-challenges"><span class="header-section-number">10.11.2</span> Implementation Challenges</a></li>
  <li><a href="#application-problems" id="toc-application-problems" class="nav-link" data-scroll-target="#application-problems"><span class="header-section-number">10.11.3</span> Application Problems</a></li>
  <li><a href="#theoretical-questions" id="toc-theoretical-questions" class="nav-link" data-scroll-target="#theoretical-questions"><span class="header-section-number">10.11.4</span> Theoretical Questions</a></li>
  <li><a href="#research-extensions" id="toc-research-extensions" class="nav-link" data-scroll-target="#research-extensions"><span class="header-section-number">10.11.5</span> Research Extensions</a></li>
  </ul></li>
  <li><a href="#further-reading" id="toc-further-reading" class="nav-link" data-scroll-target="#further-reading"><span class="header-section-number">10.12</span> 9.12 Further Reading</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/09-Advanced-Graph-Algorithms.html">Part IV: Advanced Topics</a></li><li class="breadcrumb-item"><a href="../chapters/09-Advanced-Graph-Algorithms.html"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Chapter 9: Advanced Graph Algorithms - Making Things Flow</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Chapter 9: Advanced Graph Algorithms - Making Things Flow</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><strong>When Pipes, Traffic, and Romance All Follow the Same Rules</strong></p>
<p><em>“You can’t push a gallon through a pint tube.”</em> - Old engineering wisdom</p>
<p><em>“But you can prove mathematically that you’re pushing the maximum possible gallon through your network of pint tubes.”</em> - Modern computer science</p>
<section id="introduction-the-universal-language-of-flow" class="level2" data-number="10.1">
<h2 data-number="10.1" class="anchored" data-anchor-id="introduction-the-universal-language-of-flow"><span class="header-section-number">10.1</span> 9.1 Introduction: The Universal Language of Flow</h2>
<p>Here’s a wild fact: the algorithm that finds the maximum number of cars that can flow through a highway network is <strong>exactly the same algorithm</strong> that:</p>
<ul>
<li>Matches medical students to residency programs</li>
<li>Routes data through the internet</li>
<li>Determines how to cut an image into foreground and background</li>
<li>Schedules flights for airlines</li>
<li>Assigns teachers to classrooms</li>
</ul>
<p>How is this possible? Because all these problems are secretly about <strong>flow</strong>.</p>
<p>Think about water flowing through pipes. You have a source (maybe a water tower) and a sink (maybe a city). Between them is a network of pipes, each with a maximum capacity. The question is simple: <strong>What’s the maximum amount of water you can push through this network?</strong></p>
<p>This question, first studied seriously in the 1950s, turned out to be one of the most useful questions in all of computer science. The algorithms we’ll learn in this chapter power everything from Google’s data centers to the app that matched you with your college roommate.</p>
<p>And here’s the beautiful part: we’re going to prove that finding maximum flow is <strong>exactly equivalent</strong> to finding the smallest bottleneck in the network. Two completely different-sounding problems, one elegant solution.</p>
<p>Ready to dive in? Let’s start with the basics and build up to some seriously cool applications.</p>
</section>
<section id="network-flow-the-big-picture" class="level2" data-number="10.2">
<h2 data-number="10.2" class="anchored" data-anchor-id="network-flow-the-big-picture"><span class="header-section-number">10.2</span> 9.2 Network Flow: The Big Picture</h2>
<section id="what-is-a-flow-network" class="level3" data-number="10.2.1">
<h3 data-number="10.2.1" class="anchored" data-anchor-id="what-is-a-flow-network"><span class="header-section-number">10.2.1</span> 9.2.1 What is a Flow Network?</h3>
<p>Imagine you’re designing the plumbing for a new building. You have:</p>
<ul>
<li><strong>A water source</strong> (the main line from the city)</li>
<li><strong>A destination</strong> (the building’s water tank)</li>
<li><strong>A bunch of pipes</strong> connecting them, each with a maximum flow rate</li>
</ul>
<p>Your job: figure out the maximum gallons per minute you can deliver.</p>
<p>In graph terms, a <strong>flow network</strong> is just a directed graph with some extra information:</p>
<ol type="1">
<li><strong>Source vertex (s)</strong>: Where stuff comes from</li>
<li><strong>Sink vertex (t)</strong>: Where stuff goes to</li>
<li><strong>Capacity on each edge</strong>: The maximum “stuff” that can flow through that edge</li>
</ol>
<p>The “stuff” could be water, cars, data packets, electricity, or (as we’ll see later) something completely abstract like “matching potential.”</p>
</section>
<section id="the-two-sacred-rules-of-flow" class="level3" data-number="10.2.2">
<h3 data-number="10.2.2" class="anchored" data-anchor-id="the-two-sacred-rules-of-flow"><span class="header-section-number">10.2.2</span> 9.2.2 The Two Sacred Rules of Flow</h3>
<p>Flow has to follow two non-negotiable rules:</p>
<p><strong>Rule 1: Don’t Break the Pipes (Capacity Constraint)</strong></p>
<p>You can’t push more flow through a pipe than it can handle. If an edge has capacity 10, you can send anywhere from 0 to 10 units through it, but not 11.</p>
<p>Formally: 0 ≤ f(u,v) ≤ c(u,v) for every edge.</p>
<p><strong>Rule 2: What Goes In Must Come Out (Flow Conservation)</strong></p>
<p>At every vertex except the source and sink, the flow coming in equals the flow going out. Flow can’t magically appear or disappear in the middle of the network.</p>
<p>Think of a busy intersection: if 100 cars per minute enter from all directions, then 100 cars per minute must leave. Cars don’t pile up or vanish at the intersection.</p>
<p>Formally: Σ flow-in = Σ flow-out for every vertex except s and t.</p>
</section>
<section id="a-simple-example" class="level3" data-number="10.2.3">
<h3 data-number="10.2.3" class="anchored" data-anchor-id="a-simple-example"><span class="header-section-number">10.2.3</span> 9.2.3 A Simple Example</h3>
<p>Let’s look at a tiny network:</p>
<pre><code>        [capacity: 10]
    s ----------------&gt; a
    |                   |
    |                   | [capacity: 10]
    |[5]                |
    |                   v
    v                   t
    b -----------------&gt;
        [capacity: 15]</code></pre>
<p><strong>Question</strong>: What’s the maximum flow from s to t?</p>
<p><strong>First guess</strong>: Maybe 25? (10 through the top + 15 through the bottom)</p>
<p><strong>Wrong!</strong> Look at edge s→b. It only has capacity 5. So the bottom path can only carry 5 units.</p>
<p><strong>Second guess</strong>: 15? (10 through top, 5 through bottom)</p>
<p><strong>Correct!</strong> Here’s one way to achieve it: - Send 10 units along s → a → t - Send 5 units along s → b → t - Total: 15 units</p>
<p>Can we do better? Nope! And soon we’ll prove why.</p>
</section>
<section id="the-genius-idea-the-residual-network" class="level3" data-number="10.2.4">
<h3 data-number="10.2.4" class="anchored" data-anchor-id="the-genius-idea-the-residual-network"><span class="header-section-number">10.2.4</span> 9.2.4 The Genius Idea: The Residual Network</h3>
<p>Here’s where things get clever. Imagine you’ve already sent some flow through the network. Now you’re wondering: “Can I push more?”</p>
<p>To answer this, we create something called the <strong>residual network</strong>. This is a graph that shows: 1. How much <strong>more</strong> flow you can push along each edge (forward capacity) 2. How much flow you can <strong>undo</strong> by rerouting (backward capacity)</p>
<p><strong>Wait, undo flow? What?</strong></p>
<p>Yes! This is the key insight. Let’s say you’re already pushing 7 units through an edge with capacity 10. The residual network shows:</p>
<ul>
<li><strong>Forward edge</strong>: You can push 3 more units (10 - 7 = 3)</li>
<li><strong>Backward edge</strong>: You can “undo” up to 7 units by rerouting that flow elsewhere</li>
</ul>
<p>The backward edge isn’t about water flowing backward in physical pipes. It’s about our <strong>freedom to change our mind</strong> about routing decisions.</p>
<p><strong>Concrete example:</strong></p>
<pre><code>Original: You're pushing 7 units through edge (u,v) with capacity 10

Residual network shows:
u --[3]--&gt;  v    (can push 3 more forward)
u  &lt;--[7]-- v    (can "cancel" up to 7 units)</code></pre>
<p>If you later find a better path that uses the backward edge from v to u, you’re essentially redirecting some of that flow to a better route.</p>
<p>This idea—that we can undo bad routing decisions—is what makes flow algorithms work!</p>
</section>
</section>
<section id="the-max-flow-min-cut-theorem-one-of-css-greatest-hits" class="level2" data-number="10.3">
<h2 data-number="10.3" class="anchored" data-anchor-id="the-max-flow-min-cut-theorem-one-of-css-greatest-hits"><span class="header-section-number">10.3</span> 9.3 The Max-Flow Min-Cut Theorem: One of CS’s Greatest Hits</h2>
<section id="whats-a-cut" class="level3" data-number="10.3.1">
<h3 data-number="10.3.1" class="anchored" data-anchor-id="whats-a-cut"><span class="header-section-number">10.3.1</span> 9.3.1 What’s a Cut?</h3>
<p>Imagine taking scissors and cutting your flow network into two pieces: one piece containing the source, one containing the sink. The <strong>capacity of the cut</strong> is the total capacity of edges you cut.</p>
<pre><code>    s ---[10]---&gt; a ---[10]---&gt; t
    |                            ^
    |[5]                         |
    v                            |[15]
    b ---------------------------&gt;

If I cut here: |  then I sever these edges
              |
    s    a    |     t
         b    |</code></pre>
<p>In this example, cutting between {s,a,b} and {t} means we cut edges a→t and b→t, giving us a cut capacity of 10 + 15 = 25.</p>
<p>Different cuts have different capacities. The <strong>minimum cut</strong> is the cut with the smallest capacity.</p>
</section>
<section id="the-theorem-that-changes-everything" class="level3" data-number="10.3.2">
<h3 data-number="10.3.2" class="anchored" data-anchor-id="the-theorem-that-changes-everything"><span class="header-section-number">10.3.2</span> 9.3.2 The Theorem That Changes Everything</h3>
<p><strong>Max-Flow Min-Cut Theorem</strong> (Ford &amp; Fulkerson, 1956):</p>
<p><em>The maximum amount of flow you can push through a network equals the capacity of the minimum cut.</em></p>
<p>Read that again. It’s saying that two seemingly different problems—maximizing flow and finding the smallest bottleneck—<strong>always give the same answer</strong>.</p>
<p><strong>Why is this amazing?</strong></p>
<ol type="1">
<li>It proves that when you can’t find any way to increase flow, you’ve found the maximum</li>
<li>It gives us a way to verify our answer (find the min cut and check its capacity)</li>
<li>It connects optimization (max flow) with structure (min cut)</li>
<li>It’s surprising! There’s no obvious reason these two should be equal</li>
</ol>
<p><strong>Intuition</strong>:</p>
<p>Think of a busy highway system. The maximum traffic flow is limited by the narrowest bottleneck. If you removed that bottleneck, traffic would just be limited by the next bottleneck. The minimum cut identifies all the bottlenecks at once.</p>
</section>
<section id="finding-the-min-cut-its-free" class="level3" data-number="10.3.3">
<h3 data-number="10.3.3" class="anchored" data-anchor-id="finding-the-min-cut-its-free"><span class="header-section-number">10.3.3</span> 9.3.3 Finding the Min Cut (It’s Free!)</h3>
<p>Once you’ve computed maximum flow, finding the minimum cut is trivial:</p>
<ol type="1">
<li>Look at the final residual network</li>
<li>Find all vertices you can reach from the source</li>
<li>Everything reachable is on one side of the cut; everything else is on the other side</li>
</ol>
<p>The edges crossing from the reachable to unreachable vertices form your minimum cut!</p>
<p>Why does this work? If a vertex is still reachable in the residual network, there’s unused capacity toward it. The unreachable vertices are cut off—we’ve maxed out all paths to them.</p>
</section>
</section>
<section id="ford-fulkerson-the-classic-algorithm" class="level2" data-number="10.4">
<h2 data-number="10.4" class="anchored" data-anchor-id="ford-fulkerson-the-classic-algorithm"><span class="header-section-number">10.4</span> 9.4 Ford-Fulkerson: The Classic Algorithm</h2>
<section id="the-basic-idea" class="level3" data-number="10.4.1">
<h3 data-number="10.4.1" class="anchored" data-anchor-id="the-basic-idea"><span class="header-section-number">10.4.1</span> 9.4.1 The Basic Idea</h3>
<p>Ford-Fulkerson is almost insultingly simple:</p>
<pre><code>Start with zero flow everywhere

While you can find ANY path from source to sink in the residual network:
    1. Find the bottleneck (edge with smallest residual capacity)
    2. Push that much flow along the path
    3. Update the residual network

Return the total flow</code></pre>
<p>That’s it! Find a path, push flow, repeat until no paths remain.</p>
</section>
<section id="lets-trace-through-an-example-step-by-step" class="level3" data-number="10.4.2">
<h3 data-number="10.4.2" class="anchored" data-anchor-id="lets-trace-through-an-example-step-by-step"><span class="header-section-number">10.4.2</span> 9.4.2 Let’s Trace Through an Example Step by Step</h3>
<p>Let’s work through a complete example so you really see how this works:</p>
<pre><code>Initial network (numbers show capacities):

        s --[16]-&gt; v1 --[12]-&gt; t
        |          |            ^
     [13]|       [9]|         [20]|
        |          v            |
        v2 --[4]-&gt; v3 --[7]-&gt; v4
        |                       ^
     [14]|____________________[4]|</code></pre>
<p><strong>Start</strong>: Flow everywhere is zero.</p>
<p><strong>Round 1</strong>: “I’ll try the path s → v1 → t”</p>
<ul>
<li>Bottleneck: min(16, 12) = 12</li>
<li>Push 12 units</li>
<li>Update: s→v1 now has flow 12, v1→t has flow 12</li>
<li><strong>Total flow: 12</strong></li>
</ul>
<p><strong>Round 2</strong>: “Hmm, can I find another path? Yes! s → v1 → v3 → v4 → t”</p>
<ul>
<li>Wait, s→v1 already has flow 12 and capacity 16, so residual capacity is 4</li>
<li>Bottleneck: min(4, 9, 7, 20) = 4</li>
<li>Push 4 units</li>
<li><strong>Total flow: 16</strong></li>
</ul>
<p><strong>Round 3</strong>: “Let me try s → v2 → v3 → v4 → t”</p>
<ul>
<li>Bottleneck: min(13, 4, 3, 16) = 3 (Note: v3→v4 now has residual capacity 3 because we already pushed 4)</li>
<li>Push 3 units</li>
<li><strong>Total flow: 19</strong></li>
</ul>
<p><strong>Round 4</strong>: “What about s → v2 → v4 → t?”</p>
<ul>
<li>Bottleneck: min(10, 4, 13) = 4</li>
<li>Push 4 units</li>
<li><strong>Total flow: 23</strong></li>
</ul>
<p><strong>Round 5</strong>: “Can I find another path?”</p>
<ul>
<li>Nope! All paths to t are saturated or blocked</li>
<li><strong>Done! Maximum flow = 23</strong></li>
</ul>
<p>See how we kept finding paths and pushing flow until we couldn’t anymore? That’s the entire algorithm!</p>
</section>
<section id="edmonds-karp-making-it-actually-fast" class="level3" data-number="10.4.3">
<h3 data-number="10.4.3" class="anchored" data-anchor-id="edmonds-karp-making-it-actually-fast"><span class="header-section-number">10.4.3</span> 9.4.3 Edmonds-Karp: Making It Actually Fast</h3>
<p>There’s a problem with basic Ford-Fulkerson: <strong>which path should we choose?</strong></p>
<p>If you choose paths badly, the algorithm can be horribly slow. In fact, with irrational capacities, it might not even terminate! (This is one of those weird theoretical cases, but it’s important to know.)</p>
<p><strong>Edmonds-Karp</strong> solves this by making one simple choice:</p>
<p><strong>Always pick the shortest path (in terms of number of edges).</strong></p>
<p>Use BFS to find the path, and boom—you get a polynomial-time guarantee!</p>
<p><strong>Time complexity</strong>: O(VE²)</p>
<p>This might seem like a small tweak, but it’s huge. By always taking the shortest path, you guarantee that: 1. Each edge appears on at most O(VE) augmenting paths 2. The algorithm terminates in a reasonable number of steps 3. You don’t get stuck in weird infinite loops</p>
<p>Here’s a complete, production-ready implementation:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> deque, defaultdict</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> EdmondsKarp:</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Maximum flow using Edmonds-Karp algorithm.</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Uses BFS to find shortest augmenting paths.</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, n):</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co">        Create a flow network with n vertices (numbered 0 to n-1).</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.n <span class="op">=</span> n</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># capacity[u][v] = capacity of edge from u to v</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.capacity <span class="op">=</span> defaultdict(<span class="kw">lambda</span>: defaultdict(<span class="bu">int</span>))</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>        <span class="co"># flow[u][v] = current flow on edge from u to v</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.flow <span class="op">=</span> defaultdict(<span class="kw">lambda</span>: defaultdict(<span class="bu">int</span>))</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>        <span class="co"># adjacency list (includes both directions for residual graph)</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.adj <span class="op">=</span> defaultdict(<span class="bu">set</span>)</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> add_edge(<span class="va">self</span>, u, v, cap):</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="co">        Add edge from u to v with capacity cap.</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="co">        Args:</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="co">            u: source vertex</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a><span class="co">            v: destination vertex</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="co">            cap: capacity (can be fractional)</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.capacity[u][v] <span class="op">+=</span> cap  <span class="co"># += handles multiple edges</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.adj[u].add(v)</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.adj[v].add(u)  <span class="co"># for backward edges in residual graph</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> bfs(<span class="va">self</span>, s, t, parent):</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a><span class="co">        Find shortest augmenting path using BFS.</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a><span class="co">        Args:</span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a><span class="co">            s: source vertex</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a><span class="co">            t: sink vertex</span></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a><span class="co">            parent: dict to store the path</span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a><span class="co">            </span></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns:</span></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a><span class="co">            True if path exists, False otherwise</span></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>        visited <span class="op">=</span> <span class="bu">set</span>([s])</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>        queue <span class="op">=</span> deque([s])</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> queue:</span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>            u <span class="op">=</span> queue.popleft()</span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> v <span class="kw">in</span> <span class="va">self</span>.adj[u]:</span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Check residual capacity</span></span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>                residual <span class="op">=</span> <span class="va">self</span>.capacity[u][v] <span class="op">-</span> <span class="va">self</span>.flow[u][v]</span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> v <span class="kw">not</span> <span class="kw">in</span> visited <span class="kw">and</span> residual <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>                    visited.add(v)</span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>                    parent[v] <span class="op">=</span> u</span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># Found the sink!</span></span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> v <span class="op">==</span> t:</span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>                    queue.append(v)</span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> max_flow(<span class="va">self</span>, s, t):</span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a><span class="co">        Compute maximum flow from s to t.</span></span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a><span class="co">        Args:</span></span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a><span class="co">            s: source vertex</span></span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a><span class="co">            t: sink vertex</span></span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a><span class="co">            </span></span>
<span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns:</span></span>
<span id="cb6-77"><a href="#cb6-77" aria-hidden="true" tabindex="-1"></a><span class="co">            Maximum flow value</span></span>
<span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb6-79"><a href="#cb6-79" aria-hidden="true" tabindex="-1"></a>        parent <span class="op">=</span> {}</span>
<span id="cb6-80"><a href="#cb6-80" aria-hidden="true" tabindex="-1"></a>        max_flow_value <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb6-81"><a href="#cb6-81" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-82"><a href="#cb6-82" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Keep finding augmenting paths</span></span>
<span id="cb6-83"><a href="#cb6-83" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="va">self</span>.bfs(s, t, parent):</span>
<span id="cb6-84"><a href="#cb6-84" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Find bottleneck capacity</span></span>
<span id="cb6-85"><a href="#cb6-85" aria-hidden="true" tabindex="-1"></a>            path_flow <span class="op">=</span> <span class="bu">float</span>(<span class="st">'inf'</span>)</span>
<span id="cb6-86"><a href="#cb6-86" aria-hidden="true" tabindex="-1"></a>            v <span class="op">=</span> t</span>
<span id="cb6-87"><a href="#cb6-87" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb6-88"><a href="#cb6-88" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Trace back from sink to source</span></span>
<span id="cb6-89"><a href="#cb6-89" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> v <span class="op">!=</span> s:</span>
<span id="cb6-90"><a href="#cb6-90" aria-hidden="true" tabindex="-1"></a>                u <span class="op">=</span> parent[v]</span>
<span id="cb6-91"><a href="#cb6-91" aria-hidden="true" tabindex="-1"></a>                residual <span class="op">=</span> <span class="va">self</span>.capacity[u][v] <span class="op">-</span> <span class="va">self</span>.flow[u][v]</span>
<span id="cb6-92"><a href="#cb6-92" aria-hidden="true" tabindex="-1"></a>                path_flow <span class="op">=</span> <span class="bu">min</span>(path_flow, residual)</span>
<span id="cb6-93"><a href="#cb6-93" aria-hidden="true" tabindex="-1"></a>                v <span class="op">=</span> u</span>
<span id="cb6-94"><a href="#cb6-94" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb6-95"><a href="#cb6-95" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Push flow along the path</span></span>
<span id="cb6-96"><a href="#cb6-96" aria-hidden="true" tabindex="-1"></a>            v <span class="op">=</span> t</span>
<span id="cb6-97"><a href="#cb6-97" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> v <span class="op">!=</span> s:</span>
<span id="cb6-98"><a href="#cb6-98" aria-hidden="true" tabindex="-1"></a>                u <span class="op">=</span> parent[v]</span>
<span id="cb6-99"><a href="#cb6-99" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Increase forward flow</span></span>
<span id="cb6-100"><a href="#cb6-100" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.flow[u][v] <span class="op">+=</span> path_flow</span>
<span id="cb6-101"><a href="#cb6-101" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Decrease backward flow (same as increasing reverse flow)</span></span>
<span id="cb6-102"><a href="#cb6-102" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.flow[v][u] <span class="op">-=</span> path_flow</span>
<span id="cb6-103"><a href="#cb6-103" aria-hidden="true" tabindex="-1"></a>                v <span class="op">=</span> u</span>
<span id="cb6-104"><a href="#cb6-104" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb6-105"><a href="#cb6-105" aria-hidden="true" tabindex="-1"></a>            max_flow_value <span class="op">+=</span> path_flow</span>
<span id="cb6-106"><a href="#cb6-106" aria-hidden="true" tabindex="-1"></a>            parent.clear()</span>
<span id="cb6-107"><a href="#cb6-107" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-108"><a href="#cb6-108" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> max_flow_value</span>
<span id="cb6-109"><a href="#cb6-109" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-110"><a href="#cb6-110" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> min_cut(<span class="va">self</span>, s):</span>
<span id="cb6-111"><a href="#cb6-111" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb6-112"><a href="#cb6-112" aria-hidden="true" tabindex="-1"></a><span class="co">        Find minimum cut after computing max flow.</span></span>
<span id="cb6-113"><a href="#cb6-113" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb6-114"><a href="#cb6-114" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns:</span></span>
<span id="cb6-115"><a href="#cb6-115" aria-hidden="true" tabindex="-1"></a><span class="co">            (reachable, unreachable): two sets of vertices</span></span>
<span id="cb6-116"><a href="#cb6-116" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb6-117"><a href="#cb6-117" aria-hidden="true" tabindex="-1"></a>        visited <span class="op">=</span> <span class="bu">set</span>([s])</span>
<span id="cb6-118"><a href="#cb6-118" aria-hidden="true" tabindex="-1"></a>        queue <span class="op">=</span> deque([s])</span>
<span id="cb6-119"><a href="#cb6-119" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-120"><a href="#cb6-120" aria-hidden="true" tabindex="-1"></a>        <span class="co"># BFS in residual network</span></span>
<span id="cb6-121"><a href="#cb6-121" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> queue:</span>
<span id="cb6-122"><a href="#cb6-122" aria-hidden="true" tabindex="-1"></a>            u <span class="op">=</span> queue.popleft()</span>
<span id="cb6-123"><a href="#cb6-123" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> v <span class="kw">in</span> <span class="va">self</span>.adj[u]:</span>
<span id="cb6-124"><a href="#cb6-124" aria-hidden="true" tabindex="-1"></a>                residual <span class="op">=</span> <span class="va">self</span>.capacity[u][v] <span class="op">-</span> <span class="va">self</span>.flow[u][v]</span>
<span id="cb6-125"><a href="#cb6-125" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> v <span class="kw">not</span> <span class="kw">in</span> visited <span class="kw">and</span> residual <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb6-126"><a href="#cb6-126" aria-hidden="true" tabindex="-1"></a>                    visited.add(v)</span>
<span id="cb6-127"><a href="#cb6-127" aria-hidden="true" tabindex="-1"></a>                    queue.append(v)</span>
<span id="cb6-128"><a href="#cb6-128" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-129"><a href="#cb6-129" aria-hidden="true" tabindex="-1"></a>        not_visited <span class="op">=</span> <span class="bu">set</span>(<span class="bu">range</span>(<span class="va">self</span>.n)) <span class="op">-</span> visited</span>
<span id="cb6-130"><a href="#cb6-130" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> visited, not_visited</span>
<span id="cb6-131"><a href="#cb6-131" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-132"><a href="#cb6-132" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_cut_edges(<span class="va">self</span>, s):</span>
<span id="cb6-133"><a href="#cb6-133" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb6-134"><a href="#cb6-134" aria-hidden="true" tabindex="-1"></a><span class="co">        Get the actual edges in the minimum cut.</span></span>
<span id="cb6-135"><a href="#cb6-135" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb6-136"><a href="#cb6-136" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns:</span></span>
<span id="cb6-137"><a href="#cb6-137" aria-hidden="true" tabindex="-1"></a><span class="co">            List of (u, v, capacity) tuples</span></span>
<span id="cb6-138"><a href="#cb6-138" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb6-139"><a href="#cb6-139" aria-hidden="true" tabindex="-1"></a>        reachable, unreachable <span class="op">=</span> <span class="va">self</span>.min_cut(s)</span>
<span id="cb6-140"><a href="#cb6-140" aria-hidden="true" tabindex="-1"></a>        cut_edges <span class="op">=</span> []</span>
<span id="cb6-141"><a href="#cb6-141" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-142"><a href="#cb6-142" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> u <span class="kw">in</span> reachable:</span>
<span id="cb6-143"><a href="#cb6-143" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> v <span class="kw">in</span> <span class="va">self</span>.adj[u]:</span>
<span id="cb6-144"><a href="#cb6-144" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> v <span class="kw">in</span> unreachable <span class="kw">and</span> <span class="va">self</span>.capacity[u][v] <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb6-145"><a href="#cb6-145" aria-hidden="true" tabindex="-1"></a>                    cut_edges.append((u, v, <span class="va">self</span>.capacity[u][v]))</span>
<span id="cb6-146"><a href="#cb6-146" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-147"><a href="#cb6-147" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> cut_edges</span>
<span id="cb6-148"><a href="#cb6-148" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-149"><a href="#cb6-149" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_flow_value(<span class="va">self</span>, s):</span>
<span id="cb6-150"><a href="#cb6-150" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb6-151"><a href="#cb6-151" aria-hidden="true" tabindex="-1"></a><span class="co">        Calculate total flow out of source.</span></span>
<span id="cb6-152"><a href="#cb6-152" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb6-153"><a href="#cb6-153" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">sum</span>(<span class="va">self</span>.flow[s][v] <span class="cf">for</span> v <span class="kw">in</span> <span class="va">self</span>.adj[s])</span>
<span id="cb6-154"><a href="#cb6-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-155"><a href="#cb6-155" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage</span></span>
<span id="cb6-156"><a href="#cb6-156" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> example_max_flow():</span>
<span id="cb6-157"><a href="#cb6-157" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb6-158"><a href="#cb6-158" aria-hidden="true" tabindex="-1"></a><span class="co">    Example: Find max flow in a simple network</span></span>
<span id="cb6-159"><a href="#cb6-159" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb6-160"><a href="#cb6-160" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create network with 6 vertices (0-5)</span></span>
<span id="cb6-161"><a href="#cb6-161" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let 0 = source, 5 = sink</span></span>
<span id="cb6-162"><a href="#cb6-162" aria-hidden="true" tabindex="-1"></a>    g <span class="op">=</span> EdmondsKarp(<span class="dv">6</span>)</span>
<span id="cb6-163"><a href="#cb6-163" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-164"><a href="#cb6-164" aria-hidden="true" tabindex="-1"></a>    g.add_edge(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">16</span>)</span>
<span id="cb6-165"><a href="#cb6-165" aria-hidden="true" tabindex="-1"></a>    g.add_edge(<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">13</span>)</span>
<span id="cb6-166"><a href="#cb6-166" aria-hidden="true" tabindex="-1"></a>    g.add_edge(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">10</span>)</span>
<span id="cb6-167"><a href="#cb6-167" aria-hidden="true" tabindex="-1"></a>    g.add_edge(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">12</span>)</span>
<span id="cb6-168"><a href="#cb6-168" aria-hidden="true" tabindex="-1"></a>    g.add_edge(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">4</span>)</span>
<span id="cb6-169"><a href="#cb6-169" aria-hidden="true" tabindex="-1"></a>    g.add_edge(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">14</span>)</span>
<span id="cb6-170"><a href="#cb6-170" aria-hidden="true" tabindex="-1"></a>    g.add_edge(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">9</span>)</span>
<span id="cb6-171"><a href="#cb6-171" aria-hidden="true" tabindex="-1"></a>    g.add_edge(<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">20</span>)</span>
<span id="cb6-172"><a href="#cb6-172" aria-hidden="true" tabindex="-1"></a>    g.add_edge(<span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">7</span>)</span>
<span id="cb6-173"><a href="#cb6-173" aria-hidden="true" tabindex="-1"></a>    g.add_edge(<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">4</span>)</span>
<span id="cb6-174"><a href="#cb6-174" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-175"><a href="#cb6-175" aria-hidden="true" tabindex="-1"></a>    max_flow <span class="op">=</span> g.max_flow(<span class="dv">0</span>, <span class="dv">5</span>)</span>
<span id="cb6-176"><a href="#cb6-176" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Maximum flow: </span><span class="sc">{</span>max_flow<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb6-177"><a href="#cb6-177" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-178"><a href="#cb6-178" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find min cut</span></span>
<span id="cb6-179"><a href="#cb6-179" aria-hidden="true" tabindex="-1"></a>    cut_edges <span class="op">=</span> g.get_cut_edges(<span class="dv">0</span>)</span>
<span id="cb6-180"><a href="#cb6-180" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Minimum cut edges: </span><span class="sc">{</span>cut_edges<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb6-181"><a href="#cb6-181" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Min cut capacity: </span><span class="sc">{</span><span class="bu">sum</span>(cap <span class="cf">for</span> _, _, cap <span class="kw">in</span> cut_edges)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb6-182"><a href="#cb6-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-183"><a href="#cb6-183" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>:</span>
<span id="cb6-184"><a href="#cb6-184" aria-hidden="true" tabindex="-1"></a>    example_max_flow()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="why-bfs-makes-all-the-difference" class="level3" data-number="10.4.4">
<h3 data-number="10.4.4" class="anchored" data-anchor-id="why-bfs-makes-all-the-difference"><span class="header-section-number">10.4.4</span> 9.4.4 Why BFS Makes All the Difference</h3>
<p>Here’s the key insight about Edmonds-Karp:</p>
<p><strong>The shortest path distance from s to any vertex can only increase over time.</strong></p>
<p>When you saturate an edge on a shortest path, the next shortest path must be longer. Since paths can be at most V edges long, and you have E edges to saturate, you get the O(VE) bound on the number of augmenting paths.</p>
<p>It’s one of those proofs where the intuition is beautiful but the formal details are technical. The takeaway: <strong>using BFS isn’t just convenient, it’s provably efficient</strong>.</p>
</section>
</section>
<section id="push-relabel-the-modern-approach" class="level2" data-number="10.5">
<h2 data-number="10.5" class="anchored" data-anchor-id="push-relabel-the-modern-approach"><span class="header-section-number">10.5</span> 9.5 Push-Relabel: The Modern Approach</h2>
<section id="a-completely-different-philosophy" class="level3" data-number="10.5.1">
<h3 data-number="10.5.1" class="anchored" data-anchor-id="a-completely-different-philosophy"><span class="header-section-number">10.5.1</span> 9.5.1 A Completely Different Philosophy</h3>
<p>Ford-Fulkerson thinks about flow globally: find a complete path from source to sink, push flow along it.</p>
<p><strong>Push-Relabel thinks locally</strong>: look at each vertex and try to push excess flow toward the sink.</p>
<p>It’s like the difference between: - <strong>Ford-Fulkerson</strong>: Planning your entire road trip before leaving - <strong>Push-Relabel</strong>: At each city, just head in the general direction of your destination</p>
<p>Surprisingly, the local approach can be faster! The best push-relabel variants run in O(V³), better than Edmonds-Karp’s O(VE²) on dense graphs.</p>
</section>
<section id="the-key-concepts" class="level3" data-number="10.5.2">
<h3 data-number="10.5.2" class="anchored" data-anchor-id="the-key-concepts"><span class="header-section-number">10.5.2</span> 9.5.2 The Key Concepts</h3>
<p><strong>Preflow</strong>: Like a flow, but we relax the conservation constraint. Vertices can have excess flow—more coming in than going out.</p>
<p><strong>Excess</strong>: e(v) = (flow in) - (flow out) for vertex v</p>
<p><strong>Height function</strong>: h(v) is an estimate of the distance from v to the sink. We maintain: h(s) = n, h(t) = 0, and h(u) ≤ h(v) + 1 for edges (u,v) with residual capacity.</p>
<p>Think of height as elevation. Flow “falls downhill” from high vertices to low vertices.</p>
<p><strong>Basic operations</strong>:</p>
<ol type="1">
<li><p><strong>Push</strong>: If vertex u has excess and an edge to a lower vertex v with residual capacity, push flow from u to v.</p></li>
<li><p><strong>Relabel</strong>: If vertex u has excess but can’t push to any neighbor, increase its height.</p></li>
</ol>
</section>
<section id="the-algorithm" class="level3" data-number="10.5.3">
<h3 data-number="10.5.3" class="anchored" data-anchor-id="the-algorithm"><span class="header-section-number">10.5.3</span> 9.5.3 The Algorithm</h3>
<pre><code>Push-Relabel(G, s, t):
    # Initialize
    for each vertex v:
        h(v) = 0
    h(s) = n
    
    # Push maximum flow from source
    for each edge (s, v):
        push c(s,v) units from s to v
    
    # Process vertices with excess
    while there exists a vertex u with e(u) &gt; 0 and u ≠ s, t:
        if u can push to some neighbor:
            push(u, v)  # push to some valid neighbor v
        else:
            relabel(u)  # increase height of u
    
    return flow</code></pre>
<p><strong>Push operation</strong> (when h(u) = h(v) + 1 and excess at u):</p>
<pre><code>δ = min(e(u), c_f(u,v))  # amount to push
f(u,v) += δ
e(u) -= δ
e(v) += δ</code></pre>
<p><strong>Relabel operation</strong> (when u has excess but can’t push):</p>
<pre><code>h(u) = 1 + min{h(v) : (u,v) has residual capacity}</code></pre>
</section>
<section id="why-does-this-work" class="level3" data-number="10.5.4">
<h3 data-number="10.5.4" class="anchored" data-anchor-id="why-does-this-work"><span class="header-section-number">10.5.4</span> 9.5.4 Why Does This Work?</h3>
<p>The height function ensures that flow moves “downhill” toward the sink. When we can’t push from a vertex, we raise its height until we can.</p>
<p>Key invariant: <strong>A vertex with excess must eventually either push to the sink or back to the source.</strong></p>
<p>The algorithm terminates because: 1. Heights only increase 2. Heights are bounded (max height is 2n-1) 3. Eventually, all excess gets pushed to the sink or back to source</p>
<p><strong>Intuition</strong>: Imagine water on a bumpy surface. Water in a depression (local minimum) must either find a path out or accumulate. The relabel operation “fills” the depression until water can escape.</p>
<p>Here’s a clean implementation:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> defaultdict, deque</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> PushRelabel:</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Maximum flow using push-relabel algorithm.</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co">    More efficient than Edmonds-Karp on dense graphs.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, n):</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.n <span class="op">=</span> n</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.capacity <span class="op">=</span> defaultdict(<span class="kw">lambda</span>: defaultdict(<span class="bu">int</span>))</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.flow <span class="op">=</span> defaultdict(<span class="kw">lambda</span>: defaultdict(<span class="bu">int</span>))</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.excess <span class="op">=</span> defaultdict(<span class="bu">int</span>)</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.height <span class="op">=</span> defaultdict(<span class="bu">int</span>)</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.adj <span class="op">=</span> defaultdict(<span class="bu">set</span>)</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> add_edge(<span class="va">self</span>, u, v, cap):</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Add edge with capacity."""</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.capacity[u][v] <span class="op">+=</span> cap</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.adj[u].add(v)</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.adj[v].add(u)</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> push(<span class="va">self</span>, u, v):</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a><span class="co">        Push flow from u to v.</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a><span class="co">        Precondition: excess[u] &gt; 0, residual capacity &gt; 0, height[u] = height[v] + 1</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># How much can we push?</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>        residual <span class="op">=</span> <span class="va">self</span>.capacity[u][v] <span class="op">-</span> <span class="va">self</span>.flow[u][v]</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>        delta <span class="op">=</span> <span class="bu">min</span>(<span class="va">self</span>.excess[u], residual)</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Update flow</span></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.flow[u][v] <span class="op">+=</span> delta</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.flow[v][u] <span class="op">-=</span> delta</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Update excess</span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.excess[u] <span class="op">-=</span> delta</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.excess[v] <span class="op">+=</span> delta</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> delta</span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> relabel(<span class="va">self</span>, u):</span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a><span class="co">        Increase height of u to 1 + minimum height of neighbors with residual capacity.</span></span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a><span class="co">        Precondition: cannot push from u</span></span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>        min_height <span class="op">=</span> <span class="bu">float</span>(<span class="st">'inf'</span>)</span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> v <span class="kw">in</span> <span class="va">self</span>.adj[u]:</span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>            residual <span class="op">=</span> <span class="va">self</span>.capacity[u][v] <span class="op">-</span> <span class="va">self</span>.flow[u][v]</span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> residual <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>                min_height <span class="op">=</span> <span class="bu">min</span>(min_height, <span class="va">self</span>.height[v])</span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> min_height <span class="op">&lt;</span> <span class="bu">float</span>(<span class="st">'inf'</span>):</span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.height[u] <span class="op">=</span> min_height <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> discharge(<span class="va">self</span>, u):</span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a><span class="co">        Push all excess from u or relabel if necessary.</span></span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="va">self</span>.excess[u] <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Try to find a vertex to push to</span></span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a>            pushed <span class="op">=</span> <span class="va">False</span></span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> v <span class="kw">in</span> <span class="va">self</span>.adj[u]:</span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a>                residual <span class="op">=</span> <span class="va">self</span>.capacity[u][v] <span class="op">-</span> <span class="va">self</span>.flow[u][v]</span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Can we push to v? (downhill and has capacity)</span></span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> residual <span class="op">&gt;</span> <span class="dv">0</span> <span class="kw">and</span> <span class="va">self</span>.height[u] <span class="op">==</span> <span class="va">self</span>.height[v] <span class="op">+</span> <span class="dv">1</span>:</span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.push(u, v)</span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a>                    pushed <span class="op">=</span> <span class="va">True</span></span>
<span id="cb10-72"><a href="#cb10-72" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
<span id="cb10-73"><a href="#cb10-73" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb10-74"><a href="#cb10-74" aria-hidden="true" tabindex="-1"></a>            <span class="co"># If we couldn't push, relabel</span></span>
<span id="cb10-75"><a href="#cb10-75" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> pushed:</span>
<span id="cb10-76"><a href="#cb10-76" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.relabel(u)</span>
<span id="cb10-77"><a href="#cb10-77" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-78"><a href="#cb10-78" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> max_flow(<span class="va">self</span>, s, t):</span>
<span id="cb10-79"><a href="#cb10-79" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb10-80"><a href="#cb10-80" aria-hidden="true" tabindex="-1"></a><span class="co">        Compute maximum flow from s to t.</span></span>
<span id="cb10-81"><a href="#cb10-81" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb10-82"><a href="#cb10-82" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Initialize heights and preflow</span></span>
<span id="cb10-83"><a href="#cb10-83" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.height[s] <span class="op">=</span> <span class="va">self</span>.n</span>
<span id="cb10-84"><a href="#cb10-84" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-85"><a href="#cb10-85" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Saturate all edges from source</span></span>
<span id="cb10-86"><a href="#cb10-86" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> v <span class="kw">in</span> <span class="va">self</span>.adj[s]:</span>
<span id="cb10-87"><a href="#cb10-87" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.capacity[s][v] <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb10-88"><a href="#cb10-88" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.flow[s][v] <span class="op">=</span> <span class="va">self</span>.capacity[s][v]</span>
<span id="cb10-89"><a href="#cb10-89" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.flow[v][s] <span class="op">=</span> <span class="op">-</span><span class="va">self</span>.capacity[s][v]</span>
<span id="cb10-90"><a href="#cb10-90" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.excess[v] <span class="op">=</span> <span class="va">self</span>.capacity[s][v]</span>
<span id="cb10-91"><a href="#cb10-91" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.excess[s] <span class="op">-=</span> <span class="va">self</span>.capacity[s][v]</span>
<span id="cb10-92"><a href="#cb10-92" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-93"><a href="#cb10-93" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create list of active vertices (not source or sink, with excess)</span></span>
<span id="cb10-94"><a href="#cb10-94" aria-hidden="true" tabindex="-1"></a>        active <span class="op">=</span> deque()</span>
<span id="cb10-95"><a href="#cb10-95" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> v <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.n):</span>
<span id="cb10-96"><a href="#cb10-96" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> v <span class="op">!=</span> s <span class="kw">and</span> v <span class="op">!=</span> t <span class="kw">and</span> <span class="va">self</span>.excess[v] <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb10-97"><a href="#cb10-97" aria-hidden="true" tabindex="-1"></a>                active.append(v)</span>
<span id="cb10-98"><a href="#cb10-98" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-99"><a href="#cb10-99" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Process active vertices</span></span>
<span id="cb10-100"><a href="#cb10-100" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> active:</span>
<span id="cb10-101"><a href="#cb10-101" aria-hidden="true" tabindex="-1"></a>            u <span class="op">=</span> active.popleft()</span>
<span id="cb10-102"><a href="#cb10-102" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb10-103"><a href="#cb10-103" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.excess[u] <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb10-104"><a href="#cb10-104" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.discharge(u)</span>
<span id="cb10-105"><a href="#cb10-105" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb10-106"><a href="#cb10-106" aria-hidden="true" tabindex="-1"></a>                <span class="co"># If still has excess, add back to queue</span></span>
<span id="cb10-107"><a href="#cb10-107" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="va">self</span>.excess[u] <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb10-108"><a href="#cb10-108" aria-hidden="true" tabindex="-1"></a>                    active.append(u)</span>
<span id="cb10-109"><a href="#cb10-109" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-110"><a href="#cb10-110" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Maximum flow is the excess at the sink</span></span>
<span id="cb10-111"><a href="#cb10-111" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.excess[t]</span>
<span id="cb10-112"><a href="#cb10-112" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-113"><a href="#cb10-113" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_flow_value(<span class="va">self</span>, s):</span>
<span id="cb10-114"><a href="#cb10-114" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Alternative: calculate from source."""</span></span>
<span id="cb10-115"><a href="#cb10-115" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">sum</span>(<span class="va">self</span>.flow[s][v] <span class="cf">for</span> v <span class="kw">in</span> <span class="va">self</span>.adj[s])</span>
<span id="cb10-116"><a href="#cb10-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-117"><a href="#cb10-117" aria-hidden="true" tabindex="-1"></a><span class="co"># Example</span></span>
<span id="cb10-118"><a href="#cb10-118" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> example_push_relabel():</span>
<span id="cb10-119"><a href="#cb10-119" aria-hidden="true" tabindex="-1"></a>    g <span class="op">=</span> PushRelabel(<span class="dv">6</span>)</span>
<span id="cb10-120"><a href="#cb10-120" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-121"><a href="#cb10-121" aria-hidden="true" tabindex="-1"></a>    g.add_edge(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">16</span>)</span>
<span id="cb10-122"><a href="#cb10-122" aria-hidden="true" tabindex="-1"></a>    g.add_edge(<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">13</span>)</span>
<span id="cb10-123"><a href="#cb10-123" aria-hidden="true" tabindex="-1"></a>    g.add_edge(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">10</span>)</span>
<span id="cb10-124"><a href="#cb10-124" aria-hidden="true" tabindex="-1"></a>    g.add_edge(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">12</span>)</span>
<span id="cb10-125"><a href="#cb10-125" aria-hidden="true" tabindex="-1"></a>    g.add_edge(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">4</span>)</span>
<span id="cb10-126"><a href="#cb10-126" aria-hidden="true" tabindex="-1"></a>    g.add_edge(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">14</span>)</span>
<span id="cb10-127"><a href="#cb10-127" aria-hidden="true" tabindex="-1"></a>    g.add_edge(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">9</span>)</span>
<span id="cb10-128"><a href="#cb10-128" aria-hidden="true" tabindex="-1"></a>    g.add_edge(<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">20</span>)</span>
<span id="cb10-129"><a href="#cb10-129" aria-hidden="true" tabindex="-1"></a>    g.add_edge(<span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">7</span>)</span>
<span id="cb10-130"><a href="#cb10-130" aria-hidden="true" tabindex="-1"></a>    g.add_edge(<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">4</span>)</span>
<span id="cb10-131"><a href="#cb10-131" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-132"><a href="#cb10-132" aria-hidden="true" tabindex="-1"></a>    max_flow <span class="op">=</span> g.max_flow(<span class="dv">0</span>, <span class="dv">5</span>)</span>
<span id="cb10-133"><a href="#cb10-133" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Maximum flow (push-relabel): </span><span class="sc">{</span>max_flow<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb10-134"><a href="#cb10-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-135"><a href="#cb10-135" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>:</span>
<span id="cb10-136"><a href="#cb10-136" aria-hidden="true" tabindex="-1"></a>    example_push_relabel()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="which-algorithm-should-you-use" class="level3" data-number="10.5.5">
<h3 data-number="10.5.5" class="anchored" data-anchor-id="which-algorithm-should-you-use"><span class="header-section-number">10.5.5</span> 9.5.5 Which Algorithm Should You Use?</h3>
<p><strong>Edmonds-Karp (Ford-Fulkerson with BFS)</strong>: - ✅ Simple to understand and implement - ✅ Works well on sparse graphs - ✅ Easy to modify for variants - ❌ O(VE²) can be slow on dense graphs</p>
<p><strong>Push-Relabel</strong>: - ✅ Faster on dense graphs (O(V³) or better with optimizations) - ✅ More amenable to parallelization - ❌ More complex to implement correctly - ❌ Harder to modify for special cases</p>
<p><strong>Rule of thumb</strong>: Start with Edmonds-Karp. Switch to push-relabel if you’re dealing with massive dense networks and performance matters.</p>
</section>
</section>
<section id="bipartite-matching-when-flow-solves-romance" class="level2" data-number="10.6">
<h2 data-number="10.6" class="anchored" data-anchor-id="bipartite-matching-when-flow-solves-romance"><span class="header-section-number">10.6</span> 9.6 Bipartite Matching: When Flow Solves Romance</h2>
<section id="the-matching-problem" class="level3" data-number="10.6.1">
<h3 data-number="10.6.1" class="anchored" data-anchor-id="the-matching-problem"><span class="header-section-number">10.6.1</span> 9.6.1 The Matching Problem</h3>
<p>Imagine you’re running a dating service. You have: - n people looking for dates on the left - m people looking for dates on the right - A list of compatible pairs (based on preferences, interests, etc.)</p>
<p><strong>Goal</strong>: Match as many people as possible, where each person gets at most one match.</p>
<p>This is the <strong>maximum bipartite matching</strong> problem, and it’s everywhere: - Job candidates ↔︎ job positions - Students ↔︎ schools - Tasks ↔︎ workers - Organs ↔︎ transplant recipients</p>
</section>
<section id="the-flow-network-trick" class="level3" data-number="10.6.2">
<h3 data-number="10.6.2" class="anchored" data-anchor-id="the-flow-network-trick"><span class="header-section-number">10.6.2</span> 9.6.2 The Flow Network Trick</h3>
<p>Here’s the magic: we can solve matching using maximum flow!</p>
<p><strong>Construction</strong>: 1. Create a source vertex s 2. Create a sink vertex t 3. Add edge from s to every left vertex (capacity 1) 4. Add edge from every compatible pair (capacity 1) 5. Add edge from every right vertex to t (capacity 1)</p>
<pre><code>        Left side        Right side
           L1 ------------ R1
          /  \            /  \
    s -- L2   --- X ----    R2 -- t
          \  /            \  /
           L3 ------------ R3

All edges have capacity 1</code></pre>
<p><strong>Why does this work?</strong></p>
<ul>
<li>Each unit of flow represents one match</li>
<li>Capacity 1 from s ensures each left person matches at most once</li>
<li>Capacity 1 to t ensures each right person matches at most once</li>
<li>Capacity 1 on middle edges enforces the compatibility constraint</li>
</ul>
<p>The maximum flow equals the maximum matching!</p>
</section>
<section id="implementation" class="level3" data-number="10.6.3">
<h3 data-number="10.6.3" class="anchored" data-anchor-id="implementation"><span class="header-section-number">10.6.3</span> 9.6.3 Implementation</h3>
<div class="sourceCode" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> BipartiteMatching:</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Solve maximum bipartite matching using network flow.</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, n_left, n_right):</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co">        n_left: number of vertices on left side</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co">        n_right: number of vertices on right side</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.n_left <span class="op">=</span> n_left</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.n_right <span class="op">=</span> n_right</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.edges <span class="op">=</span> []</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Vertex numbering:</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 0 = source</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 1 to n_left = left vertices</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>        <span class="co"># n_left+1 to n_left+n_right = right vertices</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># n_left+n_right+1 = sink</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.source <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.sink <span class="op">=</span> n_left <span class="op">+</span> n_right <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>        total_vertices <span class="op">=</span> <span class="va">self</span>.sink <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.flow_network <span class="op">=</span> EdmondsKarp(total_vertices)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> add_edge(<span class="va">self</span>, left, right):</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a><span class="co">        Add an edge between left vertex and right vertex.</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a><span class="co">        left: 0 to n_left-1</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a><span class="co">        right: 0 to n_right-1</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Convert to internal vertex numbering</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>        left_v <span class="op">=</span> left <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>        right_v <span class="op">=</span> <span class="va">self</span>.n_left <span class="op">+</span> right <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.edges.append((left, right))</span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.flow_network.add_edge(left_v, right_v, <span class="dv">1</span>)</span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> max_matching(<span class="va">self</span>):</span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a><span class="co">        Compute maximum matching.</span></span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns the size of maximum matching.</span></span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add edges from source to left vertices</span></span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.n_left):</span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.flow_network.add_edge(<span class="va">self</span>.source, i <span class="op">+</span> <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add edges from right vertices to sink</span></span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.n_right):</span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a>            right_v <span class="op">=</span> <span class="va">self</span>.n_left <span class="op">+</span> i <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.flow_network.add_edge(right_v, <span class="va">self</span>.sink, <span class="dv">1</span>)</span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Compute max flow</span></span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.flow_network.max_flow(<span class="va">self</span>.source, <span class="va">self</span>.sink)</span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_matching(<span class="va">self</span>):</span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a><span class="co">        Get the actual matching (which edges are used).</span></span>
<span id="cb12-60"><a href="#cb12-60" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns list of (left, right) pairs.</span></span>
<span id="cb12-61"><a href="#cb12-61" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb12-62"><a href="#cb12-62" aria-hidden="true" tabindex="-1"></a>        matching <span class="op">=</span> []</span>
<span id="cb12-63"><a href="#cb12-63" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb12-64"><a href="#cb12-64" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> left, right <span class="kw">in</span> <span class="va">self</span>.edges:</span>
<span id="cb12-65"><a href="#cb12-65" aria-hidden="true" tabindex="-1"></a>            left_v <span class="op">=</span> left <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb12-66"><a href="#cb12-66" aria-hidden="true" tabindex="-1"></a>            right_v <span class="op">=</span> <span class="va">self</span>.n_left <span class="op">+</span> right <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb12-67"><a href="#cb12-67" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb12-68"><a href="#cb12-68" aria-hidden="true" tabindex="-1"></a>            <span class="co"># If there's flow on this edge, it's in the matching</span></span>
<span id="cb12-69"><a href="#cb12-69" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.flow_network.flow[left_v][right_v] <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb12-70"><a href="#cb12-70" aria-hidden="true" tabindex="-1"></a>                matching.append((left, right))</span>
<span id="cb12-71"><a href="#cb12-71" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb12-72"><a href="#cb12-72" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> matching</span>
<span id="cb12-73"><a href="#cb12-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-74"><a href="#cb12-74" aria-hidden="true" tabindex="-1"></a><span class="co"># Example: Medical Residency Matching</span></span>
<span id="cb12-75"><a href="#cb12-75" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> example_residency_matching():</span>
<span id="cb12-76"><a href="#cb12-76" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb12-77"><a href="#cb12-77" aria-hidden="true" tabindex="-1"></a><span class="co">    Match 4 medical students to 3 hospitals.</span></span>
<span id="cb12-78"><a href="#cb12-78" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb12-79"><a href="#cb12-79" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Students: Alice=0, Bob=1, Carol=2, Dave=3</span></span>
<span id="cb12-80"><a href="#cb12-80" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Hospitals: City=0, County=1, General=2</span></span>
<span id="cb12-81"><a href="#cb12-81" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-82"><a href="#cb12-82" aria-hidden="true" tabindex="-1"></a>    matching <span class="op">=</span> BipartiteMatching(n_left<span class="op">=</span><span class="dv">4</span>, n_right<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb12-83"><a href="#cb12-83" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-84"><a href="#cb12-84" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Preferences/compatibilities</span></span>
<span id="cb12-85"><a href="#cb12-85" aria-hidden="true" tabindex="-1"></a>    matching.add_edge(<span class="dv">0</span>, <span class="dv">0</span>)  <span class="co"># Alice -&gt; City</span></span>
<span id="cb12-86"><a href="#cb12-86" aria-hidden="true" tabindex="-1"></a>    matching.add_edge(<span class="dv">0</span>, <span class="dv">2</span>)  <span class="co"># Alice -&gt; General</span></span>
<span id="cb12-87"><a href="#cb12-87" aria-hidden="true" tabindex="-1"></a>    matching.add_edge(<span class="dv">1</span>, <span class="dv">1</span>)  <span class="co"># Bob -&gt; County</span></span>
<span id="cb12-88"><a href="#cb12-88" aria-hidden="true" tabindex="-1"></a>    matching.add_edge(<span class="dv">2</span>, <span class="dv">0</span>)  <span class="co"># Carol -&gt; City</span></span>
<span id="cb12-89"><a href="#cb12-89" aria-hidden="true" tabindex="-1"></a>    matching.add_edge(<span class="dv">2</span>, <span class="dv">1</span>)  <span class="co"># Carol -&gt; County</span></span>
<span id="cb12-90"><a href="#cb12-90" aria-hidden="true" tabindex="-1"></a>    matching.add_edge(<span class="dv">3</span>, <span class="dv">2</span>)  <span class="co"># Dave -&gt; General</span></span>
<span id="cb12-91"><a href="#cb12-91" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-92"><a href="#cb12-92" aria-hidden="true" tabindex="-1"></a>    max_matches <span class="op">=</span> matching.max_matching()</span>
<span id="cb12-93"><a href="#cb12-93" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Maximum matching: </span><span class="sc">{</span>max_matches<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb12-94"><a href="#cb12-94" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-95"><a href="#cb12-95" aria-hidden="true" tabindex="-1"></a>    matches <span class="op">=</span> matching.get_matching()</span>
<span id="cb12-96"><a href="#cb12-96" aria-hidden="true" tabindex="-1"></a>    students <span class="op">=</span> [<span class="st">"Alice"</span>, <span class="st">"Bob"</span>, <span class="st">"Carol"</span>, <span class="st">"Dave"</span>]</span>
<span id="cb12-97"><a href="#cb12-97" aria-hidden="true" tabindex="-1"></a>    hospitals <span class="op">=</span> [<span class="st">"City"</span>, <span class="st">"County"</span>, <span class="st">"General"</span>]</span>
<span id="cb12-98"><a href="#cb12-98" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-99"><a href="#cb12-99" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Matches:"</span>)</span>
<span id="cb12-100"><a href="#cb12-100" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> left, right <span class="kw">in</span> matches:</span>
<span id="cb12-101"><a href="#cb12-101" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>students[left]<span class="sc">}</span><span class="ss"> -&gt; </span><span class="sc">{</span>hospitals[right]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb12-102"><a href="#cb12-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-103"><a href="#cb12-103" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>:</span>
<span id="cb12-104"><a href="#cb12-104" aria-hidden="true" tabindex="-1"></a>    example_residency_matching()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="halls-marriage-theorem" class="level3" data-number="10.6.4">
<h3 data-number="10.6.4" class="anchored" data-anchor-id="halls-marriage-theorem"><span class="header-section-number">10.6.4</span> 9.6.4 Hall’s Marriage Theorem</h3>
<p>Here’s a beautiful theorem about when perfect matching is possible:</p>
<p><strong>Hall’s Marriage Theorem</strong>: A bipartite graph has a perfect matching (matching that covers all left vertices) if and only if:</p>
<p><em>For every subset S of left vertices, |N(S)| ≥ |S|</em></p>
<p>Where N(S) is the set of neighbors of S.</p>
<p>In plain English: every subset of k people on the left must have at least k possible matches on the right.</p>
<p><strong>Example where Hall’s condition fails</strong>:</p>
<pre><code>L1 --→ R1
L2 --→ R1
L3 --→ R2</code></pre>
<p>The subset {L1, L2} has only 1 neighbor (R1), violating Hall’s condition. Indeed, no perfect matching exists—someone will be left out.</p>
<p>This theorem gives us a certificate of impossibility. If you can’t find a perfect matching, you can prove why by finding a violating subset!</p>
</section>
</section>
<section id="minimum-cost-flow-optimizing-while-flowing" class="level2" data-number="10.7">
<h2 data-number="10.7" class="anchored" data-anchor-id="minimum-cost-flow-optimizing-while-flowing"><span class="header-section-number">10.7</span> 9.7 Minimum Cost Flow: Optimizing While Flowing</h2>
<section id="the-problem" class="level3" data-number="10.7.1">
<h3 data-number="10.7.1" class="anchored" data-anchor-id="the-problem"><span class="header-section-number">10.7.1</span> 9.7.1 The Problem</h3>
<p>Maximum flow answers “how much?” but sometimes we also care about “how cheaply?”</p>
<p><strong>Min-cost flow problem</strong>: - Send exactly d units of flow from s to t - Each edge has a cost per unit of flow - Minimize total cost</p>
<p><strong>Applications</strong>: - Shipping: move goods cheaply - Network routing: minimize latency - Resource allocation: minimize waste</p>
</section>
<section id="the-setup" class="level3" data-number="10.7.2">
<h3 data-number="10.7.2" class="anchored" data-anchor-id="the-setup"><span class="header-section-number">10.7.2</span> 9.7.2 The Setup</h3>
<p>Each edge (u,v) now has: - Capacity c(u,v) - Cost per unit a(u,v)</p>
<p>Goal: send d units from s to t minimizing:</p>
<pre><code>total cost = Σ a(u,v) × f(u,v)</code></pre>
</section>
<section id="successive-shortest-paths-algorithm" class="level3" data-number="10.7.3">
<h3 data-number="10.7.3" class="anchored" data-anchor-id="successive-shortest-paths-algorithm"><span class="header-section-number">10.7.3</span> 9.7.3 Successive Shortest Paths Algorithm</h3>
<p>Basic idea: send flow along cheapest paths one unit at a time.</p>
<pre><code>Algorithm: Min-Cost Max-Flow
    Initialize flow to zero
    
    While we haven't sent enough flow:
        Find shortest path in residual network (using edge costs)
        Push maximum possible flow along this path
        Update costs
    
    Return flow</code></pre>
<p>The key: use <strong>Bellman-Ford or Dijkstra</strong> to find shortest paths by cost, not hop count!</p>
<p>For the residual network: - Forward edges keep their original cost - Backward edges have negative cost (we “save” money by undoing flow)</p>
</section>
<section id="implementation-1" class="level3" data-number="10.7.4">
<h3 data-number="10.7.4" class="anchored" data-anchor-id="implementation-1"><span class="header-section-number">10.7.4</span> 9.7.4 Implementation</h3>
<div class="sourceCode" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> heapq</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> defaultdict</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> MinCostFlow:</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Minimum cost maximum flow using successive shortest paths.</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, n):</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.n <span class="op">=</span> n</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.capacity <span class="op">=</span> defaultdict(<span class="kw">lambda</span>: defaultdict(<span class="bu">int</span>))</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.cost <span class="op">=</span> defaultdict(<span class="kw">lambda</span>: defaultdict(<span class="bu">int</span>))</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.flow <span class="op">=</span> defaultdict(<span class="kw">lambda</span>: defaultdict(<span class="bu">int</span>))</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.adj <span class="op">=</span> defaultdict(<span class="bu">set</span>)</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> add_edge(<span class="va">self</span>, u, v, cap, cost):</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a><span class="co">        Add edge from u to v with capacity and cost per unit.</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.capacity[u][v] <span class="op">+=</span> cap</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.cost[u][v] <span class="op">=</span> cost</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.cost[v][u] <span class="op">=</span> <span class="op">-</span>cost  <span class="co"># Reverse edge has negative cost</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.adj[u].add(v)</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.adj[v].add(u)</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> shortest_path(<span class="va">self</span>, s, t):</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a><span class="co">        Find shortest path by cost using Dijkstra's algorithm.</span></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns (path_exists, parent_dict, path_cost).</span></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a><span class="co">        Note: Uses Dijkstra with potential function for negative costs.</span></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>        dist <span class="op">=</span> {v: <span class="bu">float</span>(<span class="st">'inf'</span>) <span class="cf">for</span> v <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.n)}</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>        dist[s] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>        parent <span class="op">=</span> {}</span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>        pq <span class="op">=</span> [(<span class="dv">0</span>, s)]</span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>        visited <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> pq:</span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a>            d, u <span class="op">=</span> heapq.heappop(pq)</span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> u <span class="kw">in</span> visited:</span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a>            visited.add(u)</span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> u <span class="op">==</span> t:</span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">True</span>, parent, dist[t]</span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> v <span class="kw">in</span> <span class="va">self</span>.adj[u]:</span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Check residual capacity</span></span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a>                residual <span class="op">=</span> <span class="va">self</span>.capacity[u][v] <span class="op">-</span> <span class="va">self</span>.flow[u][v]</span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> residual <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb16-54"><a href="#cb16-54" aria-hidden="true" tabindex="-1"></a>                    new_dist <span class="op">=</span> dist[u] <span class="op">+</span> <span class="va">self</span>.cost[u][v]</span>
<span id="cb16-55"><a href="#cb16-55" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb16-56"><a href="#cb16-56" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> new_dist <span class="op">&lt;</span> dist[v]:</span>
<span id="cb16-57"><a href="#cb16-57" aria-hidden="true" tabindex="-1"></a>                        dist[v] <span class="op">=</span> new_dist</span>
<span id="cb16-58"><a href="#cb16-58" aria-hidden="true" tabindex="-1"></a>                        parent[v] <span class="op">=</span> u</span>
<span id="cb16-59"><a href="#cb16-59" aria-hidden="true" tabindex="-1"></a>                        heapq.heappush(pq, (new_dist, v))</span>
<span id="cb16-60"><a href="#cb16-60" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-61"><a href="#cb16-61" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span>, {}, <span class="bu">float</span>(<span class="st">'inf'</span>)</span>
<span id="cb16-62"><a href="#cb16-62" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-63"><a href="#cb16-63" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> min_cost_max_flow(<span class="va">self</span>, s, t, max_flow<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb16-64"><a href="#cb16-64" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb16-65"><a href="#cb16-65" aria-hidden="true" tabindex="-1"></a><span class="co">        Compute minimum cost flow from s to t.</span></span>
<span id="cb16-66"><a href="#cb16-66" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb16-67"><a href="#cb16-67" aria-hidden="true" tabindex="-1"></a><span class="co">        Args:</span></span>
<span id="cb16-68"><a href="#cb16-68" aria-hidden="true" tabindex="-1"></a><span class="co">            s: source</span></span>
<span id="cb16-69"><a href="#cb16-69" aria-hidden="true" tabindex="-1"></a><span class="co">            t: sink</span></span>
<span id="cb16-70"><a href="#cb16-70" aria-hidden="true" tabindex="-1"></a><span class="co">            max_flow: maximum flow to send (if None, send maximum possible)</span></span>
<span id="cb16-71"><a href="#cb16-71" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb16-72"><a href="#cb16-72" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns:</span></span>
<span id="cb16-73"><a href="#cb16-73" aria-hidden="true" tabindex="-1"></a><span class="co">            (flow_value, total_cost)</span></span>
<span id="cb16-74"><a href="#cb16-74" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb16-75"><a href="#cb16-75" aria-hidden="true" tabindex="-1"></a>        total_flow <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb16-76"><a href="#cb16-76" aria-hidden="true" tabindex="-1"></a>        total_cost <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb16-77"><a href="#cb16-77" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-78"><a href="#cb16-78" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb16-79"><a href="#cb16-79" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Find shortest path by cost</span></span>
<span id="cb16-80"><a href="#cb16-80" aria-hidden="true" tabindex="-1"></a>            exists, parent, path_cost <span class="op">=</span> <span class="va">self</span>.shortest_path(s, t)</span>
<span id="cb16-81"><a href="#cb16-81" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-82"><a href="#cb16-82" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> exists:</span>
<span id="cb16-83"><a href="#cb16-83" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb16-84"><a href="#cb16-84" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-85"><a href="#cb16-85" aria-hidden="true" tabindex="-1"></a>            <span class="co"># If costs are negative, we found a negative cycle (shouldn't happen with proper setup)</span></span>
<span id="cb16-86"><a href="#cb16-86" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> path_cost <span class="op">&lt;</span> <span class="dv">0</span>:</span>
<span id="cb16-87"><a href="#cb16-87" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb16-88"><a href="#cb16-88" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-89"><a href="#cb16-89" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Find bottleneck</span></span>
<span id="cb16-90"><a href="#cb16-90" aria-hidden="true" tabindex="-1"></a>            path_flow <span class="op">=</span> <span class="bu">float</span>(<span class="st">'inf'</span>)</span>
<span id="cb16-91"><a href="#cb16-91" aria-hidden="true" tabindex="-1"></a>            v <span class="op">=</span> t</span>
<span id="cb16-92"><a href="#cb16-92" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> v <span class="op">!=</span> s:</span>
<span id="cb16-93"><a href="#cb16-93" aria-hidden="true" tabindex="-1"></a>                u <span class="op">=</span> parent[v]</span>
<span id="cb16-94"><a href="#cb16-94" aria-hidden="true" tabindex="-1"></a>                residual <span class="op">=</span> <span class="va">self</span>.capacity[u][v] <span class="op">-</span> <span class="va">self</span>.flow[u][v]</span>
<span id="cb16-95"><a href="#cb16-95" aria-hidden="true" tabindex="-1"></a>                path_flow <span class="op">=</span> <span class="bu">min</span>(path_flow, residual)</span>
<span id="cb16-96"><a href="#cb16-96" aria-hidden="true" tabindex="-1"></a>                v <span class="op">=</span> u</span>
<span id="cb16-97"><a href="#cb16-97" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-98"><a href="#cb16-98" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Check if we've reached max_flow limit</span></span>
<span id="cb16-99"><a href="#cb16-99" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> max_flow <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="kw">and</span> total_flow <span class="op">+</span> path_flow <span class="op">&gt;</span> max_flow:</span>
<span id="cb16-100"><a href="#cb16-100" aria-hidden="true" tabindex="-1"></a>                path_flow <span class="op">=</span> max_flow <span class="op">-</span> total_flow</span>
<span id="cb16-101"><a href="#cb16-101" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-102"><a href="#cb16-102" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Push flow</span></span>
<span id="cb16-103"><a href="#cb16-103" aria-hidden="true" tabindex="-1"></a>            v <span class="op">=</span> t</span>
<span id="cb16-104"><a href="#cb16-104" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> v <span class="op">!=</span> s:</span>
<span id="cb16-105"><a href="#cb16-105" aria-hidden="true" tabindex="-1"></a>                u <span class="op">=</span> parent[v]</span>
<span id="cb16-106"><a href="#cb16-106" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.flow[u][v] <span class="op">+=</span> path_flow</span>
<span id="cb16-107"><a href="#cb16-107" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.flow[v][u] <span class="op">-=</span> path_flow</span>
<span id="cb16-108"><a href="#cb16-108" aria-hidden="true" tabindex="-1"></a>                total_cost <span class="op">+=</span> path_flow <span class="op">*</span> <span class="va">self</span>.cost[u][v]</span>
<span id="cb16-109"><a href="#cb16-109" aria-hidden="true" tabindex="-1"></a>                v <span class="op">=</span> u</span>
<span id="cb16-110"><a href="#cb16-110" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-111"><a href="#cb16-111" aria-hidden="true" tabindex="-1"></a>            total_flow <span class="op">+=</span> path_flow</span>
<span id="cb16-112"><a href="#cb16-112" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-113"><a href="#cb16-113" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> max_flow <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="kw">and</span> total_flow <span class="op">&gt;=</span> max_flow:</span>
<span id="cb16-114"><a href="#cb16-114" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb16-115"><a href="#cb16-115" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-116"><a href="#cb16-116" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> total_flow, total_cost</span>
<span id="cb16-117"><a href="#cb16-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-118"><a href="#cb16-118" aria-hidden="true" tabindex="-1"></a><span class="co"># Example: Shipping Problem</span></span>
<span id="cb16-119"><a href="#cb16-119" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> example_shipping():</span>
<span id="cb16-120"><a href="#cb16-120" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb16-121"><a href="#cb16-121" aria-hidden="true" tabindex="-1"></a><span class="co">    Ship goods from warehouses to stores minimizing cost.</span></span>
<span id="cb16-122"><a href="#cb16-122" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb16-123"><a href="#cb16-123" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 2 warehouses (0,1), 3 stores (2,3,4)</span></span>
<span id="cb16-124"><a href="#cb16-124" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Source = 5, Sink = 6</span></span>
<span id="cb16-125"><a href="#cb16-125" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-126"><a href="#cb16-126" aria-hidden="true" tabindex="-1"></a>    g <span class="op">=</span> MinCostFlow(<span class="dv">7</span>)</span>
<span id="cb16-127"><a href="#cb16-127" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-128"><a href="#cb16-128" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Source to warehouses (unlimited capacity, no cost)</span></span>
<span id="cb16-129"><a href="#cb16-129" aria-hidden="true" tabindex="-1"></a>    g.add_edge(<span class="dv">5</span>, <span class="dv">0</span>, <span class="dv">100</span>, <span class="dv">0</span>)  <span class="co"># source to warehouse 0</span></span>
<span id="cb16-130"><a href="#cb16-130" aria-hidden="true" tabindex="-1"></a>    g.add_edge(<span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">100</span>, <span class="dv">0</span>)  <span class="co"># source to warehouse 1</span></span>
<span id="cb16-131"><a href="#cb16-131" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-132"><a href="#cb16-132" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Warehouses to stores (limited capacity, various costs)</span></span>
<span id="cb16-133"><a href="#cb16-133" aria-hidden="true" tabindex="-1"></a>    g.add_edge(<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">10</span>, <span class="dv">2</span>)  <span class="co"># warehouse 0 to store 2, cost=2/unit</span></span>
<span id="cb16-134"><a href="#cb16-134" aria-hidden="true" tabindex="-1"></a>    g.add_edge(<span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">15</span>, <span class="dv">3</span>)</span>
<span id="cb16-135"><a href="#cb16-135" aria-hidden="true" tabindex="-1"></a>    g.add_edge(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">12</span>, <span class="dv">1</span>)</span>
<span id="cb16-136"><a href="#cb16-136" aria-hidden="true" tabindex="-1"></a>    g.add_edge(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">10</span>, <span class="dv">4</span>)</span>
<span id="cb16-137"><a href="#cb16-137" aria-hidden="true" tabindex="-1"></a>    g.add_edge(<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">20</span>, <span class="dv">2</span>)</span>
<span id="cb16-138"><a href="#cb16-138" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-139"><a href="#cb16-139" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Stores to sink (demand)</span></span>
<span id="cb16-140"><a href="#cb16-140" aria-hidden="true" tabindex="-1"></a>    g.add_edge(<span class="dv">2</span>, <span class="dv">6</span>, <span class="dv">15</span>, <span class="dv">0</span>)  <span class="co"># store 2 needs 15 units</span></span>
<span id="cb16-141"><a href="#cb16-141" aria-hidden="true" tabindex="-1"></a>    g.add_edge(<span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">20</span>, <span class="dv">0</span>)  <span class="co"># store 3 needs 20 units</span></span>
<span id="cb16-142"><a href="#cb16-142" aria-hidden="true" tabindex="-1"></a>    g.add_edge(<span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">10</span>, <span class="dv">0</span>)  <span class="co"># store 4 needs 10 units</span></span>
<span id="cb16-143"><a href="#cb16-143" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-144"><a href="#cb16-144" aria-hidden="true" tabindex="-1"></a>    flow, cost <span class="op">=</span> g.min_cost_max_flow(<span class="dv">5</span>, <span class="dv">6</span>)</span>
<span id="cb16-145"><a href="#cb16-145" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Flow: </span><span class="sc">{</span>flow<span class="sc">}</span><span class="ss"> units"</span>)</span>
<span id="cb16-146"><a href="#cb16-146" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Minimum cost: $</span><span class="sc">{</span>cost<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb16-147"><a href="#cb16-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-148"><a href="#cb16-148" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>:</span>
<span id="cb16-149"><a href="#cb16-149" aria-hidden="true" tabindex="-1"></a>    example_shipping()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="cycle-canceling-algorithm" class="level3" data-number="10.7.5">
<h3 data-number="10.7.5" class="anchored" data-anchor-id="cycle-canceling-algorithm"><span class="header-section-number">10.7.5</span> 9.7.5 Cycle-Canceling Algorithm</h3>
<p>Alternative approach: start with any feasible flow, then repeatedly find and cancel negative-cost cycles.</p>
<pre><code>1. Find any feasible flow (e.g., using max flow)
2. While there exists a negative-cost cycle in residual network:
       Push flow around the cycle
3. Return flow</code></pre>
<p>This works because negative-cost cycles represent opportunities to reduce cost by rerouting flow.</p>
</section>
</section>
<section id="real-world-applications" class="level2" data-number="10.8">
<h2 data-number="10.8" class="anchored" data-anchor-id="real-world-applications"><span class="header-section-number">10.8</span> 9.8 Real-World Applications</h2>
<section id="image-segmentation" class="level3" data-number="10.8.1">
<h3 data-number="10.8.1" class="anchored" data-anchor-id="image-segmentation"><span class="header-section-number">10.8.1</span> 9.8.1 Image Segmentation</h3>
<p><strong>Problem</strong>: Separate an image into foreground and background.</p>
<p><strong>Flow solution</strong>: - Each pixel is a vertex - Source represents “definitely foreground” - Sink represents “definitely background” - Edge capacities based on color similarity</p>
<p>The minimum cut separates foreground from background pixels!</p>
<p>This is used in: - Photo editing (green screen removal) - Medical imaging (tumor detection) - Object recognition</p>
</section>
<section id="airline-scheduling" class="level3" data-number="10.8.2">
<h3 data-number="10.8.2" class="anchored" data-anchor-id="airline-scheduling"><span class="header-section-number">10.8.2</span> 9.8.2 Airline Scheduling</h3>
<p><strong>Problem</strong>: Assign crews to flights.</p>
<p><strong>Flow solution</strong>: - Left vertices = flight legs - Right vertices = crew members - Edges = compatible assignments - Additional constraints for rest time, certifications, etc.</p>
<p>Maximum matching finds the best assignment!</p>
</section>
<section id="network-reliability" class="level3" data-number="10.8.3">
<h3 data-number="10.8.3" class="anchored" data-anchor-id="network-reliability"><span class="header-section-number">10.8.3</span> 9.8.3 Network Reliability</h3>
<p><strong>Problem</strong>: What’s the minimum number of edges to remove to disconnect s from t?</p>
<p><strong>Flow solution</strong>: Set all capacities to 1. The max flow (equals min cut) gives the answer!</p>
<p>This is used for: - Network vulnerability analysis - Infrastructure planning - Social network analysis</p>
</section>
<section id="project-selection" class="level3" data-number="10.8.4">
<h3 data-number="10.8.4" class="anchored" data-anchor-id="project-selection"><span class="header-section-number">10.8.4</span> 9.8.4 Project Selection</h3>
<p><strong>Problem</strong>: Choose projects to maximize profit, subject to dependencies.</p>
<p><strong>Flow solution</strong>: - Vertices for projects - Source = profit source - Sink = cost sink - Edges represent dependencies</p>
<p>The minimum cut identifies which projects to select!</p>
</section>
<section id="baseball-elimination" class="level3" data-number="10.8.5">
<h3 data-number="10.8.5" class="anchored" data-anchor-id="baseball-elimination"><span class="header-section-number">10.8.5</span> 9.8.5 Baseball Elimination</h3>
<p>Here’s a fun one: can your favorite team still win the league?</p>
<p><strong>Setup</strong>: - Teams have wins so far and games remaining - Can team X still finish in first place?</p>
<p><strong>Flow solution</strong>: - Model games as flow from source - Each game outcome adds to a team’s total - Sink captures whether team X can win</p>
<p>If max flow equals total remaining games, team X can still win!</p>
</section>
</section>
<section id="chapter-project-universal-flow-network-solver" class="level2" data-number="10.9">
<h2 data-number="10.9" class="anchored" data-anchor-id="chapter-project-universal-flow-network-solver"><span class="header-section-number">10.9</span> 9.9 Chapter Project: Universal Flow Network Solver</h2>
<p>Let’s build a comprehensive tool that handles all flow problems!</p>
<section id="project-specification" class="level3" data-number="10.9.1">
<h3 data-number="10.9.1" class="anchored" data-anchor-id="project-specification"><span class="header-section-number">10.9.1</span> 9.9.1 Project Specification</h3>
<p><strong>Goal</strong>: Create a flexible flow network solver with:</p>
<ol type="1">
<li><strong>Multiple algorithms</strong>: Edmonds-Karp, Push-Relabel, Min-Cost Flow</li>
<li><strong>Visualization</strong>: Show flow network and results</li>
<li><strong>Applications</strong>: Built-in solvers for matching, image seg, etc.</li>
<li><strong>Performance</strong>: Handle networks with 10,000+ vertices</li>
</ol>
</section>
<section id="architecture" class="level3" data-number="10.9.2">
<h3 data-number="10.9.2" class="anchored" data-anchor-id="architecture"><span class="header-section-number">10.9.2</span> 9.9.2 Architecture</h3>
<pre><code>FlowNetworkSolver/
├── core/
│   ├── network.py          # Network representation
│   ├── edmonds_karp.py     # EK algorithm
│   ├── push_relabel.py     # PR algorithm
│   └── min_cost_flow.py    # MCF algorithm
├── applications/
│   ├── matching.py         # Bipartite matching
│   ├── image_seg.py        # Image segmentation
│   └── scheduling.py       # Resource scheduling
├── visualization/
│   ├── plot_network.py     # Plot graphs
│   └── animate_flow.py     # Animate algorithm
├── utils/
│   ├── generators.py       # Generate test networks
│   └── validators.py       # Verify solutions
└── main.py                 # CLI interface</code></pre>
</section>
<section id="core-network-class" class="level3" data-number="10.9.3">
<h3 data-number="10.9.3" class="anchored" data-anchor-id="core-network-class"><span class="header-section-number">10.9.3</span> 9.9.3 Core Network Class</h3>
<div class="sourceCode" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># core/network.py</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> defaultdict</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> FlowNetwork:</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Universal flow network representation.</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="co">    Supports multiple algorithms and applications.</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, n<span class="op">=</span><span class="dv">0</span>):</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.n <span class="op">=</span> n</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.capacity <span class="op">=</span> defaultdict(<span class="kw">lambda</span>: defaultdict(<span class="bu">float</span>))</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.cost <span class="op">=</span> defaultdict(<span class="kw">lambda</span>: defaultdict(<span class="bu">float</span>))</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.flow <span class="op">=</span> defaultdict(<span class="kw">lambda</span>: defaultdict(<span class="bu">float</span>))</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.adj <span class="op">=</span> defaultdict(<span class="bu">set</span>)</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.vertex_labels <span class="op">=</span> {}  <span class="co"># Optional labels for vertices</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.edge_labels <span class="op">=</span> {}    <span class="co"># Optional labels for edges</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> add_vertex(<span class="va">self</span>, v, label<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Add a vertex (automatically extends n if needed)."""</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> v <span class="op">&gt;=</span> <span class="va">self</span>.n:</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.n <span class="op">=</span> v <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> label:</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.vertex_labels[v] <span class="op">=</span> label</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> add_edge(<span class="va">self</span>, u, v, capacity, cost<span class="op">=</span><span class="dv">0</span>, label<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Add directed edge with capacity and optional cost."""</span></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.add_vertex(u)</span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.add_vertex(v)</span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.capacity[u][v] <span class="op">+=</span> capacity</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.cost[u][v] <span class="op">=</span> cost</span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.cost[v][u] <span class="op">=</span> <span class="op">-</span>cost</span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.adj[u].add(v)</span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.adj[v].add(u)</span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> label:</span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.edge_labels[(u, v)] <span class="op">=</span> label</span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_residual_capacity(<span class="va">self</span>, u, v):</span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Get residual capacity of edge."""</span></span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.capacity[u][v] <span class="op">-</span> <span class="va">self</span>.flow[u][v]</span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> has_residual_capacity(<span class="va">self</span>, u, v):</span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Check if edge has residual capacity."""</span></span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.get_residual_capacity(u, v) <span class="op">&gt;</span> <span class="fl">1e-9</span></span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> reset_flow(<span class="va">self</span>):</span>
<span id="cb19-50"><a href="#cb19-50" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Clear all flow."""</span></span>
<span id="cb19-51"><a href="#cb19-51" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.flow <span class="op">=</span> defaultdict(<span class="kw">lambda</span>: defaultdict(<span class="bu">float</span>))</span>
<span id="cb19-52"><a href="#cb19-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-53"><a href="#cb19-53" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_flow_value(<span class="va">self</span>, s):</span>
<span id="cb19-54"><a href="#cb19-54" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Calculate total flow from source."""</span></span>
<span id="cb19-55"><a href="#cb19-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">sum</span>(<span class="va">self</span>.flow[s][v] <span class="cf">for</span> v <span class="kw">in</span> <span class="va">self</span>.adj[s])</span>
<span id="cb19-56"><a href="#cb19-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-57"><a href="#cb19-57" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_total_cost(<span class="va">self</span>):</span>
<span id="cb19-58"><a href="#cb19-58" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Calculate total cost of current flow."""</span></span>
<span id="cb19-59"><a href="#cb19-59" aria-hidden="true" tabindex="-1"></a>        total <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb19-60"><a href="#cb19-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> u <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.n):</span>
<span id="cb19-61"><a href="#cb19-61" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> v <span class="kw">in</span> <span class="va">self</span>.adj[u]:</span>
<span id="cb19-62"><a href="#cb19-62" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="va">self</span>.flow[u][v] <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb19-63"><a href="#cb19-63" aria-hidden="true" tabindex="-1"></a>                    total <span class="op">+=</span> <span class="va">self</span>.flow[u][v] <span class="op">*</span> <span class="va">self</span>.cost[u][v]</span>
<span id="cb19-64"><a href="#cb19-64" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> total <span class="op">/</span> <span class="dv">2</span>  <span class="co"># Divide by 2 because we count each edge twice</span></span>
<span id="cb19-65"><a href="#cb19-65" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-66"><a href="#cb19-66" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> to_dict(<span class="va">self</span>):</span>
<span id="cb19-67"><a href="#cb19-67" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Export network to dictionary for JSON serialization."""</span></span>
<span id="cb19-68"><a href="#cb19-68" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb19-69"><a href="#cb19-69" aria-hidden="true" tabindex="-1"></a>            <span class="st">'n'</span>: <span class="va">self</span>.n,</span>
<span id="cb19-70"><a href="#cb19-70" aria-hidden="true" tabindex="-1"></a>            <span class="st">'edges'</span>: [</span>
<span id="cb19-71"><a href="#cb19-71" aria-hidden="true" tabindex="-1"></a>                {</span>
<span id="cb19-72"><a href="#cb19-72" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'from'</span>: u,</span>
<span id="cb19-73"><a href="#cb19-73" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'to'</span>: v,</span>
<span id="cb19-74"><a href="#cb19-74" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'capacity'</span>: <span class="va">self</span>.capacity[u][v],</span>
<span id="cb19-75"><a href="#cb19-75" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'cost'</span>: <span class="va">self</span>.cost[u][v],</span>
<span id="cb19-76"><a href="#cb19-76" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'flow'</span>: <span class="va">self</span>.flow[u][v],</span>
<span id="cb19-77"><a href="#cb19-77" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'label'</span>: <span class="va">self</span>.edge_labels.get((u, v))</span>
<span id="cb19-78"><a href="#cb19-78" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb19-79"><a href="#cb19-79" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> u <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.n)</span>
<span id="cb19-80"><a href="#cb19-80" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> v <span class="kw">in</span> <span class="va">self</span>.adj[u]</span>
<span id="cb19-81"><a href="#cb19-81" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="va">self</span>.capacity[u][v] <span class="op">&gt;</span> <span class="dv">0</span></span>
<span id="cb19-82"><a href="#cb19-82" aria-hidden="true" tabindex="-1"></a>            ],</span>
<span id="cb19-83"><a href="#cb19-83" aria-hidden="true" tabindex="-1"></a>            <span class="st">'vertices'</span>: [</span>
<span id="cb19-84"><a href="#cb19-84" aria-hidden="true" tabindex="-1"></a>                {</span>
<span id="cb19-85"><a href="#cb19-85" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'id'</span>: v,</span>
<span id="cb19-86"><a href="#cb19-86" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'label'</span>: <span class="va">self</span>.vertex_labels.get(v)</span>
<span id="cb19-87"><a href="#cb19-87" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb19-88"><a href="#cb19-88" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> v <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.n)</span>
<span id="cb19-89"><a href="#cb19-89" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb19-90"><a href="#cb19-90" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb19-91"><a href="#cb19-91" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-92"><a href="#cb19-92" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> save(<span class="va">self</span>, filename):</span>
<span id="cb19-93"><a href="#cb19-93" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Save network to JSON file."""</span></span>
<span id="cb19-94"><a href="#cb19-94" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(filename, <span class="st">'w'</span>) <span class="im">as</span> f:</span>
<span id="cb19-95"><a href="#cb19-95" aria-hidden="true" tabindex="-1"></a>            json.dump(<span class="va">self</span>.to_dict(), f, indent<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb19-96"><a href="#cb19-96" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-97"><a href="#cb19-97" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb19-98"><a href="#cb19-98" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> load(filename):</span>
<span id="cb19-99"><a href="#cb19-99" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Load network from JSON file."""</span></span>
<span id="cb19-100"><a href="#cb19-100" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(filename) <span class="im">as</span> f:</span>
<span id="cb19-101"><a href="#cb19-101" aria-hidden="true" tabindex="-1"></a>            data <span class="op">=</span> json.load(f)</span>
<span id="cb19-102"><a href="#cb19-102" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-103"><a href="#cb19-103" aria-hidden="true" tabindex="-1"></a>        network <span class="op">=</span> FlowNetwork(data[<span class="st">'n'</span>])</span>
<span id="cb19-104"><a href="#cb19-104" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-105"><a href="#cb19-105" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> vertex <span class="kw">in</span> data.get(<span class="st">'vertices'</span>, []):</span>
<span id="cb19-106"><a href="#cb19-106" aria-hidden="true" tabindex="-1"></a>            network.vertex_labels[vertex[<span class="st">'id'</span>]] <span class="op">=</span> vertex.get(<span class="st">'label'</span>)</span>
<span id="cb19-107"><a href="#cb19-107" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-108"><a href="#cb19-108" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> edge <span class="kw">in</span> data[<span class="st">'edges'</span>]:</span>
<span id="cb19-109"><a href="#cb19-109" aria-hidden="true" tabindex="-1"></a>            network.add_edge(</span>
<span id="cb19-110"><a href="#cb19-110" aria-hidden="true" tabindex="-1"></a>                edge[<span class="st">'from'</span>],</span>
<span id="cb19-111"><a href="#cb19-111" aria-hidden="true" tabindex="-1"></a>                edge[<span class="st">'to'</span>],</span>
<span id="cb19-112"><a href="#cb19-112" aria-hidden="true" tabindex="-1"></a>                edge[<span class="st">'capacity'</span>],</span>
<span id="cb19-113"><a href="#cb19-113" aria-hidden="true" tabindex="-1"></a>                edge.get(<span class="st">'cost'</span>, <span class="dv">0</span>),</span>
<span id="cb19-114"><a href="#cb19-114" aria-hidden="true" tabindex="-1"></a>                edge.get(<span class="st">'label'</span>)</span>
<span id="cb19-115"><a href="#cb19-115" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb19-116"><a href="#cb19-116" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> edge.get(<span class="st">'flow'</span>):</span>
<span id="cb19-117"><a href="#cb19-117" aria-hidden="true" tabindex="-1"></a>                network.flow[edge[<span class="st">'from'</span>]][edge[<span class="st">'to'</span>]] <span class="op">=</span> edge[<span class="st">'flow'</span>]</span>
<span id="cb19-118"><a href="#cb19-118" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-119"><a href="#cb19-119" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> network</span>
<span id="cb19-120"><a href="#cb19-120" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-121"><a href="#cb19-121" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__str__</span>(<span class="va">self</span>):</span>
<span id="cb19-122"><a href="#cb19-122" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""String representation."""</span></span>
<span id="cb19-123"><a href="#cb19-123" aria-hidden="true" tabindex="-1"></a>        lines <span class="op">=</span> [<span class="ss">f"Flow Network (</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>n<span class="sc">}</span><span class="ss"> vertices, </span><span class="sc">{</span><span class="bu">sum</span>(<span class="bu">len</span>(v) <span class="cf">for</span> v <span class="kw">in</span> <span class="va">self</span>.adj.values()) <span class="op">//</span> <span class="dv">2</span><span class="sc">}</span><span class="ss"> edges)"</span>]</span>
<span id="cb19-124"><a href="#cb19-124" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> u <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.n):</span>
<span id="cb19-125"><a href="#cb19-125" aria-hidden="true" tabindex="-1"></a>            label_u <span class="op">=</span> <span class="va">self</span>.vertex_labels.get(u, u)</span>
<span id="cb19-126"><a href="#cb19-126" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> v <span class="kw">in</span> <span class="va">self</span>.adj[u]:</span>
<span id="cb19-127"><a href="#cb19-127" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="va">self</span>.capacity[u][v] <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb19-128"><a href="#cb19-128" aria-hidden="true" tabindex="-1"></a>                    label_v <span class="op">=</span> <span class="va">self</span>.vertex_labels.get(v, v)</span>
<span id="cb19-129"><a href="#cb19-129" aria-hidden="true" tabindex="-1"></a>                    flow <span class="op">=</span> <span class="va">self</span>.flow[u][v]</span>
<span id="cb19-130"><a href="#cb19-130" aria-hidden="true" tabindex="-1"></a>                    cap <span class="op">=</span> <span class="va">self</span>.capacity[u][v]</span>
<span id="cb19-131"><a href="#cb19-131" aria-hidden="true" tabindex="-1"></a>                    cost <span class="op">=</span> <span class="va">self</span>.cost[u][v]</span>
<span id="cb19-132"><a href="#cb19-132" aria-hidden="true" tabindex="-1"></a>                    lines.append(<span class="ss">f"  </span><span class="sc">{</span>label_u<span class="sc">}</span><span class="ss"> -&gt; </span><span class="sc">{</span>label_v<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>flow<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>cap<span class="sc">}</span><span class="ss"> (cost: </span><span class="sc">{</span>cost<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb19-133"><a href="#cb19-133" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>.join(lines)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="algorithm-interface" class="level3" data-number="10.9.4">
<h3 data-number="10.9.4" class="anchored" data-anchor-id="algorithm-interface"><span class="header-section-number">10.9.4</span> 9.9.4 Algorithm Interface</h3>
<div class="sourceCode" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># core/algorithm.py</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> abc <span class="im">import</span> ABC, abstractmethod</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> FlowAlgorithm(ABC):</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Abstract base class for flow algorithms."""</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, network):</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.network <span class="op">=</span> network</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.iterations <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.history <span class="op">=</span> []  <span class="co"># For visualization</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">@abstractmethod</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> solve(<span class="va">self</span>, source, sink):</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="co">        Solve the flow problem.</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns (flow_value, computation_info).</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">pass</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> record_state(<span class="va">self</span>, description):</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Record current network state for visualization."""</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.history.append({</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>            <span class="st">'iteration'</span>: <span class="va">self</span>.iterations,</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>            <span class="st">'description'</span>: description,</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>            <span class="st">'flow'</span>: <span class="bu">dict</span>(<span class="va">self</span>.network.flow),</span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>            <span class="st">'value'</span>: <span class="va">self</span>.network.get_flow_value(<span class="va">self</span>.source) <span class="cf">if</span> <span class="bu">hasattr</span>(<span class="va">self</span>, <span class="st">'source'</span>) <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>        })</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="application-matching-solver" class="level3" data-number="10.9.5">
<h3 data-number="10.9.5" class="anchored" data-anchor-id="application-matching-solver"><span class="header-section-number">10.9.5</span> 9.9.5 Application: Matching Solver</h3>
<div class="sourceCode" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># applications/matching.py</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> core.network <span class="im">import</span> FlowNetwork</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> core.edmonds_karp <span class="im">import</span> EdmondsKarp</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> MatchingSolver:</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Solve bipartite matching problems.</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, left_items, right_items):</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="co">        Initialize with lists of left and right items.</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="co">        Items can be any hashable type (strings, ints, etc.).</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.left_items <span class="op">=</span> <span class="bu">list</span>(left_items)</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.right_items <span class="op">=</span> <span class="bu">list</span>(right_items)</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.left_to_id <span class="op">=</span> {item: i <span class="cf">for</span> i, item <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="va">self</span>.left_items)}</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.right_to_id <span class="op">=</span> {item: i <span class="cf">for</span> i, item <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="va">self</span>.right_items)}</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Vertex IDs:</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 0 = source</span></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 1..n_left = left vertices</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>        <span class="co"># n_left+1..n_left+n_right = right vertices</span></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># n_left+n_right+1 = sink</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.source <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.sink <span class="op">=</span> <span class="bu">len</span>(left_items) <span class="op">+</span> <span class="bu">len</span>(right_items) <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.network <span class="op">=</span> FlowNetwork(<span class="va">self</span>.sink <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Label vertices</span></span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.network.vertex_labels[<span class="va">self</span>.source] <span class="op">=</span> <span class="st">"SOURCE"</span></span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.network.vertex_labels[<span class="va">self</span>.sink] <span class="op">=</span> <span class="st">"SINK"</span></span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, item <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="va">self</span>.left_items):</span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.network.vertex_labels[i <span class="op">+</span> <span class="dv">1</span>] <span class="op">=</span> <span class="ss">f"L:</span><span class="sc">{</span>item<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, item <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="va">self</span>.right_items):</span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.network.vertex_labels[<span class="bu">len</span>(<span class="va">self</span>.left_items) <span class="op">+</span> i <span class="op">+</span> <span class="dv">1</span>] <span class="op">=</span> <span class="ss">f"R:</span><span class="sc">{</span>item<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> add_compatibility(<span class="va">self</span>, left_item, right_item, weight<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a><span class="co">        Add compatibility between left and right items.</span></span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a><span class="co">        Weight can be used for weighted matching.</span></span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a>        left_id <span class="op">=</span> <span class="va">self</span>.left_to_id[left_item] <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a>        right_id <span class="op">=</span> <span class="bu">len</span>(<span class="va">self</span>.left_items) <span class="op">+</span> <span class="va">self</span>.right_to_id[right_item] <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.network.add_edge(left_id, right_id, <span class="dv">1</span>, <span class="op">-</span>weight)  <span class="co"># Negative for max weight</span></span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> solve(<span class="va">self</span>):</span>
<span id="cb21-49"><a href="#cb21-49" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb21-50"><a href="#cb21-50" aria-hidden="true" tabindex="-1"></a><span class="co">        Find maximum matching.</span></span>
<span id="cb21-51"><a href="#cb21-51" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns (matching_size, matches_list).</span></span>
<span id="cb21-52"><a href="#cb21-52" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb21-53"><a href="#cb21-53" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add source and sink edges</span></span>
<span id="cb21-54"><a href="#cb21-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(<span class="va">self</span>.left_items)):</span>
<span id="cb21-55"><a href="#cb21-55" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.network.add_edge(<span class="va">self</span>.source, i <span class="op">+</span> <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb21-56"><a href="#cb21-56" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-57"><a href="#cb21-57" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(<span class="va">self</span>.right_items)):</span>
<span id="cb21-58"><a href="#cb21-58" aria-hidden="true" tabindex="-1"></a>            right_id <span class="op">=</span> <span class="bu">len</span>(<span class="va">self</span>.left_items) <span class="op">+</span> i <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb21-59"><a href="#cb21-59" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.network.add_edge(right_id, <span class="va">self</span>.sink, <span class="dv">1</span>)</span>
<span id="cb21-60"><a href="#cb21-60" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-61"><a href="#cb21-61" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Solve using Edmonds-Karp</span></span>
<span id="cb21-62"><a href="#cb21-62" aria-hidden="true" tabindex="-1"></a>        ek <span class="op">=</span> EdmondsKarp(<span class="va">self</span>.network)</span>
<span id="cb21-63"><a href="#cb21-63" aria-hidden="true" tabindex="-1"></a>        flow_value, _ <span class="op">=</span> ek.solve(<span class="va">self</span>.source, <span class="va">self</span>.sink)</span>
<span id="cb21-64"><a href="#cb21-64" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-65"><a href="#cb21-65" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Extract matching</span></span>
<span id="cb21-66"><a href="#cb21-66" aria-hidden="true" tabindex="-1"></a>        matches <span class="op">=</span> []</span>
<span id="cb21-67"><a href="#cb21-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, left_item <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="va">self</span>.left_items):</span>
<span id="cb21-68"><a href="#cb21-68" aria-hidden="true" tabindex="-1"></a>            left_id <span class="op">=</span> i <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb21-69"><a href="#cb21-69" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> j, right_item <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="va">self</span>.right_items):</span>
<span id="cb21-70"><a href="#cb21-70" aria-hidden="true" tabindex="-1"></a>                right_id <span class="op">=</span> <span class="bu">len</span>(<span class="va">self</span>.left_items) <span class="op">+</span> j <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb21-71"><a href="#cb21-71" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="va">self</span>.network.flow[left_id][right_id] <span class="op">&gt;</span> <span class="fl">0.5</span>:  <span class="co"># Flow is 1</span></span>
<span id="cb21-72"><a href="#cb21-72" aria-hidden="true" tabindex="-1"></a>                    matches.append((left_item, right_item))</span>
<span id="cb21-73"><a href="#cb21-73" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-74"><a href="#cb21-74" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">int</span>(flow_value), matches</span>
<span id="cb21-75"><a href="#cb21-75" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-76"><a href="#cb21-76" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_unmatched(<span class="va">self</span>, matches):</span>
<span id="cb21-77"><a href="#cb21-77" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Get items that weren't matched."""</span></span>
<span id="cb21-78"><a href="#cb21-78" aria-hidden="true" tabindex="-1"></a>        matched_left <span class="op">=</span> {left <span class="cf">for</span> left, _ <span class="kw">in</span> matches}</span>
<span id="cb21-79"><a href="#cb21-79" aria-hidden="true" tabindex="-1"></a>        matched_right <span class="op">=</span> {right <span class="cf">for</span> _, right <span class="kw">in</span> matches}</span>
<span id="cb21-80"><a href="#cb21-80" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-81"><a href="#cb21-81" aria-hidden="true" tabindex="-1"></a>        unmatched_left <span class="op">=</span> [item <span class="cf">for</span> item <span class="kw">in</span> <span class="va">self</span>.left_items <span class="cf">if</span> item <span class="kw">not</span> <span class="kw">in</span> matched_left]</span>
<span id="cb21-82"><a href="#cb21-82" aria-hidden="true" tabindex="-1"></a>        unmatched_right <span class="op">=</span> [item <span class="cf">for</span> item <span class="kw">in</span> <span class="va">self</span>.right_items <span class="cf">if</span> item <span class="kw">not</span> <span class="kw">in</span> matched_right]</span>
<span id="cb21-83"><a href="#cb21-83" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb21-84"><a href="#cb21-84" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> unmatched_left, unmatched_right</span>
<span id="cb21-85"><a href="#cb21-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-86"><a href="#cb21-86" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage</span></span>
<span id="cb21-87"><a href="#cb21-87" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> example_job_matching():</span>
<span id="cb21-88"><a href="#cb21-88" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Match candidates to jobs."""</span></span>
<span id="cb21-89"><a href="#cb21-89" aria-hidden="true" tabindex="-1"></a>    candidates <span class="op">=</span> [<span class="st">"Alice"</span>, <span class="st">"Bob"</span>, <span class="st">"Charlie"</span>, <span class="st">"Diana"</span>]</span>
<span id="cb21-90"><a href="#cb21-90" aria-hidden="true" tabindex="-1"></a>    jobs <span class="op">=</span> [<span class="st">"Engineer"</span>, <span class="st">"Designer"</span>, <span class="st">"Manager"</span>]</span>
<span id="cb21-91"><a href="#cb21-91" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-92"><a href="#cb21-92" aria-hidden="true" tabindex="-1"></a>    solver <span class="op">=</span> MatchingSolver(candidates, jobs)</span>
<span id="cb21-93"><a href="#cb21-93" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-94"><a href="#cb21-94" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add qualifications</span></span>
<span id="cb21-95"><a href="#cb21-95" aria-hidden="true" tabindex="-1"></a>    solver.add_compatibility(<span class="st">"Alice"</span>, <span class="st">"Engineer"</span>)</span>
<span id="cb21-96"><a href="#cb21-96" aria-hidden="true" tabindex="-1"></a>    solver.add_compatibility(<span class="st">"Alice"</span>, <span class="st">"Manager"</span>)</span>
<span id="cb21-97"><a href="#cb21-97" aria-hidden="true" tabindex="-1"></a>    solver.add_compatibility(<span class="st">"Bob"</span>, <span class="st">"Engineer"</span>)</span>
<span id="cb21-98"><a href="#cb21-98" aria-hidden="true" tabindex="-1"></a>    solver.add_compatibility(<span class="st">"Charlie"</span>, <span class="st">"Designer"</span>)</span>
<span id="cb21-99"><a href="#cb21-99" aria-hidden="true" tabindex="-1"></a>    solver.add_compatibility(<span class="st">"Diana"</span>, <span class="st">"Manager"</span>)</span>
<span id="cb21-100"><a href="#cb21-100" aria-hidden="true" tabindex="-1"></a>    solver.add_compatibility(<span class="st">"Diana"</span>, <span class="st">"Designer"</span>)</span>
<span id="cb21-101"><a href="#cb21-101" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-102"><a href="#cb21-102" aria-hidden="true" tabindex="-1"></a>    size, matches <span class="op">=</span> solver.solve()</span>
<span id="cb21-103"><a href="#cb21-103" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-104"><a href="#cb21-104" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Maximum matching: </span><span class="sc">{</span>size<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb21-105"><a href="#cb21-105" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Matches:"</span>)</span>
<span id="cb21-106"><a href="#cb21-106" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> candidate, job <span class="kw">in</span> matches:</span>
<span id="cb21-107"><a href="#cb21-107" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>candidate<span class="sc">}</span><span class="ss"> -&gt; </span><span class="sc">{</span>job<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb21-108"><a href="#cb21-108" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-109"><a href="#cb21-109" aria-hidden="true" tabindex="-1"></a>    unmatched_candidates, unmatched_jobs <span class="op">=</span> solver.get_unmatched(matches)</span>
<span id="cb21-110"><a href="#cb21-110" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> unmatched_candidates:</span>
<span id="cb21-111"><a href="#cb21-111" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Unmatched candidates: </span><span class="sc">{</span><span class="st">', '</span><span class="sc">.</span>join(unmatched_candidates)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb21-112"><a href="#cb21-112" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> unmatched_jobs:</span>
<span id="cb21-113"><a href="#cb21-113" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Unmatched jobs: </span><span class="sc">{</span><span class="st">', '</span><span class="sc">.</span>join(unmatched_jobs)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb21-114"><a href="#cb21-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-115"><a href="#cb21-115" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>:</span>
<span id="cb21-116"><a href="#cb21-116" aria-hidden="true" tabindex="-1"></a>    example_job_matching()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="visualization-module" class="level3" data-number="10.9.6">
<h3 data-number="10.9.6" class="anchored" data-anchor-id="visualization-module"><span class="header-section-number">10.9.6</span> 9.9.6 Visualization Module</h3>
<div class="sourceCode" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># visualization/plot_network.py</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> networkx <span class="im">as</span> nx</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.patches <span class="im">import</span> FancyBboxPatch</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_flow_network(network, source<span class="op">=</span><span class="va">None</span>, sink<span class="op">=</span><span class="va">None</span>, filename<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co">    Visualize flow network using matplotlib and networkx.</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    G <span class="op">=</span> nx.DiGraph()</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add nodes</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> v <span class="kw">in</span> <span class="bu">range</span>(network.n):</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>        label <span class="op">=</span> network.vertex_labels.get(v, <span class="bu">str</span>(v))</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>        G.add_node(v, label<span class="op">=</span>label)</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add edges</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>    edge_labels <span class="op">=</span> {}</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> u <span class="kw">in</span> <span class="bu">range</span>(network.n):</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> v <span class="kw">in</span> network.adj[u]:</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> network.capacity[u][v] <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>                G.add_edge(u, v)</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>                flow <span class="op">=</span> network.flow[u][v]</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>                cap <span class="op">=</span> network.capacity[u][v]</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>                cost <span class="op">=</span> network.cost[u][v]</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> cost <span class="op">!=</span> <span class="dv">0</span>:</span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>                    edge_labels[(u, v)] <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>flow<span class="sc">:.0f}</span><span class="ss">/</span><span class="sc">{</span>cap<span class="sc">:.0f}</span><span class="ch">\n</span><span class="ss">($</span><span class="sc">{</span>cost<span class="sc">:.1f}</span><span class="ss">)"</span></span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>                    edge_labels[(u, v)] <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>flow<span class="sc">:.0f}</span><span class="ss">/</span><span class="sc">{</span>cap<span class="sc">:.0f}</span><span class="ss">"</span></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Layout</span></span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>    pos <span class="op">=</span> nx.spring_layout(G, k<span class="op">=</span><span class="dv">2</span>, iterations<span class="op">=</span><span class="dv">50</span>)</span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If source/sink specified, position them specially</span></span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> source <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="kw">and</span> sink <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>        pos[source] <span class="op">=</span> (<span class="op">-</span><span class="dv">2</span>, <span class="dv">0</span>)</span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>        pos[sink] <span class="op">=</span> (<span class="dv">2</span>, <span class="dv">0</span>)</span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create figure</span></span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">10</span>))</span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Draw nodes</span></span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a>    node_colors <span class="op">=</span> []</span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> v <span class="kw">in</span> G.nodes():</span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> v <span class="op">==</span> source:</span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a>            node_colors.append(<span class="st">'#90EE90'</span>)  <span class="co"># Light green</span></span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> v <span class="op">==</span> sink:</span>
<span id="cb22-49"><a href="#cb22-49" aria-hidden="true" tabindex="-1"></a>            node_colors.append(<span class="st">'#FFB6C1'</span>)  <span class="co"># Light pink</span></span>
<span id="cb22-50"><a href="#cb22-50" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb22-51"><a href="#cb22-51" aria-hidden="true" tabindex="-1"></a>            node_colors.append(<span class="st">'#87CEEB'</span>)  <span class="co"># Sky blue</span></span>
<span id="cb22-52"><a href="#cb22-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-53"><a href="#cb22-53" aria-hidden="true" tabindex="-1"></a>    nx.draw_networkx_nodes(G, pos, node_color<span class="op">=</span>node_colors,</span>
<span id="cb22-54"><a href="#cb22-54" aria-hidden="true" tabindex="-1"></a>                          node_size<span class="op">=</span><span class="dv">800</span>, ax<span class="op">=</span>ax)</span>
<span id="cb22-55"><a href="#cb22-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-56"><a href="#cb22-56" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Draw edges</span></span>
<span id="cb22-57"><a href="#cb22-57" aria-hidden="true" tabindex="-1"></a>    edges_with_flow <span class="op">=</span> [(u, v) <span class="cf">for</span> u, v <span class="kw">in</span> G.edges()</span>
<span id="cb22-58"><a href="#cb22-58" aria-hidden="true" tabindex="-1"></a>                       <span class="cf">if</span> network.flow[u][v] <span class="op">&gt;</span> <span class="fl">1e-9</span>]</span>
<span id="cb22-59"><a href="#cb22-59" aria-hidden="true" tabindex="-1"></a>    edges_without_flow <span class="op">=</span> [(u, v) <span class="cf">for</span> u, v <span class="kw">in</span> G.edges()</span>
<span id="cb22-60"><a href="#cb22-60" aria-hidden="true" tabindex="-1"></a>                         <span class="cf">if</span> network.flow[u][v] <span class="op">&lt;=</span> <span class="fl">1e-9</span>]</span>
<span id="cb22-61"><a href="#cb22-61" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-62"><a href="#cb22-62" aria-hidden="true" tabindex="-1"></a>    nx.draw_networkx_edges(G, pos, edges_with_flow,</span>
<span id="cb22-63"><a href="#cb22-63" aria-hidden="true" tabindex="-1"></a>                          edge_color<span class="op">=</span><span class="st">'red'</span>, width<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb22-64"><a href="#cb22-64" aria-hidden="true" tabindex="-1"></a>                          arrowsize<span class="op">=</span><span class="dv">20</span>, ax<span class="op">=</span>ax)</span>
<span id="cb22-65"><a href="#cb22-65" aria-hidden="true" tabindex="-1"></a>    nx.draw_networkx_edges(G, pos, edges_without_flow,</span>
<span id="cb22-66"><a href="#cb22-66" aria-hidden="true" tabindex="-1"></a>                          edge_color<span class="op">=</span><span class="st">'gray'</span>, width<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb22-67"><a href="#cb22-67" aria-hidden="true" tabindex="-1"></a>                          style<span class="op">=</span><span class="st">'dashed'</span>, arrowsize<span class="op">=</span><span class="dv">15</span>, ax<span class="op">=</span>ax)</span>
<span id="cb22-68"><a href="#cb22-68" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-69"><a href="#cb22-69" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Draw labels</span></span>
<span id="cb22-70"><a href="#cb22-70" aria-hidden="true" tabindex="-1"></a>    labels <span class="op">=</span> {v: network.vertex_labels.get(v, <span class="bu">str</span>(v)) <span class="cf">for</span> v <span class="kw">in</span> G.nodes()}</span>
<span id="cb22-71"><a href="#cb22-71" aria-hidden="true" tabindex="-1"></a>    nx.draw_networkx_labels(G, pos, labels, font_size<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb22-72"><a href="#cb22-72" aria-hidden="true" tabindex="-1"></a>                           font_weight<span class="op">=</span><span class="st">'bold'</span>, ax<span class="op">=</span>ax)</span>
<span id="cb22-73"><a href="#cb22-73" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-74"><a href="#cb22-74" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Draw edge labels</span></span>
<span id="cb22-75"><a href="#cb22-75" aria-hidden="true" tabindex="-1"></a>    nx.draw_networkx_edge_labels(G, pos, edge_labels,</span>
<span id="cb22-76"><a href="#cb22-76" aria-hidden="true" tabindex="-1"></a>                                font_size<span class="op">=</span><span class="dv">8</span>, ax<span class="op">=</span>ax)</span>
<span id="cb22-77"><a href="#cb22-77" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-78"><a href="#cb22-78" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Title</span></span>
<span id="cb22-79"><a href="#cb22-79" aria-hidden="true" tabindex="-1"></a>    flow_value <span class="op">=</span> network.get_flow_value(source) <span class="cf">if</span> source <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb22-80"><a href="#cb22-80" aria-hidden="true" tabindex="-1"></a>    total_cost <span class="op">=</span> network.get_total_cost()</span>
<span id="cb22-81"><a href="#cb22-81" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="ss">f"Flow Network</span><span class="ch">\n</span><span class="ss">Total Flow: </span><span class="sc">{</span>flow_value<span class="sc">:.1f}</span><span class="ss"> | Total Cost: $</span><span class="sc">{</span>total_cost<span class="sc">:.1f}</span><span class="ss">"</span>,</span>
<span id="cb22-82"><a href="#cb22-82" aria-hidden="true" tabindex="-1"></a>                fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb22-83"><a href="#cb22-83" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-84"><a href="#cb22-84" aria-hidden="true" tabindex="-1"></a>    plt.axis(<span class="st">'off'</span>)</span>
<span id="cb22-85"><a href="#cb22-85" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb22-86"><a href="#cb22-86" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-87"><a href="#cb22-87" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> filename:</span>
<span id="cb22-88"><a href="#cb22-88" aria-hidden="true" tabindex="-1"></a>        plt.savefig(filename, dpi<span class="op">=</span><span class="dv">300</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb22-89"><a href="#cb22-89" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb22-90"><a href="#cb22-90" aria-hidden="true" tabindex="-1"></a>        plt.show()</span>
<span id="cb22-91"><a href="#cb22-91" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-92"><a href="#cb22-92" aria-hidden="true" tabindex="-1"></a>    plt.close()</span>
<span id="cb22-93"><a href="#cb22-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-94"><a href="#cb22-94" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> animate_algorithm(algorithm, source, sink, output_prefix<span class="op">=</span><span class="st">"frame"</span>):</span>
<span id="cb22-95"><a href="#cb22-95" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb22-96"><a href="#cb22-96" aria-hidden="true" tabindex="-1"></a><span class="co">    Create animation frames for algorithm execution.</span></span>
<span id="cb22-97"><a href="#cb22-97" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb22-98"><a href="#cb22-98" aria-hidden="true" tabindex="-1"></a>    algorithm.solve(source, sink)</span>
<span id="cb22-99"><a href="#cb22-99" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-100"><a href="#cb22-100" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, state <span class="kw">in</span> <span class="bu">enumerate</span>(algorithm.history):</span>
<span id="cb22-101"><a href="#cb22-101" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Temporarily set flow to historical state</span></span>
<span id="cb22-102"><a href="#cb22-102" aria-hidden="true" tabindex="-1"></a>        old_flow <span class="op">=</span> <span class="bu">dict</span>(algorithm.network.flow)</span>
<span id="cb22-103"><a href="#cb22-103" aria-hidden="true" tabindex="-1"></a>        algorithm.network.flow <span class="op">=</span> state[<span class="st">'flow'</span>]</span>
<span id="cb22-104"><a href="#cb22-104" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb22-105"><a href="#cb22-105" aria-hidden="true" tabindex="-1"></a>        filename <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>output_prefix<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>i<span class="sc">:03d}</span><span class="ss">.png"</span></span>
<span id="cb22-106"><a href="#cb22-106" aria-hidden="true" tabindex="-1"></a>        plot_flow_network(algorithm.network, source, sink, filename)</span>
<span id="cb22-107"><a href="#cb22-107" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb22-108"><a href="#cb22-108" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Frame </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>state[<span class="st">'description'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb22-109"><a href="#cb22-109" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb22-110"><a href="#cb22-110" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Restore current flow</span></span>
<span id="cb22-111"><a href="#cb22-111" aria-hidden="true" tabindex="-1"></a>        algorithm.network.flow <span class="op">=</span> old_flow</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="command-line-interface" class="level3" data-number="10.9.7">
<h3 data-number="10.9.7" class="anchored" data-anchor-id="command-line-interface"><span class="header-section-number">10.9.7</span> 9.9.7 Command-Line Interface</h3>
<div class="sourceCode" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># main.py</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> argparse</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> core.network <span class="im">import</span> FlowNetwork</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> core.edmonds_karp <span class="im">import</span> EdmondsKarp</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> core.push_relabel <span class="im">import</span> PushRelabel</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> core.min_cost_flow <span class="im">import</span> MinCostFlow</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> applications.matching <span class="im">import</span> MatchingSolver</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> visualization.plot_network <span class="im">import</span> plot_flow_network</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> utils.generators <span class="im">import</span> generate_random_network</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> main():</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    parser <span class="op">=</span> argparse.ArgumentParser(description<span class="op">=</span><span class="st">'Universal Flow Network Solver'</span>)</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>    subparsers <span class="op">=</span> parser.add_subparsers(dest<span class="op">=</span><span class="st">'command'</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'Command to execute'</span>)</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Max flow command</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>    maxflow_parser <span class="op">=</span> subparsers.add_parser(<span class="st">'maxflow'</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'Compute maximum flow'</span>)</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>    maxflow_parser.add_argument(<span class="st">'input'</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'Input network file (JSON)'</span>)</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>    maxflow_parser.add_argument(<span class="st">'-s'</span>, <span class="st">'--source'</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">int</span>, required<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>    maxflow_parser.add_argument(<span class="st">'-t'</span>, <span class="st">'--sink'</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">int</span>, required<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>    maxflow_parser.add_argument(<span class="st">'-a'</span>, <span class="st">'--algorithm'</span>, choices<span class="op">=</span>[<span class="st">'ek'</span>, <span class="st">'pr'</span>],</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>                               default<span class="op">=</span><span class="st">'ek'</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'Algorithm to use'</span>)</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>    maxflow_parser.add_argument(<span class="st">'-v'</span>, <span class="st">'--visualize'</span>, action<span class="op">=</span><span class="st">'store_true'</span>,</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>                               <span class="bu">help</span><span class="op">=</span><span class="st">'Visualize result'</span>)</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Min cost flow command</span></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>    mincost_parser <span class="op">=</span> subparsers.add_parser(<span class="st">'mincost'</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'Compute minimum cost flow'</span>)</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>    mincost_parser.add_argument(<span class="st">'input'</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'Input network file (JSON)'</span>)</span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>    mincost_parser.add_argument(<span class="st">'-s'</span>, <span class="st">'--source'</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">int</span>, required<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>    mincost_parser.add_argument(<span class="st">'-t'</span>, <span class="st">'--sink'</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">int</span>, required<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>    mincost_parser.add_argument(<span class="st">'-f'</span>, <span class="st">'--flow'</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">float</span>,</span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>                               <span class="bu">help</span><span class="op">=</span><span class="st">'Flow amount (default: maximum)'</span>)</span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>    mincost_parser.add_argument(<span class="st">'-v'</span>, <span class="st">'--visualize'</span>, action<span class="op">=</span><span class="st">'store_true'</span>)</span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Generate network command</span></span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>    gen_parser <span class="op">=</span> subparsers.add_parser(<span class="st">'generate'</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'Generate random network'</span>)</span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>    gen_parser.add_argument(<span class="st">'output'</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'Output file (JSON)'</span>)</span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a>    gen_parser.add_argument(<span class="st">'-n'</span>, <span class="st">'--vertices'</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">int</span>, default<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a>    gen_parser.add_argument(<span class="st">'-e'</span>, <span class="st">'--edges'</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">int</span>, default<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a>    gen_parser.add_argument(<span class="st">'--max-capacity'</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">float</span>, default<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a>    args <span class="op">=</span> parser.parse_args()</span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> args.command <span class="op">==</span> <span class="st">'maxflow'</span>:</span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a>        network <span class="op">=</span> FlowNetwork.load(args.<span class="bu">input</span>)</span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb23-47"><a href="#cb23-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> args.algorithm <span class="op">==</span> <span class="st">'ek'</span>:</span>
<span id="cb23-48"><a href="#cb23-48" aria-hidden="true" tabindex="-1"></a>            solver <span class="op">=</span> EdmondsKarp(network)</span>
<span id="cb23-49"><a href="#cb23-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb23-50"><a href="#cb23-50" aria-hidden="true" tabindex="-1"></a>            solver <span class="op">=</span> PushRelabel(network)</span>
<span id="cb23-51"><a href="#cb23-51" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb23-52"><a href="#cb23-52" aria-hidden="true" tabindex="-1"></a>        flow_value, info <span class="op">=</span> solver.solve(args.source, args.sink)</span>
<span id="cb23-53"><a href="#cb23-53" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb23-54"><a href="#cb23-54" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Maximum Flow: </span><span class="sc">{</span>flow_value<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb23-55"><a href="#cb23-55" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Algorithm: </span><span class="sc">{</span>args<span class="sc">.</span>algorithm<span class="sc">.</span>upper()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb23-56"><a href="#cb23-56" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Iterations: </span><span class="sc">{</span>info<span class="sc">.</span>get(<span class="st">'iterations'</span>, <span class="dv">0</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb23-57"><a href="#cb23-57" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Time: </span><span class="sc">{</span>info<span class="sc">.</span>get(<span class="st">'time'</span>, <span class="dv">0</span>)<span class="sc">:.3f}</span><span class="ss">s"</span>)</span>
<span id="cb23-58"><a href="#cb23-58" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb23-59"><a href="#cb23-59" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> args.visualize:</span>
<span id="cb23-60"><a href="#cb23-60" aria-hidden="true" tabindex="-1"></a>            plot_flow_network(network, args.source, args.sink)</span>
<span id="cb23-61"><a href="#cb23-61" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-62"><a href="#cb23-62" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> args.command <span class="op">==</span> <span class="st">'mincost'</span>:</span>
<span id="cb23-63"><a href="#cb23-63" aria-hidden="true" tabindex="-1"></a>        network <span class="op">=</span> FlowNetwork.load(args.<span class="bu">input</span>)</span>
<span id="cb23-64"><a href="#cb23-64" aria-hidden="true" tabindex="-1"></a>        solver <span class="op">=</span> MinCostFlow(network)</span>
<span id="cb23-65"><a href="#cb23-65" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb23-66"><a href="#cb23-66" aria-hidden="true" tabindex="-1"></a>        flow_value, cost <span class="op">=</span> solver.solve(args.source, args.sink, args.flow)</span>
<span id="cb23-67"><a href="#cb23-67" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb23-68"><a href="#cb23-68" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Flow: </span><span class="sc">{</span>flow_value<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb23-69"><a href="#cb23-69" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Minimum Cost: </span><span class="sc">{</span>cost<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb23-70"><a href="#cb23-70" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb23-71"><a href="#cb23-71" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> args.visualize:</span>
<span id="cb23-72"><a href="#cb23-72" aria-hidden="true" tabindex="-1"></a>            plot_flow_network(network, args.source, args.sink)</span>
<span id="cb23-73"><a href="#cb23-73" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-74"><a href="#cb23-74" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> args.command <span class="op">==</span> <span class="st">'generate'</span>:</span>
<span id="cb23-75"><a href="#cb23-75" aria-hidden="true" tabindex="-1"></a>        network <span class="op">=</span> generate_random_network(</span>
<span id="cb23-76"><a href="#cb23-76" aria-hidden="true" tabindex="-1"></a>            args.vertices,</span>
<span id="cb23-77"><a href="#cb23-77" aria-hidden="true" tabindex="-1"></a>            args.edges,</span>
<span id="cb23-78"><a href="#cb23-78" aria-hidden="true" tabindex="-1"></a>            max_capacity<span class="op">=</span>args.max_capacity</span>
<span id="cb23-79"><a href="#cb23-79" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb23-80"><a href="#cb23-80" aria-hidden="true" tabindex="-1"></a>        network.save(args.output)</span>
<span id="cb23-81"><a href="#cb23-81" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Generated network saved to </span><span class="sc">{</span>args<span class="sc">.</span>output<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb23-82"><a href="#cb23-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-83"><a href="#cb23-83" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb23-84"><a href="#cb23-84" aria-hidden="true" tabindex="-1"></a>    main()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="testing-suite" class="level3" data-number="10.9.8">
<h3 data-number="10.9.8" class="anchored" data-anchor-id="testing-suite"><span class="header-section-number">10.9.8</span> 9.9.8 Testing Suite</h3>
<div class="sourceCode" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># tests/test_algorithms.py</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> unittest</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> core.network <span class="im">import</span> FlowNetwork</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> core.edmonds_karp <span class="im">import</span> EdmondsKarp</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> core.push_relabel <span class="im">import</span> PushRelabel</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> TestFlowAlgorithms(unittest.TestCase):</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Test suite for flow algorithms."""</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> setUp(<span class="va">self</span>):</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Create test networks."""</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Simple network</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.simple <span class="op">=</span> FlowNetwork(<span class="dv">4</span>)</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.simple.add_edge(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">10</span>)</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.simple.add_edge(<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">10</span>)</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.simple.add_edge(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">10</span>)</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.simple.add_edge(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">10</span>)</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Complex network</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.<span class="bu">complex</span> <span class="op">=</span> FlowNetwork(<span class="dv">6</span>)</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.<span class="bu">complex</span>.add_edge(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">16</span>)</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.<span class="bu">complex</span>.add_edge(<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">13</span>)</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.<span class="bu">complex</span>.add_edge(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">10</span>)</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.<span class="bu">complex</span>.add_edge(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">12</span>)</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.<span class="bu">complex</span>.add_edge(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">4</span>)</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.<span class="bu">complex</span>.add_edge(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">14</span>)</span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.<span class="bu">complex</span>.add_edge(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">9</span>)</span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.<span class="bu">complex</span>.add_edge(<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">20</span>)</span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.<span class="bu">complex</span>.add_edge(<span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">7</span>)</span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.<span class="bu">complex</span>.add_edge(<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">4</span>)</span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> test_simple_edmonds_karp(<span class="va">self</span>):</span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Test EK on simple network."""</span></span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>        solver <span class="op">=</span> EdmondsKarp(<span class="va">self</span>.simple)</span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>        flow, _ <span class="op">=</span> solver.solve(<span class="dv">0</span>, <span class="dv">3</span>)</span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.assertEqual(flow, <span class="dv">20</span>)</span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> test_simple_push_relabel(<span class="va">self</span>):</span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Test PR on simple network."""</span></span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a>        solver <span class="op">=</span> PushRelabel(<span class="va">self</span>.simple)</span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a>        flow, _ <span class="op">=</span> solver.solve(<span class="dv">0</span>, <span class="dv">3</span>)</span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.assertEqual(flow, <span class="dv">20</span>)</span>
<span id="cb24-43"><a href="#cb24-43" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-44"><a href="#cb24-44" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> test_complex_edmonds_karp(<span class="va">self</span>):</span>
<span id="cb24-45"><a href="#cb24-45" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Test EK on complex network."""</span></span>
<span id="cb24-46"><a href="#cb24-46" aria-hidden="true" tabindex="-1"></a>        solver <span class="op">=</span> EdmondsKarp(<span class="va">self</span>.<span class="bu">complex</span>)</span>
<span id="cb24-47"><a href="#cb24-47" aria-hidden="true" tabindex="-1"></a>        flow, _ <span class="op">=</span> solver.solve(<span class="dv">0</span>, <span class="dv">5</span>)</span>
<span id="cb24-48"><a href="#cb24-48" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.assertEqual(flow, <span class="dv">23</span>)</span>
<span id="cb24-49"><a href="#cb24-49" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-50"><a href="#cb24-50" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> test_complex_push_relabel(<span class="va">self</span>):</span>
<span id="cb24-51"><a href="#cb24-51" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Test PR on complex network."""</span></span>
<span id="cb24-52"><a href="#cb24-52" aria-hidden="true" tabindex="-1"></a>        solver <span class="op">=</span> PushRelabel(<span class="va">self</span>.<span class="bu">complex</span>)</span>
<span id="cb24-53"><a href="#cb24-53" aria-hidden="true" tabindex="-1"></a>        flow, _ <span class="op">=</span> solver.solve(<span class="dv">0</span>, <span class="dv">5</span>)</span>
<span id="cb24-54"><a href="#cb24-54" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.assertEqual(flow, <span class="dv">23</span>)</span>
<span id="cb24-55"><a href="#cb24-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-56"><a href="#cb24-56" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> test_algorithms_agree(<span class="va">self</span>):</span>
<span id="cb24-57"><a href="#cb24-57" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Verify all algorithms give same answer."""</span></span>
<span id="cb24-58"><a href="#cb24-58" aria-hidden="true" tabindex="-1"></a>        networks <span class="op">=</span> [<span class="va">self</span>.simple, <span class="va">self</span>.<span class="bu">complex</span>]</span>
<span id="cb24-59"><a href="#cb24-59" aria-hidden="true" tabindex="-1"></a>        sources <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">0</span>]</span>
<span id="cb24-60"><a href="#cb24-60" aria-hidden="true" tabindex="-1"></a>        sinks <span class="op">=</span> [<span class="dv">3</span>, <span class="dv">5</span>]</span>
<span id="cb24-61"><a href="#cb24-61" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-62"><a href="#cb24-62" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> net, s, t <span class="kw">in</span> <span class="bu">zip</span>(networks, sources, sinks):</span>
<span id="cb24-63"><a href="#cb24-63" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Reset network</span></span>
<span id="cb24-64"><a href="#cb24-64" aria-hidden="true" tabindex="-1"></a>            net.reset_flow()</span>
<span id="cb24-65"><a href="#cb24-65" aria-hidden="true" tabindex="-1"></a>            ek <span class="op">=</span> EdmondsKarp(net)</span>
<span id="cb24-66"><a href="#cb24-66" aria-hidden="true" tabindex="-1"></a>            flow_ek, _ <span class="op">=</span> ek.solve(s, t)</span>
<span id="cb24-67"><a href="#cb24-67" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb24-68"><a href="#cb24-68" aria-hidden="true" tabindex="-1"></a>            net.reset_flow()</span>
<span id="cb24-69"><a href="#cb24-69" aria-hidden="true" tabindex="-1"></a>            pr <span class="op">=</span> PushRelabel(net)</span>
<span id="cb24-70"><a href="#cb24-70" aria-hidden="true" tabindex="-1"></a>            flow_pr, _ <span class="op">=</span> pr.solve(s, t)</span>
<span id="cb24-71"><a href="#cb24-71" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb24-72"><a href="#cb24-72" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.assertAlmostEqual(flow_ek, flow_pr, places<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb24-73"><a href="#cb24-73" aria-hidden="true" tabindex="-1"></a>                                 msg<span class="op">=</span><span class="st">"Algorithms disagree on max flow"</span>)</span>
<span id="cb24-74"><a href="#cb24-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-75"><a href="#cb24-75" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb24-76"><a href="#cb24-76" aria-hidden="true" tabindex="-1"></a>    unittest.main()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="summary-and-key-takeaways" class="level2" data-number="10.10">
<h2 data-number="10.10" class="anchored" data-anchor-id="summary-and-key-takeaways"><span class="header-section-number">10.10</span> 9.10 Summary and Key Takeaways</h2>
<p>We’ve covered a LOT in this chapter! Let’s recap the big ideas:</p>
<p><strong>Core Concepts</strong>: 1. <strong>Network flow</strong> models “stuff” moving through a network from source to sink 2. The <strong>residual network</strong> tracks remaining capacity (and allows us to undo decisions) 3. <strong>Max-Flow Min-Cut Theorem</strong>: Maximum flow equals minimum cut capacity</p>
<p><strong>Algorithms</strong>: 1. <strong>Ford-Fulkerson</strong>: Find augmenting paths, push flow, repeat 2. <strong>Edmonds-Karp</strong>: Use BFS for paths → O(VE²) time 3. <strong>Push-Relabel</strong>: Local “push excess downhill” approach → O(V³) time 4. <strong>Min-Cost Flow</strong>: Find cheapest way to send flow</p>
<p><strong>Applications</strong>: - <strong>Matching</strong>: Job assignment, dating apps, organ donation - <strong>Image segmentation</strong>: Separate foreground/background - <strong>Network design</strong>: Reliability, capacity planning - <strong>Scheduling</strong>: Resource allocation, crew assignment</p>
<p><strong>Why This Matters</strong>:</p>
<p>Network flow is one of those rare algorithmic techniques that: 1. Solves a huge variety of real problems 2. Has elegant theory (Max-Flow Min-Cut!) 3. Has practical, efficient implementations 4. Connects to deep mathematics (linear programming, game theory)</p>
<p>When you see a problem involving: - Pairing things up - Moving resources through constraints - Finding bottlenecks - Cutting networks optimally</p>
<p>…think “Can I model this as flow?”</p>
<p>Often, the answer is yes, and suddenly you have 60 years of algorithmic research at your fingertips!</p>
</section>
<section id="exercises" class="level2" data-number="10.11">
<h2 data-number="10.11" class="anchored" data-anchor-id="exercises"><span class="header-section-number">10.11</span> 9.11 Exercises</h2>
<section id="warm-up-problems" class="level3" data-number="10.11.1">
<h3 data-number="10.11.1" class="anchored" data-anchor-id="warm-up-problems"><span class="header-section-number">10.11.1</span> Warm-Up Problems</h3>
<ol type="1">
<li><p><strong>Manual Trace</strong>: Find maximum flow by hand:</p>
<pre><code>s --[8]--&gt; a --[6]--&gt; t
|          |          ^
[10]      [4]        [5]
|          v          |
v          b --------+</code></pre></li>
<li><p><strong>Residual Network</strong>: Draw the residual network after pushing 5 units along s→a→t in the above network.</p></li>
<li><p><strong>Min Cut</strong>: Identify the minimum cut in the network from problem 1.</p></li>
</ol>
</section>
<section id="implementation-challenges" class="level3" data-number="10.11.2">
<h3 data-number="10.11.2" class="anchored" data-anchor-id="implementation-challenges"><span class="header-section-number">10.11.2</span> Implementation Challenges</h3>
<ol start="4" type="1">
<li><p><strong>Scaling Edmonds-Karp</strong>: Implement the capacity-scaling variant that only uses edges with residual capacity ≥ Δ, halving Δ each phase.</p></li>
<li><p><strong>Dinic’s Algorithm</strong>: Implement Dinic’s algorithm (uses level graphs instead of simple BFS). Compare performance with Edmonds-Karp.</p></li>
<li><p><strong>Weighted Matching</strong>: Extend the bipartite matching solver to handle weights (maximum weight matching).</p></li>
</ol>
</section>
<section id="application-problems" class="level3" data-number="10.11.3">
<h3 data-number="10.11.3" class="anchored" data-anchor-id="application-problems"><span class="header-section-number">10.11.3</span> Application Problems</h3>
<ol start="7" type="1">
<li><p><strong>Social Network Influence</strong>: Model influence spreading in a social network as a flow problem. Each person can be “convinced” by friends (with varying influence weights).</p></li>
<li><p><strong>Supply Chain</strong>: A company has 3 factories and 4 distribution centers. Model and solve the problem of moving products to meet demand while minimizing shipping costs.</p></li>
<li><p><strong>College Admissions</strong>: Build a matching system for students and colleges where:</p>
<ul>
<li>Students have preference lists</li>
<li>Colleges have capacity limits</li>
<li>Matches should be “stable” (no pair prefers each other to their match)</li>
</ul></li>
</ol>
</section>
<section id="theoretical-questions" class="level3" data-number="10.11.4">
<h3 data-number="10.11.4" class="anchored" data-anchor-id="theoretical-questions"><span class="header-section-number">10.11.4</span> Theoretical Questions</h3>
<ol start="10" type="1">
<li><p><strong>Prove Hall’s Theorem</strong>: Show that if Hall’s condition fails, no perfect matching exists.</p></li>
<li><p><strong>Integer Flows</strong>: Prove that if all capacities are integers, Edmonds-Karp produces integer flows.</p></li>
<li><p><strong>Complexity Lower Bound</strong>: Show that any max-flow algorithm must examine all edges at least once, giving an Ω(E) lower bound.</p></li>
</ol>
</section>
<section id="research-extensions" class="level3" data-number="10.11.5">
<h3 data-number="10.11.5" class="anchored" data-anchor-id="research-extensions"><span class="header-section-number">10.11.5</span> Research Extensions</h3>
<ol start="13" type="1">
<li><p><strong>Parallel Push-Relabel</strong>: Design and implement a parallel version of push-relabel. How much speedup can you achieve?</p></li>
<li><p><strong>Dynamic Flows</strong>: Extend algorithms to handle networks where capacities change over time.</p></li>
<li><p><strong>Multi-Commodity Flow</strong>: Solve the problem of routing multiple different “commodities” through a shared network (e.g., different data types through internet).</p></li>
</ol>
</section>
</section>
<section id="further-reading" class="level2" data-number="10.12">
<h2 data-number="10.12" class="anchored" data-anchor-id="further-reading"><span class="header-section-number">10.12</span> 9.12 Further Reading</h2>
<p><strong>Classic Papers</strong>: - Ford &amp; Fulkerson (1956): “Maximal Flow Through a Network” - Edmonds &amp; Karp (1972): “Theoretical Improvements in Algorithmic Efficiency” - Goldberg &amp; Tarjan (1988): “A New Approach to the Maximum-Flow Problem”</p>
<p><strong>Books</strong>: - Ahuja, Magnanti, &amp; Orlin: “Network Flows” (the bible) - Kleinberg &amp; Tardos: “Algorithm Design” (Chapter 7) - Cormen et al.: “Introduction to Algorithms” (Chapter 26)</p>
<p><strong>Modern Applications</strong>: - Image segmentation papers (Boykov &amp; Kolmogorov) - Market design and matching (Roth &amp; Sotomayor) - Network reliability (Karger’s algorithms)</p>
<p><strong>Online Resources</strong>: - Visualgo: Interactive flow algorithm animations - NIST Dictionary: Network flow definitions - TopCoder tutorials: Practical flow applications</p>
<hr>
<p>Congratulations! You’ve mastered one of the most versatile algorithmic frameworks in computer science. Network flow appears everywhere, from Google’s data centers to the app that matched you with your apartment. You now have the tools to recognize flow problems in the wild and solve them efficiently.</p>
<p>In the next chapter, we’ll explore another fundamental technique: dynamic programming on advanced structures. But flow will keep showing up—it’s that useful!</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../chapters/08-Approximation-Algorithms.html" class="pagination-link" aria-label="Chapter 8: Approximation Algorithms - When &quot;Good Enough&quot; is Perfect">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Chapter 8: Approximation Algorithms - When “Good Enough” is Perfect</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../chapters/10-String-Processing-Algorithms.html" class="pagination-link" aria-label="Chapter 10: String Algorithms - Finding Needles in Haystacks at Light Speed">
        <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Chapter 10: String Algorithms - Finding Needles in Haystacks at Light Speed</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>