<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>18&nbsp; Chapter 10: String Algorithms - Finding Needles in Haystacks at Light Speed – Advanced Computational Algorithms</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../chapters/11-Numerical-Algorithms.html" rel="next">
<link href="../chapters/09-Advanced-Graph-Algorithms.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-9b98f18118eee809be1c051eb5cc78e4.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/09-Advanced-Graph-Algorithms.html">Part IV: Advanced Topics</a></li><li class="breadcrumb-item"><a href="../chapters/10-String-Processing-Algorithms.html"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Chapter 10: String Algorithms - Finding Needles in Haystacks at Light Speed</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Advanced Computational Algorithms</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../title.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Advanced Computational Algorithms</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../edition.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Edition Notice</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../copyright.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Copyright</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../dedication.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Dedication</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../about-author.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">About the Author</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../about-gdsi.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">About Global Data Science Institute</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../how-to-use.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">How to Use This Book</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Preface</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Part I: Foundations</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/01-introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Advanced Algorithms: A Journey Through Computational Problem Solving</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/02-Divide-and-Conquer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Advanced Algorithms: A Journey Through Computational Problem Solving</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Part II: Core Techniques</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/03-Data-Structures-for-Efficiency.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Chapter 3: Data Structures for Efficiency</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/04-Greedy-Algorithms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Chapter 4: Greedy Algorithms - When Local Optimality Leads to Global Solutions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/05-Dynamic-Programming.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Advanced Algorithms: A Journey Through Computational Problem Solving</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/06-Randomized-Algorithms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Chapter 6: Randomized Algorithms - The Power of Controlled Chaos</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Part III: Complexity and Hard Problems</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/07-Computational-Complexity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Chapter 7: Computational Complexity &amp; NP-Completeness - The Limits of Computing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/08-Approximation-Algorithms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Chapter 8: Approximation Algorithms - When “Good Enough” is Perfect</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Part IV: Advanced Topics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/09-Advanced-Graph-Algorithms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Chapter 9: Advanced Graph Algorithms - Making Things Flow</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/10-String-Processing-Algorithms.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Chapter 10: String Algorithms - Finding Needles in Haystacks at Light Speed</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/11-Numerical-Algorithms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Chapter 11: Matrix &amp; Numerical Algorithms - When Math Meets Speed</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/12-Advanced-Data-Structures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Chapter 12: Advanced Data Structures - When Arrays and Trees Aren’t Enough</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Part V: Applications and Professional Practice</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/13-Research-Industry-Applications.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Chapter 13: Research and Industry Applications - Where Algorithms Meet Reality</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/14-Project-Development.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Chapter 14: Project Development &amp; Presentation Prep - Bringing It All Together</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/15-Final-Presentations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Chapter 15: Final Presentations &amp; Submission - Showcasing Your Mastery</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction-the-search-for-patterns" id="toc-introduction-the-search-for-patterns" class="nav-link active" data-scroll-target="#introduction-the-search-for-patterns"><span class="header-section-number">18.1</span> 10.1 Introduction: The Search for Patterns</a></li>
  <li><a href="#the-pattern-matching-problem" id="toc-the-pattern-matching-problem" class="nav-link" data-scroll-target="#the-pattern-matching-problem"><span class="header-section-number">18.2</span> 10.2 The Pattern Matching Problem</a>
  <ul class="collapse">
  <li><a href="#the-setup" id="toc-the-setup" class="nav-link" data-scroll-target="#the-setup"><span class="header-section-number">18.2.1</span> 10.2.1 The Setup</a></li>
  <li><a href="#the-naive-approach" id="toc-the-naive-approach" class="nav-link" data-scroll-target="#the-naive-approach"><span class="header-section-number">18.2.2</span> 10.2.2 The Naive Approach</a></li>
  <li><a href="#the-key-insight" id="toc-the-key-insight" class="nav-link" data-scroll-target="#the-key-insight"><span class="header-section-number">18.2.3</span> 10.2.3 The Key Insight</a></li>
  </ul></li>
  <li><a href="#the-kmp-algorithm-never-look-back" id="toc-the-kmp-algorithm-never-look-back" class="nav-link" data-scroll-target="#the-kmp-algorithm-never-look-back"><span class="header-section-number">18.3</span> 10.3 The KMP Algorithm: Never Look Back</a>
  <ul class="collapse">
  <li><a href="#the-big-idea" id="toc-the-big-idea" class="nav-link" data-scroll-target="#the-big-idea"><span class="header-section-number">18.3.1</span> 10.3.1 The Big Idea</a></li>
  <li><a href="#the-failure-function-longest-proper-prefix-suffix" id="toc-the-failure-function-longest-proper-prefix-suffix" class="nav-link" data-scroll-target="#the-failure-function-longest-proper-prefix-suffix"><span class="header-section-number">18.3.2</span> 10.3.2 The Failure Function (Longest Proper Prefix-Suffix)</a></li>
  <li><a href="#computing-the-failure-function" id="toc-computing-the-failure-function" class="nav-link" data-scroll-target="#computing-the-failure-function"><span class="header-section-number">18.3.3</span> 10.3.3 Computing the Failure Function</a></li>
  <li><a href="#the-kmp-search-algorithm" id="toc-the-kmp-search-algorithm" class="nav-link" data-scroll-target="#the-kmp-search-algorithm"><span class="header-section-number">18.3.4</span> 10.3.4 The KMP Search Algorithm</a></li>
  <li><a href="#complete-kmp-example-trace" id="toc-complete-kmp-example-trace" class="nav-link" data-scroll-target="#complete-kmp-example-trace"><span class="header-section-number">18.3.5</span> 10.3.5 Complete KMP Example Trace</a></li>
  <li><a href="#full-implementation-with-examples" id="toc-full-implementation-with-examples" class="nav-link" data-scroll-target="#full-implementation-with-examples"><span class="header-section-number">18.3.6</span> 10.3.6 Full Implementation with Examples</a></li>
  </ul></li>
  <li><a href="#rabin-karp-hashing-to-the-rescue" id="toc-rabin-karp-hashing-to-the-rescue" class="nav-link" data-scroll-target="#rabin-karp-hashing-to-the-rescue"><span class="header-section-number">18.4</span> 10.4 Rabin-Karp: Hashing to the Rescue</a>
  <ul class="collapse">
  <li><a href="#the-hashing-idea" id="toc-the-hashing-idea" class="nav-link" data-scroll-target="#the-hashing-idea"><span class="header-section-number">18.4.1</span> 10.4.1 The Hashing Idea</a></li>
  <li><a href="#rolling-hash-function" id="toc-rolling-hash-function" class="nav-link" data-scroll-target="#rolling-hash-function"><span class="header-section-number">18.4.2</span> 10.4.2 Rolling Hash Function</a></li>
  <li><a href="#dealing-with-large-numbers" id="toc-dealing-with-large-numbers" class="nav-link" data-scroll-target="#dealing-with-large-numbers"><span class="header-section-number">18.4.3</span> 10.4.3 Dealing with Large Numbers</a></li>
  <li><a href="#implementation" id="toc-implementation" class="nav-link" data-scroll-target="#implementation"><span class="header-section-number">18.4.4</span> 10.4.4 Implementation</a></li>
  <li><a href="#when-to-use-rabin-karp" id="toc-when-to-use-rabin-karp" class="nav-link" data-scroll-target="#when-to-use-rabin-karp"><span class="header-section-number">18.4.5</span> 10.4.5 When to Use Rabin-Karp</a></li>
  </ul></li>
  <li><a href="#suffix-arrays-the-swiss-army-knife" id="toc-suffix-arrays-the-swiss-army-knife" class="nav-link" data-scroll-target="#suffix-arrays-the-swiss-army-knife"><span class="header-section-number">18.5</span> 10.5 Suffix Arrays: The Swiss Army Knife</a>
  <ul class="collapse">
  <li><a href="#whats-a-suffix" id="toc-whats-a-suffix" class="nav-link" data-scroll-target="#whats-a-suffix"><span class="header-section-number">18.5.1</span> 10.5.1 What’s a Suffix?</a></li>
  <li><a href="#the-suffix-array" id="toc-the-suffix-array" class="nav-link" data-scroll-target="#the-suffix-array"><span class="header-section-number">18.5.2</span> 10.5.2 The Suffix Array</a></li>
  <li><a href="#building-a-suffix-array-naive" id="toc-building-a-suffix-array-naive" class="nav-link" data-scroll-target="#building-a-suffix-array-naive"><span class="header-section-number">18.5.3</span> 10.5.3 Building a Suffix Array (Naive)</a></li>
  <li><a href="#building-a-suffix-array-efficiently" id="toc-building-a-suffix-array-efficiently" class="nav-link" data-scroll-target="#building-a-suffix-array-efficiently"><span class="header-section-number">18.5.4</span> 10.5.4 Building a Suffix Array Efficiently</a></li>
  <li><a href="#applications-of-suffix-arrays" id="toc-applications-of-suffix-arrays" class="nav-link" data-scroll-target="#applications-of-suffix-arrays"><span class="header-section-number">18.5.5</span> 10.5.5 Applications of Suffix Arrays</a></li>
  </ul></li>
  <li><a href="#suffix-trees-suffix-arrays-on-steroids" id="toc-suffix-trees-suffix-arrays-on-steroids" class="nav-link" data-scroll-target="#suffix-trees-suffix-arrays-on-steroids"><span class="header-section-number">18.6</span> 10.6 Suffix Trees: Suffix Arrays on Steroids</a>
  <ul class="collapse">
  <li><a href="#whats-a-suffix-tree" id="toc-whats-a-suffix-tree" class="nav-link" data-scroll-target="#whats-a-suffix-tree"><span class="header-section-number">18.6.1</span> 10.6.1 What’s a Suffix Tree?</a></li>
  <li><a href="#when-to-use-suffix-trees-vs-arrays" id="toc-when-to-use-suffix-trees-vs-arrays" class="nav-link" data-scroll-target="#when-to-use-suffix-trees-vs-arrays"><span class="header-section-number">18.6.2</span> 10.6.2 When to Use Suffix Trees vs Arrays</a></li>
  </ul></li>
  <li><a href="#applications-to-genomics" id="toc-applications-to-genomics" class="nav-link" data-scroll-target="#applications-to-genomics"><span class="header-section-number">18.7</span> 10.7 Applications to Genomics</a>
  <ul class="collapse">
  <li><a href="#dna-sequence-matching" id="toc-dna-sequence-matching" class="nav-link" data-scroll-target="#dna-sequence-matching"><span class="header-section-number">18.7.1</span> 10.7.1 DNA Sequence Matching</a></li>
  <li><a href="#read-alignment" id="toc-read-alignment" class="nav-link" data-scroll-target="#read-alignment"><span class="header-section-number">18.7.2</span> 10.7.2 Read Alignment</a></li>
  <li><a href="#detecting-tandem-repeats" id="toc-detecting-tandem-repeats" class="nav-link" data-scroll-target="#detecting-tandem-repeats"><span class="header-section-number">18.7.3</span> 10.7.3 Detecting Tandem Repeats</a></li>
  </ul></li>
  <li><a href="#chapter-project-professional-string-processing-library" id="toc-chapter-project-professional-string-processing-library" class="nav-link" data-scroll-target="#chapter-project-professional-string-processing-library"><span class="header-section-number">18.8</span> 10.8 Chapter Project: Professional String Processing Library</a>
  <ul class="collapse">
  <li><a href="#project-structure" id="toc-project-structure" class="nav-link" data-scroll-target="#project-structure"><span class="header-section-number">18.8.1</span> 10.8.1 Project Structure</a></li>
  <li><a href="#core-library-implementation" id="toc-core-library-implementation" class="nav-link" data-scroll-target="#core-library-implementation"><span class="header-section-number">18.8.2</span> 10.8.2 Core Library Implementation</a></li>
  <li><a href="#text-compression-application" id="toc-text-compression-application" class="nav-link" data-scroll-target="#text-compression-application"><span class="header-section-number">18.8.3</span> 10.8.3 Text Compression Application</a></li>
  <li><a href="#command-line-tool" id="toc-command-line-tool" class="nav-link" data-scroll-target="#command-line-tool"><span class="header-section-number">18.8.4</span> 10.8.4 Command-Line Tool</a></li>
  </ul></li>
  <li><a href="#summary-and-key-takeaways" id="toc-summary-and-key-takeaways" class="nav-link" data-scroll-target="#summary-and-key-takeaways"><span class="header-section-number">18.9</span> 10.9 Summary and Key Takeaways</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">18.10</span> 10.10 Exercises</a>
  <ul class="collapse">
  <li><a href="#basic-understanding" id="toc-basic-understanding" class="nav-link" data-scroll-target="#basic-understanding"><span class="header-section-number">18.10.1</span> Basic Understanding</a></li>
  <li><a href="#implementation-challenges" id="toc-implementation-challenges" class="nav-link" data-scroll-target="#implementation-challenges"><span class="header-section-number">18.10.2</span> Implementation Challenges</a></li>
  <li><a href="#application-problems" id="toc-application-problems" class="nav-link" data-scroll-target="#application-problems"><span class="header-section-number">18.10.3</span> Application Problems</a></li>
  <li><a href="#advanced-topics" id="toc-advanced-topics" class="nav-link" data-scroll-target="#advanced-topics"><span class="header-section-number">18.10.4</span> Advanced Topics</a></li>
  <li><a href="#research-extensions" id="toc-research-extensions" class="nav-link" data-scroll-target="#research-extensions"><span class="header-section-number">18.10.5</span> Research Extensions</a></li>
  </ul></li>
  <li><a href="#further-reading" id="toc-further-reading" class="nav-link" data-scroll-target="#further-reading"><span class="header-section-number">18.11</span> 10.11 Further Reading</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/09-Advanced-Graph-Algorithms.html">Part IV: Advanced Topics</a></li><li class="breadcrumb-item"><a href="../chapters/10-String-Processing-Algorithms.html"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Chapter 10: String Algorithms - Finding Needles in Haystacks at Light Speed</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Chapter 10: String Algorithms - Finding Needles in Haystacks at Light Speed</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><strong>When Ctrl+F Meets Computer Science</strong></p>
<p><em>“There are only two hard problems in computer science: cache invalidation, naming things, and off-by-one errors.”</em> - Traditional programmer joke</p>
<p><em>“And finding all occurrences of ‘ACGT’ in 3 billion base pairs of DNA in under a second.”</em> - Modern bioinformatics</p>
<section id="introduction-the-search-for-patterns" class="level2" data-number="18.1">
<h2 data-number="18.1" class="anchored" data-anchor-id="introduction-the-search-for-patterns"><span class="header-section-number">18.1</span> 10.1 Introduction: The Search for Patterns</h2>
<p>Here’s something you probably do dozens of times a day without thinking: press Ctrl+F and search for text. Finding “pizza” in a restaurant menu. Searching your email for “flight confirmation.” Looking for your name in a document.</p>
<p>Seems simple, right? Just look at each position and check if the pattern matches!</p>
<p>But here’s the thing: if you’re Google, you’re searching through <em>trillions</em> of web pages. If you’re doing DNA analysis, you’re searching through 3 <em>billion</em> letters of genetic code. If you’re building an antivirus, you’re checking files against millions of malware signatures. The naive approach—checking every single position—becomes painfully slow.</p>
<p><strong>The beautiful surprise</strong>: There are algorithms that can search text <em>without looking at every character</em>. They can skip ahead, eliminating huge chunks of text in single jumps. They can search for thousands of patterns simultaneously. They can even tell you about <em>all possible substrings</em> in a text by building a single magical data structure.</p>
<p>String algorithms are behind: - <strong>Text editors</strong>: Every Ctrl+F you’ve ever done - <strong>DNA sequencing</strong>: Finding genes, detecting mutations - <strong>Plagiarism detection</strong>: Comparing documents - <strong>Data compression</strong>: Finding repeated patterns (ZIP, gzip) - <strong>Network security</strong>: Deep packet inspection, malware detection - <strong>Biometric matching</strong>: Fingerprints, DNA forensics</p>
<p>In this chapter, we’ll go from the naive O(nm) approach to algorithms that run in O(n+m) time—a massive improvement. We’ll build suffix trees that answer complex queries in milliseconds. And we’ll see how these algorithms are literally helping cure diseases and catch criminals.</p>
<p>Ready to become a string algorithm wizard? Let’s dive in!</p>
</section>
<section id="the-pattern-matching-problem" class="level2" data-number="18.2">
<h2 data-number="18.2" class="anchored" data-anchor-id="the-pattern-matching-problem"><span class="header-section-number">18.2</span> 10.2 The Pattern Matching Problem</h2>
<section id="the-setup" class="level3" data-number="18.2.1">
<h3 data-number="18.2.1" class="anchored" data-anchor-id="the-setup"><span class="header-section-number">18.2.1</span> 10.2.1 The Setup</h3>
<p>You have: - A <strong>text</strong> T of length n (the haystack) - A <strong>pattern</strong> P of length m (the needle)</p>
<p><strong>Goal</strong>: Find all positions in T where P occurs.</p>
<p><strong>Example</strong>:</p>
<pre><code>Text:    "ABABCABABA"
Pattern: "ABA"

Answer: Positions 0, 5, 7
         ABA           (position 0)
              ABA      (position 5)
                ABA    (position 7)</code></pre>
</section>
<section id="the-naive-approach" class="level3" data-number="18.2.2">
<h3 data-number="18.2.2" class="anchored" data-anchor-id="the-naive-approach"><span class="header-section-number">18.2.2</span> 10.2.2 The Naive Approach</h3>
<p>The obvious solution: try every position!</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> naive_search(text, pattern):</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""The obvious way to search. Works, but slow!"""</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="bu">len</span>(text)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    m <span class="op">=</span> <span class="bu">len</span>(pattern)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    positions <span class="op">=</span> []</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Try starting at each position</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n <span class="op">-</span> m <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Check if pattern matches at position i</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>        match <span class="op">=</span> <span class="va">True</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(m):</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> text[i <span class="op">+</span> j] <span class="op">!=</span> pattern[j]:</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>                match <span class="op">=</span> <span class="va">False</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> match:</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>            positions.append(i)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> positions</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Time complexity</strong>: O(nm) - We check n positions - Each check takes O(m) comparisons in the worst case</p>
<p><strong>When is this bad?</strong></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Worst case: almost matches everywhere</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>text <span class="op">=</span> <span class="st">"AAAAAAAAAA"</span>  <span class="co"># n = 10,000</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>pattern <span class="op">=</span> <span class="st">"AAAAB"</span>     <span class="co"># m = 5</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># We'll compare 4 characters at EVERY position!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Total comparisons: nearly 10,000 × 5 = 50,000</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>For short patterns and texts, naive search is fine. But we can do <em>much</em> better!</p>
</section>
<section id="the-key-insight" class="level3" data-number="18.2.3">
<h3 data-number="18.2.3" class="anchored" data-anchor-id="the-key-insight"><span class="header-section-number">18.2.3</span> 10.2.3 The Key Insight</h3>
<p>When a mismatch occurs, <strong>we’ve learned something about the text</strong>. Can we use this information to skip ahead smartly instead of just moving one position forward?</p>
<p>That’s the key idea behind both KMP and Boyer-Moore algorithms!</p>
</section>
</section>
<section id="the-kmp-algorithm-never-look-back" class="level2" data-number="18.3">
<h2 data-number="18.3" class="anchored" data-anchor-id="the-kmp-algorithm-never-look-back"><span class="header-section-number">18.3</span> 10.3 The KMP Algorithm: Never Look Back</h2>
<section id="the-big-idea" class="level3" data-number="18.3.1">
<h3 data-number="18.3.1" class="anchored" data-anchor-id="the-big-idea"><span class="header-section-number">18.3.1</span> 10.3.1 The Big Idea</h3>
<p>The <strong>Knuth-Morris-Pratt (KMP)</strong> algorithm is based on a brilliant observation:</p>
<p><strong>When a mismatch occurs, we already know some characters in the text (the ones that matched). We can use this information to skip ahead without re-examining those characters!</strong></p>
<p>Let’s see this in action:</p>
<pre><code>Text:    "ABABCABABA"
Pattern: "ABABD"

Position 0:
  ABABC...
  ABABD
      ^--- Mismatch at position 4

Naive approach: Move pattern one position right, start checking from the beginning again.

KMP insight: We just matched "ABAB". We know "AB" appears at both the start 
and end of what we matched. So we can skip ahead!

  ABABC...
    ABABD
    ^--- Resume checking here! We already know "AB" matches.</code></pre>
<p>The KMP algorithm never moves backward in the text. It only moves forward, using information about the pattern itself to make smart jumps.</p>
</section>
<section id="the-failure-function-longest-proper-prefix-suffix" class="level3" data-number="18.3.2">
<h3 data-number="18.3.2" class="anchored" data-anchor-id="the-failure-function-longest-proper-prefix-suffix"><span class="header-section-number">18.3.2</span> 10.3.2 The Failure Function (Longest Proper Prefix-Suffix)</h3>
<p>The magic of KMP is in preprocessing the pattern to build a <strong>failure function</strong> (also called the LPS array: Longest Proper Prefix which is also Suffix).</p>
<p>For each position j in the pattern, the failure function tells us: <em>“If we mismatch at position j+1, where should we continue matching?”</em></p>
<p><strong>Definition</strong>: failure[j] = length of the longest proper prefix of pattern[0..j] that is also a suffix.</p>
<p>Let’s compute this for pattern “ABABD”:</p>
<pre><code>Position:  0 1 2 3 4
Pattern:   A B A B D
Failure:   0 0 1 2 0

Position 0 ('A'): No proper prefix/suffix. failure[0] = 0
Position 1 ('AB'): No match. failure[1] = 0
Position 2 ('ABA'): 'A' is both prefix and suffix. failure[2] = 1
Position 3 ('ABAB'): 'AB' is both prefix and suffix. failure[3] = 2
Position 4 ('ABABD'): No match. failure[4] = 0</code></pre>
<p><strong>Another example</strong>: Pattern “AABAAB”</p>
<pre><code>Position:  0 1 2 3 4 5
Pattern:   A A B A A B
Failure:   0 1 0 1 2 3

Position 0: failure[0] = 0
Position 1 ('AA'): 'A' matches. failure[1] = 1
Position 2 ('AAB'): No match. failure[2] = 0
Position 3 ('AABA'): 'A' matches. failure[3] = 1
Position 4 ('AABAA'): 'AA' matches. failure[4] = 2
Position 5 ('AABAAB'): 'AAB' matches. failure[5] = 3</code></pre>
</section>
<section id="computing-the-failure-function" class="level3" data-number="18.3.3">
<h3 data-number="18.3.3" class="anchored" data-anchor-id="computing-the-failure-function"><span class="header-section-number">18.3.3</span> 10.3.3 Computing the Failure Function</h3>
<p>Here’s where KMP gets really clever: we use KMP to build the failure function!</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_failure_function(pattern):</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Compute the failure function (LPS array) for KMP.</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co">    failure[i] = length of longest proper prefix of pattern[0..i]</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co">                 that is also a suffix of pattern[0..i]</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    m <span class="op">=</span> <span class="bu">len</span>(pattern)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    failure <span class="op">=</span> [<span class="dv">0</span>] <span class="op">*</span> m</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Length of previous longest prefix suffix</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    length <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> i <span class="op">&lt;</span> m:</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> pattern[i] <span class="op">==</span> pattern[length]:</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Characters match! Extend the current prefix-suffix</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>            length <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>            failure[i] <span class="op">=</span> length</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>            i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Mismatch!</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> length <span class="op">!=</span> <span class="dv">0</span>:</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Try a shorter prefix-suffix</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>                <span class="co"># This is the KMP trick applied to building the table!</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>                length <span class="op">=</span> failure[length <span class="op">-</span> <span class="dv">1</span>]</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>                <span class="co"># No prefix-suffix exists</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>                failure[i] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>                i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> failure</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Let’s trace this for pattern “AABAAB”</strong>:</p>
<pre><code>Initial: failure = [0, 0, 0, 0, 0, 0], length = 0, i = 1

i=1: pattern[1]='A' == pattern[0]='A'
     length = 1, failure[1] = 1
     → failure = [0, 1, 0, 0, 0, 0]

i=2: pattern[2]='B' != pattern[1]='A'
     length becomes 0
     failure[2] = 0
     → failure = [0, 1, 0, 0, 0, 0]

i=3: pattern[3]='A' == pattern[0]='A'
     length = 1, failure[3] = 1
     → failure = [0, 1, 0, 1, 0, 0]

i=4: pattern[4]='A' == pattern[1]='A'
     length = 2, failure[4] = 2
     → failure = [0, 1, 0, 1, 2, 0]

i=5: pattern[5]='B' == pattern[2]='B'
     length = 3, failure[5] = 3
     → failure = [0, 1, 0, 1, 2, 3]</code></pre>
<p><strong>Time complexity</strong>: O(m) - we process each character at most twice!</p>
</section>
<section id="the-kmp-search-algorithm" class="level3" data-number="18.3.4">
<h3 data-number="18.3.4" class="anchored" data-anchor-id="the-kmp-search-algorithm"><span class="header-section-number">18.3.4</span> 10.3.4 The KMP Search Algorithm</h3>
<p>Now that we have the failure function, searching is straightforward:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> kmp_search(text, pattern):</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Find all occurrences of pattern in text using KMP algorithm.</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Time: O(n + m) where n = len(text), m = len(pattern)</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Space: O(m) for the failure function</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="bu">len</span>(text)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    m <span class="op">=</span> <span class="bu">len</span>(pattern)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> m <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> []</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Preprocess: compute failure function</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    failure <span class="op">=</span> compute_failure_function(pattern)</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    positions <span class="op">=</span> []</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> <span class="dv">0</span>  <span class="co"># Index in text</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    j <span class="op">=</span> <span class="dv">0</span>  <span class="co"># Index in pattern</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> i <span class="op">&lt;</span> n:</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> pattern[j] <span class="op">==</span> text[i]:</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Characters match!</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>            i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>            j <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> j <span class="op">==</span> m:</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Found complete match!</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>            positions.append(i <span class="op">-</span> j)</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>            j <span class="op">=</span> failure[j <span class="op">-</span> <span class="dv">1</span>]  <span class="co"># Look for next match</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> i <span class="op">&lt;</span> n <span class="kw">and</span> pattern[j] <span class="op">!=</span> text[i]:</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Mismatch after j matches</span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> j <span class="op">!=</span> <span class="dv">0</span>:</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Use failure function to skip</span></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>                j <span class="op">=</span> failure[j <span class="op">-</span> <span class="dv">1</span>]</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>                <span class="co"># No matches at all, move forward in text</span></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>                i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> positions</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="complete-kmp-example-trace" class="level3" data-number="18.3.5">
<h3 data-number="18.3.5" class="anchored" data-anchor-id="complete-kmp-example-trace"><span class="header-section-number">18.3.5</span> 10.3.5 Complete KMP Example Trace</h3>
<p>Let’s trace through a complete example:</p>
<pre><code>Text:    "ABABDABACDABABCABABA"
Pattern: "ABABCABABA"

Step 1: Compute failure function for "ABABCABABA"
Position:  0 1 2 3 4 5 6 7 8 9
Pattern:   A B A B C A B A B A
Failure:   0 0 1 2 0 1 2 3 4 3

Step 2: Search

Text:    A B A B D A B A C D A B A B C A B A B A
Pattern: A B A B C A B A B A
         0 1 2 3 4
         i i i i i
         ^^^^^^^--- Match: A B A B
                 ^--- Mismatch: D != C

j = 4, failure[3] = 2, so j becomes 2
(We know "AB" at start matches "AB" before the mismatch)

Text:    A B A B D A B A C D A B A B C A B A B A
Pattern:     A B A B C A B A B A
               2 3 4 5 6 7 8 9
               ^^^--- Already know these match!
                   ^--- Mismatch: D != C

j = 4, failure[3] = 2, so j becomes 2

Text:    A B A B D A B A C D A B A B C A B A B A
Pattern:         A B A B C A B A B A
                 2 3 4 5 6 7
                     ^--- Mismatch: C != C... wait, continue
                         ^--- Mismatch: D != A

j = 2, failure[1] = 0, so j becomes 0

Text:    A B A B D A B A C D A B A B C A B A B A
Pattern:                   A B A B C A B A B A
                           0 1 2 3 4 5 6 7 8 9
                           ^^^^^^^^^^^^^^^^^^^--- FULL MATCH!

Found at position 10!</code></pre>
<p><strong>Why KMP is Fast</strong>: - Each character in the text is examined at most once - The pattern pointer j only moves forward or jumps back via the failure function - Total time: O(n + m)</p>
</section>
<section id="full-implementation-with-examples" class="level3" data-number="18.3.6">
<h3 data-number="18.3.6" class="anchored" data-anchor-id="full-implementation-with-examples"><span class="header-section-number">18.3.6</span> 10.3.6 Full Implementation with Examples</h3>
<div class="sourceCode" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> KMPMatcher:</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Knuth-Morris-Pratt string matching algorithm.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Provides O(n+m) time pattern matching.</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, pattern):</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Initialize with a pattern to search for."""</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.pattern <span class="op">=</span> pattern</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.m <span class="op">=</span> <span class="bu">len</span>(pattern)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.failure <span class="op">=</span> <span class="va">self</span>._compute_failure_function()</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _compute_failure_function(<span class="va">self</span>):</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Compute failure function (LPS array)."""</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>        m <span class="op">=</span> <span class="va">self</span>.m</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>        failure <span class="op">=</span> [<span class="dv">0</span>] <span class="op">*</span> m</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>        length <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>        i <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> i <span class="op">&lt;</span> m:</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.pattern[i] <span class="op">==</span> <span class="va">self</span>.pattern[length]:</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>                length <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>                failure[i] <span class="op">=</span> length</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>                i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> length <span class="op">!=</span> <span class="dv">0</span>:</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>                    length <span class="op">=</span> failure[length <span class="op">-</span> <span class="dv">1</span>]</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>                    failure[i] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>                    i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> failure</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> search(<span class="va">self</span>, text):</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a><span class="co">        Find all occurrences of pattern in text.</span></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns list of starting positions.</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>        n <span class="op">=</span> <span class="bu">len</span>(text)</span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>        positions <span class="op">=</span> []</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>        i <span class="op">=</span> <span class="dv">0</span>  <span class="co"># text index</span></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>        j <span class="op">=</span> <span class="dv">0</span>  <span class="co"># pattern index</span></span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> i <span class="op">&lt;</span> n:</span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.pattern[j] <span class="op">==</span> text[i]:</span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>                i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>                j <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> j <span class="op">==</span> <span class="va">self</span>.m:</span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Found match</span></span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a>                positions.append(i <span class="op">-</span> j)</span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>                j <span class="op">=</span> <span class="va">self</span>.failure[j <span class="op">-</span> <span class="dv">1</span>]</span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> i <span class="op">&lt;</span> n <span class="kw">and</span> <span class="va">self</span>.pattern[j] <span class="op">!=</span> text[i]:</span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> j <span class="op">!=</span> <span class="dv">0</span>:</span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>                    j <span class="op">=</span> <span class="va">self</span>.failure[j <span class="op">-</span> <span class="dv">1</span>]</span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a>                    i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> positions</span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> search_first(<span class="va">self</span>, text):</span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Find first occurrence only (faster if you only need one)."""</span></span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a>        n <span class="op">=</span> <span class="bu">len</span>(text)</span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a>        i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a>        j <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> i <span class="op">&lt;</span> n:</span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.pattern[j] <span class="op">==</span> text[i]:</span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a>                i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb11-71"><a href="#cb11-71" aria-hidden="true" tabindex="-1"></a>                j <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb11-72"><a href="#cb11-72" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb11-73"><a href="#cb11-73" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> j <span class="op">==</span> <span class="va">self</span>.m:</span>
<span id="cb11-74"><a href="#cb11-74" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> i <span class="op">-</span> j</span>
<span id="cb11-75"><a href="#cb11-75" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> i <span class="op">&lt;</span> n <span class="kw">and</span> <span class="va">self</span>.pattern[j] <span class="op">!=</span> text[i]:</span>
<span id="cb11-76"><a href="#cb11-76" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> j <span class="op">!=</span> <span class="dv">0</span>:</span>
<span id="cb11-77"><a href="#cb11-77" aria-hidden="true" tabindex="-1"></a>                    j <span class="op">=</span> <span class="va">self</span>.failure[j <span class="op">-</span> <span class="dv">1</span>]</span>
<span id="cb11-78"><a href="#cb11-78" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb11-79"><a href="#cb11-79" aria-hidden="true" tabindex="-1"></a>                    i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb11-80"><a href="#cb11-80" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb11-81"><a href="#cb11-81" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="op">-</span><span class="dv">1</span>  <span class="co"># Not found</span></span>
<span id="cb11-82"><a href="#cb11-82" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-83"><a href="#cb11-83" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> count(<span class="va">self</span>, text):</span>
<span id="cb11-84"><a href="#cb11-84" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Count occurrences (faster than len(search()))."""</span></span>
<span id="cb11-85"><a href="#cb11-85" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">len</span>(<span class="va">self</span>.search(text))</span>
<span id="cb11-86"><a href="#cb11-86" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-87"><a href="#cb11-87" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_failure_function(<span class="va">self</span>):</span>
<span id="cb11-88"><a href="#cb11-88" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Return the failure function for educational purposes."""</span></span>
<span id="cb11-89"><a href="#cb11-89" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.failure.copy()</span>
<span id="cb11-90"><a href="#cb11-90" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-91"><a href="#cb11-91" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> visualize_failure_function(<span class="va">self</span>):</span>
<span id="cb11-92"><a href="#cb11-92" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Print a nice visualization of the failure function."""</span></span>
<span id="cb11-93"><a href="#cb11-93" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Pattern: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>pattern<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb11-94"><a href="#cb11-94" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Index:   </span><span class="sc">{</span><span class="st">' '</span><span class="sc">.</span>join(<span class="bu">str</span>(i) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.m))<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb11-95"><a href="#cb11-95" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Failure: </span><span class="sc">{</span><span class="st">' '</span><span class="sc">.</span>join(<span class="bu">str</span>(f) <span class="cf">for</span> f <span class="kw">in</span> <span class="va">self</span>.failure)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb11-96"><a href="#cb11-96" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>()</span>
<span id="cb11-97"><a href="#cb11-97" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, f <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="va">self</span>.failure):</span>
<span id="cb11-98"><a href="#cb11-98" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> f <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb11-99"><a href="#cb11-99" aria-hidden="true" tabindex="-1"></a>                prefix <span class="op">=</span> <span class="va">self</span>.pattern[:f]</span>
<span id="cb11-100"><a href="#cb11-100" aria-hidden="true" tabindex="-1"></a>                suffix <span class="op">=</span> <span class="va">self</span>.pattern[i<span class="op">-</span>f<span class="op">+</span><span class="dv">1</span>:i<span class="op">+</span><span class="dv">1</span>]</span>
<span id="cb11-101"><a href="#cb11-101" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f"  Position </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">: '</span><span class="sc">{</span>prefix<span class="sc">}</span><span class="ss">' == '</span><span class="sc">{</span>suffix<span class="sc">}</span><span class="ss">' (length </span><span class="sc">{</span>f<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb11-102"><a href="#cb11-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-103"><a href="#cb11-103" aria-hidden="true" tabindex="-1"></a><span class="co"># Examples</span></span>
<span id="cb11-104"><a href="#cb11-104" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> example_basic_search():</span>
<span id="cb11-105"><a href="#cb11-105" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Basic pattern matching example."""</span></span>
<span id="cb11-106"><a href="#cb11-106" aria-hidden="true" tabindex="-1"></a>    text <span class="op">=</span> <span class="st">"ABABDABACDABABCABABA"</span></span>
<span id="cb11-107"><a href="#cb11-107" aria-hidden="true" tabindex="-1"></a>    pattern <span class="op">=</span> <span class="st">"ABAB"</span></span>
<span id="cb11-108"><a href="#cb11-108" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-109"><a href="#cb11-109" aria-hidden="true" tabindex="-1"></a>    matcher <span class="op">=</span> KMPMatcher(pattern)</span>
<span id="cb11-110"><a href="#cb11-110" aria-hidden="true" tabindex="-1"></a>    positions <span class="op">=</span> matcher.search(text)</span>
<span id="cb11-111"><a href="#cb11-111" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-112"><a href="#cb11-112" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Text: </span><span class="sc">{</span>text<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb11-113"><a href="#cb11-113" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Pattern: </span><span class="sc">{</span>pattern<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb11-114"><a href="#cb11-114" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Found at positions: </span><span class="sc">{</span>positions<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb11-115"><a href="#cb11-115" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>()</span>
<span id="cb11-116"><a href="#cb11-116" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-117"><a href="#cb11-117" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Visualize matches</span></span>
<span id="cb11-118"><a href="#cb11-118" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> pos <span class="kw">in</span> positions:</span>
<span id="cb11-119"><a href="#cb11-119" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">" "</span> <span class="op">*</span> pos <span class="op">+</span> pattern <span class="op">+</span> <span class="ss">f" (position </span><span class="sc">{</span>pos<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb11-120"><a href="#cb11-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-121"><a href="#cb11-121" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> example_dna_search():</span>
<span id="cb11-122"><a href="#cb11-122" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""DNA sequence matching."""</span></span>
<span id="cb11-123"><a href="#cb11-123" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample DNA sequence</span></span>
<span id="cb11-124"><a href="#cb11-124" aria-hidden="true" tabindex="-1"></a>    dna <span class="op">=</span> <span class="st">"ACGTACGTTAGCTAGCTAGCTAGCTACGTACGTT"</span></span>
<span id="cb11-125"><a href="#cb11-125" aria-hidden="true" tabindex="-1"></a>    motif <span class="op">=</span> <span class="st">"TAGC"</span></span>
<span id="cb11-126"><a href="#cb11-126" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-127"><a href="#cb11-127" aria-hidden="true" tabindex="-1"></a>    matcher <span class="op">=</span> KMPMatcher(motif)</span>
<span id="cb11-128"><a href="#cb11-128" aria-hidden="true" tabindex="-1"></a>    positions <span class="op">=</span> matcher.search(dna)</span>
<span id="cb11-129"><a href="#cb11-129" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-130"><a href="#cb11-130" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"DNA Sequence: </span><span class="sc">{</span>dna<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb11-131"><a href="#cb11-131" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Motif: </span><span class="sc">{</span>motif<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb11-132"><a href="#cb11-132" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Found </span><span class="sc">{</span><span class="bu">len</span>(positions)<span class="sc">}</span><span class="ss"> occurrences at positions: </span><span class="sc">{</span>positions<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb11-133"><a href="#cb11-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-134"><a href="#cb11-134" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> example_failure_function():</span>
<span id="cb11-135"><a href="#cb11-135" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Demonstrate failure function."""</span></span>
<span id="cb11-136"><a href="#cb11-136" aria-hidden="true" tabindex="-1"></a>    patterns <span class="op">=</span> [<span class="st">"ABABC"</span>, <span class="st">"AABAAB"</span>, <span class="st">"ABCABC"</span>, <span class="st">"AAAAA"</span>]</span>
<span id="cb11-137"><a href="#cb11-137" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-138"><a href="#cb11-138" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> pattern <span class="kw">in</span> patterns:</span>
<span id="cb11-139"><a href="#cb11-139" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Pattern: </span><span class="sc">{</span>pattern<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb11-140"><a href="#cb11-140" aria-hidden="true" tabindex="-1"></a>        matcher <span class="op">=</span> KMPMatcher(pattern)</span>
<span id="cb11-141"><a href="#cb11-141" aria-hidden="true" tabindex="-1"></a>        matcher.visualize_failure_function()</span>
<span id="cb11-142"><a href="#cb11-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-143"><a href="#cb11-143" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> benchmark_comparison():</span>
<span id="cb11-144"><a href="#cb11-144" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Compare KMP with naive search."""</span></span>
<span id="cb11-145"><a href="#cb11-145" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> time</span>
<span id="cb11-146"><a href="#cb11-146" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-147"><a href="#cb11-147" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create worst-case scenario</span></span>
<span id="cb11-148"><a href="#cb11-148" aria-hidden="true" tabindex="-1"></a>    text <span class="op">=</span> <span class="st">"A"</span> <span class="op">*</span> <span class="dv">100000</span> <span class="op">+</span> <span class="st">"B"</span></span>
<span id="cb11-149"><a href="#cb11-149" aria-hidden="true" tabindex="-1"></a>    pattern <span class="op">=</span> <span class="st">"A"</span> <span class="op">*</span> <span class="dv">100</span> <span class="op">+</span> <span class="st">"B"</span></span>
<span id="cb11-150"><a href="#cb11-150" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-151"><a href="#cb11-151" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Naive search</span></span>
<span id="cb11-152"><a href="#cb11-152" aria-hidden="true" tabindex="-1"></a>    start <span class="op">=</span> time.time()</span>
<span id="cb11-153"><a href="#cb11-153" aria-hidden="true" tabindex="-1"></a>    naive_positions <span class="op">=</span> naive_search(text, pattern)</span>
<span id="cb11-154"><a href="#cb11-154" aria-hidden="true" tabindex="-1"></a>    naive_time <span class="op">=</span> time.time() <span class="op">-</span> start</span>
<span id="cb11-155"><a href="#cb11-155" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-156"><a href="#cb11-156" aria-hidden="true" tabindex="-1"></a>    <span class="co"># KMP search</span></span>
<span id="cb11-157"><a href="#cb11-157" aria-hidden="true" tabindex="-1"></a>    start <span class="op">=</span> time.time()</span>
<span id="cb11-158"><a href="#cb11-158" aria-hidden="true" tabindex="-1"></a>    matcher <span class="op">=</span> KMPMatcher(pattern)</span>
<span id="cb11-159"><a href="#cb11-159" aria-hidden="true" tabindex="-1"></a>    kmp_positions <span class="op">=</span> matcher.search(text)</span>
<span id="cb11-160"><a href="#cb11-160" aria-hidden="true" tabindex="-1"></a>    kmp_time <span class="op">=</span> time.time() <span class="op">-</span> start</span>
<span id="cb11-161"><a href="#cb11-161" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-162"><a href="#cb11-162" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Text length: </span><span class="sc">{</span><span class="bu">len</span>(text)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb11-163"><a href="#cb11-163" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Pattern length: </span><span class="sc">{</span><span class="bu">len</span>(pattern)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb11-164"><a href="#cb11-164" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Matches found: </span><span class="sc">{</span><span class="bu">len</span>(kmp_positions)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb11-165"><a href="#cb11-165" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Naive search: </span><span class="sc">{</span>naive_time<span class="sc">:.4f}</span><span class="ss"> seconds"</span>)</span>
<span id="cb11-166"><a href="#cb11-166" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"KMP search: </span><span class="sc">{</span>kmp_time<span class="sc">:.4f}</span><span class="ss"> seconds"</span>)</span>
<span id="cb11-167"><a href="#cb11-167" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Speedup: </span><span class="sc">{</span>naive_time<span class="op">/</span>kmp_time<span class="sc">:.2f}</span><span class="ss">x"</span>)</span>
<span id="cb11-168"><a href="#cb11-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-169"><a href="#cb11-169" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>:</span>
<span id="cb11-170"><a href="#cb11-170" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"=== Basic Search ==="</span>)</span>
<span id="cb11-171"><a href="#cb11-171" aria-hidden="true" tabindex="-1"></a>    example_basic_search()</span>
<span id="cb11-172"><a href="#cb11-172" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-173"><a href="#cb11-173" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">=== DNA Search ==="</span>)</span>
<span id="cb11-174"><a href="#cb11-174" aria-hidden="true" tabindex="-1"></a>    example_dna_search()</span>
<span id="cb11-175"><a href="#cb11-175" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-176"><a href="#cb11-176" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">=== Failure Function Examples ==="</span>)</span>
<span id="cb11-177"><a href="#cb11-177" aria-hidden="true" tabindex="-1"></a>    example_failure_function()</span>
<span id="cb11-178"><a href="#cb11-178" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-179"><a href="#cb11-179" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">=== Benchmark ==="</span>)</span>
<span id="cb11-180"><a href="#cb11-180" aria-hidden="true" tabindex="-1"></a>    benchmark_comparison()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="rabin-karp-hashing-to-the-rescue" class="level2" data-number="18.4">
<h2 data-number="18.4" class="anchored" data-anchor-id="rabin-karp-hashing-to-the-rescue"><span class="header-section-number">18.4</span> 10.4 Rabin-Karp: Hashing to the Rescue</h2>
<section id="the-hashing-idea" class="level3" data-number="18.4.1">
<h3 data-number="18.4.1" class="anchored" data-anchor-id="the-hashing-idea"><span class="header-section-number">18.4.1</span> 10.4.1 The Hashing Idea</h3>
<p>The <strong>Rabin-Karp algorithm</strong> takes a completely different approach: treat strings as numbers!</p>
<p><strong>Main idea</strong>: 1. Convert the pattern to a hash value 2. Compute hash values for all substrings of text 3. When hashes match, verify with direct comparison</p>
<p><strong>Why is this clever?</strong></p>
<p>If we can compute hashes efficiently, we can compare a pattern against a text position in O(1) time!</p>
</section>
<section id="rolling-hash-function" class="level3" data-number="18.4.2">
<h3 data-number="18.4.2" class="anchored" data-anchor-id="rolling-hash-function"><span class="header-section-number">18.4.2</span> 10.4.2 Rolling Hash Function</h3>
<p>The magic is in the <strong>rolling hash</strong>: we can compute the hash of the next substring from the previous hash in O(1) time!</p>
<p>Think of the string as a number in base d (where d = alphabet size):</p>
<pre><code>For string "ABC" with A=1, B=2, C=3, base d=10:
hash("ABC") = 1×10² + 2×10¹ + 3×10⁰ = 123

For string "BCD" with B=2, C=3, D=4:
hash("BCD") = 2×10² + 3×10¹ + 4×10⁰ = 234</code></pre>
<p><strong>Rolling property</strong>:</p>
<pre><code>If we know hash("ABC") = 123, we can compute hash("BCD"):

1. Subtract contribution of 'A': 123 - 1×10² = 23
2. Shift left (multiply by base): 23 × 10 = 230
3. Add new character 'D': 230 + 4 = 234</code></pre>
<p>In one formula:</p>
<pre><code>hash(s[1..m]) = (hash(s[0..m-1]) - s[0]×d^(m-1)) × d + s[m]</code></pre>
</section>
<section id="dealing-with-large-numbers" class="level3" data-number="18.4.3">
<h3 data-number="18.4.3" class="anchored" data-anchor-id="dealing-with-large-numbers"><span class="header-section-number">18.4.3</span> 10.4.3 Dealing with Large Numbers</h3>
<p>For long strings, hashes become huge numbers. Solution: <strong>modular arithmetic</strong>!</p>
<pre><code>hash(s) = (Σ s[i] × d^(m-1-i)) mod q</code></pre>
<p>Where q is a large prime number (e.g., 10^9 + 7).</p>
<p><strong>Important caveat</strong>: With modular hashing, collisions can occur (different strings with same hash). So we must verify matches!</p>
</section>
<section id="implementation" class="level3" data-number="18.4.4">
<h3 data-number="18.4.4" class="anchored" data-anchor-id="implementation"><span class="header-section-number">18.4.4</span> 10.4.4 Implementation</h3>
<div class="sourceCode" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> RabinKarp:</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Rabin-Karp string matching using rolling hash.</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Expected time: O(n+m), Worst case: O(nm) due to hash collisions.</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, d<span class="op">=</span><span class="dv">256</span>, q<span class="op">=</span><span class="dv">101</span>):</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="co">        Initialize Rabin-Karp matcher.</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="co">        Args:</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="co">            d: Base for hash (alphabet size, default 256 for ASCII)</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="co">            q: Prime modulus for hash (use large prime to reduce collisions)</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.d <span class="op">=</span> d</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.q <span class="op">=</span> q</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> search(<span class="va">self</span>, text, pattern):</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a><span class="co">        Find all occurrences of pattern in text.</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns list of starting positions.</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>        n <span class="op">=</span> <span class="bu">len</span>(text)</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>        m <span class="op">=</span> <span class="bu">len</span>(pattern)</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> m <span class="op">&gt;</span> n:</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> []</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>        positions <span class="op">=</span> []</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate d^(m-1) % q for rolling hash</span></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>        h <span class="op">=</span> <span class="bu">pow</span>(<span class="va">self</span>.d, m <span class="op">-</span> <span class="dv">1</span>, <span class="va">self</span>.q)</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate hash values for pattern and first window of text</span></span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>        pattern_hash <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>        text_hash <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(m):</span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>            pattern_hash <span class="op">=</span> (<span class="va">self</span>.d <span class="op">*</span> pattern_hash <span class="op">+</span> <span class="bu">ord</span>(pattern[i])) <span class="op">%</span> <span class="va">self</span>.q</span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a>            text_hash <span class="op">=</span> (<span class="va">self</span>.d <span class="op">*</span> text_hash <span class="op">+</span> <span class="bu">ord</span>(text[i])) <span class="op">%</span> <span class="va">self</span>.q</span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Slide the pattern over text</span></span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n <span class="op">-</span> m <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Check if hash values match</span></span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> pattern_hash <span class="op">==</span> text_hash:</span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Hash match! Verify character by character</span></span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> text[i:i<span class="op">+</span>m] <span class="op">==</span> pattern:</span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a>                    positions.append(i)</span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Calculate hash for next window (if not at end)</span></span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> i <span class="op">&lt;</span> n <span class="op">-</span> m:</span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Remove leading character, add trailing character</span></span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a>                text_hash <span class="op">=</span> (<span class="va">self</span>.d <span class="op">*</span> (text_hash <span class="op">-</span> <span class="bu">ord</span>(text[i]) <span class="op">*</span> h) <span class="op">+</span> </span>
<span id="cb16-54"><a href="#cb16-54" aria-hidden="true" tabindex="-1"></a>                           <span class="bu">ord</span>(text[i <span class="op">+</span> m])) <span class="op">%</span> <span class="va">self</span>.q</span>
<span id="cb16-55"><a href="#cb16-55" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb16-56"><a href="#cb16-56" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Make sure hash is positive</span></span>
<span id="cb16-57"><a href="#cb16-57" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> text_hash <span class="op">&lt;</span> <span class="dv">0</span>:</span>
<span id="cb16-58"><a href="#cb16-58" aria-hidden="true" tabindex="-1"></a>                    text_hash <span class="op">+=</span> <span class="va">self</span>.q</span>
<span id="cb16-59"><a href="#cb16-59" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-60"><a href="#cb16-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> positions</span>
<span id="cb16-61"><a href="#cb16-61" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-62"><a href="#cb16-62" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> search_multiple(<span class="va">self</span>, text, patterns):</span>
<span id="cb16-63"><a href="#cb16-63" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb16-64"><a href="#cb16-64" aria-hidden="true" tabindex="-1"></a><span class="co">        Search for multiple patterns simultaneously.</span></span>
<span id="cb16-65"><a href="#cb16-65" aria-hidden="true" tabindex="-1"></a><span class="co">        This is where Rabin-Karp really shines!</span></span>
<span id="cb16-66"><a href="#cb16-66" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb16-67"><a href="#cb16-67" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns dict mapping pattern to list of positions.</span></span>
<span id="cb16-68"><a href="#cb16-68" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb16-69"><a href="#cb16-69" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> patterns:</span>
<span id="cb16-70"><a href="#cb16-70" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> {}</span>
<span id="cb16-71"><a href="#cb16-71" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-72"><a href="#cb16-72" aria-hidden="true" tabindex="-1"></a>        n <span class="op">=</span> <span class="bu">len</span>(text)</span>
<span id="cb16-73"><a href="#cb16-73" aria-hidden="true" tabindex="-1"></a>        m <span class="op">=</span> <span class="bu">len</span>(patterns[<span class="dv">0</span>])  <span class="co"># Assume all patterns same length</span></span>
<span id="cb16-74"><a href="#cb16-74" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-75"><a href="#cb16-75" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Verify all patterns have same length</span></span>
<span id="cb16-76"><a href="#cb16-76" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="bu">all</span>(<span class="bu">len</span>(p) <span class="op">==</span> m <span class="cf">for</span> p <span class="kw">in</span> patterns):</span>
<span id="cb16-77"><a href="#cb16-77" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"All patterns must have same length"</span>)</span>
<span id="cb16-78"><a href="#cb16-78" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-79"><a href="#cb16-79" aria-hidden="true" tabindex="-1"></a>        results <span class="op">=</span> {pattern: [] <span class="cf">for</span> pattern <span class="kw">in</span> patterns}</span>
<span id="cb16-80"><a href="#cb16-80" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-81"><a href="#cb16-81" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate pattern hashes</span></span>
<span id="cb16-82"><a href="#cb16-82" aria-hidden="true" tabindex="-1"></a>        pattern_hashes <span class="op">=</span> {}</span>
<span id="cb16-83"><a href="#cb16-83" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> pattern <span class="kw">in</span> patterns:</span>
<span id="cb16-84"><a href="#cb16-84" aria-hidden="true" tabindex="-1"></a>            h <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb16-85"><a href="#cb16-85" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> char <span class="kw">in</span> pattern:</span>
<span id="cb16-86"><a href="#cb16-86" aria-hidden="true" tabindex="-1"></a>                h <span class="op">=</span> (<span class="va">self</span>.d <span class="op">*</span> h <span class="op">+</span> <span class="bu">ord</span>(char)) <span class="op">%</span> <span class="va">self</span>.q</span>
<span id="cb16-87"><a href="#cb16-87" aria-hidden="true" tabindex="-1"></a>            pattern_hashes[h] <span class="op">=</span> pattern</span>
<span id="cb16-88"><a href="#cb16-88" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-89"><a href="#cb16-89" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate d^(m-1) % q</span></span>
<span id="cb16-90"><a href="#cb16-90" aria-hidden="true" tabindex="-1"></a>        h <span class="op">=</span> <span class="bu">pow</span>(<span class="va">self</span>.d, m <span class="op">-</span> <span class="dv">1</span>, <span class="va">self</span>.q)</span>
<span id="cb16-91"><a href="#cb16-91" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-92"><a href="#cb16-92" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate hash for first window</span></span>
<span id="cb16-93"><a href="#cb16-93" aria-hidden="true" tabindex="-1"></a>        text_hash <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb16-94"><a href="#cb16-94" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(m):</span>
<span id="cb16-95"><a href="#cb16-95" aria-hidden="true" tabindex="-1"></a>            text_hash <span class="op">=</span> (<span class="va">self</span>.d <span class="op">*</span> text_hash <span class="op">+</span> <span class="bu">ord</span>(text[i])) <span class="op">%</span> <span class="va">self</span>.q</span>
<span id="cb16-96"><a href="#cb16-96" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-97"><a href="#cb16-97" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Slide over text</span></span>
<span id="cb16-98"><a href="#cb16-98" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n <span class="op">-</span> m <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb16-99"><a href="#cb16-99" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Check if this hash matches any pattern</span></span>
<span id="cb16-100"><a href="#cb16-100" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> text_hash <span class="kw">in</span> pattern_hashes:</span>
<span id="cb16-101"><a href="#cb16-101" aria-hidden="true" tabindex="-1"></a>                pattern <span class="op">=</span> pattern_hashes[text_hash]</span>
<span id="cb16-102"><a href="#cb16-102" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Verify match</span></span>
<span id="cb16-103"><a href="#cb16-103" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> text[i:i<span class="op">+</span>m] <span class="op">==</span> pattern:</span>
<span id="cb16-104"><a href="#cb16-104" aria-hidden="true" tabindex="-1"></a>                    results[pattern].append(i)</span>
<span id="cb16-105"><a href="#cb16-105" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-106"><a href="#cb16-106" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Roll hash forward</span></span>
<span id="cb16-107"><a href="#cb16-107" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> i <span class="op">&lt;</span> n <span class="op">-</span> m:</span>
<span id="cb16-108"><a href="#cb16-108" aria-hidden="true" tabindex="-1"></a>                text_hash <span class="op">=</span> (<span class="va">self</span>.d <span class="op">*</span> (text_hash <span class="op">-</span> <span class="bu">ord</span>(text[i]) <span class="op">*</span> h) <span class="op">+</span> </span>
<span id="cb16-109"><a href="#cb16-109" aria-hidden="true" tabindex="-1"></a>                           <span class="bu">ord</span>(text[i <span class="op">+</span> m])) <span class="op">%</span> <span class="va">self</span>.q</span>
<span id="cb16-110"><a href="#cb16-110" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> text_hash <span class="op">&lt;</span> <span class="dv">0</span>:</span>
<span id="cb16-111"><a href="#cb16-111" aria-hidden="true" tabindex="-1"></a>                    text_hash <span class="op">+=</span> <span class="va">self</span>.q</span>
<span id="cb16-112"><a href="#cb16-112" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-113"><a href="#cb16-113" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> results</span>
<span id="cb16-114"><a href="#cb16-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-115"><a href="#cb16-115" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> visualize_rolling_hash(text, pattern):</span>
<span id="cb16-116"><a href="#cb16-116" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Show how rolling hash works step by step."""</span></span>
<span id="cb16-117"><a href="#cb16-117" aria-hidden="true" tabindex="-1"></a>    d <span class="op">=</span> <span class="dv">256</span></span>
<span id="cb16-118"><a href="#cb16-118" aria-hidden="true" tabindex="-1"></a>    q <span class="op">=</span> <span class="dv">101</span></span>
<span id="cb16-119"><a href="#cb16-119" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="bu">len</span>(text)</span>
<span id="cb16-120"><a href="#cb16-120" aria-hidden="true" tabindex="-1"></a>    m <span class="op">=</span> <span class="bu">len</span>(pattern)</span>
<span id="cb16-121"><a href="#cb16-121" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-122"><a href="#cb16-122" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Text: </span><span class="sc">{</span>text<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb16-123"><a href="#cb16-123" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Pattern: </span><span class="sc">{</span>pattern<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb16-124"><a href="#cb16-124" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Base (d): </span><span class="sc">{</span>d<span class="sc">}</span><span class="ss">, Modulus (q): </span><span class="sc">{</span>q<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb16-125"><a href="#cb16-125" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-126"><a href="#cb16-126" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate pattern hash</span></span>
<span id="cb16-127"><a href="#cb16-127" aria-hidden="true" tabindex="-1"></a>    pattern_hash <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb16-128"><a href="#cb16-128" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> char <span class="kw">in</span> pattern:</span>
<span id="cb16-129"><a href="#cb16-129" aria-hidden="true" tabindex="-1"></a>        pattern_hash <span class="op">=</span> (d <span class="op">*</span> pattern_hash <span class="op">+</span> <span class="bu">ord</span>(char)) <span class="op">%</span> q</span>
<span id="cb16-130"><a href="#cb16-130" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Pattern hash: </span><span class="sc">{</span>pattern_hash<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb16-131"><a href="#cb16-131" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-132"><a href="#cb16-132" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Show first few windows</span></span>
<span id="cb16-133"><a href="#cb16-133" aria-hidden="true" tabindex="-1"></a>    h <span class="op">=</span> <span class="bu">pow</span>(d, m <span class="op">-</span> <span class="dv">1</span>, q)</span>
<span id="cb16-134"><a href="#cb16-134" aria-hidden="true" tabindex="-1"></a>    text_hash <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb16-135"><a href="#cb16-135" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-136"><a href="#cb16-136" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(m):</span>
<span id="cb16-137"><a href="#cb16-137" aria-hidden="true" tabindex="-1"></a>        text_hash <span class="op">=</span> (d <span class="op">*</span> text_hash <span class="op">+</span> <span class="bu">ord</span>(text[i])) <span class="op">%</span> q</span>
<span id="cb16-138"><a href="#cb16-138" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-139"><a href="#cb16-139" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Rolling through text:"</span>)</span>
<span id="cb16-140"><a href="#cb16-140" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">min</span>(n <span class="op">-</span> m <span class="op">+</span> <span class="dv">1</span>, <span class="dv">10</span>)):  <span class="co"># Show first 10 positions</span></span>
<span id="cb16-141"><a href="#cb16-141" aria-hidden="true" tabindex="-1"></a>        window <span class="op">=</span> text[i:i<span class="op">+</span>m]</span>
<span id="cb16-142"><a href="#cb16-142" aria-hidden="true" tabindex="-1"></a>        match <span class="op">=</span> <span class="st">"✓ MATCH!"</span> <span class="cf">if</span> text_hash <span class="op">==</span> pattern_hash <span class="cf">else</span> <span class="st">""</span></span>
<span id="cb16-143"><a href="#cb16-143" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  Position </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">: '</span><span class="sc">{</span>window<span class="sc">}</span><span class="ss">' → hash = </span><span class="sc">{</span>text_hash<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>match<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb16-144"><a href="#cb16-144" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-145"><a href="#cb16-145" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Roll forward</span></span>
<span id="cb16-146"><a href="#cb16-146" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">&lt;</span> n <span class="op">-</span> m:</span>
<span id="cb16-147"><a href="#cb16-147" aria-hidden="true" tabindex="-1"></a>            text_hash <span class="op">=</span> (d <span class="op">*</span> (text_hash <span class="op">-</span> <span class="bu">ord</span>(text[i]) <span class="op">*</span> h) <span class="op">+</span> </span>
<span id="cb16-148"><a href="#cb16-148" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">ord</span>(text[i <span class="op">+</span> m])) <span class="op">%</span> q</span>
<span id="cb16-149"><a href="#cb16-149" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> text_hash <span class="op">&lt;</span> <span class="dv">0</span>:</span>
<span id="cb16-150"><a href="#cb16-150" aria-hidden="true" tabindex="-1"></a>                text_hash <span class="op">+=</span> <span class="va">self</span>.q</span>
<span id="cb16-151"><a href="#cb16-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-152"><a href="#cb16-152" aria-hidden="true" tabindex="-1"></a><span class="co"># Examples</span></span>
<span id="cb16-153"><a href="#cb16-153" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> example_basic_rabin_karp():</span>
<span id="cb16-154"><a href="#cb16-154" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Basic Rabin-Karp example."""</span></span>
<span id="cb16-155"><a href="#cb16-155" aria-hidden="true" tabindex="-1"></a>    text <span class="op">=</span> <span class="st">"ABABDABACDABABCABABA"</span></span>
<span id="cb16-156"><a href="#cb16-156" aria-hidden="true" tabindex="-1"></a>    pattern <span class="op">=</span> <span class="st">"ABAB"</span></span>
<span id="cb16-157"><a href="#cb16-157" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-158"><a href="#cb16-158" aria-hidden="true" tabindex="-1"></a>    rk <span class="op">=</span> RabinKarp()</span>
<span id="cb16-159"><a href="#cb16-159" aria-hidden="true" tabindex="-1"></a>    positions <span class="op">=</span> rk.search(text, pattern)</span>
<span id="cb16-160"><a href="#cb16-160" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-161"><a href="#cb16-161" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Text: </span><span class="sc">{</span>text<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb16-162"><a href="#cb16-162" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Pattern: </span><span class="sc">{</span>pattern<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb16-163"><a href="#cb16-163" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Found at positions: </span><span class="sc">{</span>positions<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb16-164"><a href="#cb16-164" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-165"><a href="#cb16-165" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> pos <span class="kw">in</span> positions:</span>
<span id="cb16-166"><a href="#cb16-166" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">" "</span> <span class="op">*</span> pos <span class="op">+</span> pattern <span class="op">+</span> <span class="ss">f" (position </span><span class="sc">{</span>pos<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb16-167"><a href="#cb16-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-168"><a href="#cb16-168" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> example_multiple_patterns():</span>
<span id="cb16-169"><a href="#cb16-169" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Search for multiple patterns at once - RK's superpower!"""</span></span>
<span id="cb16-170"><a href="#cb16-170" aria-hidden="true" tabindex="-1"></a>    text <span class="op">=</span> <span class="st">"The quick brown fox jumps over the lazy dog"</span></span>
<span id="cb16-171"><a href="#cb16-171" aria-hidden="true" tabindex="-1"></a>    patterns <span class="op">=</span> [<span class="st">"quick"</span>, <span class="st">"brown"</span>, <span class="st">"jumps"</span>, <span class="st">"lazy "</span>, <span class="st">"cat  "</span>]  <span class="co"># Same length</span></span>
<span id="cb16-172"><a href="#cb16-172" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-173"><a href="#cb16-173" aria-hidden="true" tabindex="-1"></a>    rk <span class="op">=</span> RabinKarp()</span>
<span id="cb16-174"><a href="#cb16-174" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> rk.search_multiple(text, patterns)</span>
<span id="cb16-175"><a href="#cb16-175" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-176"><a href="#cb16-176" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Text: </span><span class="sc">{</span>text<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb16-177"><a href="#cb16-177" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Searching for multiple 5-character patterns:"</span>)</span>
<span id="cb16-178"><a href="#cb16-178" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> pattern, positions <span class="kw">in</span> results.items():</span>
<span id="cb16-179"><a href="#cb16-179" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> positions:</span>
<span id="cb16-180"><a href="#cb16-180" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"  '</span><span class="sc">{</span>pattern<span class="sc">}</span><span class="ss">': found at </span><span class="sc">{</span>positions<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb16-181"><a href="#cb16-181" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb16-182"><a href="#cb16-182" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"  '</span><span class="sc">{</span>pattern<span class="sc">}</span><span class="ss">': not found"</span>)</span>
<span id="cb16-183"><a href="#cb16-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-184"><a href="#cb16-184" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> example_plagiarism_detection():</span>
<span id="cb16-185"><a href="#cb16-185" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Simulate plagiarism detection using Rabin-Karp."""</span></span>
<span id="cb16-186"><a href="#cb16-186" aria-hidden="true" tabindex="-1"></a>    original <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb16-187"><a href="#cb16-187" aria-hidden="true" tabindex="-1"></a><span class="st">    The quick brown fox jumps over the lazy dog.</span></span>
<span id="cb16-188"><a href="#cb16-188" aria-hidden="true" tabindex="-1"></a><span class="st">    Pack my box with five dozen liquor jugs.</span></span>
<span id="cb16-189"><a href="#cb16-189" aria-hidden="true" tabindex="-1"></a><span class="st">    How vexingly quick daft zebras jump!</span></span>
<span id="cb16-190"><a href="#cb16-190" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb16-191"><a href="#cb16-191" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-192"><a href="#cb16-192" aria-hidden="true" tabindex="-1"></a>    suspicious <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb16-193"><a href="#cb16-193" aria-hidden="true" tabindex="-1"></a><span class="st">    The quick brown fox jumps over the lazy cat.</span></span>
<span id="cb16-194"><a href="#cb16-194" aria-hidden="true" tabindex="-1"></a><span class="st">    Pack my box with five dozen liquor jugs.</span></span>
<span id="cb16-195"><a href="#cb16-195" aria-hidden="true" tabindex="-1"></a><span class="st">    Amazingly, zebras can jump quite far!</span></span>
<span id="cb16-196"><a href="#cb16-196" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb16-197"><a href="#cb16-197" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-198"><a href="#cb16-198" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Look for common phrases (6+ word sequences)</span></span>
<span id="cb16-199"><a href="#cb16-199" aria-hidden="true" tabindex="-1"></a>    window_size <span class="op">=</span> <span class="dv">30</span></span>
<span id="cb16-200"><a href="#cb16-200" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-201"><a href="#cb16-201" aria-hidden="true" tabindex="-1"></a>    rk <span class="op">=</span> RabinKarp()</span>
<span id="cb16-202"><a href="#cb16-202" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-203"><a href="#cb16-203" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract all windows from original</span></span>
<span id="cb16-204"><a href="#cb16-204" aria-hidden="true" tabindex="-1"></a>    original_clean <span class="op">=</span> original.replace(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>, <span class="st">' '</span>)</span>
<span id="cb16-205"><a href="#cb16-205" aria-hidden="true" tabindex="-1"></a>    suspicious_clean <span class="op">=</span> suspicious.replace(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>, <span class="st">' '</span>)</span>
<span id="cb16-206"><a href="#cb16-206" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-207"><a href="#cb16-207" aria-hidden="true" tabindex="-1"></a>    original_phrases <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb16-208"><a href="#cb16-208" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(original_clean) <span class="op">-</span> window_size <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb16-209"><a href="#cb16-209" aria-hidden="true" tabindex="-1"></a>        phrase <span class="op">=</span> original_clean[i:i<span class="op">+</span>window_size]</span>
<span id="cb16-210"><a href="#cb16-210" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> phrase.strip():  <span class="co"># Skip whitespace-only</span></span>
<span id="cb16-211"><a href="#cb16-211" aria-hidden="true" tabindex="-1"></a>            original_phrases.add(phrase)</span>
<span id="cb16-212"><a href="#cb16-212" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-213"><a href="#cb16-213" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find matches in suspicious text</span></span>
<span id="cb16-214"><a href="#cb16-214" aria-hidden="true" tabindex="-1"></a>    matches <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb16-215"><a href="#cb16-215" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> phrase <span class="kw">in</span> original_phrases:</span>
<span id="cb16-216"><a href="#cb16-216" aria-hidden="true" tabindex="-1"></a>        positions <span class="op">=</span> rk.search(suspicious_clean, phrase)</span>
<span id="cb16-217"><a href="#cb16-217" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> positions:</span>
<span id="cb16-218"><a href="#cb16-218" aria-hidden="true" tabindex="-1"></a>            matches <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb16-219"><a href="#cb16-219" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Matching phrase: '</span><span class="sc">{</span>phrase<span class="sc">.</span>strip()<span class="sc">}</span><span class="ss">'"</span>)</span>
<span id="cb16-220"><a href="#cb16-220" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-221"><a href="#cb16-221" aria-hidden="true" tabindex="-1"></a>    similarity <span class="op">=</span> (matches <span class="op">/</span> <span class="bu">len</span>(original_phrases)) <span class="op">*</span> <span class="dv">100</span> <span class="cf">if</span> original_phrases <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb16-222"><a href="#cb16-222" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Similarity: </span><span class="sc">{</span>similarity<span class="sc">:.1f}</span><span class="ss">%"</span>)</span>
<span id="cb16-223"><a href="#cb16-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-224"><a href="#cb16-224" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>:</span>
<span id="cb16-225"><a href="#cb16-225" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"=== Basic Rabin-Karp ==="</span>)</span>
<span id="cb16-226"><a href="#cb16-226" aria-hidden="true" tabindex="-1"></a>    example_basic_rabin_karp()</span>
<span id="cb16-227"><a href="#cb16-227" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-228"><a href="#cb16-228" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">=== Multiple Pattern Search ==="</span>)</span>
<span id="cb16-229"><a href="#cb16-229" aria-hidden="true" tabindex="-1"></a>    example_multiple_patterns()</span>
<span id="cb16-230"><a href="#cb16-230" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-231"><a href="#cb16-231" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">=== Plagiarism Detection ==="</span>)</span>
<span id="cb16-232"><a href="#cb16-232" aria-hidden="true" tabindex="-1"></a>    example_plagiarism_detection()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="when-to-use-rabin-karp" class="level3" data-number="18.4.5">
<h3 data-number="18.4.5" class="anchored" data-anchor-id="when-to-use-rabin-karp"><span class="header-section-number">18.4.5</span> 10.4.5 When to Use Rabin-Karp</h3>
<p><strong>Advantages</strong>: - ✅ Great for multiple pattern matching - ✅ Easy to implement - ✅ Works well in practice with good hash functions - ✅ Can be extended to 2D pattern matching (images!)</p>
<p><strong>Disadvantages</strong>: - ❌ Worst case still O(nm) due to hash collisions - ❌ Requires good prime number selection - ❌ Verification step needed for matches</p>
<p><strong>Best use cases</strong>: - Plagiarism detection (many patterns) - Virus scanning (thousands of signatures) - Finding duplicate files - 2D pattern matching in images</p>
</section>
</section>
<section id="suffix-arrays-the-swiss-army-knife" class="level2" data-number="18.5">
<h2 data-number="18.5" class="anchored" data-anchor-id="suffix-arrays-the-swiss-army-knife"><span class="header-section-number">18.5</span> 10.5 Suffix Arrays: The Swiss Army Knife</h2>
<section id="whats-a-suffix" class="level3" data-number="18.5.1">
<h3 data-number="18.5.1" class="anchored" data-anchor-id="whats-a-suffix"><span class="header-section-number">18.5.1</span> 10.5.1 What’s a Suffix?</h3>
<p>A <strong>suffix</strong> of a string is any substring that starts at some position and goes to the end.</p>
<pre><code>String: "banana"

Suffixes:
0: banana
1: anana
2: nana
3: ana
4: na
5: a</code></pre>
</section>
<section id="the-suffix-array" class="level3" data-number="18.5.2">
<h3 data-number="18.5.2" class="anchored" data-anchor-id="the-suffix-array"><span class="header-section-number">18.5.2</span> 10.5.2 The Suffix Array</h3>
<p>A <strong>suffix array</strong> is simply an array of integers representing the starting positions of all suffixes, sorted in lexicographical order.</p>
<pre><code>String: "banana$"  ($ = end marker, lexicographically smallest)

Sorted suffixes:
$           → position 6
a$          → position 5
ana$        → position 3
anana$      → position 1
banana$     → position 0
na$         → position 4
nana$       → position 2

Suffix array: [6, 5, 3, 1, 0, 4, 2]</code></pre>
<p><strong>Why is this useful?</strong></p>
<p>Once you have a suffix array, you can: - Find any pattern in O(m log n) time using binary search! - Find longest repeated substring - Find longest common substring between two strings - Build compressed text indices</p>
</section>
<section id="building-a-suffix-array-naive" class="level3" data-number="18.5.3">
<h3 data-number="18.5.3" class="anchored" data-anchor-id="building-a-suffix-array-naive"><span class="header-section-number">18.5.3</span> 10.5.3 Building a Suffix Array (Naive)</h3>
<p>The simplest approach: generate all suffixes, sort them.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> build_suffix_array_naive(text):</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Build suffix array by sorting all suffixes.</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Time: O(n² log n) due to string comparisons</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="bu">len</span>(text)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create list of (suffix, starting_position) pairs</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    suffixes <span class="op">=</span> [(text[i:], i) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n)]</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sort by suffix</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    suffixes.sort()</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract positions</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>    suffix_array <span class="op">=</span> [pos <span class="cf">for</span> suffix, pos <span class="kw">in</span> suffixes]</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> suffix_array</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Problem</strong>: Comparing strings takes O(n) time, so sorting takes O(n² log n). Too slow for large texts!</p>
</section>
<section id="building-a-suffix-array-efficiently" class="level3" data-number="18.5.4">
<h3 data-number="18.5.4" class="anchored" data-anchor-id="building-a-suffix-array-efficiently"><span class="header-section-number">18.5.4</span> 10.5.4 Building a Suffix Array Efficiently</h3>
<p>Modern algorithms build suffix arrays in O(n log n) or even O(n) time! The key: don’t compare full suffixes, use integer comparisons instead.</p>
<p><strong>DC3/Skew Algorithm</strong> (simplified version):</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SuffixArray:</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Efficient suffix array construction and queries.</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Uses prefix doubling for O(n log² n) construction.</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, text):</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Build suffix array for text."""</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.text <span class="op">=</span> text</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.n <span class="op">=</span> <span class="bu">len</span>(text)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.suffix_array <span class="op">=</span> <span class="va">self</span>._build()</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.lcp <span class="op">=</span> <span class="va">self</span>._build_lcp()</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _build(<span class="va">self</span>):</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="co">        Build suffix array using prefix doubling.</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="co">        Time: O(n log² n)</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>        n <span class="op">=</span> <span class="va">self</span>.n</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Initialize: rank by first character</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>        rank <span class="op">=</span> [<span class="bu">ord</span>(<span class="va">self</span>.text[i]) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n)]</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>        suffix_array <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(n))</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>        k <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> k <span class="op">&lt;</span> n:</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Sort by (rank[i], rank[i+k]) pairs</span></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>            <span class="co"># This ranks based on first 2k characters</span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>            <span class="kw">def</span> compare_key(i):</span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> (rank[i], rank[i <span class="op">+</span> k] <span class="cf">if</span> i <span class="op">+</span> k <span class="op">&lt;</span> n <span class="cf">else</span> <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>            suffix_array.sort(key<span class="op">=</span>compare_key)</span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Recompute ranks</span></span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>            new_rank <span class="op">=</span> [<span class="dv">0</span>] <span class="op">*</span> n</span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, n):</span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>                prev <span class="op">=</span> suffix_array[i <span class="op">-</span> <span class="dv">1</span>]</span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a>                curr <span class="op">=</span> suffix_array[i]</span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Same rank if both pairs are equal</span></span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (rank[prev], rank[prev <span class="op">+</span> k] <span class="cf">if</span> prev <span class="op">+</span> k <span class="op">&lt;</span> n <span class="cf">else</span> <span class="op">-</span><span class="dv">1</span>) <span class="op">==</span> <span class="op">\</span></span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a>                   (rank[curr], rank[curr <span class="op">+</span> k] <span class="cf">if</span> curr <span class="op">+</span> k <span class="op">&lt;</span> n <span class="cf">else</span> <span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a>                    new_rank[curr] <span class="op">=</span> new_rank[prev]</span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a>                    new_rank[curr] <span class="op">=</span> new_rank[prev] <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a>            rank <span class="op">=</span> new_rank</span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a>            k <span class="op">*=</span> <span class="dv">2</span></span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> suffix_array</span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _build_lcp(<span class="va">self</span>):</span>
<span id="cb20-54"><a href="#cb20-54" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb20-55"><a href="#cb20-55" aria-hidden="true" tabindex="-1"></a><span class="co">        Build LCP (Longest Common Prefix) array.</span></span>
<span id="cb20-56"><a href="#cb20-56" aria-hidden="true" tabindex="-1"></a><span class="co">        lcp[i] = length of longest common prefix between </span></span>
<span id="cb20-57"><a href="#cb20-57" aria-hidden="true" tabindex="-1"></a><span class="co">                 suffix_array[i] and suffix_array[i-1]</span></span>
<span id="cb20-58"><a href="#cb20-58" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb20-59"><a href="#cb20-59" aria-hidden="true" tabindex="-1"></a><span class="co">        Time: O(n)</span></span>
<span id="cb20-60"><a href="#cb20-60" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb20-61"><a href="#cb20-61" aria-hidden="true" tabindex="-1"></a>        n <span class="op">=</span> <span class="va">self</span>.n</span>
<span id="cb20-62"><a href="#cb20-62" aria-hidden="true" tabindex="-1"></a>        lcp <span class="op">=</span> [<span class="dv">0</span>] <span class="op">*</span> n</span>
<span id="cb20-63"><a href="#cb20-63" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb20-64"><a href="#cb20-64" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Inverse suffix array: rank[i] = position of suffix i in sorted order</span></span>
<span id="cb20-65"><a href="#cb20-65" aria-hidden="true" tabindex="-1"></a>        rank <span class="op">=</span> [<span class="dv">0</span>] <span class="op">*</span> n</span>
<span id="cb20-66"><a href="#cb20-66" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n):</span>
<span id="cb20-67"><a href="#cb20-67" aria-hidden="true" tabindex="-1"></a>            rank[<span class="va">self</span>.suffix_array[i]] <span class="op">=</span> i</span>
<span id="cb20-68"><a href="#cb20-68" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb20-69"><a href="#cb20-69" aria-hidden="true" tabindex="-1"></a>        h <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb20-70"><a href="#cb20-70" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n):</span>
<span id="cb20-71"><a href="#cb20-71" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> rank[i] <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb20-72"><a href="#cb20-72" aria-hidden="true" tabindex="-1"></a>                j <span class="op">=</span> <span class="va">self</span>.suffix_array[rank[i] <span class="op">-</span> <span class="dv">1</span>]</span>
<span id="cb20-73"><a href="#cb20-73" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb20-74"><a href="#cb20-74" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Calculate LCP between suffix i and suffix j</span></span>
<span id="cb20-75"><a href="#cb20-75" aria-hidden="true" tabindex="-1"></a>                <span class="cf">while</span> (i <span class="op">+</span> h <span class="op">&lt;</span> n <span class="kw">and</span> j <span class="op">+</span> h <span class="op">&lt;</span> n <span class="kw">and</span> </span>
<span id="cb20-76"><a href="#cb20-76" aria-hidden="true" tabindex="-1"></a>                       <span class="va">self</span>.text[i <span class="op">+</span> h] <span class="op">==</span> <span class="va">self</span>.text[j <span class="op">+</span> h]):</span>
<span id="cb20-77"><a href="#cb20-77" aria-hidden="true" tabindex="-1"></a>                    h <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb20-78"><a href="#cb20-78" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb20-79"><a href="#cb20-79" aria-hidden="true" tabindex="-1"></a>                lcp[rank[i]] <span class="op">=</span> h</span>
<span id="cb20-80"><a href="#cb20-80" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb20-81"><a href="#cb20-81" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> h <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb20-82"><a href="#cb20-82" aria-hidden="true" tabindex="-1"></a>                    h <span class="op">-=</span> <span class="dv">1</span></span>
<span id="cb20-83"><a href="#cb20-83" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb20-84"><a href="#cb20-84" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> lcp</span>
<span id="cb20-85"><a href="#cb20-85" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-86"><a href="#cb20-86" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> search(<span class="va">self</span>, pattern):</span>
<span id="cb20-87"><a href="#cb20-87" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb20-88"><a href="#cb20-88" aria-hidden="true" tabindex="-1"></a><span class="co">        Find all occurrences of pattern using binary search.</span></span>
<span id="cb20-89"><a href="#cb20-89" aria-hidden="true" tabindex="-1"></a><span class="co">        Time: O(m log n)  where m = len(pattern)</span></span>
<span id="cb20-90"><a href="#cb20-90" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb20-91"><a href="#cb20-91" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Binary search for lower bound</span></span>
<span id="cb20-92"><a href="#cb20-92" aria-hidden="true" tabindex="-1"></a>        left <span class="op">=</span> <span class="va">self</span>._lower_bound(pattern)</span>
<span id="cb20-93"><a href="#cb20-93" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb20-94"><a href="#cb20-94" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Binary search for upper bound</span></span>
<span id="cb20-95"><a href="#cb20-95" aria-hidden="true" tabindex="-1"></a>        right <span class="op">=</span> <span class="va">self</span>._upper_bound(pattern)</span>
<span id="cb20-96"><a href="#cb20-96" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb20-97"><a href="#cb20-97" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> left <span class="op">==</span> right:</span>
<span id="cb20-98"><a href="#cb20-98" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> []  <span class="co"># Not found</span></span>
<span id="cb20-99"><a href="#cb20-99" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb20-100"><a href="#cb20-100" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> [<span class="va">self</span>.suffix_array[i] <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(left, right)]</span>
<span id="cb20-101"><a href="#cb20-101" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-102"><a href="#cb20-102" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _lower_bound(<span class="va">self</span>, pattern):</span>
<span id="cb20-103"><a href="#cb20-103" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Find first position where pattern could be inserted."""</span></span>
<span id="cb20-104"><a href="#cb20-104" aria-hidden="true" tabindex="-1"></a>        left, right <span class="op">=</span> <span class="dv">0</span>, <span class="va">self</span>.n</span>
<span id="cb20-105"><a href="#cb20-105" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb20-106"><a href="#cb20-106" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> left <span class="op">&lt;</span> right:</span>
<span id="cb20-107"><a href="#cb20-107" aria-hidden="true" tabindex="-1"></a>            mid <span class="op">=</span> (left <span class="op">+</span> right) <span class="op">//</span> <span class="dv">2</span></span>
<span id="cb20-108"><a href="#cb20-108" aria-hidden="true" tabindex="-1"></a>            suffix_pos <span class="op">=</span> <span class="va">self</span>.suffix_array[mid]</span>
<span id="cb20-109"><a href="#cb20-109" aria-hidden="true" tabindex="-1"></a>            suffix <span class="op">=</span> <span class="va">self</span>.text[suffix_pos:]</span>
<span id="cb20-110"><a href="#cb20-110" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb20-111"><a href="#cb20-111" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> suffix <span class="op">&lt;</span> pattern:</span>
<span id="cb20-112"><a href="#cb20-112" aria-hidden="true" tabindex="-1"></a>                left <span class="op">=</span> mid <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb20-113"><a href="#cb20-113" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb20-114"><a href="#cb20-114" aria-hidden="true" tabindex="-1"></a>                right <span class="op">=</span> mid</span>
<span id="cb20-115"><a href="#cb20-115" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb20-116"><a href="#cb20-116" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> left</span>
<span id="cb20-117"><a href="#cb20-117" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-118"><a href="#cb20-118" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _upper_bound(<span class="va">self</span>, pattern):</span>
<span id="cb20-119"><a href="#cb20-119" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Find position after last match of pattern."""</span></span>
<span id="cb20-120"><a href="#cb20-120" aria-hidden="true" tabindex="-1"></a>        left, right <span class="op">=</span> <span class="dv">0</span>, <span class="va">self</span>.n</span>
<span id="cb20-121"><a href="#cb20-121" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb20-122"><a href="#cb20-122" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> left <span class="op">&lt;</span> right:</span>
<span id="cb20-123"><a href="#cb20-123" aria-hidden="true" tabindex="-1"></a>            mid <span class="op">=</span> (left <span class="op">+</span> right) <span class="op">//</span> <span class="dv">2</span></span>
<span id="cb20-124"><a href="#cb20-124" aria-hidden="true" tabindex="-1"></a>            suffix_pos <span class="op">=</span> <span class="va">self</span>.suffix_array[mid]</span>
<span id="cb20-125"><a href="#cb20-125" aria-hidden="true" tabindex="-1"></a>            suffix <span class="op">=</span> <span class="va">self</span>.text[suffix_pos:]</span>
<span id="cb20-126"><a href="#cb20-126" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb20-127"><a href="#cb20-127" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> suffix.startswith(pattern) <span class="kw">or</span> suffix <span class="op">&lt;</span> pattern:</span>
<span id="cb20-128"><a href="#cb20-128" aria-hidden="true" tabindex="-1"></a>                left <span class="op">=</span> mid <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb20-129"><a href="#cb20-129" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb20-130"><a href="#cb20-130" aria-hidden="true" tabindex="-1"></a>                right <span class="op">=</span> mid</span>
<span id="cb20-131"><a href="#cb20-131" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb20-132"><a href="#cb20-132" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> left</span>
<span id="cb20-133"><a href="#cb20-133" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-134"><a href="#cb20-134" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> longest_repeated_substring(<span class="va">self</span>):</span>
<span id="cb20-135"><a href="#cb20-135" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb20-136"><a href="#cb20-136" aria-hidden="true" tabindex="-1"></a><span class="co">        Find the longest substring that appears at least twice.</span></span>
<span id="cb20-137"><a href="#cb20-137" aria-hidden="true" tabindex="-1"></a><span class="co">        Uses LCP array.</span></span>
<span id="cb20-138"><a href="#cb20-138" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb20-139"><a href="#cb20-139" aria-hidden="true" tabindex="-1"></a><span class="co">        Time: O(n)</span></span>
<span id="cb20-140"><a href="#cb20-140" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb20-141"><a href="#cb20-141" aria-hidden="true" tabindex="-1"></a>        max_lcp <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb20-142"><a href="#cb20-142" aria-hidden="true" tabindex="-1"></a>        max_pos <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb20-143"><a href="#cb20-143" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb20-144"><a href="#cb20-144" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="va">self</span>.n):</span>
<span id="cb20-145"><a href="#cb20-145" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.lcp[i] <span class="op">&gt;</span> max_lcp:</span>
<span id="cb20-146"><a href="#cb20-146" aria-hidden="true" tabindex="-1"></a>                max_lcp <span class="op">=</span> <span class="va">self</span>.lcp[i]</span>
<span id="cb20-147"><a href="#cb20-147" aria-hidden="true" tabindex="-1"></a>                max_pos <span class="op">=</span> <span class="va">self</span>.suffix_array[i]</span>
<span id="cb20-148"><a href="#cb20-148" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb20-149"><a href="#cb20-149" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> max_lcp <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb20-150"><a href="#cb20-150" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">""</span></span>
<span id="cb20-151"><a href="#cb20-151" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb20-152"><a href="#cb20-152" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.text[max_pos:max_pos <span class="op">+</span> max_lcp]</span>
<span id="cb20-153"><a href="#cb20-153" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-154"><a href="#cb20-154" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> count_distinct_substrings(<span class="va">self</span>):</span>
<span id="cb20-155"><a href="#cb20-155" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb20-156"><a href="#cb20-156" aria-hidden="true" tabindex="-1"></a><span class="co">        Count number of distinct substrings.</span></span>
<span id="cb20-157"><a href="#cb20-157" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb20-158"><a href="#cb20-158" aria-hidden="true" tabindex="-1"></a><span class="co">        Formula: n(n+1)/2 - sum(lcp)</span></span>
<span id="cb20-159"><a href="#cb20-159" aria-hidden="true" tabindex="-1"></a><span class="co">        (Total possible substrings minus duplicates)</span></span>
<span id="cb20-160"><a href="#cb20-160" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb20-161"><a href="#cb20-161" aria-hidden="true" tabindex="-1"></a>        n <span class="op">=</span> <span class="va">self</span>.n</span>
<span id="cb20-162"><a href="#cb20-162" aria-hidden="true" tabindex="-1"></a>        total <span class="op">=</span> n <span class="op">*</span> (n <span class="op">+</span> <span class="dv">1</span>) <span class="op">//</span> <span class="dv">2</span></span>
<span id="cb20-163"><a href="#cb20-163" aria-hidden="true" tabindex="-1"></a>        duplicates <span class="op">=</span> <span class="bu">sum</span>(<span class="va">self</span>.lcp)</span>
<span id="cb20-164"><a href="#cb20-164" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> total <span class="op">-</span> duplicates</span>
<span id="cb20-165"><a href="#cb20-165" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-166"><a href="#cb20-166" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> visualize(<span class="va">self</span>, max_display<span class="op">=</span><span class="dv">15</span>):</span>
<span id="cb20-167"><a href="#cb20-167" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Print suffix array and LCP array for visualization."""</span></span>
<span id="cb20-168"><a href="#cb20-168" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Text: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>text<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb20-169"><a href="#cb20-169" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Suffix Array:"</span>)</span>
<span id="cb20-170"><a href="#cb20-170" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Index | Pos | LCP | Suffix"</span>)</span>
<span id="cb20-171"><a href="#cb20-171" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"------|-----|-----|"</span> <span class="op">+</span> <span class="st">"-"</span> <span class="op">*</span> <span class="dv">30</span>)</span>
<span id="cb20-172"><a href="#cb20-172" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb20-173"><a href="#cb20-173" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">min</span>(<span class="bu">len</span>(<span class="va">self</span>.suffix_array), max_display)):</span>
<span id="cb20-174"><a href="#cb20-174" aria-hidden="true" tabindex="-1"></a>            pos <span class="op">=</span> <span class="va">self</span>.suffix_array[i]</span>
<span id="cb20-175"><a href="#cb20-175" aria-hidden="true" tabindex="-1"></a>            suffix <span class="op">=</span> <span class="va">self</span>.text[pos:]</span>
<span id="cb20-176"><a href="#cb20-176" aria-hidden="true" tabindex="-1"></a>            lcp_val <span class="op">=</span> <span class="va">self</span>.lcp[i] <span class="cf">if</span> i <span class="op">&lt;</span> <span class="bu">len</span>(<span class="va">self</span>.lcp) <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb20-177"><a href="#cb20-177" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb20-178"><a href="#cb20-178" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Truncate long suffixes</span></span>
<span id="cb20-179"><a href="#cb20-179" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(suffix) <span class="op">&gt;</span> <span class="dv">25</span>:</span>
<span id="cb20-180"><a href="#cb20-180" aria-hidden="true" tabindex="-1"></a>                suffix <span class="op">=</span> suffix[:<span class="dv">25</span>] <span class="op">+</span> <span class="st">"..."</span></span>
<span id="cb20-181"><a href="#cb20-181" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb20-182"><a href="#cb20-182" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>i<span class="sc">:5}</span><span class="ss"> | </span><span class="sc">{</span>pos<span class="sc">:3}</span><span class="ss"> | </span><span class="sc">{</span>lcp_val<span class="sc">:3}</span><span class="ss"> | </span><span class="sc">{</span>suffix<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb20-183"><a href="#cb20-183" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb20-184"><a href="#cb20-184" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(<span class="va">self</span>.suffix_array) <span class="op">&gt;</span> max_display:</span>
<span id="cb20-185"><a href="#cb20-185" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"... (</span><span class="sc">{</span><span class="bu">len</span>(<span class="va">self</span>.suffix_array) <span class="op">-</span> max_display<span class="sc">}</span><span class="ss"> more)"</span>)</span>
<span id="cb20-186"><a href="#cb20-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-187"><a href="#cb20-187" aria-hidden="true" tabindex="-1"></a><span class="co"># Examples</span></span>
<span id="cb20-188"><a href="#cb20-188" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> example_basic_suffix_array():</span>
<span id="cb20-189"><a href="#cb20-189" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Basic suffix array construction and search."""</span></span>
<span id="cb20-190"><a href="#cb20-190" aria-hidden="true" tabindex="-1"></a>    text <span class="op">=</span> <span class="st">"banana$"</span></span>
<span id="cb20-191"><a href="#cb20-191" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-192"><a href="#cb20-192" aria-hidden="true" tabindex="-1"></a>    sa <span class="op">=</span> SuffixArray(text)</span>
<span id="cb20-193"><a href="#cb20-193" aria-hidden="true" tabindex="-1"></a>    sa.visualize()</span>
<span id="cb20-194"><a href="#cb20-194" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-195"><a href="#cb20-195" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Search for pattern</span></span>
<span id="cb20-196"><a href="#cb20-196" aria-hidden="true" tabindex="-1"></a>    pattern <span class="op">=</span> <span class="st">"ana"</span></span>
<span id="cb20-197"><a href="#cb20-197" aria-hidden="true" tabindex="-1"></a>    positions <span class="op">=</span> sa.search(pattern)</span>
<span id="cb20-198"><a href="#cb20-198" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Searching for '</span><span class="sc">{</span>pattern<span class="sc">}</span><span class="ss">':"</span>)</span>
<span id="cb20-199"><a href="#cb20-199" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Found at positions: </span><span class="sc">{</span>positions<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb20-200"><a href="#cb20-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-201"><a href="#cb20-201" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> example_repeated_substrings():</span>
<span id="cb20-202"><a href="#cb20-202" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Find longest repeated substring."""</span></span>
<span id="cb20-203"><a href="#cb20-203" aria-hidden="true" tabindex="-1"></a>    text <span class="op">=</span> <span class="st">"to be or not to be$"</span></span>
<span id="cb20-204"><a href="#cb20-204" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-205"><a href="#cb20-205" aria-hidden="true" tabindex="-1"></a>    sa <span class="op">=</span> SuffixArray(text)</span>
<span id="cb20-206"><a href="#cb20-206" aria-hidden="true" tabindex="-1"></a>    lrs <span class="op">=</span> sa.longest_repeated_substring()</span>
<span id="cb20-207"><a href="#cb20-207" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-208"><a href="#cb20-208" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Text: </span><span class="sc">{</span>text<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb20-209"><a href="#cb20-209" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Longest repeated substring: '</span><span class="sc">{</span>lrs<span class="sc">}</span><span class="ss">'"</span>)</span>
<span id="cb20-210"><a href="#cb20-210" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-211"><a href="#cb20-211" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Count distinct substrings</span></span>
<span id="cb20-212"><a href="#cb20-212" aria-hidden="true" tabindex="-1"></a>    count <span class="op">=</span> sa.count_distinct_substrings()</span>
<span id="cb20-213"><a href="#cb20-213" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Number of distinct substrings: </span><span class="sc">{</span>count<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb20-214"><a href="#cb20-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-215"><a href="#cb20-215" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> example_dna_analysis():</span>
<span id="cb20-216"><a href="#cb20-216" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""DNA sequence analysis with suffix arrays."""</span></span>
<span id="cb20-217"><a href="#cb20-217" aria-hidden="true" tabindex="-1"></a>    dna <span class="op">=</span> <span class="st">"ACGTACGTTAGCTAGCTAGCT$"</span></span>
<span id="cb20-218"><a href="#cb20-218" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-219"><a href="#cb20-219" aria-hidden="true" tabindex="-1"></a>    sa <span class="op">=</span> SuffixArray(dna)</span>
<span id="cb20-220"><a href="#cb20-220" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-221"><a href="#cb20-221" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"DNA Sequence: </span><span class="sc">{</span>dna[:<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>)  <span class="co"># Don't print $</span></span>
<span id="cb20-222"><a href="#cb20-222" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-223"><a href="#cb20-223" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find repeated sequences</span></span>
<span id="cb20-224"><a href="#cb20-224" aria-hidden="true" tabindex="-1"></a>    lrs <span class="op">=</span> sa.longest_repeated_substring()</span>
<span id="cb20-225"><a href="#cb20-225" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Longest repeated sequence: </span><span class="sc">{</span>lrs<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb20-226"><a href="#cb20-226" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-227"><a href="#cb20-227" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Search for specific motifs</span></span>
<span id="cb20-228"><a href="#cb20-228" aria-hidden="true" tabindex="-1"></a>    motifs <span class="op">=</span> [<span class="st">"ACGT"</span>, <span class="st">"TAGC"</span>, <span class="st">"GCT"</span>]</span>
<span id="cb20-229"><a href="#cb20-229" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Motif occurrences:"</span>)</span>
<span id="cb20-230"><a href="#cb20-230" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> motif <span class="kw">in</span> motifs:</span>
<span id="cb20-231"><a href="#cb20-231" aria-hidden="true" tabindex="-1"></a>        positions <span class="op">=</span> sa.search(motif)</span>
<span id="cb20-232"><a href="#cb20-232" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>motif<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="bu">len</span>(positions)<span class="sc">}</span><span class="ss"> times at positions </span><span class="sc">{</span>positions<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb20-233"><a href="#cb20-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-234"><a href="#cb20-234" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>:</span>
<span id="cb20-235"><a href="#cb20-235" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"=== Basic Suffix Array ==="</span>)</span>
<span id="cb20-236"><a href="#cb20-236" aria-hidden="true" tabindex="-1"></a>    example_basic_suffix_array()</span>
<span id="cb20-237"><a href="#cb20-237" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-238"><a href="#cb20-238" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">=== Repeated Substrings ==="</span>)</span>
<span id="cb20-239"><a href="#cb20-239" aria-hidden="true" tabindex="-1"></a>    example_repeated_substrings()</span>
<span id="cb20-240"><a href="#cb20-240" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-241"><a href="#cb20-241" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">=== DNA Analysis ==="</span>)</span>
<span id="cb20-242"><a href="#cb20-242" aria-hidden="true" tabindex="-1"></a>    example_dna_analysis()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="applications-of-suffix-arrays" class="level3" data-number="18.5.5">
<h3 data-number="18.5.5" class="anchored" data-anchor-id="applications-of-suffix-arrays"><span class="header-section-number">18.5.5</span> 10.5.5 Applications of Suffix Arrays</h3>
<p><strong>Text compression</strong> (BWT - Burrows-Wheeler Transform):</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> bwt_encode(text):</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Burrows-Wheeler Transform using suffix array."""</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    sa <span class="op">=</span> SuffixArray(text <span class="op">+</span> <span class="st">'$'</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># BWT is the last column of the sorted rotations</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">''</span>.join(text[(pos <span class="op">-</span> <span class="dv">1</span>) <span class="op">%</span> <span class="bu">len</span>(text)] <span class="cf">for</span> pos <span class="kw">in</span> sa.suffix_array)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Longest common substring of two strings</strong>:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> longest_common_substring(s1, s2):</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Find longest substring common to both s1 and s2."""</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    combined <span class="op">=</span> s1 <span class="op">+</span> <span class="st">'#'</span> <span class="op">+</span> s2 <span class="op">+</span> <span class="st">'$'</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    sa <span class="op">=</span> SuffixArray(combined)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    max_lcp <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    max_pos <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(combined)):</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Check if adjacent suffixes are from different strings</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>        pos1 <span class="op">=</span> sa.suffix_array[i<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>        pos2 <span class="op">=</span> sa.suffix_array[i]</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (pos1 <span class="op">&lt;</span> <span class="bu">len</span>(s1)) <span class="op">!=</span> (pos2 <span class="op">&lt;</span> <span class="bu">len</span>(s1)):  <span class="co"># From different strings</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> sa.lcp[i] <span class="op">&gt;</span> max_lcp:</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>                max_lcp <span class="op">=</span> sa.lcp[i]</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>                max_pos <span class="op">=</span> pos1</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> combined[max_pos:max_pos <span class="op">+</span> max_lcp]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="suffix-trees-suffix-arrays-on-steroids" class="level2" data-number="18.6">
<h2 data-number="18.6" class="anchored" data-anchor-id="suffix-trees-suffix-arrays-on-steroids"><span class="header-section-number">18.6</span> 10.6 Suffix Trees: Suffix Arrays on Steroids</h2>
<section id="whats-a-suffix-tree" class="level3" data-number="18.6.1">
<h3 data-number="18.6.1" class="anchored" data-anchor-id="whats-a-suffix-tree"><span class="header-section-number">18.6.1</span> 10.6.1 What’s a Suffix Tree?</h3>
<p>A <strong>suffix tree</strong> is like a suffix array, but in tree form. It’s a compressed trie of all suffixes.</p>
<p><strong>Key properties</strong>: - All suffixes of the text are paths from root to leaves - Each edge is labeled with a substring - Can be built in O(n) time! - Answers many queries in O(m) time (where m = pattern length)</p>
<p><strong>Example for “banana$”</strong>:</p>
<pre><code>                    root
               /     |      \
            $      a        na
                 / | \        |
               $  na$ na$    $
                   |   |
                  $   na$
                       |
                      $</code></pre>
</section>
<section id="when-to-use-suffix-trees-vs-arrays" class="level3" data-number="18.6.2">
<h3 data-number="18.6.2" class="anchored" data-anchor-id="when-to-use-suffix-trees-vs-arrays"><span class="header-section-number">18.6.2</span> 10.6.2 When to Use Suffix Trees vs Arrays</h3>
<p><strong>Suffix Trees</strong>: - ✅ Fastest queries: O(m) pattern matching - ✅ Supports many complex queries - ❌ More memory: O(n) space but with large constants - ❌ More complex to implement</p>
<p><strong>Suffix Arrays</strong>: - ✅ Less memory: just an array of integers - ✅ Simpler to implement and understand - ✅ Cache-friendly - ❌ Slower queries: O(m log n)</p>
<p><strong>Rule of thumb</strong>: Use suffix arrays unless you need the absolute fastest queries or very complex string operations.</p>
<p>(For brevity, we’ll focus on suffix arrays in our project, but know that suffix trees exist for when you need that extra speed!)</p>
</section>
</section>
<section id="applications-to-genomics" class="level2" data-number="18.7">
<h2 data-number="18.7" class="anchored" data-anchor-id="applications-to-genomics"><span class="header-section-number">18.7</span> 10.7 Applications to Genomics</h2>
<section id="dna-sequence-matching" class="level3" data-number="18.7.1">
<h3 data-number="18.7.1" class="anchored" data-anchor-id="dna-sequence-matching"><span class="header-section-number">18.7.1</span> 10.7.1 DNA Sequence Matching</h3>
<p>DNA is just a string over the alphabet {A, C, G, T}. String algorithms are perfect for:</p>
<p><strong>Finding genes</strong>:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_gene_markers(genome, start_codon<span class="op">=</span><span class="st">"ATG"</span>, stop_codons<span class="op">=</span>[<span class="st">"TAA"</span>, <span class="st">"TAG"</span>, <span class="st">"TGA"</span>]):</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Find potential genes (regions between start and stop codons)."""</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    sa <span class="op">=</span> SuffixArray(genome)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find all start positions</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    start_positions <span class="op">=</span> sa.search(start_codon)</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    genes <span class="op">=</span> []</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> start <span class="kw">in</span> start_positions:</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Look for nearest stop codon</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> stop_codon <span class="kw">in</span> stop_codons:</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>            positions <span class="op">=</span> sa.search(stop_codon)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Find first stop after start</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>            valid_stops <span class="op">=</span> [p <span class="cf">for</span> p <span class="kw">in</span> positions <span class="cf">if</span> p <span class="op">&gt;</span> start <span class="kw">and</span> (p <span class="op">-</span> start) <span class="op">%</span> <span class="dv">3</span> <span class="op">==</span> <span class="dv">0</span>]</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> valid_stops:</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>                stop <span class="op">=</span> <span class="bu">min</span>(valid_stops)</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> stop <span class="op">-</span> start <span class="op">&gt;=</span> <span class="dv">30</span>:  <span class="co"># Minimum gene length</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>                    genes.append((start, stop, genome[start:stop<span class="op">+</span><span class="dv">3</span>]))</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> genes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Detecting mutations</strong>:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_mutations(reference, sample, min_length<span class="op">=</span><span class="dv">10</span>):</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Find differences between reference and sample genomes."""</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Build suffix array for combined sequence</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    lcs <span class="op">=</span> longest_common_substring(reference, sample)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Regions not in LCS are potential mutations</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># (This is simplified - real mutation detection is more complex)</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> lcs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="read-alignment" class="level3" data-number="18.7.2">
<h3 data-number="18.7.2" class="anchored" data-anchor-id="read-alignment"><span class="header-section-number">18.7.2</span> 10.7.2 Read Alignment</h3>
<p>When sequencing DNA, you get millions of short “reads” (fragments). You need to align them to a reference genome.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ReadAligner:</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Align short DNA reads to a reference genome."""</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, reference):</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Build index of reference genome."""</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.reference <span class="op">=</span> reference</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.sa <span class="op">=</span> SuffixArray(reference <span class="op">+</span> <span class="st">'$'</span>)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> align_read(<span class="va">self</span>, read, max_mismatches<span class="op">=</span><span class="dv">2</span>):</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="co">        Find best alignment of read to reference.</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="co">        Allows up to max_mismatches differences.</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Try exact match first</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>        positions <span class="op">=</span> <span class="va">self</span>.sa.search(read)</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> positions:</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> [(pos, <span class="dv">0</span>) <span class="cf">for</span> pos <span class="kw">in</span> positions]  <span class="co"># (position, mismatches)</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Try with mismatches (simplified - real tools use more sophisticated methods)</span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>        results <span class="op">=</span> []</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>        n <span class="op">=</span> <span class="bu">len</span>(<span class="va">self</span>.reference)</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>        m <span class="op">=</span> <span class="bu">len</span>(read)</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n <span class="op">-</span> m <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>            mismatches <span class="op">=</span> <span class="bu">sum</span>(<span class="dv">1</span> <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(m) </span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>                           <span class="cf">if</span> <span class="va">self</span>.reference[i<span class="op">+</span>j] <span class="op">!=</span> read[j])</span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> mismatches <span class="op">&lt;=</span> max_mismatches:</span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>                results.append((i, mismatches))</span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">sorted</span>(results, key<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="dv">1</span>])[:<span class="dv">10</span>]  <span class="co"># Best 10 alignments</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="detecting-tandem-repeats" class="level3" data-number="18.7.3">
<h3 data-number="18.7.3" class="anchored" data-anchor-id="detecting-tandem-repeats"><span class="header-section-number">18.7.3</span> 10.7.3 Detecting Tandem Repeats</h3>
<p>Tandem repeats are patterns that repeat consecutively in DNA (like “CAGCAGCAG”).</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_tandem_repeats(genome, min_period<span class="op">=</span><span class="dv">2</span>, min_copies<span class="op">=</span><span class="dv">3</span>):</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Find tandem repeats in genome."""</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    repeats <span class="op">=</span> []</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="bu">len</span>(genome)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> period <span class="kw">in</span> <span class="bu">range</span>(min_period, n <span class="op">//</span> min_copies):</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>        i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> i <span class="op">&lt;</span> n <span class="op">-</span> period <span class="op">*</span> min_copies:</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Check if pattern repeats</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>            pattern <span class="op">=</span> genome[i:i<span class="op">+</span>period]</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>            copies <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>            j <span class="op">=</span> i <span class="op">+</span> period</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> j <span class="op">+</span> period <span class="op">&lt;=</span> n <span class="kw">and</span> genome[j:j<span class="op">+</span>period] <span class="op">==</span> pattern:</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>                copies <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>                j <span class="op">+=</span> period</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> copies <span class="op">&gt;=</span> min_copies:</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>                repeats.append({</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'position'</span>: i,</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'pattern'</span>: pattern,</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'copies'</span>: copies,</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'length'</span>: copies <span class="op">*</span> period</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>                })</span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>                i <span class="op">=</span> j</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>                i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> repeats</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="chapter-project-professional-string-processing-library" class="level2" data-number="18.8">
<h2 data-number="18.8" class="anchored" data-anchor-id="chapter-project-professional-string-processing-library"><span class="header-section-number">18.8</span> 10.8 Chapter Project: Professional String Processing Library</h2>
<p>Let’s build a comprehensive, production-ready string algorithm library!</p>
<section id="project-structure" class="level3" data-number="18.8.1">
<h3 data-number="18.8.1" class="anchored" data-anchor-id="project-structure"><span class="header-section-number">18.8.1</span> 10.8.1 Project Structure</h3>
<pre><code>StringAlgorithms/
├── stringalgo/
│   ├── __init__.py
│   ├── matchers/
│   │   ├── __init__.py
│   │   ├── kmp.py              # KMP implementation
│   │   ├── rabin_karp.py       # Rabin-Karp implementation
│   │   └── boyer_moore.py      # Bonus: Boyer-Moore
│   ├── suffix/
│   │   ├── __init__.py
│   │   ├── suffix_array.py     # Suffix array
│   │   └── lcp.py              # LCP array utilities
│   ├── applications/
│   │   ├── __init__.py
│   │   ├── genomics.py         # DNA/protein analysis
│   │   ├── compression.py      # BWT, LZ77
│   │   └── plagiarism.py       # Document comparison
│   └── utils/
│       ├── __init__.py
│       ├── alphabet.py         # Alphabet handling
│       └── visualization.py    # Pretty printing
├── tests/
│   ├── test_matchers.py
│   ├── test_suffix_array.py
│   └── test_applications.py
├── benchmarks/
│   ├── benchmark_search.py
│   └── generate_data.py
├── examples/
│   ├── dna_analysis.py
│   ├── text_search.py
│   └── compression_demo.py
├── docs/
│   ├── API.md
│   └── tutorial.md
├── setup.py
└── README.md</code></pre>
</section>
<section id="core-library-implementation" class="level3" data-number="18.8.2">
<h3 data-number="18.8.2" class="anchored" data-anchor-id="core-library-implementation"><span class="header-section-number">18.8.2</span> 10.8.2 Core Library Implementation</h3>
<div class="sourceCode" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># stringalgo/__init__.py</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co">StringAlgo: A comprehensive string algorithm library.</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co">Provides efficient implementations of:</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="co">- Pattern matching (KMP, Rabin-Karp, Boyer-Moore)</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="co">- Suffix arrays and LCP arrays</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="co">- Applications (genomics, compression, plagiarism detection)</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>__version__ <span class="op">=</span> <span class="st">"1.0.0"</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> .matchers <span class="im">import</span> KMPMatcher, RabinKarpMatcher</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> .suffix <span class="im">import</span> SuffixArray</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> .applications <span class="im">import</span> DNAAnalyzer, TextCompressor, PlagiarismDetector</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a><span class="va">__all__</span> <span class="op">=</span> [</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">'KMPMatcher'</span>,</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">'RabinKarpMatcher'</span>,</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">'SuffixArray'</span>,</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">'DNAAnalyzer'</span>,</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">'TextCompressor'</span>,</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">'PlagiarismDetector'</span>,</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># stringalgo/applications/genomics.py</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co">DNA and protein sequence analysis tools.</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ..suffix <span class="im">import</span> SuffixArray</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ..matchers <span class="im">import</span> KMPMatcher</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> List, Tuple, Dict</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> DNAAnalyzer:</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Comprehensive DNA sequence analysis."""</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Standard genetic code</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>    CODON_TABLE <span class="op">=</span> {</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">'ATA'</span>:<span class="st">'I'</span>, <span class="st">'ATC'</span>:<span class="st">'I'</span>, <span class="st">'ATT'</span>:<span class="st">'I'</span>, <span class="st">'ATG'</span>:<span class="st">'M'</span>,</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">'ACA'</span>:<span class="st">'T'</span>, <span class="st">'ACC'</span>:<span class="st">'T'</span>, <span class="st">'ACG'</span>:<span class="st">'T'</span>, <span class="st">'ACT'</span>:<span class="st">'T'</span>,</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">'AAC'</span>:<span class="st">'N'</span>, <span class="st">'AAT'</span>:<span class="st">'N'</span>, <span class="st">'AAA'</span>:<span class="st">'K'</span>, <span class="st">'AAG'</span>:<span class="st">'K'</span>,</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">'AGC'</span>:<span class="st">'S'</span>, <span class="st">'AGT'</span>:<span class="st">'S'</span>, <span class="st">'AGA'</span>:<span class="st">'R'</span>, <span class="st">'AGG'</span>:<span class="st">'R'</span>,</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">'CTA'</span>:<span class="st">'L'</span>, <span class="st">'CTC'</span>:<span class="st">'L'</span>, <span class="st">'CTG'</span>:<span class="st">'L'</span>, <span class="st">'CTT'</span>:<span class="st">'L'</span>,</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">'CCA'</span>:<span class="st">'P'</span>, <span class="st">'CCC'</span>:<span class="st">'P'</span>, <span class="st">'CCG'</span>:<span class="st">'P'</span>, <span class="st">'CCT'</span>:<span class="st">'P'</span>,</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">'CAC'</span>:<span class="st">'H'</span>, <span class="st">'CAT'</span>:<span class="st">'H'</span>, <span class="st">'CAA'</span>:<span class="st">'Q'</span>, <span class="st">'CAG'</span>:<span class="st">'Q'</span>,</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">'CGA'</span>:<span class="st">'R'</span>, <span class="st">'CGC'</span>:<span class="st">'R'</span>, <span class="st">'CGG'</span>:<span class="st">'R'</span>, <span class="st">'CGT'</span>:<span class="st">'R'</span>,</span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>        <span class="st">'GTA'</span>:<span class="st">'V'</span>, <span class="st">'GTC'</span>:<span class="st">'V'</span>, <span class="st">'GTG'</span>:<span class="st">'V'</span>, <span class="st">'GTT'</span>:<span class="st">'V'</span>,</span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>        <span class="st">'GCA'</span>:<span class="st">'A'</span>, <span class="st">'GCC'</span>:<span class="st">'A'</span>, <span class="st">'GCG'</span>:<span class="st">'A'</span>, <span class="st">'GCT'</span>:<span class="st">'A'</span>,</span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">'GAC'</span>:<span class="st">'D'</span>, <span class="st">'GAT'</span>:<span class="st">'D'</span>, <span class="st">'GAA'</span>:<span class="st">'E'</span>, <span class="st">'GAG'</span>:<span class="st">'E'</span>,</span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>        <span class="st">'GGA'</span>:<span class="st">'G'</span>, <span class="st">'GGC'</span>:<span class="st">'G'</span>, <span class="st">'GGG'</span>:<span class="st">'G'</span>, <span class="st">'GGT'</span>:<span class="st">'G'</span>,</span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">'TCA'</span>:<span class="st">'S'</span>, <span class="st">'TCC'</span>:<span class="st">'S'</span>, <span class="st">'TCG'</span>:<span class="st">'S'</span>, <span class="st">'TCT'</span>:<span class="st">'S'</span>,</span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>        <span class="st">'TTC'</span>:<span class="st">'F'</span>, <span class="st">'TTT'</span>:<span class="st">'F'</span>, <span class="st">'TTA'</span>:<span class="st">'L'</span>, <span class="st">'TTG'</span>:<span class="st">'L'</span>,</span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>        <span class="st">'TAC'</span>:<span class="st">'Y'</span>, <span class="st">'TAT'</span>:<span class="st">'Y'</span>, <span class="st">'TAA'</span>:<span class="st">'*'</span>, <span class="st">'TAG'</span>:<span class="st">'*'</span>,</span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>        <span class="st">'TGC'</span>:<span class="st">'C'</span>, <span class="st">'TGT'</span>:<span class="st">'C'</span>, <span class="st">'TGA'</span>:<span class="st">'*'</span>, <span class="st">'TGG'</span>:<span class="st">'W'</span>,</span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, sequence: <span class="bu">str</span>):</span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a><span class="co">        Initialize with DNA sequence.</span></span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a><span class="co">        Args:</span></span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a><span class="co">            sequence: DNA sequence (A, C, G, T)</span></span>
<span id="cb30-39"><a href="#cb30-39" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb30-40"><a href="#cb30-40" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.sequence <span class="op">=</span> sequence.upper()</span>
<span id="cb30-41"><a href="#cb30-41" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._validate_sequence()</span>
<span id="cb30-42"><a href="#cb30-42" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.suffix_array <span class="op">=</span> <span class="va">None</span></span>
<span id="cb30-43"><a href="#cb30-43" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-44"><a href="#cb30-44" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _validate_sequence(<span class="va">self</span>):</span>
<span id="cb30-45"><a href="#cb30-45" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Ensure sequence contains only valid DNA bases."""</span></span>
<span id="cb30-46"><a href="#cb30-46" aria-hidden="true" tabindex="-1"></a>        valid <span class="op">=</span> <span class="bu">set</span>(<span class="st">'ACGT'</span>)</span>
<span id="cb30-47"><a href="#cb30-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="bu">all</span>(c <span class="kw">in</span> valid <span class="cf">for</span> c <span class="kw">in</span> <span class="va">self</span>.sequence):</span>
<span id="cb30-48"><a href="#cb30-48" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"Invalid DNA sequence. Use only A, C, G, T"</span>)</span>
<span id="cb30-49"><a href="#cb30-49" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-50"><a href="#cb30-50" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> build_index(<span class="va">self</span>):</span>
<span id="cb30-51"><a href="#cb30-51" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Build suffix array index for fast queries."""</span></span>
<span id="cb30-52"><a href="#cb30-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.suffix_array <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb30-53"><a href="#cb30-53" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.suffix_array <span class="op">=</span> SuffixArray(<span class="va">self</span>.sequence <span class="op">+</span> <span class="st">'$'</span>)</span>
<span id="cb30-54"><a href="#cb30-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span></span>
<span id="cb30-55"><a href="#cb30-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-56"><a href="#cb30-56" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> translate(<span class="va">self</span>, start_pos<span class="op">=</span><span class="dv">0</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb30-57"><a href="#cb30-57" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb30-58"><a href="#cb30-58" aria-hidden="true" tabindex="-1"></a><span class="co">        Translate DNA to protein sequence.</span></span>
<span id="cb30-59"><a href="#cb30-59" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb30-60"><a href="#cb30-60" aria-hidden="true" tabindex="-1"></a><span class="co">        Args:</span></span>
<span id="cb30-61"><a href="#cb30-61" aria-hidden="true" tabindex="-1"></a><span class="co">            start_pos: Starting position (0-indexed)</span></span>
<span id="cb30-62"><a href="#cb30-62" aria-hidden="true" tabindex="-1"></a><span class="co">            </span></span>
<span id="cb30-63"><a href="#cb30-63" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns:</span></span>
<span id="cb30-64"><a href="#cb30-64" aria-hidden="true" tabindex="-1"></a><span class="co">            Protein sequence as string of amino acids</span></span>
<span id="cb30-65"><a href="#cb30-65" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb30-66"><a href="#cb30-66" aria-hidden="true" tabindex="-1"></a>        protein <span class="op">=</span> []</span>
<span id="cb30-67"><a href="#cb30-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(start_pos, <span class="bu">len</span>(<span class="va">self</span>.sequence) <span class="op">-</span> <span class="dv">2</span>, <span class="dv">3</span>):</span>
<span id="cb30-68"><a href="#cb30-68" aria-hidden="true" tabindex="-1"></a>            codon <span class="op">=</span> <span class="va">self</span>.sequence[i:i<span class="op">+</span><span class="dv">3</span>]</span>
<span id="cb30-69"><a href="#cb30-69" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(codon) <span class="op">==</span> <span class="dv">3</span>:</span>
<span id="cb30-70"><a href="#cb30-70" aria-hidden="true" tabindex="-1"></a>                amino_acid <span class="op">=</span> <span class="va">self</span>.CODON_TABLE.get(codon, <span class="st">'X'</span>)</span>
<span id="cb30-71"><a href="#cb30-71" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> amino_acid <span class="op">==</span> <span class="st">'*'</span>:  <span class="co"># Stop codon</span></span>
<span id="cb30-72"><a href="#cb30-72" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
<span id="cb30-73"><a href="#cb30-73" aria-hidden="true" tabindex="-1"></a>                protein.append(amino_acid)</span>
<span id="cb30-74"><a href="#cb30-74" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">''</span>.join(protein)</span>
<span id="cb30-75"><a href="#cb30-75" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-76"><a href="#cb30-76" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> find_orfs(<span class="va">self</span>, min_length<span class="op">=</span><span class="dv">30</span>) <span class="op">-&gt;</span> List[Dict]:</span>
<span id="cb30-77"><a href="#cb30-77" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb30-78"><a href="#cb30-78" aria-hidden="true" tabindex="-1"></a><span class="co">        Find Open Reading Frames (potential genes).</span></span>
<span id="cb30-79"><a href="#cb30-79" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb30-80"><a href="#cb30-80" aria-hidden="true" tabindex="-1"></a><span class="co">        An ORF is a sequence between start codon (ATG) and stop codon.</span></span>
<span id="cb30-81"><a href="#cb30-81" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb30-82"><a href="#cb30-82" aria-hidden="true" tabindex="-1"></a><span class="co">        Args:</span></span>
<span id="cb30-83"><a href="#cb30-83" aria-hidden="true" tabindex="-1"></a><span class="co">            min_length: Minimum ORF length in nucleotides</span></span>
<span id="cb30-84"><a href="#cb30-84" aria-hidden="true" tabindex="-1"></a><span class="co">            </span></span>
<span id="cb30-85"><a href="#cb30-85" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns:</span></span>
<span id="cb30-86"><a href="#cb30-86" aria-hidden="true" tabindex="-1"></a><span class="co">            List of ORFs with position, length, and protein sequence</span></span>
<span id="cb30-87"><a href="#cb30-87" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb30-88"><a href="#cb30-88" aria-hidden="true" tabindex="-1"></a>        start_codon <span class="op">=</span> <span class="st">"ATG"</span></span>
<span id="cb30-89"><a href="#cb30-89" aria-hidden="true" tabindex="-1"></a>        stop_codons <span class="op">=</span> {<span class="st">"TAA"</span>, <span class="st">"TAG"</span>, <span class="st">"TGA"</span>}</span>
<span id="cb30-90"><a href="#cb30-90" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-91"><a href="#cb30-91" aria-hidden="true" tabindex="-1"></a>        orfs <span class="op">=</span> []</span>
<span id="cb30-92"><a href="#cb30-92" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-93"><a href="#cb30-93" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Search in all three reading frames</span></span>
<span id="cb30-94"><a href="#cb30-94" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> frame <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb30-95"><a href="#cb30-95" aria-hidden="true" tabindex="-1"></a>            i <span class="op">=</span> frame</span>
<span id="cb30-96"><a href="#cb30-96" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> i <span class="op">&lt;</span> <span class="bu">len</span>(<span class="va">self</span>.sequence) <span class="op">-</span> <span class="dv">2</span>:</span>
<span id="cb30-97"><a href="#cb30-97" aria-hidden="true" tabindex="-1"></a>                codon <span class="op">=</span> <span class="va">self</span>.sequence[i:i<span class="op">+</span><span class="dv">3</span>]</span>
<span id="cb30-98"><a href="#cb30-98" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb30-99"><a href="#cb30-99" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> codon <span class="op">==</span> start_codon:</span>
<span id="cb30-100"><a href="#cb30-100" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># Found start, look for stop</span></span>
<span id="cb30-101"><a href="#cb30-101" aria-hidden="true" tabindex="-1"></a>                    start <span class="op">=</span> i</span>
<span id="cb30-102"><a href="#cb30-102" aria-hidden="true" tabindex="-1"></a>                    j <span class="op">=</span> i <span class="op">+</span> <span class="dv">3</span></span>
<span id="cb30-103"><a href="#cb30-103" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb30-104"><a href="#cb30-104" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">while</span> j <span class="op">&lt;</span> <span class="bu">len</span>(<span class="va">self</span>.sequence) <span class="op">-</span> <span class="dv">2</span>:</span>
<span id="cb30-105"><a href="#cb30-105" aria-hidden="true" tabindex="-1"></a>                        codon <span class="op">=</span> <span class="va">self</span>.sequence[j:j<span class="op">+</span><span class="dv">3</span>]</span>
<span id="cb30-106"><a href="#cb30-106" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> codon <span class="kw">in</span> stop_codons:</span>
<span id="cb30-107"><a href="#cb30-107" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># Found complete ORF</span></span>
<span id="cb30-108"><a href="#cb30-108" aria-hidden="true" tabindex="-1"></a>                            length <span class="op">=</span> j <span class="op">-</span> start <span class="op">+</span> <span class="dv">3</span></span>
<span id="cb30-109"><a href="#cb30-109" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> length <span class="op">&gt;=</span> min_length:</span>
<span id="cb30-110"><a href="#cb30-110" aria-hidden="true" tabindex="-1"></a>                                protein <span class="op">=</span> <span class="va">self</span>.translate(start)</span>
<span id="cb30-111"><a href="#cb30-111" aria-hidden="true" tabindex="-1"></a>                                orfs.append({</span>
<span id="cb30-112"><a href="#cb30-112" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">'start'</span>: start,</span>
<span id="cb30-113"><a href="#cb30-113" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">'end'</span>: j <span class="op">+</span> <span class="dv">3</span>,</span>
<span id="cb30-114"><a href="#cb30-114" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">'frame'</span>: frame,</span>
<span id="cb30-115"><a href="#cb30-115" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">'length'</span>: length,</span>
<span id="cb30-116"><a href="#cb30-116" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">'dna'</span>: <span class="va">self</span>.sequence[start:j<span class="op">+</span><span class="dv">3</span>],</span>
<span id="cb30-117"><a href="#cb30-117" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">'protein'</span>: protein</span>
<span id="cb30-118"><a href="#cb30-118" aria-hidden="true" tabindex="-1"></a>                                })</span>
<span id="cb30-119"><a href="#cb30-119" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">break</span></span>
<span id="cb30-120"><a href="#cb30-120" aria-hidden="true" tabindex="-1"></a>                        j <span class="op">+=</span> <span class="dv">3</span></span>
<span id="cb30-121"><a href="#cb30-121" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb30-122"><a href="#cb30-122" aria-hidden="true" tabindex="-1"></a>                    i <span class="op">=</span> j <span class="op">+</span> <span class="dv">3</span></span>
<span id="cb30-123"><a href="#cb30-123" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb30-124"><a href="#cb30-124" aria-hidden="true" tabindex="-1"></a>                    i <span class="op">+=</span> <span class="dv">3</span></span>
<span id="cb30-125"><a href="#cb30-125" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-126"><a href="#cb30-126" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">sorted</span>(orfs, key<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="st">'length'</span>], reverse<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb30-127"><a href="#cb30-127" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-128"><a href="#cb30-128" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> gc_content(<span class="va">self</span>, window_size<span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">float</span> <span class="kw">or</span> List[<span class="bu">float</span>]:</span>
<span id="cb30-129"><a href="#cb30-129" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb30-130"><a href="#cb30-130" aria-hidden="true" tabindex="-1"></a><span class="co">        Calculate GC content (percentage of G and C bases).</span></span>
<span id="cb30-131"><a href="#cb30-131" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb30-132"><a href="#cb30-132" aria-hidden="true" tabindex="-1"></a><span class="co">        Args:</span></span>
<span id="cb30-133"><a href="#cb30-133" aria-hidden="true" tabindex="-1"></a><span class="co">            window_size: If specified, return sliding window GC content</span></span>
<span id="cb30-134"><a href="#cb30-134" aria-hidden="true" tabindex="-1"></a><span class="co">            </span></span>
<span id="cb30-135"><a href="#cb30-135" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns:</span></span>
<span id="cb30-136"><a href="#cb30-136" aria-hidden="true" tabindex="-1"></a><span class="co">            Overall GC% or list of windowed GC%</span></span>
<span id="cb30-137"><a href="#cb30-137" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb30-138"><a href="#cb30-138" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> window_size <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb30-139"><a href="#cb30-139" aria-hidden="true" tabindex="-1"></a>            gc_count <span class="op">=</span> <span class="va">self</span>.sequence.count(<span class="st">'G'</span>) <span class="op">+</span> <span class="va">self</span>.sequence.count(<span class="st">'C'</span>)</span>
<span id="cb30-140"><a href="#cb30-140" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> (gc_count <span class="op">/</span> <span class="bu">len</span>(<span class="va">self</span>.sequence)) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb30-141"><a href="#cb30-141" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-142"><a href="#cb30-142" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Sliding window</span></span>
<span id="cb30-143"><a href="#cb30-143" aria-hidden="true" tabindex="-1"></a>        gc_values <span class="op">=</span> []</span>
<span id="cb30-144"><a href="#cb30-144" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(<span class="va">self</span>.sequence) <span class="op">-</span> window_size <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb30-145"><a href="#cb30-145" aria-hidden="true" tabindex="-1"></a>            window <span class="op">=</span> <span class="va">self</span>.sequence[i:i<span class="op">+</span>window_size]</span>
<span id="cb30-146"><a href="#cb30-146" aria-hidden="true" tabindex="-1"></a>            gc <span class="op">=</span> (window.count(<span class="st">'G'</span>) <span class="op">+</span> window.count(<span class="st">'C'</span>)) <span class="op">/</span> window_size <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb30-147"><a href="#cb30-147" aria-hidden="true" tabindex="-1"></a>            gc_values.append(gc)</span>
<span id="cb30-148"><a href="#cb30-148" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-149"><a href="#cb30-149" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> gc_values</span>
<span id="cb30-150"><a href="#cb30-150" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-151"><a href="#cb30-151" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> find_motif(<span class="va">self</span>, motif: <span class="bu">str</span>) <span class="op">-&gt;</span> List[<span class="bu">int</span>]:</span>
<span id="cb30-152"><a href="#cb30-152" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb30-153"><a href="#cb30-153" aria-hidden="true" tabindex="-1"></a><span class="co">        Find all occurrences of a DNA motif.</span></span>
<span id="cb30-154"><a href="#cb30-154" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb30-155"><a href="#cb30-155" aria-hidden="true" tabindex="-1"></a><span class="co">        Args:</span></span>
<span id="cb30-156"><a href="#cb30-156" aria-hidden="true" tabindex="-1"></a><span class="co">            motif: DNA sequence to search for</span></span>
<span id="cb30-157"><a href="#cb30-157" aria-hidden="true" tabindex="-1"></a><span class="co">            </span></span>
<span id="cb30-158"><a href="#cb30-158" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns:</span></span>
<span id="cb30-159"><a href="#cb30-159" aria-hidden="true" tabindex="-1"></a><span class="co">            List of starting positions</span></span>
<span id="cb30-160"><a href="#cb30-160" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb30-161"><a href="#cb30-161" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.suffix_array <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb30-162"><a href="#cb30-162" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Use KMP for one-time searches</span></span>
<span id="cb30-163"><a href="#cb30-163" aria-hidden="true" tabindex="-1"></a>            matcher <span class="op">=</span> KMPMatcher(motif.upper())</span>
<span id="cb30-164"><a href="#cb30-164" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> matcher.search(<span class="va">self</span>.sequence)</span>
<span id="cb30-165"><a href="#cb30-165" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb30-166"><a href="#cb30-166" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Use suffix array for indexed searches</span></span>
<span id="cb30-167"><a href="#cb30-167" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">self</span>.suffix_array.search(motif.upper())</span>
<span id="cb30-168"><a href="#cb30-168" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-169"><a href="#cb30-169" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> find_repeats(<span class="va">self</span>, min_length<span class="op">=</span><span class="dv">10</span>) <span class="op">-&gt;</span> List[Tuple[<span class="bu">str</span>, <span class="bu">int</span>]]:</span>
<span id="cb30-170"><a href="#cb30-170" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb30-171"><a href="#cb30-171" aria-hidden="true" tabindex="-1"></a><span class="co">        Find repeated sequences.</span></span>
<span id="cb30-172"><a href="#cb30-172" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb30-173"><a href="#cb30-173" aria-hidden="true" tabindex="-1"></a><span class="co">        Args:</span></span>
<span id="cb30-174"><a href="#cb30-174" aria-hidden="true" tabindex="-1"></a><span class="co">            min_length: Minimum repeat length</span></span>
<span id="cb30-175"><a href="#cb30-175" aria-hidden="true" tabindex="-1"></a><span class="co">            </span></span>
<span id="cb30-176"><a href="#cb30-176" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns:</span></span>
<span id="cb30-177"><a href="#cb30-177" aria-hidden="true" tabindex="-1"></a><span class="co">            List of (sequence, count) tuples</span></span>
<span id="cb30-178"><a href="#cb30-178" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb30-179"><a href="#cb30-179" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.suffix_array <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb30-180"><a href="#cb30-180" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.build_index()</span>
<span id="cb30-181"><a href="#cb30-181" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-182"><a href="#cb30-182" aria-hidden="true" tabindex="-1"></a>        repeats <span class="op">=</span> {}</span>
<span id="cb30-183"><a href="#cb30-183" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-184"><a href="#cb30-184" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Use LCP array to find repeats efficiently</span></span>
<span id="cb30-185"><a href="#cb30-185" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(<span class="va">self</span>.suffix_array.lcp)):</span>
<span id="cb30-186"><a href="#cb30-186" aria-hidden="true" tabindex="-1"></a>            lcp_len <span class="op">=</span> <span class="va">self</span>.suffix_array.lcp[i]</span>
<span id="cb30-187"><a href="#cb30-187" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> lcp_len <span class="op">&gt;=</span> min_length:</span>
<span id="cb30-188"><a href="#cb30-188" aria-hidden="true" tabindex="-1"></a>                pos <span class="op">=</span> <span class="va">self</span>.suffix_array.suffix_array[i]</span>
<span id="cb30-189"><a href="#cb30-189" aria-hidden="true" tabindex="-1"></a>                repeat <span class="op">=</span> <span class="va">self</span>.sequence[pos:pos<span class="op">+</span>lcp_len]</span>
<span id="cb30-190"><a href="#cb30-190" aria-hidden="true" tabindex="-1"></a>                repeats[repeat] <span class="op">=</span> repeats.get(repeat, <span class="dv">0</span>) <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb30-191"><a href="#cb30-191" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-192"><a href="#cb30-192" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">sorted</span>(repeats.items(), key<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="dv">1</span>], reverse<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb30-193"><a href="#cb30-193" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-194"><a href="#cb30-194" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> complement(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb30-195"><a href="#cb30-195" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Return complement strand."""</span></span>
<span id="cb30-196"><a href="#cb30-196" aria-hidden="true" tabindex="-1"></a>        comp <span class="op">=</span> {<span class="st">'A'</span>: <span class="st">'T'</span>, <span class="st">'T'</span>: <span class="st">'A'</span>, <span class="st">'C'</span>: <span class="st">'G'</span>, <span class="st">'G'</span>: <span class="st">'C'</span>}</span>
<span id="cb30-197"><a href="#cb30-197" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">''</span>.join(comp[base] <span class="cf">for</span> base <span class="kw">in</span> <span class="va">self</span>.sequence)</span>
<span id="cb30-198"><a href="#cb30-198" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-199"><a href="#cb30-199" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> reverse_complement(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb30-200"><a href="#cb30-200" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Return reverse complement (other DNA strand)."""</span></span>
<span id="cb30-201"><a href="#cb30-201" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.complement()[::<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb30-202"><a href="#cb30-202" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-203"><a href="#cb30-203" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> find_palindromes(<span class="va">self</span>, min_length<span class="op">=</span><span class="dv">6</span>) <span class="op">-&gt;</span> List[Tuple[<span class="bu">int</span>, <span class="bu">int</span>, <span class="bu">str</span>]]:</span>
<span id="cb30-204"><a href="#cb30-204" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb30-205"><a href="#cb30-205" aria-hidden="true" tabindex="-1"></a><span class="co">        Find palindromic sequences (restriction sites).</span></span>
<span id="cb30-206"><a href="#cb30-206" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb30-207"><a href="#cb30-207" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns:</span></span>
<span id="cb30-208"><a href="#cb30-208" aria-hidden="true" tabindex="-1"></a><span class="co">            List of (start, end, sequence) tuples</span></span>
<span id="cb30-209"><a href="#cb30-209" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb30-210"><a href="#cb30-210" aria-hidden="true" tabindex="-1"></a>        palindromes <span class="op">=</span> []</span>
<span id="cb30-211"><a href="#cb30-211" aria-hidden="true" tabindex="-1"></a>        rc <span class="op">=</span> <span class="va">self</span>.reverse_complement()</span>
<span id="cb30-212"><a href="#cb30-212" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-213"><a href="#cb30-213" aria-hidden="true" tabindex="-1"></a>        <span class="co"># A palindrome in DNA means sequence equals its reverse complement</span></span>
<span id="cb30-214"><a href="#cb30-214" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> length <span class="kw">in</span> <span class="bu">range</span>(min_length, <span class="bu">min</span>(<span class="dv">50</span>, <span class="bu">len</span>(<span class="va">self</span>.sequence) <span class="op">//</span> <span class="dv">2</span>)):</span>
<span id="cb30-215"><a href="#cb30-215" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(<span class="va">self</span>.sequence) <span class="op">-</span> length <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb30-216"><a href="#cb30-216" aria-hidden="true" tabindex="-1"></a>                seq <span class="op">=</span> <span class="va">self</span>.sequence[i:i<span class="op">+</span>length]</span>
<span id="cb30-217"><a href="#cb30-217" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> seq <span class="op">==</span> rc[<span class="op">-</span>(i<span class="op">+</span>length):<span class="op">-</span>i <span class="cf">if</span> i <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="va">None</span>]:</span>
<span id="cb30-218"><a href="#cb30-218" aria-hidden="true" tabindex="-1"></a>                    palindromes.append((i, i<span class="op">+</span>length, seq))</span>
<span id="cb30-219"><a href="#cb30-219" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-220"><a href="#cb30-220" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> palindromes</span>
<span id="cb30-221"><a href="#cb30-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-222"><a href="#cb30-222" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage</span></span>
<span id="cb30-223"><a href="#cb30-223" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> example_dna_analysis():</span>
<span id="cb30-224"><a href="#cb30-224" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Comprehensive DNA analysis example."""</span></span>
<span id="cb30-225"><a href="#cb30-225" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-226"><a href="#cb30-226" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample DNA sequence (part of human beta-globin gene)</span></span>
<span id="cb30-227"><a href="#cb30-227" aria-hidden="true" tabindex="-1"></a>    dna <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb30-228"><a href="#cb30-228" aria-hidden="true" tabindex="-1"></a><span class="st">    ATGGTGCACCTGACTCCTGAGGAGAAGTCTGCCGTTACTGCCCTGTGGGGCAAGGTGAACGTGGATGAAGTTGGTGGTGAGGCCCTGGGCAGG</span></span>
<span id="cb30-229"><a href="#cb30-229" aria-hidden="true" tabindex="-1"></a><span class="st">    TTGGTATCAAGGTTACAAGACAGGTTTAAGGAGACCAATAGAAACTGGGCATGTGGAGACAGAGAAGACTCTTGGGTTTCTGATAGGCACTGACTCTCTCTGCCTATTGGTCTATTTTCCCACCCTTAGG</span></span>
<span id="cb30-230"><a href="#cb30-230" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb30-231"><a href="#cb30-231" aria-hidden="true" tabindex="-1"></a>    dna <span class="op">=</span> <span class="st">''</span>.join(dna.split())  <span class="co"># Remove whitespace</span></span>
<span id="cb30-232"><a href="#cb30-232" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-233"><a href="#cb30-233" aria-hidden="true" tabindex="-1"></a>    analyzer <span class="op">=</span> DNAAnalyzer(dna)</span>
<span id="cb30-234"><a href="#cb30-234" aria-hidden="true" tabindex="-1"></a>    analyzer.build_index()</span>
<span id="cb30-235"><a href="#cb30-235" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-236"><a href="#cb30-236" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"=== DNA Analysis ===</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb30-237"><a href="#cb30-237" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Sequence length: </span><span class="sc">{</span><span class="bu">len</span>(dna)<span class="sc">}</span><span class="ss"> bp"</span>)</span>
<span id="cb30-238"><a href="#cb30-238" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"GC content: </span><span class="sc">{</span>analyzer<span class="sc">.</span>gc_content()<span class="sc">:.1f}</span><span class="ss">%</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb30-239"><a href="#cb30-239" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-240"><a href="#cb30-240" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find ORFs</span></span>
<span id="cb30-241"><a href="#cb30-241" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Open Reading Frames:"</span>)</span>
<span id="cb30-242"><a href="#cb30-242" aria-hidden="true" tabindex="-1"></a>    orfs <span class="op">=</span> analyzer.find_orfs(min_length<span class="op">=</span><span class="dv">30</span>)</span>
<span id="cb30-243"><a href="#cb30-243" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, orf <span class="kw">in</span> <span class="bu">enumerate</span>(orfs[:<span class="dv">3</span>], <span class="dv">1</span>):</span>
<span id="cb30-244"><a href="#cb30-244" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">ORF </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb30-245"><a href="#cb30-245" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  Position: </span><span class="sc">{</span>orf[<span class="st">'start'</span>]<span class="sc">}</span><span class="ss">-</span><span class="sc">{</span>orf[<span class="st">'end'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb30-246"><a href="#cb30-246" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  Length: </span><span class="sc">{</span>orf[<span class="st">'length'</span>]<span class="sc">}</span><span class="ss"> bp"</span>)</span>
<span id="cb30-247"><a href="#cb30-247" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  Protein: </span><span class="sc">{</span>orf[<span class="st">'protein'</span>][:<span class="dv">50</span>]<span class="sc">}</span><span class="ss">..."</span>)</span>
<span id="cb30-248"><a href="#cb30-248" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-249"><a href="#cb30-249" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find motifs</span></span>
<span id="cb30-250"><a href="#cb30-250" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n\n</span><span class="st">Motif Search:"</span>)</span>
<span id="cb30-251"><a href="#cb30-251" aria-hidden="true" tabindex="-1"></a>    motifs <span class="op">=</span> [<span class="st">"ATG"</span>, <span class="st">"TAA"</span>, <span class="st">"GCC"</span>]</span>
<span id="cb30-252"><a href="#cb30-252" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> motif <span class="kw">in</span> motifs:</span>
<span id="cb30-253"><a href="#cb30-253" aria-hidden="true" tabindex="-1"></a>        positions <span class="op">=</span> analyzer.find_motif(motif)</span>
<span id="cb30-254"><a href="#cb30-254" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>motif<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="bu">len</span>(positions)<span class="sc">}</span><span class="ss"> occurrences"</span>)</span>
<span id="cb30-255"><a href="#cb30-255" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-256"><a href="#cb30-256" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find repeats</span></span>
<span id="cb30-257"><a href="#cb30-257" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n\n</span><span class="st">Repeated Sequences:"</span>)</span>
<span id="cb30-258"><a href="#cb30-258" aria-hidden="true" tabindex="-1"></a>    repeats <span class="op">=</span> analyzer.find_repeats(min_length<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb30-259"><a href="#cb30-259" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> seq, count <span class="kw">in</span> repeats[:<span class="dv">5</span>]:</span>
<span id="cb30-260"><a href="#cb30-260" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>seq<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>count<span class="sc">}</span><span class="ss"> times"</span>)</span>
<span id="cb30-261"><a href="#cb30-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-262"><a href="#cb30-262" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>:</span>
<span id="cb30-263"><a href="#cb30-263" aria-hidden="true" tabindex="-1"></a>    example_dna_analysis()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="text-compression-application" class="level3" data-number="18.8.3">
<h3 data-number="18.8.3" class="anchored" data-anchor-id="text-compression-application"><span class="header-section-number">18.8.3</span> 10.8.3 Text Compression Application</h3>
<div class="sourceCode" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># stringalgo/applications/compression.py</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co">Text compression using string algorithms.</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ..suffix <span class="im">import</span> SuffixArray</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Tuple, List</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> TextCompressor:</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Text compression using Burrows-Wheeler Transform and Move-To-Front."""</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> bwt_encode(text: <span class="bu">str</span>) <span class="op">-&gt;</span> Tuple[<span class="bu">str</span>, <span class="bu">int</span>]:</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a><span class="co">        Burrows-Wheeler Transform encoding.</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns:</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a><span class="co">            (transformed_text, original_index)</span></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> text <span class="kw">or</span> text[<span class="op">-</span><span class="dv">1</span>] <span class="op">!=</span> <span class="st">'$'</span>:</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>            text <span class="op">=</span> text <span class="op">+</span> <span class="st">'$'</span></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>        sa <span class="op">=</span> SuffixArray(text)</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># BWT is last column of sorted rotations</span></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>        bwt <span class="op">=</span> <span class="st">''</span>.join(text[(pos <span class="op">-</span> <span class="dv">1</span>) <span class="op">%</span> <span class="bu">len</span>(text)] </span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>                     <span class="cf">for</span> pos <span class="kw">in</span> sa.suffix_array)</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Find position of original string</span></span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>        original_idx <span class="op">=</span> sa.suffix_array.index(<span class="dv">0</span>)</span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> bwt, original_idx</span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> bwt_decode(bwt: <span class="bu">str</span>, original_idx: <span class="bu">int</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Decode Burrows-Wheeler Transform."""</span></span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a>        n <span class="op">=</span> <span class="bu">len</span>(bwt)</span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create table of (char, original_index) pairs</span></span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a>        table <span class="op">=</span> <span class="bu">sorted</span>((bwt[i], i) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n))</span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Follow the links</span></span>
<span id="cb31-43"><a href="#cb31-43" aria-hidden="true" tabindex="-1"></a>        result <span class="op">=</span> []</span>
<span id="cb31-44"><a href="#cb31-44" aria-hidden="true" tabindex="-1"></a>        idx <span class="op">=</span> original_idx</span>
<span id="cb31-45"><a href="#cb31-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(n):</span>
<span id="cb31-46"><a href="#cb31-46" aria-hidden="true" tabindex="-1"></a>            char, idx <span class="op">=</span> table[idx]</span>
<span id="cb31-47"><a href="#cb31-47" aria-hidden="true" tabindex="-1"></a>            result.append(char)</span>
<span id="cb31-48"><a href="#cb31-48" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb31-49"><a href="#cb31-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">''</span>.join(result).rstrip(<span class="st">'$'</span>)</span>
<span id="cb31-50"><a href="#cb31-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-51"><a href="#cb31-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb31-52"><a href="#cb31-52" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> mtf_encode(text: <span class="bu">str</span>) <span class="op">-&gt;</span> List[<span class="bu">int</span>]:</span>
<span id="cb31-53"><a href="#cb31-53" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb31-54"><a href="#cb31-54" aria-hidden="true" tabindex="-1"></a><span class="co">        Move-To-Front encoding.</span></span>
<span id="cb31-55"><a href="#cb31-55" aria-hidden="true" tabindex="-1"></a><span class="co">        Works well after BWT as it clusters repeated characters.</span></span>
<span id="cb31-56"><a href="#cb31-56" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb31-57"><a href="#cb31-57" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Initialize alphabet in order</span></span>
<span id="cb31-58"><a href="#cb31-58" aria-hidden="true" tabindex="-1"></a>        alphabet <span class="op">=</span> <span class="bu">list</span>(<span class="bu">set</span>(text))</span>
<span id="cb31-59"><a href="#cb31-59" aria-hidden="true" tabindex="-1"></a>        alphabet.sort()</span>
<span id="cb31-60"><a href="#cb31-60" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb31-61"><a href="#cb31-61" aria-hidden="true" tabindex="-1"></a>        encoded <span class="op">=</span> []</span>
<span id="cb31-62"><a href="#cb31-62" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> char <span class="kw">in</span> text:</span>
<span id="cb31-63"><a href="#cb31-63" aria-hidden="true" tabindex="-1"></a>            idx <span class="op">=</span> alphabet.index(char)</span>
<span id="cb31-64"><a href="#cb31-64" aria-hidden="true" tabindex="-1"></a>            encoded.append(idx)</span>
<span id="cb31-65"><a href="#cb31-65" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb31-66"><a href="#cb31-66" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Move character to front</span></span>
<span id="cb31-67"><a href="#cb31-67" aria-hidden="true" tabindex="-1"></a>            alphabet.pop(idx)</span>
<span id="cb31-68"><a href="#cb31-68" aria-hidden="true" tabindex="-1"></a>            alphabet.insert(<span class="dv">0</span>, char)</span>
<span id="cb31-69"><a href="#cb31-69" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb31-70"><a href="#cb31-70" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> encoded</span>
<span id="cb31-71"><a href="#cb31-71" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-72"><a href="#cb31-72" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb31-73"><a href="#cb31-73" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> mtf_decode(encoded: List[<span class="bu">int</span>], alphabet: List[<span class="bu">str</span>]) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb31-74"><a href="#cb31-74" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Decode Move-To-Front encoding."""</span></span>
<span id="cb31-75"><a href="#cb31-75" aria-hidden="true" tabindex="-1"></a>        alphabet <span class="op">=</span> alphabet.copy()</span>
<span id="cb31-76"><a href="#cb31-76" aria-hidden="true" tabindex="-1"></a>        decoded <span class="op">=</span> []</span>
<span id="cb31-77"><a href="#cb31-77" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb31-78"><a href="#cb31-78" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx <span class="kw">in</span> encoded:</span>
<span id="cb31-79"><a href="#cb31-79" aria-hidden="true" tabindex="-1"></a>            char <span class="op">=</span> alphabet[idx]</span>
<span id="cb31-80"><a href="#cb31-80" aria-hidden="true" tabindex="-1"></a>            decoded.append(char)</span>
<span id="cb31-81"><a href="#cb31-81" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb31-82"><a href="#cb31-82" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Move to front</span></span>
<span id="cb31-83"><a href="#cb31-83" aria-hidden="true" tabindex="-1"></a>            alphabet.pop(idx)</span>
<span id="cb31-84"><a href="#cb31-84" aria-hidden="true" tabindex="-1"></a>            alphabet.insert(<span class="dv">0</span>, char)</span>
<span id="cb31-85"><a href="#cb31-85" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb31-86"><a href="#cb31-86" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">''</span>.join(decoded)</span>
<span id="cb31-87"><a href="#cb31-87" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-88"><a href="#cb31-88" aria-hidden="true" tabindex="-1"></a>    <span class="at">@classmethod</span></span>
<span id="cb31-89"><a href="#cb31-89" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> compress(cls, text: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">dict</span>:</span>
<span id="cb31-90"><a href="#cb31-90" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb31-91"><a href="#cb31-91" aria-hidden="true" tabindex="-1"></a><span class="co">        Full compression pipeline: BWT + MTF + RLE.</span></span>
<span id="cb31-92"><a href="#cb31-92" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb31-93"><a href="#cb31-93" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns:</span></span>
<span id="cb31-94"><a href="#cb31-94" aria-hidden="true" tabindex="-1"></a><span class="co">            Dictionary with compressed data and metadata</span></span>
<span id="cb31-95"><a href="#cb31-95" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb31-96"><a href="#cb31-96" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Step 1: BWT</span></span>
<span id="cb31-97"><a href="#cb31-97" aria-hidden="true" tabindex="-1"></a>        bwt, orig_idx <span class="op">=</span> cls.bwt_encode(text)</span>
<span id="cb31-98"><a href="#cb31-98" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb31-99"><a href="#cb31-99" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Step 2: MTF</span></span>
<span id="cb31-100"><a href="#cb31-100" aria-hidden="true" tabindex="-1"></a>        alphabet <span class="op">=</span> <span class="bu">sorted</span>(<span class="bu">set</span>(text <span class="op">+</span> <span class="st">'$'</span>))</span>
<span id="cb31-101"><a href="#cb31-101" aria-hidden="true" tabindex="-1"></a>        mtf <span class="op">=</span> cls.mtf_encode(bwt)</span>
<span id="cb31-102"><a href="#cb31-102" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb31-103"><a href="#cb31-103" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Step 3: Run-Length Encoding of MTF output</span></span>
<span id="cb31-104"><a href="#cb31-104" aria-hidden="true" tabindex="-1"></a>        rle <span class="op">=</span> []</span>
<span id="cb31-105"><a href="#cb31-105" aria-hidden="true" tabindex="-1"></a>        i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb31-106"><a href="#cb31-106" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> i <span class="op">&lt;</span> <span class="bu">len</span>(mtf):</span>
<span id="cb31-107"><a href="#cb31-107" aria-hidden="true" tabindex="-1"></a>            count <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb31-108"><a href="#cb31-108" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> i <span class="op">+</span> count <span class="op">&lt;</span> <span class="bu">len</span>(mtf) <span class="kw">and</span> mtf[i <span class="op">+</span> count] <span class="op">==</span> mtf[i]:</span>
<span id="cb31-109"><a href="#cb31-109" aria-hidden="true" tabindex="-1"></a>                count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb31-110"><a href="#cb31-110" aria-hidden="true" tabindex="-1"></a>            rle.append((mtf[i], count))</span>
<span id="cb31-111"><a href="#cb31-111" aria-hidden="true" tabindex="-1"></a>            i <span class="op">+=</span> count</span>
<span id="cb31-112"><a href="#cb31-112" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb31-113"><a href="#cb31-113" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb31-114"><a href="#cb31-114" aria-hidden="true" tabindex="-1"></a>            <span class="st">'rle'</span>: rle,</span>
<span id="cb31-115"><a href="#cb31-115" aria-hidden="true" tabindex="-1"></a>            <span class="st">'alphabet'</span>: alphabet,</span>
<span id="cb31-116"><a href="#cb31-116" aria-hidden="true" tabindex="-1"></a>            <span class="st">'original_idx'</span>: orig_idx,</span>
<span id="cb31-117"><a href="#cb31-117" aria-hidden="true" tabindex="-1"></a>            <span class="st">'original_length'</span>: <span class="bu">len</span>(text)</span>
<span id="cb31-118"><a href="#cb31-118" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb31-119"><a href="#cb31-119" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-120"><a href="#cb31-120" aria-hidden="true" tabindex="-1"></a>    <span class="at">@classmethod</span></span>
<span id="cb31-121"><a href="#cb31-121" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> decompress(cls, compressed: <span class="bu">dict</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb31-122"><a href="#cb31-122" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Decompress data."""</span></span>
<span id="cb31-123"><a href="#cb31-123" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Decode RLE</span></span>
<span id="cb31-124"><a href="#cb31-124" aria-hidden="true" tabindex="-1"></a>        mtf <span class="op">=</span> []</span>
<span id="cb31-125"><a href="#cb31-125" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> value, count <span class="kw">in</span> compressed[<span class="st">'rle'</span>]:</span>
<span id="cb31-126"><a href="#cb31-126" aria-hidden="true" tabindex="-1"></a>            mtf.extend([value] <span class="op">*</span> count)</span>
<span id="cb31-127"><a href="#cb31-127" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb31-128"><a href="#cb31-128" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Decode MTF</span></span>
<span id="cb31-129"><a href="#cb31-129" aria-hidden="true" tabindex="-1"></a>        bwt <span class="op">=</span> cls.mtf_decode(mtf, compressed[<span class="st">'alphabet'</span>])</span>
<span id="cb31-130"><a href="#cb31-130" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb31-131"><a href="#cb31-131" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Decode BWT</span></span>
<span id="cb31-132"><a href="#cb31-132" aria-hidden="true" tabindex="-1"></a>        text <span class="op">=</span> cls.bwt_decode(bwt, compressed[<span class="st">'original_idx'</span>])</span>
<span id="cb31-133"><a href="#cb31-133" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb31-134"><a href="#cb31-134" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> text</span>
<span id="cb31-135"><a href="#cb31-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-136"><a href="#cb31-136" aria-hidden="true" tabindex="-1"></a><span class="co"># Example</span></span>
<span id="cb31-137"><a href="#cb31-137" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> example_compression():</span>
<span id="cb31-138"><a href="#cb31-138" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Demonstrate text compression."""</span></span>
<span id="cb31-139"><a href="#cb31-139" aria-hidden="true" tabindex="-1"></a>    text <span class="op">=</span> <span class="st">"banana"</span> <span class="op">*</span> <span class="dv">100</span>  <span class="co"># Highly repetitive</span></span>
<span id="cb31-140"><a href="#cb31-140" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-141"><a href="#cb31-141" aria-hidden="true" tabindex="-1"></a>    compressor <span class="op">=</span> TextCompressor()</span>
<span id="cb31-142"><a href="#cb31-142" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-143"><a href="#cb31-143" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Original text: </span><span class="sc">{</span><span class="bu">len</span>(text)<span class="sc">}</span><span class="ss"> characters"</span>)</span>
<span id="cb31-144"><a href="#cb31-144" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Sample: </span><span class="sc">{</span>text[:<span class="dv">50</span>]<span class="sc">}</span><span class="ss">...</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb31-145"><a href="#cb31-145" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-146"><a href="#cb31-146" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compress</span></span>
<span id="cb31-147"><a href="#cb31-147" aria-hidden="true" tabindex="-1"></a>    compressed <span class="op">=</span> compressor.compress(text)</span>
<span id="cb31-148"><a href="#cb31-148" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-149"><a href="#cb31-149" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Estimate compressed size (rough)</span></span>
<span id="cb31-150"><a href="#cb31-150" aria-hidden="true" tabindex="-1"></a>    compressed_size <span class="op">=</span> <span class="bu">len</span>(compressed[<span class="st">'rle'</span>]) <span class="op">*</span> <span class="dv">2</span>  <span class="co"># (value, count) pairs</span></span>
<span id="cb31-151"><a href="#cb31-151" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-152"><a href="#cb31-152" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Compressed: ~</span><span class="sc">{</span>compressed_size<span class="sc">}</span><span class="ss"> units"</span>)</span>
<span id="cb31-153"><a href="#cb31-153" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Compression ratio: </span><span class="sc">{</span><span class="bu">len</span>(text) <span class="op">/</span> compressed_size<span class="sc">:.2f}</span><span class="ss">x</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb31-154"><a href="#cb31-154" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-155"><a href="#cb31-155" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Decompress</span></span>
<span id="cb31-156"><a href="#cb31-156" aria-hidden="true" tabindex="-1"></a>    decompressed <span class="op">=</span> compressor.decompress(compressed)</span>
<span id="cb31-157"><a href="#cb31-157" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-158"><a href="#cb31-158" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Verify</span></span>
<span id="cb31-159"><a href="#cb31-159" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> decompressed <span class="op">==</span> text, <span class="st">"Compression/decompression failed!"</span></span>
<span id="cb31-160"><a href="#cb31-160" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"✓ Compression successful and reversible"</span>)</span>
<span id="cb31-161"><a href="#cb31-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-162"><a href="#cb31-162" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>:</span>
<span id="cb31-163"><a href="#cb31-163" aria-hidden="true" tabindex="-1"></a>    example_compression()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="command-line-tool" class="level3" data-number="18.8.4">
<h3 data-number="18.8.4" class="anchored" data-anchor-id="command-line-tool"><span class="header-section-number">18.8.4</span> 10.8.4 Command-Line Tool</h3>
<div class="sourceCode" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># stringalgo/cli.py</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="co">Command-line interface for StringAlgo library.</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> argparse</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> . <span class="im">import</span> KMPMatcher, RabinKarpMatcher, SuffixArray</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> .applications <span class="im">import</span> DNAAnalyzer, TextCompressor, PlagiarismDetector</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> cmd_search(args):</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Search for pattern in text file."""</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(args.text, <span class="st">'r'</span>) <span class="im">as</span> f:</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>        text <span class="op">=</span> f.read()</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> args.algorithm <span class="op">==</span> <span class="st">'kmp'</span>:</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>        matcher <span class="op">=</span> KMPMatcher(args.pattern)</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>        positions <span class="op">=</span> matcher.search(text)</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> args.algorithm <span class="op">==</span> <span class="st">'rk'</span>:</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>        matcher <span class="op">=</span> RabinKarpMatcher()</span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>        positions <span class="op">=</span> matcher.search(text, args.pattern)</span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:  <span class="co"># suffix array</span></span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>        sa <span class="op">=</span> SuffixArray(text)</span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>        positions <span class="op">=</span> sa.search(args.pattern)</span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Found </span><span class="sc">{</span><span class="bu">len</span>(positions)<span class="sc">}</span><span class="ss"> occurrences:"</span>)</span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> pos <span class="kw">in</span> positions[:args.max_results]:</span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Show context</span></span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>        start <span class="op">=</span> <span class="bu">max</span>(<span class="dv">0</span>, pos <span class="op">-</span> <span class="dv">20</span>)</span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a>        end <span class="op">=</span> <span class="bu">min</span>(<span class="bu">len</span>(text), pos <span class="op">+</span> <span class="bu">len</span>(args.pattern) <span class="op">+</span> <span class="dv">20</span>)</span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a>        context <span class="op">=</span> text[start:end]</span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  Position </span><span class="sc">{</span>pos<span class="sc">}</span><span class="ss">: ...</span><span class="sc">{</span>context<span class="sc">}</span><span class="ss">..."</span>)</span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> cmd_dna(args):</span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Analyze DNA sequence."""</span></span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(args.<span class="bu">input</span>, <span class="st">'r'</span>) <span class="im">as</span> f:</span>
<span id="cb32-39"><a href="#cb32-39" aria-hidden="true" tabindex="-1"></a>        sequence <span class="op">=</span> <span class="st">''</span>.join(line.strip() <span class="cf">for</span> line <span class="kw">in</span> f <span class="cf">if</span> <span class="kw">not</span> line.startswith(<span class="st">'&gt;'</span>))</span>
<span id="cb32-40"><a href="#cb32-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-41"><a href="#cb32-41" aria-hidden="true" tabindex="-1"></a>    analyzer <span class="op">=</span> DNAAnalyzer(sequence)</span>
<span id="cb32-42"><a href="#cb32-42" aria-hidden="true" tabindex="-1"></a>    analyzer.build_index()</span>
<span id="cb32-43"><a href="#cb32-43" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-44"><a href="#cb32-44" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Sequence length: </span><span class="sc">{</span><span class="bu">len</span>(sequence)<span class="sc">}</span><span class="ss"> bp"</span>)</span>
<span id="cb32-45"><a href="#cb32-45" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"GC content: </span><span class="sc">{</span>analyzer<span class="sc">.</span>gc_content()<span class="sc">:.1f}</span><span class="ss">%"</span>)</span>
<span id="cb32-46"><a href="#cb32-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-47"><a href="#cb32-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> args.orfs:</span>
<span id="cb32-48"><a href="#cb32-48" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Open Reading Frames:"</span>)</span>
<span id="cb32-49"><a href="#cb32-49" aria-hidden="true" tabindex="-1"></a>        orfs <span class="op">=</span> analyzer.find_orfs()</span>
<span id="cb32-50"><a href="#cb32-50" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, orf <span class="kw">in</span> <span class="bu">enumerate</span>(orfs[:<span class="dv">10</span>], <span class="dv">1</span>):</span>
<span id="cb32-51"><a href="#cb32-51" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">. Position </span><span class="sc">{</span>orf[<span class="st">'start'</span>]<span class="sc">}</span><span class="ss">-</span><span class="sc">{</span>orf[<span class="st">'end'</span>]<span class="sc">}</span><span class="ss">, "</span></span>
<span id="cb32-52"><a href="#cb32-52" aria-hidden="true" tabindex="-1"></a>                  <span class="ss">f"Length: </span><span class="sc">{</span>orf[<span class="st">'length'</span>]<span class="sc">}</span><span class="ss"> bp"</span>)</span>
<span id="cb32-53"><a href="#cb32-53" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-54"><a href="#cb32-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> args.motif:</span>
<span id="cb32-55"><a href="#cb32-55" aria-hidden="true" tabindex="-1"></a>        positions <span class="op">=</span> analyzer.find_motif(args.motif)</span>
<span id="cb32-56"><a href="#cb32-56" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Motif '</span><span class="sc">{</span>args<span class="sc">.</span>motif<span class="sc">}</span><span class="ss">': </span><span class="sc">{</span><span class="bu">len</span>(positions)<span class="sc">}</span><span class="ss"> occurrences"</span>)</span>
<span id="cb32-57"><a href="#cb32-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-58"><a href="#cb32-58" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> cmd_compress(args):</span>
<span id="cb32-59"><a href="#cb32-59" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Compress text file."""</span></span>
<span id="cb32-60"><a href="#cb32-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(args.<span class="bu">input</span>, <span class="st">'r'</span>) <span class="im">as</span> f:</span>
<span id="cb32-61"><a href="#cb32-61" aria-hidden="true" tabindex="-1"></a>        text <span class="op">=</span> f.read()</span>
<span id="cb32-62"><a href="#cb32-62" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-63"><a href="#cb32-63" aria-hidden="true" tabindex="-1"></a>    compressor <span class="op">=</span> TextCompressor()</span>
<span id="cb32-64"><a href="#cb32-64" aria-hidden="true" tabindex="-1"></a>    compressed <span class="op">=</span> compressor.compress(text)</span>
<span id="cb32-65"><a href="#cb32-65" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-66"><a href="#cb32-66" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Save compressed data</span></span>
<span id="cb32-67"><a href="#cb32-67" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> pickle</span>
<span id="cb32-68"><a href="#cb32-68" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(args.output, <span class="st">'wb'</span>) <span class="im">as</span> f:</span>
<span id="cb32-69"><a href="#cb32-69" aria-hidden="true" tabindex="-1"></a>        pickle.dump(compressed, f)</span>
<span id="cb32-70"><a href="#cb32-70" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-71"><a href="#cb32-71" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Compressed </span><span class="sc">{</span><span class="bu">len</span>(text)<span class="sc">}</span><span class="ss"> bytes"</span>)</span>
<span id="cb32-72"><a href="#cb32-72" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Output: </span><span class="sc">{</span>args<span class="sc">.</span>output<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb32-73"><a href="#cb32-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-74"><a href="#cb32-74" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> cmd_decompress(args):</span>
<span id="cb32-75"><a href="#cb32-75" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Decompress file."""</span></span>
<span id="cb32-76"><a href="#cb32-76" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> pickle</span>
<span id="cb32-77"><a href="#cb32-77" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(args.<span class="bu">input</span>, <span class="st">'rb'</span>) <span class="im">as</span> f:</span>
<span id="cb32-78"><a href="#cb32-78" aria-hidden="true" tabindex="-1"></a>        compressed <span class="op">=</span> pickle.load(f)</span>
<span id="cb32-79"><a href="#cb32-79" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-80"><a href="#cb32-80" aria-hidden="true" tabindex="-1"></a>    compressor <span class="op">=</span> TextCompressor()</span>
<span id="cb32-81"><a href="#cb32-81" aria-hidden="true" tabindex="-1"></a>    text <span class="op">=</span> compressor.decompress(compressed)</span>
<span id="cb32-82"><a href="#cb32-82" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-83"><a href="#cb32-83" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(args.output, <span class="st">'w'</span>) <span class="im">as</span> f:</span>
<span id="cb32-84"><a href="#cb32-84" aria-hidden="true" tabindex="-1"></a>        f.write(text)</span>
<span id="cb32-85"><a href="#cb32-85" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-86"><a href="#cb32-86" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Decompressed to </span><span class="sc">{</span>args<span class="sc">.</span>output<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb32-87"><a href="#cb32-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-88"><a href="#cb32-88" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> main():</span>
<span id="cb32-89"><a href="#cb32-89" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Main CLI entry point."""</span></span>
<span id="cb32-90"><a href="#cb32-90" aria-hidden="true" tabindex="-1"></a>    parser <span class="op">=</span> argparse.ArgumentParser(</span>
<span id="cb32-91"><a href="#cb32-91" aria-hidden="true" tabindex="-1"></a>        description<span class="op">=</span><span class="st">'StringAlgo: Advanced string algorithms toolkit'</span></span>
<span id="cb32-92"><a href="#cb32-92" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb32-93"><a href="#cb32-93" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-94"><a href="#cb32-94" aria-hidden="true" tabindex="-1"></a>    subparsers <span class="op">=</span> parser.add_subparsers(dest<span class="op">=</span><span class="st">'command'</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'Command to run'</span>)</span>
<span id="cb32-95"><a href="#cb32-95" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-96"><a href="#cb32-96" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Search command</span></span>
<span id="cb32-97"><a href="#cb32-97" aria-hidden="true" tabindex="-1"></a>    search_parser <span class="op">=</span> subparsers.add_parser(<span class="st">'search'</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'Search for pattern'</span>)</span>
<span id="cb32-98"><a href="#cb32-98" aria-hidden="true" tabindex="-1"></a>    search_parser.add_argument(<span class="st">'text'</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'Text file'</span>)</span>
<span id="cb32-99"><a href="#cb32-99" aria-hidden="true" tabindex="-1"></a>    search_parser.add_argument(<span class="st">'pattern'</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'Pattern to search'</span>)</span>
<span id="cb32-100"><a href="#cb32-100" aria-hidden="true" tabindex="-1"></a>    search_parser.add_argument(<span class="st">'-a'</span>, <span class="st">'--algorithm'</span>, </span>
<span id="cb32-101"><a href="#cb32-101" aria-hidden="true" tabindex="-1"></a>                              choices<span class="op">=</span>[<span class="st">'kmp'</span>, <span class="st">'rk'</span>, <span class="st">'sa'</span>],</span>
<span id="cb32-102"><a href="#cb32-102" aria-hidden="true" tabindex="-1"></a>                              default<span class="op">=</span><span class="st">'kmp'</span>,</span>
<span id="cb32-103"><a href="#cb32-103" aria-hidden="true" tabindex="-1"></a>                              <span class="bu">help</span><span class="op">=</span><span class="st">'Algorithm to use'</span>)</span>
<span id="cb32-104"><a href="#cb32-104" aria-hidden="true" tabindex="-1"></a>    search_parser.add_argument(<span class="st">'-n'</span>, <span class="st">'--max-results'</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">int</span>, default<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb32-105"><a href="#cb32-105" aria-hidden="true" tabindex="-1"></a>                              <span class="bu">help</span><span class="op">=</span><span class="st">'Maximum results to show'</span>)</span>
<span id="cb32-106"><a href="#cb32-106" aria-hidden="true" tabindex="-1"></a>    search_parser.set_defaults(func<span class="op">=</span>cmd_search)</span>
<span id="cb32-107"><a href="#cb32-107" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-108"><a href="#cb32-108" aria-hidden="true" tabindex="-1"></a>    <span class="co"># DNA command</span></span>
<span id="cb32-109"><a href="#cb32-109" aria-hidden="true" tabindex="-1"></a>    dna_parser <span class="op">=</span> subparsers.add_parser(<span class="st">'dna'</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'Analyze DNA sequence'</span>)</span>
<span id="cb32-110"><a href="#cb32-110" aria-hidden="true" tabindex="-1"></a>    dna_parser.add_argument(<span class="st">'input'</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'FASTA file'</span>)</span>
<span id="cb32-111"><a href="#cb32-111" aria-hidden="true" tabindex="-1"></a>    dna_parser.add_argument(<span class="st">'--orfs'</span>, action<span class="op">=</span><span class="st">'store_true'</span>,</span>
<span id="cb32-112"><a href="#cb32-112" aria-hidden="true" tabindex="-1"></a>                           <span class="bu">help</span><span class="op">=</span><span class="st">'Find open reading frames'</span>)</span>
<span id="cb32-113"><a href="#cb32-113" aria-hidden="true" tabindex="-1"></a>    dna_parser.add_argument(<span class="st">'--motif'</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'Search for motif'</span>)</span>
<span id="cb32-114"><a href="#cb32-114" aria-hidden="true" tabindex="-1"></a>    dna_parser.set_defaults(func<span class="op">=</span>cmd_dna)</span>
<span id="cb32-115"><a href="#cb32-115" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-116"><a href="#cb32-116" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compress command</span></span>
<span id="cb32-117"><a href="#cb32-117" aria-hidden="true" tabindex="-1"></a>    comp_parser <span class="op">=</span> subparsers.add_parser(<span class="st">'compress'</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'Compress text'</span>)</span>
<span id="cb32-118"><a href="#cb32-118" aria-hidden="true" tabindex="-1"></a>    comp_parser.add_argument(<span class="st">'input'</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'Input file'</span>)</span>
<span id="cb32-119"><a href="#cb32-119" aria-hidden="true" tabindex="-1"></a>    comp_parser.add_argument(<span class="st">'output'</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'Output file'</span>)</span>
<span id="cb32-120"><a href="#cb32-120" aria-hidden="true" tabindex="-1"></a>    comp_parser.set_defaults(func<span class="op">=</span>cmd_compress)</span>
<span id="cb32-121"><a href="#cb32-121" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-122"><a href="#cb32-122" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Decompress command</span></span>
<span id="cb32-123"><a href="#cb32-123" aria-hidden="true" tabindex="-1"></a>    decomp_parser <span class="op">=</span> subparsers.add_parser(<span class="st">'decompress'</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'Decompress text'</span>)</span>
<span id="cb32-124"><a href="#cb32-124" aria-hidden="true" tabindex="-1"></a>    decomp_parser.add_argument(<span class="st">'input'</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'Compressed file'</span>)</span>
<span id="cb32-125"><a href="#cb32-125" aria-hidden="true" tabindex="-1"></a>    decomp_parser.add_argument(<span class="st">'output'</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'Output file'</span>)</span>
<span id="cb32-126"><a href="#cb32-126" aria-hidden="true" tabindex="-1"></a>    decomp_parser.set_defaults(func<span class="op">=</span>cmd_decompress)</span>
<span id="cb32-127"><a href="#cb32-127" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-128"><a href="#cb32-128" aria-hidden="true" tabindex="-1"></a>    args <span class="op">=</span> parser.parse_args()</span>
<span id="cb32-129"><a href="#cb32-129" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-130"><a href="#cb32-130" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> args.command:</span>
<span id="cb32-131"><a href="#cb32-131" aria-hidden="true" tabindex="-1"></a>        parser.print_help()</span>
<span id="cb32-132"><a href="#cb32-132" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span></span>
<span id="cb32-133"><a href="#cb32-133" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-134"><a href="#cb32-134" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb32-135"><a href="#cb32-135" aria-hidden="true" tabindex="-1"></a>        args.func(args)</span>
<span id="cb32-136"><a href="#cb32-136" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span></span>
<span id="cb32-137"><a href="#cb32-137" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb32-138"><a href="#cb32-138" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Error: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>, <span class="bu">file</span><span class="op">=</span>sys.stderr)</span>
<span id="cb32-139"><a href="#cb32-139" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span></span>
<span id="cb32-140"><a href="#cb32-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-141"><a href="#cb32-141" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb32-142"><a href="#cb32-142" aria-hidden="true" tabindex="-1"></a>    sys.exit(main())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="summary-and-key-takeaways" class="level2" data-number="18.9">
<h2 data-number="18.9" class="anchored" data-anchor-id="summary-and-key-takeaways"><span class="header-section-number">18.9</span> 10.9 Summary and Key Takeaways</h2>
<p><strong>Core Algorithms</strong>: 1. <strong>Naive search</strong>: O(nm) - simple but slow 2. <strong>KMP</strong>: O(n+m) - never backs up in text, uses failure function 3. <strong>Rabin-Karp</strong>: O(n+m) expected - rolling hash, great for multiple patterns 4. <strong>Suffix arrays</strong>: O(n log n) build, O(m log n) search - versatile and powerful</p>
<p><strong>When to Use What</strong>: - <strong>One-time search, short pattern</strong>: Naive is fine - <strong>Repeated searches, same pattern</strong>: KMP - <strong>Multiple patterns</strong>: Rabin-Karp - <strong>Complex queries, many searches</strong>: Suffix array - <strong>Need absolute fastest</strong>: Suffix tree (not covered in depth)</p>
<p><strong>Real-World Impact</strong>: - <strong>Genomics</strong>: Finding genes, aligning reads, detecting mutations - <strong>Security</strong>: Malware detection, intrusion detection - <strong>Data compression</strong>: BWT, LZ77, gzip - <strong>Plagiarism detection</strong>: Document comparison - <strong>Text editors</strong>: Your Ctrl+F!</p>
<p><strong>The Big Picture</strong>:</p>
<p>String algorithms show us that sometimes the “obvious” solution (check every position) can be dramatically improved with clever preprocessing and mathematical insights. The KMP failure function, the Rabin-Karp rolling hash, and suffix arrays all use different techniques to achieve the same goal: avoid redundant work.</p>
<p>These aren’t just academic exercises—they’re the backbone of tools you use every day, from Google Search to genome sequencing to your text editor. String algorithms have literally helped sequence the human genome, catch criminals through DNA evidence, and make the internet searchable.</p>
</section>
<section id="exercises" class="level2" data-number="18.10">
<h2 data-number="18.10" class="anchored" data-anchor-id="exercises"><span class="header-section-number">18.10</span> 10.10 Exercises</h2>
<section id="basic-understanding" class="level3" data-number="18.10.1">
<h3 data-number="18.10.1" class="anchored" data-anchor-id="basic-understanding"><span class="header-section-number">18.10.1</span> Basic Understanding</h3>
<ol type="1">
<li><p><strong>Failure Function</strong>: Compute the KMP failure function by hand for:</p>
<ul>
<li>“ABCABC”</li>
<li>“AAAA”</li>
<li>“ABCDABD”</li>
</ul></li>
<li><p><strong>Hash Collision</strong>: Find two different 3-character strings that have the same Rabin-Karp hash (mod 101).</p></li>
<li><p><strong>Suffix Array</strong>: Build the suffix array by hand for “BANANA$”.</p></li>
</ol>
</section>
<section id="implementation-challenges" class="level3" data-number="18.10.2">
<h3 data-number="18.10.2" class="anchored" data-anchor-id="implementation-challenges"><span class="header-section-number">18.10.2</span> Implementation Challenges</h3>
<ol start="4" type="1">
<li><p><strong>Boyer-Moore</strong>: Implement the Boyer-Moore algorithm (uses “bad character” and “good suffix” rules).</p></li>
<li><p><strong>Aho-Corasick</strong>: Implement the Aho-Corasick algorithm for matching multiple patterns simultaneously in O(n + m + z) time.</p></li>
<li><p><strong>Longest Palindrome</strong>: Use a suffix array to find the longest palindromic substring.</p></li>
</ol>
</section>
<section id="application-problems" class="level3" data-number="18.10.3">
<h3 data-number="18.10.3" class="anchored" data-anchor-id="application-problems"><span class="header-section-number">18.10.3</span> Application Problems</h3>
<ol start="7" type="1">
<li><p><strong>Fuzzy Matching</strong>: Extend KMP to allow k mismatches.</p></li>
<li><p><strong>DNA Compression</strong>: Build a specialized DNA compressor that exploits:</p>
<ul>
<li>Only 4-character alphabet</li>
<li>Common motifs</li>
<li>Palindromic sequences</li>
</ul></li>
<li><p><strong>Code Clone Detection</strong>: Build a tool to detect copy-pasted code (allowing variable renaming).</p></li>
</ol>
</section>
<section id="advanced-topics" class="level3" data-number="18.10.4">
<h3 data-number="18.10.4" class="anchored" data-anchor-id="advanced-topics"><span class="header-section-number">18.10.4</span> Advanced Topics</h3>
<ol start="10" type="1">
<li><p><strong>Suffix Tree Construction</strong>: Implement Ukkonen’s online suffix tree algorithm.</p></li>
<li><p><strong>Longest Common Extension</strong>: Use suffix arrays with RMQ to answer “longest common prefix starting at positions i and j” in O(1).</p></li>
<li><p><strong>All-Pairs Suffix-Prefix</strong>: For a set of strings, find all pairs where a suffix of one matches a prefix of another (useful for genome assembly).</p></li>
</ol>
</section>
<section id="research-extensions" class="level3" data-number="18.10.5">
<h3 data-number="18.10.5" class="anchored" data-anchor-id="research-extensions"><span class="header-section-number">18.10.5</span> Research Extensions</h3>
<ol start="13" type="1">
<li><p><strong>Approximate Matching</strong>: Implement an algorithm for finding patterns with edit distance ≤ k.</p></li>
<li><p><strong>Bidirectional Search</strong>: Implement bidirectional pattern matching (search from both ends).</p></li>
<li><p><strong>Compressed Pattern Matching</strong>: Search directly on BWT-compressed text without decompression.</p></li>
</ol>
</section>
</section>
<section id="further-reading" class="level2" data-number="18.11">
<h2 data-number="18.11" class="anchored" data-anchor-id="further-reading"><span class="header-section-number">18.11</span> 10.11 Further Reading</h2>
<p><strong>Classic Papers</strong>: - Knuth, Morris, Pratt (1977): “Fast Pattern Matching in Strings” - Karp, Rabin (1987): “Efficient Randomized Pattern-Matching Algorithms” - Manber, Myers (1993): “Suffix Arrays: A New Method for On-Line String Searches”</p>
<p><strong>Books</strong>: - Gusfield: “Algorithms on Strings, Trees, and Sequences” (the Bible of string algorithms) - Crochemore, Rytter: “Text Algorithms” - Ohlebusch: “Bioinformatics Algorithms: Sequence Analysis, Genome Rearrangements, and Phylogenetic Reconstruction”</p>
<p><strong>Online Resources</strong>: - Rosalind: Bioinformatics problems (great practice!) - CP-Algorithms: String algorithms tutorials - Stanford CS166: Advanced string structures lectures</p>
<p><strong>Software</strong>: - BWA: DNA read aligner (uses BWT and FM-index) - grep: Uses Boyer-Moore variants - gzip: Uses LZ77 with suffix-based matching</p>
<hr>
<p>You’ve now mastered the algorithms behind text search, DNA sequencing, and data compression! String algorithms are everywhere, from the code you write to search your emails, to the tools scientists use to understand our genetic code.</p>
<p>Next up: we’ll explore matrix algorithms and the Fast Fourier Transform—where string-like thinking meets continuous mathematics!</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../chapters/09-Advanced-Graph-Algorithms.html" class="pagination-link" aria-label="Chapter 9: Advanced Graph Algorithms - Making Things Flow">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Chapter 9: Advanced Graph Algorithms - Making Things Flow</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../chapters/11-Numerical-Algorithms.html" class="pagination-link" aria-label="Chapter 11: Matrix &amp; Numerical Algorithms - When Math Meets Speed">
        <span class="nav-page-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Chapter 11: Matrix &amp; Numerical Algorithms - When Math Meets Speed</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>