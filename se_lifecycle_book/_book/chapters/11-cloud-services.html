<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>13&nbsp; Chapter 11: Cloud Services and Deployment – The Complete Software Engineering Lifecycle</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../chapters/12-security.html" rel="next">
<link href="../chapters/10-data-management.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-9b98f18118eee809be1c051eb5cc78e4.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/11-cloud-services.html"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Chapter 11: Cloud Services and Deployment</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">The Complete Software Engineering Lifecycle</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">The Complete Software Engineering Lifecycle</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Preface</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../acknowledgments.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Acknowledgments</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/01-introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Chapter 1: Introduction to Software Engineering</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/02-requirements-engineering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Chapter 2: Requirements Engineering</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/03-systems-modeling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Chapter 3: Systems Modeling and UML</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/04-software-architecture.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Chapter 4: Software Architecture and Design Patterns</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/05-ui-ux.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Chapter 5: UI/UX Design and Prototyping</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/06-agile-methodologies.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Chapter 6: Agile Methodologies and Project Management</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/07-version-control.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Chapter 7: Version Control Workflows</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/09-cicd.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Chapter 9: Continuous Integration and Continuous Deployment</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/10-data-management.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Chapter 10: Data Management and APIs</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/11-cloud-services.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Chapter 11: Cloud Services and Deployment</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/12-security.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Chapter 12: Software Security</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/13-maintenance-evolution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Chapter 13: Software Maintenance and Evolution</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/14-ethics-professionalism.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Chapter 14: Professional Practice and Ethics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/15-final-project-integration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Chapter 15: Final Project Integration and Course Synthesis</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/glossary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Glossary</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#learning-objectives" id="toc-learning-objectives" class="nav-link active" data-scroll-target="#learning-objectives"><span class="header-section-number">13.1</span> Learning Objectives</a></li>
  <li><a href="#the-cloud-computing-revolution" id="toc-the-cloud-computing-revolution" class="nav-link" data-scroll-target="#the-cloud-computing-revolution"><span class="header-section-number">13.2</span> 11.1 The Cloud Computing Revolution</a>
  <ul class="collapse">
  <li><a href="#what-is-cloud-computing" id="toc-what-is-cloud-computing" class="nav-link" data-scroll-target="#what-is-cloud-computing"><span class="header-section-number">13.2.1</span> 11.1.1 What is Cloud Computing?</a></li>
  <li><a href="#cloud-service-models" id="toc-cloud-service-models" class="nav-link" data-scroll-target="#cloud-service-models"><span class="header-section-number">13.2.2</span> 11.1.2 Cloud Service Models</a></li>
  <li><a href="#major-cloud-providers" id="toc-major-cloud-providers" class="nav-link" data-scroll-target="#major-cloud-providers"><span class="header-section-number">13.2.3</span> 11.1.3 Major Cloud Providers</a></li>
  </ul></li>
  <li><a href="#core-cloud-services" id="toc-core-cloud-services" class="nav-link" data-scroll-target="#core-cloud-services"><span class="header-section-number">13.3</span> 11.2 Core Cloud Services</a>
  <ul class="collapse">
  <li><a href="#compute-services" id="toc-compute-services" class="nav-link" data-scroll-target="#compute-services"><span class="header-section-number">13.3.1</span> 11.2.1 Compute Services</a></li>
  <li><a href="#storage-services" id="toc-storage-services" class="nav-link" data-scroll-target="#storage-services"><span class="header-section-number">13.3.2</span> 11.2.2 Storage Services</a></li>
  <li><a href="#database-services" id="toc-database-services" class="nav-link" data-scroll-target="#database-services"><span class="header-section-number">13.3.3</span> 11.2.3 Database Services</a></li>
  <li><a href="#networking-services" id="toc-networking-services" class="nav-link" data-scroll-target="#networking-services"><span class="header-section-number">13.3.4</span> 11.2.4 Networking Services</a></li>
  </ul></li>
  <li><a href="#containerization-with-docker" id="toc-containerization-with-docker" class="nav-link" data-scroll-target="#containerization-with-docker"><span class="header-section-number">13.4</span> 11.3 Containerization with Docker</a>
  <ul class="collapse">
  <li><a href="#the-problem-containers-solve" id="toc-the-problem-containers-solve" class="nav-link" data-scroll-target="#the-problem-containers-solve"><span class="header-section-number">13.4.1</span> 11.3.1 The Problem Containers Solve</a></li>
  <li><a href="#docker-fundamentals" id="toc-docker-fundamentals" class="nav-link" data-scroll-target="#docker-fundamentals"><span class="header-section-number">13.4.2</span> 11.3.2 Docker Fundamentals</a></li>
  <li><a href="#docker-compose-for-local-development" id="toc-docker-compose-for-local-development" class="nav-link" data-scroll-target="#docker-compose-for-local-development"><span class="header-section-number">13.4.3</span> 11.3.3 Docker Compose for Local Development</a></li>
  <li><a href="#container-best-practices" id="toc-container-best-practices" class="nav-link" data-scroll-target="#container-best-practices"><span class="header-section-number">13.4.4</span> 11.3.4 Container Best Practices</a></li>
  </ul></li>
  <li><a href="#container-orchestration-with-kubernetes" id="toc-container-orchestration-with-kubernetes" class="nav-link" data-scroll-target="#container-orchestration-with-kubernetes"><span class="header-section-number">13.5</span> 11.4 Container Orchestration with Kubernetes</a>
  <ul class="collapse">
  <li><a href="#why-kubernetes" id="toc-why-kubernetes" class="nav-link" data-scroll-target="#why-kubernetes"><span class="header-section-number">13.5.1</span> 11.4.1 Why Kubernetes?</a></li>
  <li><a href="#core-kubernetes-concepts" id="toc-core-kubernetes-concepts" class="nav-link" data-scroll-target="#core-kubernetes-concepts"><span class="header-section-number">13.5.2</span> 11.4.2 Core Kubernetes Concepts</a></li>
  <li><a href="#deploying-to-kubernetes" id="toc-deploying-to-kubernetes" class="nav-link" data-scroll-target="#deploying-to-kubernetes"><span class="header-section-number">13.5.3</span> 11.4.3 Deploying to Kubernetes</a></li>
  <li><a href="#horizontal-pod-autoscaling" id="toc-horizontal-pod-autoscaling" class="nav-link" data-scroll-target="#horizontal-pod-autoscaling"><span class="header-section-number">13.5.4</span> 11.4.4 Horizontal Pod Autoscaling</a></li>
  <li><a href="#managed-kubernetes-services" id="toc-managed-kubernetes-services" class="nav-link" data-scroll-target="#managed-kubernetes-services"><span class="header-section-number">13.5.5</span> 11.4.5 Managed Kubernetes Services</a></li>
  </ul></li>
  <li><a href="#serverless-computing" id="toc-serverless-computing" class="nav-link" data-scroll-target="#serverless-computing"><span class="header-section-number">13.6</span> 11.5 Serverless Computing</a>
  <ul class="collapse">
  <li><a href="#what-is-serverless" id="toc-what-is-serverless" class="nav-link" data-scroll-target="#what-is-serverless"><span class="header-section-number">13.6.1</span> 11.5.1 What is Serverless?</a></li>
  <li><a href="#aws-lambda" id="toc-aws-lambda" class="nav-link" data-scroll-target="#aws-lambda"><span class="header-section-number">13.6.2</span> 11.5.2 AWS Lambda</a></li>
  <li><a href="#infrastructure-as-code-for-lambda" id="toc-infrastructure-as-code-for-lambda" class="nav-link" data-scroll-target="#infrastructure-as-code-for-lambda"><span class="header-section-number">13.6.3</span> 11.5.3 Infrastructure as Code for Lambda</a></li>
  <li><a href="#serverless-patterns" id="toc-serverless-patterns" class="nav-link" data-scroll-target="#serverless-patterns"><span class="header-section-number">13.6.4</span> 11.5.4 Serverless Patterns</a></li>
  <li><a href="#when-to-use-serverless" id="toc-when-to-use-serverless" class="nav-link" data-scroll-target="#when-to-use-serverless"><span class="header-section-number">13.6.5</span> 11.5.5 When to Use Serverless</a></li>
  </ul></li>
  <li><a href="#infrastructure-as-code" id="toc-infrastructure-as-code" class="nav-link" data-scroll-target="#infrastructure-as-code"><span class="header-section-number">13.7</span> 11.6 Infrastructure as Code</a>
  <ul class="collapse">
  <li><a href="#benefits-of-infrastructure-as-code" id="toc-benefits-of-infrastructure-as-code" class="nav-link" data-scroll-target="#benefits-of-infrastructure-as-code"><span class="header-section-number">13.7.1</span> 11.6.1 Benefits of Infrastructure as Code</a></li>
  <li><a href="#terraform" id="toc-terraform" class="nav-link" data-scroll-target="#terraform"><span class="header-section-number">13.7.2</span> 11.6.2 Terraform</a></li>
  <li><a href="#terraform-workflow" id="toc-terraform-workflow" class="nav-link" data-scroll-target="#terraform-workflow"><span class="header-section-number">13.7.3</span> 11.6.3 Terraform Workflow</a></li>
  <li><a href="#terraform-best-practices" id="toc-terraform-best-practices" class="nav-link" data-scroll-target="#terraform-best-practices"><span class="header-section-number">13.7.4</span> 11.6.4 Terraform Best Practices</a></li>
  </ul></li>
  <li><a href="#cloud-security-best-practices" id="toc-cloud-security-best-practices" class="nav-link" data-scroll-target="#cloud-security-best-practices"><span class="header-section-number">13.8</span> 11.7 Cloud Security Best Practices</a>
  <ul class="collapse">
  <li><a href="#identity-and-access-management" id="toc-identity-and-access-management" class="nav-link" data-scroll-target="#identity-and-access-management"><span class="header-section-number">13.8.1</span> 11.7.1 Identity and Access Management</a></li>
  <li><a href="#secrets-management" id="toc-secrets-management" class="nav-link" data-scroll-target="#secrets-management"><span class="header-section-number">13.8.2</span> 11.7.2 Secrets Management</a></li>
  <li><a href="#network-security" id="toc-network-security" class="nav-link" data-scroll-target="#network-security"><span class="header-section-number">13.8.3</span> 11.7.3 Network Security</a></li>
  </ul></li>
  <li><a href="#cost-optimization" id="toc-cost-optimization" class="nav-link" data-scroll-target="#cost-optimization"><span class="header-section-number">13.9</span> 11.8 Cost Optimization</a>
  <ul class="collapse">
  <li><a href="#understanding-cloud-pricing" id="toc-understanding-cloud-pricing" class="nav-link" data-scroll-target="#understanding-cloud-pricing"><span class="header-section-number">13.9.1</span> 11.8.1 Understanding Cloud Pricing</a></li>
  <li><a href="#cost-optimization-strategies" id="toc-cost-optimization-strategies" class="nav-link" data-scroll-target="#cost-optimization-strategies"><span class="header-section-number">13.9.2</span> 11.8.2 Cost Optimization Strategies</a></li>
  </ul></li>
  <li><a href="#chapter-summary" id="toc-chapter-summary" class="nav-link" data-scroll-target="#chapter-summary"><span class="header-section-number">13.10</span> 11.9 Chapter Summary</a></li>
  <li><a href="#key-terms" id="toc-key-terms" class="nav-link" data-scroll-target="#key-terms"><span class="header-section-number">13.11</span> 11.10 Key Terms</a></li>
  <li><a href="#review-questions" id="toc-review-questions" class="nav-link" data-scroll-target="#review-questions"><span class="header-section-number">13.12</span> 11.11 Review Questions</a></li>
  <li><a href="#hands-on-exercises" id="toc-hands-on-exercises" class="nav-link" data-scroll-target="#hands-on-exercises"><span class="header-section-number">13.13</span> 11.12 Hands-On Exercises</a>
  <ul class="collapse">
  <li><a href="#exercise-11.1-containerize-your-application" id="toc-exercise-11.1-containerize-your-application" class="nav-link" data-scroll-target="#exercise-11.1-containerize-your-application"><span class="header-section-number">13.13.1</span> Exercise 11.1: Containerize Your Application</a></li>
  <li><a href="#exercise-11.2-deploy-to-kubernetes" id="toc-exercise-11.2-deploy-to-kubernetes" class="nav-link" data-scroll-target="#exercise-11.2-deploy-to-kubernetes"><span class="header-section-number">13.13.2</span> Exercise 11.2: Deploy to Kubernetes</a></li>
  <li><a href="#exercise-11.3-serverless-function" id="toc-exercise-11.3-serverless-function" class="nav-link" data-scroll-target="#exercise-11.3-serverless-function"><span class="header-section-number">13.13.3</span> Exercise 11.3: Serverless Function</a></li>
  <li><a href="#exercise-11.4-infrastructure-as-code" id="toc-exercise-11.4-infrastructure-as-code" class="nav-link" data-scroll-target="#exercise-11.4-infrastructure-as-code"><span class="header-section-number">13.13.4</span> Exercise 11.4: Infrastructure as Code</a></li>
  <li><a href="#exercise-11.5-security-audit" id="toc-exercise-11.5-security-audit" class="nav-link" data-scroll-target="#exercise-11.5-security-audit"><span class="header-section-number">13.13.5</span> Exercise 11.5: Security Audit</a></li>
  <li><a href="#exercise-11.6-cost-analysis" id="toc-exercise-11.6-cost-analysis" class="nav-link" data-scroll-target="#exercise-11.6-cost-analysis"><span class="header-section-number">13.13.6</span> Exercise 11.6: Cost Analysis</a></li>
  </ul></li>
  <li><a href="#further-reading" id="toc-further-reading" class="nav-link" data-scroll-target="#further-reading"><span class="header-section-number">13.14</span> 11.13 Further Reading</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references"><span class="header-section-number">13.15</span> References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Chapter 11: Cloud Services and Deployment</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="learning-objectives" class="level2" data-number="13.1">
<h2 data-number="13.1" class="anchored" data-anchor-id="learning-objectives"><span class="header-section-number">13.1</span> Learning Objectives</h2>
<p>By the end of this chapter, you will be able to:</p>
<ul>
<li>Explain the fundamental concepts of cloud computing and its service models</li>
<li>Compare major cloud providers (AWS, Google Cloud, Azure) and their core services</li>
<li>Containerize applications using Docker with best practices for production</li>
<li>Orchestrate containers using Kubernetes for scalable deployments</li>
<li>Design serverless architectures using functions-as-a-service</li>
<li>Implement infrastructure as code for reproducible deployments</li>
<li>Apply cloud security best practices and cost optimization strategies</li>
<li>Choose appropriate cloud services for different application requirements</li>
</ul>
<hr>
</section>
<section id="the-cloud-computing-revolution" class="level2" data-number="13.2">
<h2 data-number="13.2" class="anchored" data-anchor-id="the-cloud-computing-revolution"><span class="header-section-number">13.2</span> 11.1 The Cloud Computing Revolution</h2>
<p>Before cloud computing, deploying an application meant purchasing physical servers, installing them in a data center, configuring networking equipment, and maintaining everything yourself. This process could take months and required significant capital investment—often before you knew whether your application would succeed.</p>
<p>Cloud computing transformed this model fundamentally. Instead of buying hardware, you rent computing resources on-demand. Instead of maintaining data centers, you use facilities managed by specialists. Instead of planning capacity years in advance, you scale up and down as needed, paying only for what you use.</p>
<p>This shift has profound implications for how we build software. Applications can start small and grow organically. Experimentation costs pennies instead of thousands of dollars. Global deployment happens in minutes, not months. The democratization of infrastructure has enabled startups to compete with established enterprises and has made scalable, reliable systems accessible to teams of any size.</p>
<section id="what-is-cloud-computing" class="level3" data-number="13.2.1">
<h3 data-number="13.2.1" class="anchored" data-anchor-id="what-is-cloud-computing"><span class="header-section-number">13.2.1</span> 11.1.1 What is Cloud Computing?</h3>
<p>At its core, cloud computing is the delivery of computing services—servers, storage, databases, networking, software—over the internet. Rather than owning and maintaining physical infrastructure, you access these resources as services, typically paying based on usage.</p>
<pre><code>┌─────────────────────────────────────────────────────────────────────────┐
│                    CLOUD COMPUTING CHARACTERISTICS                      │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ON-DEMAND SELF-SERVICE                                                 │
│  Provision resources automatically without human interaction with       │
│  the provider. Click a button, run a command, or make an API call      │
│  to spin up new servers instantly.                                      │
│                                                                         │
│  BROAD NETWORK ACCESS                                                   │
│  Access services from anywhere via standard network protocols.          │
│  Your infrastructure is available globally, not tied to a physical     │
│  location.                                                              │
│                                                                         │
│  RESOURCE POOLING                                                       │
│  Provider's resources serve multiple customers from the same physical   │
│  infrastructure. This multi-tenancy enables economies of scale that    │
│  individual organizations couldn't achieve alone.                       │
│                                                                         │
│  RAPID ELASTICITY                                                       │
│  Scale resources up or down quickly based on demand. Handle traffic    │
│  spikes without planning months ahead, and scale down during quiet     │
│  periods to save costs.                                                 │
│                                                                         │
│  MEASURED SERVICE                                                       │
│  Pay for what you use, measured automatically. No upfront costs for    │
│  hardware; operating expenses replace capital expenses.                 │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘</code></pre>
<p>These characteristics combine to create unprecedented flexibility. Consider a retail application preparing for Black Friday. Traditionally, you’d buy servers to handle peak load, leaving them idle 364 days a year. With cloud computing, you scale up for the shopping rush and scale back down afterward, paying only for the resources you actually use.</p>
</section>
<section id="cloud-service-models" class="level3" data-number="13.2.2">
<h3 data-number="13.2.2" class="anchored" data-anchor-id="cloud-service-models"><span class="header-section-number">13.2.2</span> 11.1.2 Cloud Service Models</h3>
<p>Cloud services are organized into three primary models, each offering different levels of abstraction and control. Understanding these models helps you choose the right approach for your needs.</p>
<pre><code>┌─────────────────────────────────────────────────────────────────────────┐
│                    CLOUD SERVICE MODELS                                 │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                     SOFTWARE AS A SERVICE (SaaS)                │   │
│  │  Complete applications delivered over the internet              │   │
│  │  You manage: Just your data and user access                     │   │
│  │  Provider manages: Everything else                              │   │
│  │  Examples: Gmail, Salesforce, Slack, GitHub                     │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                              ▲                                          │
│                              │ More abstraction, less control           │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                   PLATFORM AS A SERVICE (PaaS)                  │   │
│  │  Platform for building and deploying applications               │   │
│  │  You manage: Application code, data                             │   │
│  │  Provider manages: Runtime, OS, servers, storage, networking    │   │
│  │  Examples: Heroku, Google App Engine, AWS Elastic Beanstalk     │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                              ▲                                          │
│                              │                                          │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                INFRASTRUCTURE AS A SERVICE (IaaS)               │   │
│  │  Raw computing resources: VMs, storage, networks                │   │
│  │  You manage: OS, runtime, middleware, applications, data        │   │
│  │  Provider manages: Virtualization, servers, storage, networking │   │
│  │  Examples: AWS EC2, Google Compute Engine, Azure VMs            │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                              ▲                                          │
│                              │ Less abstraction, more control           │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                      ON-PREMISES / BARE METAL                   │   │
│  │  You own and manage everything                                  │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘</code></pre>
<p><strong>Infrastructure as a Service (IaaS)</strong> provides the fundamental building blocks: virtual machines, storage, and networking. You have complete control over the operating system and everything above it, but you’re responsible for maintaining all of it. IaaS is ideal when you need maximum flexibility or have specialized requirements that higher-level services can’t accommodate.</p>
<p><strong>Platform as a Service (PaaS)</strong> removes the burden of managing servers and operating systems. You deploy your application code, and the platform handles everything else: provisioning servers, configuring load balancers, managing SSL certificates, scaling based on traffic. PaaS accelerates development by letting teams focus on application logic rather than infrastructure.</p>
<p><strong>Software as a Service (SaaS)</strong> delivers complete applications. As a user, you simply access the software through a browser or API. As a developer building applications, you might integrate with SaaS products (using Stripe for payments, SendGrid for email, Auth0 for authentication) rather than building everything yourself.</p>
<p>Modern applications typically combine all three models. You might run your custom backend on IaaS (EC2 instances), use PaaS for your database (RDS), and integrate SaaS products for authentication (Auth0) and monitoring (Datadog).</p>
</section>
<section id="major-cloud-providers" class="level3" data-number="13.2.3">
<h3 data-number="13.2.3" class="anchored" data-anchor-id="major-cloud-providers"><span class="header-section-number">13.2.3</span> 11.1.3 Major Cloud Providers</h3>
<p>Three providers dominate the cloud market, each with distinctive strengths:</p>
<pre><code>┌─────────────────────────────────────────────────────────────────────────┐
│                    MAJOR CLOUD PROVIDERS                                │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  AMAZON WEB SERVICES (AWS)                                              │
│  • Market leader (~32% market share)                                    │
│  • Broadest service catalog (200+ services)                             │
│  • Most mature ecosystem and documentation                              │
│  • Strengths: Breadth, enterprise features, global reach                │
│  • Key services: EC2, S3, Lambda, RDS, DynamoDB, EKS                    │
│                                                                         │
│  GOOGLE CLOUD PLATFORM (GCP)                                            │
│  • Strong in data analytics and machine learning                        │
│  • Kubernetes expertise (Google created Kubernetes)                     │
│  • Excellent network performance                                        │
│  • Strengths: BigQuery, AI/ML, Kubernetes, developer experience         │
│  • Key services: Compute Engine, Cloud Storage, BigQuery, GKE           │
│                                                                         │
│  MICROSOFT AZURE                                                        │
│  • Strong enterprise integration (Active Directory, Office 365)         │
│  • Hybrid cloud leadership (Azure Arc, Azure Stack)                     │
│  • Comprehensive compliance certifications                              │
│  • Strengths: Enterprise, hybrid cloud, .NET ecosystem                  │
│  • Key services: Virtual Machines, Blob Storage, Azure Functions        │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘</code></pre>
<p>For most applications, any major provider works well. The choice often depends on existing relationships (enterprise Microsoft shops gravitate toward Azure), specific technical needs (heavy ML workloads might favor GCP), or team familiarity. Many organizations use multiple providers for redundancy or to leverage each provider’s strengths.</p>
<hr>
</section>
</section>
<section id="core-cloud-services" class="level2" data-number="13.3">
<h2 data-number="13.3" class="anchored" data-anchor-id="core-cloud-services"><span class="header-section-number">13.3</span> 11.2 Core Cloud Services</h2>
<p>Every cloud provider offers hundreds of services, but a core set handles most application needs. Understanding these fundamental services provides a foundation for building cloud-native applications.</p>
<section id="compute-services" class="level3" data-number="13.3.1">
<h3 data-number="13.3.1" class="anchored" data-anchor-id="compute-services"><span class="header-section-number">13.3.1</span> 11.2.1 Compute Services</h3>
<p>Compute services provide the processing power to run your applications. They range from raw virtual machines to fully managed containers and serverless functions.</p>
<p><strong>Virtual Machines (VMs)</strong> provide complete, isolated computing environments. You select the CPU, memory, and storage configuration, choose an operating system, and have full control over the environment. VMs are the most flexible compute option but require the most management.</p>
<pre><code>┌─────────────────────────────────────────────────────────────────────────┐
│                    COMPUTE SERVICE COMPARISON                           │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  Service Type      AWS              GCP                 Azure           │
│  ─────────────────────────────────────────────────────────────────────  │
│  Virtual Machines  EC2              Compute Engine      Virtual Machines│
│  Containers        ECS, EKS         Cloud Run, GKE      ACI, AKS        │
│  Serverless        Lambda           Cloud Functions     Azure Functions │
│  App Platform      Elastic Beanstalk App Engine         App Service     │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘</code></pre>
<p>Let’s examine how to launch a virtual machine on AWS using their command-line interface. This example demonstrates the programmatic approach to infrastructure management:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new EC2 instance</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="ex">aws</span> ec2 run-instances <span class="dt">\</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">--image-id</span> ami-0c55b159cbfafe1f0 <span class="dt">\ </span>       <span class="co"># Amazon Linux 2 AMI</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="ex">--instance-type</span> t3.micro <span class="dt">\ </span>                <span class="co"># 2 vCPU, 1GB RAM</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="ex">--key-name</span> my-key-pair <span class="dt">\ </span>                  <span class="co"># SSH key for access</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="ex">--security-group-ids</span> sg-903004f8 <span class="dt">\ </span>        <span class="co"># Firewall rules</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="ex">--subnet-id</span> subnet-6e7f829e <span class="dt">\ </span>             <span class="co"># Network placement</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="ex">--tag-specifications</span> <span class="st">'ResourceType=instance,Tags=[{Key=Name,Value=web-server}]'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Each parameter configures a different aspect of the instance. The <code>image-id</code> specifies the operating system image (AMI - Amazon Machine Image). The <code>instance-type</code> determines computing resources—t3.micro is a small, burstable instance suitable for light workloads or testing. The <code>key-name</code> references an SSH key pair for secure access. Security groups act as virtual firewalls, controlling inbound and outbound traffic. The subnet determines which network segment the instance joins.</p>
<p>This imperative approach works for simple cases, but managing infrastructure through CLI commands becomes unwieldy at scale. Later in this chapter, we’ll explore infrastructure as code, which provides a declarative, version-controlled approach.</p>
</section>
<section id="storage-services" class="level3" data-number="13.3.2">
<h3 data-number="13.3.2" class="anchored" data-anchor-id="storage-services"><span class="header-section-number">13.3.2</span> 11.2.2 Storage Services</h3>
<p>Cloud storage services provide durable, scalable data storage without managing physical disks. Different storage types optimize for different access patterns.</p>
<p><strong>Object Storage</strong> (S3, Cloud Storage, Blob Storage) stores unstructured data as objects—files with metadata. Objects are accessed via HTTP, making object storage ideal for static assets, backups, and data lakes. Object storage scales infinitely and costs pennies per gigabyte, but doesn’t support traditional filesystem operations.</p>
<p><strong>Block Storage</strong> (EBS, Persistent Disk, Managed Disks) provides raw storage volumes that attach to VMs. Block storage works like a physical hard drive—you format it with a filesystem and use normal file operations. Block storage offers high performance but must be attached to a specific VM.</p>
<p><strong>File Storage</strong> (EFS, Filestore, Azure Files) provides managed network filesystems that multiple VMs can access simultaneously. File storage is useful for applications requiring shared filesystem access but costs more than object storage.</p>
<p>Here’s an example of uploading to and downloading from S3, the most commonly used object storage service:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> { S3Client<span class="op">,</span> PutObjectCommand<span class="op">,</span> GetObjectCommand } <span class="op">=</span> <span class="pp">require</span>(<span class="st">'@aws-sdk/client-s3'</span>)<span class="op">;</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Create S3 client - credentials come from environment or IAM role</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> s3Client <span class="op">=</span> <span class="kw">new</span> <span class="fu">S3Client</span>({ <span class="dt">region</span><span class="op">:</span> <span class="st">'us-east-1'</span> })<span class="op">;</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="kw">async</span> <span class="kw">function</span> <span class="fu">uploadFile</span>(bucket<span class="op">,</span> key<span class="op">,</span> body<span class="op">,</span> contentType) {</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">// PutObjectCommand uploads data to S3</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> command <span class="op">=</span> <span class="kw">new</span> <span class="fu">PutObjectCommand</span>({</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">Bucket</span><span class="op">:</span> bucket<span class="op">,</span>           <span class="co">// S3 bucket name (globally unique)</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">Key</span><span class="op">:</span> key<span class="op">,</span>                 <span class="co">// Object path within bucket</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">Body</span><span class="op">:</span> body<span class="op">,</span>               <span class="co">// File contents (Buffer, string, or stream)</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ContentType</span><span class="op">:</span> contentType  <span class="co">// MIME type for proper handling</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">await</span> s3Client<span class="op">.</span><span class="fu">send</span>(command)<span class="op">;</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Construct the URL where the object can be accessed</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="vs">`https://</span><span class="sc">${</span>bucket<span class="sc">}</span><span class="vs">.s3.amazonaws.com/</span><span class="sc">${</span>key<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="kw">async</span> <span class="kw">function</span> <span class="fu">downloadFile</span>(bucket<span class="op">,</span> key) {</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> command <span class="op">=</span> <span class="kw">new</span> <span class="fu">GetObjectCommand</span>({</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    <span class="dt">Bucket</span><span class="op">:</span> bucket<span class="op">,</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    <span class="dt">Key</span><span class="op">:</span> key</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> s3Client<span class="op">.</span><span class="fu">send</span>(command)<span class="op">;</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Response.Body is a readable stream</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Convert to string for text content</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> response<span class="op">.</span><span class="at">Body</span><span class="op">.</span><span class="fu">transformToString</span>()<span class="op">;</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The key concepts here merit explanation. A <strong>bucket</strong> is a container for objects with a globally unique name across all of S3. The <strong>key</strong> is the path to the object within the bucket—it looks like a file path but S3 doesn’t actually have folders (the slash is just part of the key name). S3 uses eventual consistency for some operations, meaning changes might take a moment to propagate.</p>
<p>Object storage excels at certain patterns: serving static website assets, storing user uploads, archiving backups, hosting data for analytics. It’s not suitable for applications requiring traditional filesystem semantics or database-like operations.</p>
</section>
<section id="database-services" class="level3" data-number="13.3.3">
<h3 data-number="13.3.3" class="anchored" data-anchor-id="database-services"><span class="header-section-number">13.3.3</span> 11.2.3 Database Services</h3>
<p>Cloud providers offer managed database services that handle backups, patching, replication, and failover automatically. These services reduce operational burden significantly compared to self-managed databases.</p>
<pre><code>┌─────────────────────────────────────────────────────────────────────────┐
│                    MANAGED DATABASE SERVICES                            │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  RELATIONAL DATABASES                                                   │
│  AWS: RDS (MySQL, PostgreSQL, Oracle, SQL Server), Aurora               │
│  GCP: Cloud SQL, Cloud Spanner                                          │
│  Azure: Azure SQL, Azure Database for PostgreSQL/MySQL                  │
│                                                                         │
│  Benefits: Automated backups, read replicas, automatic failover,        │
│  point-in-time recovery, managed patching                               │
│                                                                         │
│  NOSQL DATABASES                                                        │
│  AWS: DynamoDB (key-value), DocumentDB (document), ElastiCache          │
│  GCP: Firestore (document), Cloud Bigtable (wide-column), Memorystore   │
│  Azure: Cosmos DB (multi-model), Azure Cache for Redis                  │
│                                                                         │
│  Benefits: Automatic scaling, global distribution, single-digit         │
│  millisecond latency, serverless options                                │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘</code></pre>
<p><strong>When to use managed databases:</strong> Almost always for production workloads. The operational complexity of running databases reliably—handling failover, managing backups, applying security patches, optimizing performance—is significant. Managed services handle these concerns, letting your team focus on application development.</p>
<p><strong>When self-managed makes sense:</strong> When you need a database not offered as a managed service, require specific versions or configurations, or have compliance requirements mandating full control. Even then, consider running on managed Kubernetes rather than bare VMs.</p>
<p>Here’s an example connecting to Amazon RDS PostgreSQL:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> { Pool } <span class="op">=</span> <span class="pp">require</span>(<span class="st">'pg'</span>)<span class="op">;</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Connection string from environment variable</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Format: postgresql://user:password@host:port/database</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> pool <span class="op">=</span> <span class="kw">new</span> <span class="fu">Pool</span>({</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">connectionString</span><span class="op">:</span> <span class="bu">process</span><span class="op">.</span><span class="at">env</span><span class="op">.</span><span class="at">DATABASE_URL</span><span class="op">,</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">ssl</span><span class="op">:</span> {</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">rejectUnauthorized</span><span class="op">:</span> <span class="kw">true</span>  <span class="co">// Verify SSL certificate</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">max</span><span class="op">:</span> <span class="dv">20</span><span class="op">,</span>                     <span class="co">// Connection pool size</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">idleTimeoutMillis</span><span class="op">:</span> <span class="dv">30000</span><span class="op">,</span>    <span class="co">// Close idle connections after 30s</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">connectionTimeoutMillis</span><span class="op">:</span> <span class="dv">2000</span> <span class="co">// Fail fast if can't connect</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="co">// RDS handles: backups, failover, patching, monitoring</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="co">// Your application just uses standard PostgreSQL</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="kw">async</span> <span class="kw">function</span> <span class="fu">getUsers</span>() {</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> client <span class="op">=</span> <span class="cf">await</span> pool<span class="op">.</span><span class="fu">connect</span>()<span class="op">;</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">try</span> {</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> result <span class="op">=</span> <span class="cf">await</span> client<span class="op">.</span><span class="fu">query</span>(<span class="st">'SELECT * FROM users LIMIT 10'</span>)<span class="op">;</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result<span class="op">.</span><span class="at">rows</span><span class="op">;</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">finally</span> {</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>    client<span class="op">.</span><span class="fu">release</span>()<span class="op">;</span>  <span class="co">// Return connection to pool</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The code looks identical to connecting to any PostgreSQL database—that’s the point. Managed databases provide the same interface as self-hosted databases while handling operational complexity behind the scenes. The <code>DATABASE_URL</code> environment variable typically contains the RDS endpoint, which might point to a primary instance or a read replica depending on your needs.</p>
</section>
<section id="networking-services" class="level3" data-number="13.3.4">
<h3 data-number="13.3.4" class="anchored" data-anchor-id="networking-services"><span class="header-section-number">13.3.4</span> 11.2.4 Networking Services</h3>
<p>Cloud networking services create isolated networks, control traffic flow, and connect resources securely. Understanding networking is crucial for security and performance.</p>
<p><strong>Virtual Private Cloud (VPC)</strong> creates an isolated network within the cloud. Your resources (VMs, databases, containers) exist within your VPC, separate from other customers. You control the IP address range, create subnets, and define routing rules.</p>
<p><strong>Subnets</strong> divide your VPC into segments. Public subnets have routes to the internet; private subnets don’t. Typically, you place web servers in public subnets (they need to receive traffic from users) and databases in private subnets (they should only be accessible from your application servers).</p>
<p><strong>Security Groups and Network ACLs</strong> act as firewalls. Security groups operate at the instance level, controlling which traffic can reach specific resources. Network ACLs operate at the subnet level, providing an additional layer of defense.</p>
<pre><code>┌─────────────────────────────────────────────────────────────────────────┐
│                    VPC ARCHITECTURE                                     │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                        VPC (10.0.0.0/16)                        │   │
│  │                                                                 │   │
│  │  ┌─────────────────────┐     ┌─────────────────────┐           │   │
│  │  │   Public Subnet     │     │   Public Subnet     │           │   │
│  │  │   (10.0.1.0/24)     │     │   (10.0.2.0/24)     │           │   │
│  │  │   Availability      │     │   Availability      │           │   │
│  │  │   Zone A            │     │   Zone B            │           │   │
│  │  │                     │     │                     │           │   │
│  │  │  ┌──────────────┐   │     │  ┌──────────────┐   │           │   │
│  │  │  │ Web Server   │   │     │  │ Web Server   │   │           │   │
│  │  │  │ (EC2)        │   │     │  │ (EC2)        │   │           │   │
│  │  │  └──────────────┘   │     │  └──────────────┘   │           │   │
│  │  └─────────────────────┘     └─────────────────────┘           │   │
│  │           │                           │                         │   │
│  │           └───────────┬───────────────┘                         │   │
│  │                       │                                         │   │
│  │  ┌─────────────────────┐     ┌─────────────────────┐           │   │
│  │  │   Private Subnet    │     │   Private Subnet    │           │   │
│  │  │   (10.0.3.0/24)     │     │   (10.0.4.0/24)     │           │   │
│  │  │   Availability      │     │   Availability      │           │   │
│  │  │   Zone A            │     │   Zone B            │           │   │
│  │  │                     │     │                     │           │   │
│  │  │  ┌──────────────┐   │     │  ┌──────────────┐   │           │   │
│  │  │  │ Database     │   │     │  │ Database     │   │           │   │
│  │  │  │ (RDS Primary)│   │     │  │ (RDS Standby)│   │           │   │
│  │  │  └──────────────┘   │     │  └──────────────┘   │           │   │
│  │  └─────────────────────┘     └─────────────────────┘           │   │
│  │                                                                 │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  Internet traffic → Internet Gateway → Load Balancer → Web Servers      │
│  Web Servers → Private network → Database (no internet access)          │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘</code></pre>
<p>This architecture demonstrates several important patterns. Resources span multiple Availability Zones (physically separate data centers) for high availability—if one zone fails, the other continues serving traffic. Databases reside in private subnets, accessible only from application servers, not directly from the internet. A load balancer distributes traffic across web servers and provides a single entry point.</p>
<p><strong>Load Balancers</strong> distribute incoming traffic across multiple instances, enabling horizontal scaling and high availability. If one instance fails, the load balancer routes traffic to healthy instances. Cloud load balancers integrate with auto-scaling to adjust capacity based on demand.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Example: Health check endpoint for load balancer</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co">// The load balancer periodically calls this endpoint</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co">// to verify the instance is healthy</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">get</span>(<span class="st">'/health'</span><span class="op">,</span> <span class="kw">async</span> (req<span class="op">,</span> res) <span class="kw">=&gt;</span> {</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">try</span> {</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Check database connectivity</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> db<span class="op">.</span><span class="fu">raw</span>(<span class="st">'SELECT 1'</span>)<span class="op">;</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Check Redis connectivity</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> redis<span class="op">.</span><span class="fu">ping</span>()<span class="op">;</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Check available memory (fail if critically low)</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> memUsage <span class="op">=</span> <span class="bu">process</span><span class="op">.</span><span class="fu">memoryUsage</span>()<span class="op">;</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> memoryOk <span class="op">=</span> memUsage<span class="op">.</span><span class="at">heapUsed</span> <span class="op">&lt;</span> memUsage<span class="op">.</span><span class="at">heapTotal</span> <span class="op">*</span> <span class="fl">0.95</span><span class="op">;</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>memoryOk) {</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> res<span class="op">.</span><span class="fu">status</span>(<span class="dv">503</span>)<span class="op">.</span><span class="fu">json</span>({ </span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>        <span class="dt">status</span><span class="op">:</span> <span class="st">'unhealthy'</span><span class="op">,</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>        <span class="dt">reason</span><span class="op">:</span> <span class="st">'Memory pressure'</span> </span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>    res<span class="op">.</span><span class="fu">json</span>({ </span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>      <span class="dt">status</span><span class="op">:</span> <span class="st">'healthy'</span><span class="op">,</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>      <span class="dt">timestamp</span><span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">.</span><span class="fu">toISOString</span>()</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">catch</span> (error) {</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Return 503 so load balancer stops sending traffic</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>    res<span class="op">.</span><span class="fu">status</span>(<span class="dv">503</span>)<span class="op">.</span><span class="fu">json</span>({ </span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>      <span class="dt">status</span><span class="op">:</span> <span class="st">'unhealthy'</span><span class="op">,</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>      <span class="dt">error</span><span class="op">:</span> error<span class="op">.</span><span class="at">message</span> </span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Load balancers use health checks to determine which instances can receive traffic. If your health check returns a 5xx status code, the load balancer marks the instance as unhealthy and stops sending traffic until it recovers. The health check should verify all critical dependencies—a server that can’t reach its database shouldn’t receive requests.</p>
<hr>
</section>
</section>
<section id="containerization-with-docker" class="level2" data-number="13.4">
<h2 data-number="13.4" class="anchored" data-anchor-id="containerization-with-docker"><span class="header-section-number">13.4</span> 11.3 Containerization with Docker</h2>
<p>Containers have revolutionized how we package and deploy applications. A container bundles an application with everything it needs to run—code, runtime, libraries, configuration—into a standardized unit that runs consistently across environments.</p>
<section id="the-problem-containers-solve" class="level3" data-number="13.4.1">
<h3 data-number="13.4.1" class="anchored" data-anchor-id="the-problem-containers-solve"><span class="header-section-number">13.4.1</span> 11.3.1 The Problem Containers Solve</h3>
<p>Before containers, deploying applications was fraught with environment inconsistencies. “It works on my machine” became a running joke because applications frequently behaved differently in development, testing, and production. Different operating system versions, library versions, configurations, and dependencies created subtle bugs that were difficult to diagnose.</p>
<p>Containers solve this by packaging the entire runtime environment. The same container image runs identically whether on a developer’s laptop, a CI server, or a production cluster. This consistency eliminates a whole class of deployment problems.</p>
<pre><code>┌─────────────────────────────────────────────────────────────────────────┐
│                    CONTAINERS VS VIRTUAL MACHINES                       │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  VIRTUAL MACHINES                      CONTAINERS                       │
│  ┌─────────────────────────────┐      ┌─────────────────────────────┐  │
│  │ App A │ App B │ App C       │      │ App A │ App B │ App C       │  │
│  ├───────┴───────┴─────────────┤      ├───────┴───────┴─────────────┤  │
│  │ Guest OS │ Guest OS │Guest OS│     │     Container Runtime        │  │
│  ├──────────┴──────────┴───────┤      │         (Docker)             │  │
│  │         Hypervisor          │      ├─────────────────────────────┤  │
│  ├─────────────────────────────┤      │         Host OS              │  │
│  │         Host OS             │      ├─────────────────────────────┤  │
│  ├─────────────────────────────┤      │       Infrastructure         │  │
│  │       Infrastructure        │      └─────────────────────────────┘  │
│  └─────────────────────────────┘                                        │
│                                                                         │
│  Each VM runs a complete OS         Containers share the host OS       │
│  (gigabytes of overhead)            kernel (megabytes of overhead)     │
│  Minutes to start                   Seconds to start                   │
│  Strong isolation                   Process-level isolation            │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘</code></pre>
<p>Containers are much lighter than virtual machines. A VM includes a complete operating system—several gigabytes of overhead for each application. Containers share the host operating system’s kernel, requiring only the application and its dependencies. This efficiency means you can run many more containers than VMs on the same hardware, and containers start in seconds rather than minutes.</p>
</section>
<section id="docker-fundamentals" class="level3" data-number="13.4.2">
<h3 data-number="13.4.2" class="anchored" data-anchor-id="docker-fundamentals"><span class="header-section-number">13.4.2</span> 11.3.2 Docker Fundamentals</h3>
<p><strong>Docker</strong> is the most popular container platform. It provides tools for building container images, running containers, and managing container lifecycle.</p>
<p>Key Docker concepts:</p>
<p><strong>Image</strong>: A read-only template containing the application and its dependencies. Images are built in layers—each instruction in a Dockerfile adds a layer. Layers are cached and shared between images, making builds efficient.</p>
<p><strong>Container</strong>: A running instance of an image. You can run multiple containers from the same image. Containers are isolated from each other and from the host system.</p>
<p><strong>Dockerfile</strong>: A text file containing instructions for building an image. Each instruction creates a layer in the image.</p>
<p><strong>Registry</strong>: A repository for storing and distributing images. Docker Hub is the public registry; organizations typically also use private registries.</p>
<p>Let’s create a Dockerfile for a Node.js application. We’ll examine each instruction in detail:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode dockerfile code-with-copy"><code class="sourceCode dockerfile"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Dockerfile for a Node.js application</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Stage 1: Build stage</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use Node 20 on Alpine Linux (small base image, ~50MB)</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> node:20-alpine <span class="kw">AS</span> builder</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Set working directory inside the container</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co"># All subsequent commands run relative to this directory</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="kw">WORKDIR</span> /app</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Copy package files first (separate from source code)</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="co"># This leverages Docker's layer caching - if package.json hasn't changed,</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="co"># npm install can be skipped on subsequent builds</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> package*.json ./</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Install ALL dependencies (including devDependencies for building)</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">npm</span> ci</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Now copy application source code</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="co"># This layer changes frequently, but previous layers are cached</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> . .</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Build the application (TypeScript compilation, bundling, etc.)</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">npm</span> run build</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Stage 2: Production stage</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Start fresh with a clean base image</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> node:20-alpine <span class="kw">AS</span> production</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Run as non-root user for security</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Alpine includes a 'node' user we can use</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a><span class="kw">USER</span> node</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Set working directory</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a><span class="kw">WORKDIR</span> /app</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Copy package files and install ONLY production dependencies</span></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> <span class="op">--chown=node:node</span> package*.json ./</span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">npm</span> ci <span class="at">--only</span><span class="op">=</span>production</span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Copy built application from builder stage</span></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a><span class="co"># We don't need source code or devDependencies</span></span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> <span class="op">--chown=node:node</span> <span class="op">--from=builder</span> /app/dist ./dist</span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Document which port the application uses</span></span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a><span class="co"># (doesn't actually expose it - that's done at runtime)</span></span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a><span class="kw">EXPOSE</span> 3000</span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Set environment to production</span></span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a><span class="kw">ENV</span> NODE_ENV=production</span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a><span class="co"># Health check - Docker monitors container health</span></span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a><span class="kw">HEALTHCHECK</span> <span class="op">--interval=30s</span> <span class="op">--timeout=3s</span> <span class="op">--start-period=5s</span> <span class="op">--retries=3</span> \</span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a>  <span class="kw">CMD</span> <span class="fu">wget</span> <span class="at">--quiet</span> <span class="at">--tries</span><span class="op">=</span>1 <span class="at">--spider</span> http://localhost:3000/health <span class="kw">||</span> <span class="bu">exit</span> 1</span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Command to run when container starts</span></span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a><span class="kw">CMD</span> [<span class="st">"node"</span>, <span class="st">"dist/index.js"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This Dockerfile demonstrates several best practices that deserve explanation:</p>
<p><strong>Multi-stage builds</strong> use multiple FROM instructions, each starting a new build stage. The first stage (<code>builder</code>) installs all dependencies and compiles the application. The second stage (<code>production</code>) starts fresh and copies only what’s needed to run the application. This produces a smaller final image—we don’t need TypeScript, build tools, or development dependencies in production.</p>
<p><strong>Layer ordering</strong> matters for build performance. Docker caches each layer and reuses it if the inputs haven’t changed. By copying <code>package.json</code> before source code, we cache the expensive <code>npm install</code> step. Only when dependencies change does npm reinstall; code changes trigger only the faster COPY and build steps.</p>
<p><strong>Running as non-root</strong> is a security best practice. If an attacker compromises your application, they have only the limited permissions of the <code>node</code> user, not full root access. The <code>--chown=node:node</code> flag ensures copied files are owned by this user.</p>
<p><strong>Health checks</strong> let Docker monitor container health. If the health check fails repeatedly, Docker can restart the container or (in orchestrated environments) replace it. The check should verify the application is actually working, not just that the process is running.</p>
<p>Let’s build and run this container:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Build the image and tag it with a name</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">-t</span> my-app:1.0.0 .</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># The build output shows each layer being created:</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># =&gt; [builder 1/6] FROM node:20-alpine</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co"># =&gt; [builder 2/6] WORKDIR /app</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co"># =&gt; [builder 3/6] COPY package*.json ./</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co"># =&gt; [builder 4/6] RUN npm ci</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co"># =&gt; [builder 5/6] COPY . .</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co"># =&gt; [builder 6/6] RUN npm run build</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="co"># =&gt; [production 1/5] FROM node:20-alpine</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co"># ...</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the container</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-d</span> <span class="dt">\</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">--name</span> my-app <span class="dt">\</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">-p</span> 3000:3000 <span class="dt">\</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">-e</span> DATABASE_URL=postgresql://... <span class="dt">\</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>  my-app:1.0.0</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Explanation of flags:</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a><span class="co"># -d: Run in background (detached mode)</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a><span class="co"># --name: Give the container a memorable name</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a><span class="co"># -p 3000:3000: Map host port 3000 to container port 3000</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a><span class="co"># -e: Set environment variables</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a><span class="co"># my-app:1.0.0: Image name and tag to run</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The <code>-p</code> flag (port mapping) is crucial for network access. The container runs in isolation—its port 3000 isn’t automatically accessible from outside. Port mapping connects a host port to the container port, allowing external traffic to reach the application.</p>
</section>
<section id="docker-compose-for-local-development" class="level3" data-number="13.4.3">
<h3 data-number="13.4.3" class="anchored" data-anchor-id="docker-compose-for-local-development"><span class="header-section-number">13.4.3</span> 11.3.3 Docker Compose for Local Development</h3>
<p>While a single container works for simple applications, real systems typically involve multiple services: a web server, database, cache, and perhaps other microservices. <strong>Docker Compose</strong> defines and runs multi-container applications from a single configuration file.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># docker-compose.yml</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Defines all services needed to run the application locally</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="fu">version</span><span class="kw">:</span><span class="at"> </span><span class="st">'3.8'</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co">  # Main application</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">app</span><span class="kw">:</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">build</span><span class="kw">:</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">context</span><span class="kw">:</span><span class="at"> .</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">dockerfile</span><span class="kw">:</span><span class="at"> Dockerfile</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">target</span><span class="kw">:</span><span class="at"> builder</span><span class="co">  # Use builder stage for hot reload</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">"3000:3000"</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">NODE_ENV</span><span class="kw">:</span><span class="at"> development</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">DATABASE_URL</span><span class="kw">:</span><span class="at"> postgresql://postgres:password@db:5432/taskflow</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">REDIS_URL</span><span class="kw">:</span><span class="at"> redis://redis:6379</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="co">      # Mount source code for hot reload</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="co">      # Changes on host immediately reflect in container</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> ./src:/app/src</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> ./package.json:/app/package.json</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">depends_on</span><span class="kw">:</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">db</span><span class="kw">:</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">condition</span><span class="kw">:</span><span class="at"> service_healthy</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">redis</span><span class="kw">:</span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">condition</span><span class="kw">:</span><span class="at"> service_started</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a><span class="co">    # Override CMD for development (enables hot reload)</span></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">command</span><span class="kw">:</span><span class="at"> npm run dev</span></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a><span class="co">  # PostgreSQL database</span></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">db</span><span class="kw">:</span></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> postgres:15-alpine</span></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">POSTGRES_USER</span><span class="kw">:</span><span class="at"> postgres</span></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">POSTGRES_PASSWORD</span><span class="kw">:</span><span class="at"> password</span></span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">POSTGRES_DB</span><span class="kw">:</span><span class="at"> taskflow</span></span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">"5432:5432"</span><span class="co">  # Expose for local database tools</span></span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a><span class="co">      # Persist data between container restarts</span></span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> postgres_data:/var/lib/postgresql/data</span></span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a><span class="co">      # Run initialization scripts on first startup</span></span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> ./scripts/init.sql:/docker-entrypoint-initdb.d/init.sql</span></span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">healthcheck</span><span class="kw">:</span></span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">test</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">"CMD-SHELL"</span><span class="kw">,</span><span class="at"> </span><span class="st">"pg_isready -U postgres"</span><span class="kw">]</span></span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">interval</span><span class="kw">:</span><span class="at"> 5s</span></span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">timeout</span><span class="kw">:</span><span class="at"> 5s</span></span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">retries</span><span class="kw">:</span><span class="at"> </span><span class="dv">5</span></span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a><span class="co">  # Redis for caching and sessions</span></span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">redis</span><span class="kw">:</span></span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> redis:7-alpine</span></span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">"6379:6379"</span></span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> redis_data:/data</span></span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a><span class="co">    # Enable persistence</span></span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">command</span><span class="kw">:</span><span class="at"> redis-server --appendonly yes</span></span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a><span class="co">  # Database admin UI (development only)</span></span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">adminer</span><span class="kw">:</span></span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> adminer</span></span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb14-66"><a href="#cb14-66" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">"8080:8080"</span></span>
<span id="cb14-67"><a href="#cb14-67" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">depends_on</span><span class="kw">:</span></span>
<span id="cb14-68"><a href="#cb14-68" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> db</span></span>
<span id="cb14-69"><a href="#cb14-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-70"><a href="#cb14-70" aria-hidden="true" tabindex="-1"></a><span class="co"># Named volumes persist data across container restarts</span></span>
<span id="cb14-71"><a href="#cb14-71" aria-hidden="true" tabindex="-1"></a><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb14-72"><a href="#cb14-72" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">postgres_data</span><span class="kw">:</span></span>
<span id="cb14-73"><a href="#cb14-73" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">redis_data</span><span class="kw">:</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This Compose file deserves detailed explanation:</p>
<p><strong>Service networking</strong>: Docker Compose creates a network connecting all services. Services reference each other by name—the app connects to <code>db:5432</code>, not <code>localhost:5432</code>. This name resolution happens automatically within the Docker network.</p>
<p><strong>Volume mounts</strong> serve different purposes. The <code>./src:/app/src</code> mount enables hot reload during development—edit code on your host, and changes appear immediately in the container. The <code>postgres_data:/var/lib/postgresql/data</code> volume persists database data; without it, the database would be empty each time you restart.</p>
<p><strong>Dependency management</strong> with <code>depends_on</code> ensures services start in order. The <code>condition: service_healthy</code> option waits until the database health check passes before starting the app, preventing connection errors during startup.</p>
<p><strong>Health checks</strong> in Compose mirror the Dockerfile pattern. The database health check uses <code>pg_isready</code>, a PostgreSQL utility that verifies the server is accepting connections.</p>
<p>Using Docker Compose:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Start all services in the background</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> compose up <span class="at">-d</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># View logs from all services</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> compose logs <span class="at">-f</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co"># View logs from specific service</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> compose logs <span class="at">-f</span> app</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Stop all services</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> compose down</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Stop and remove volumes (deletes database data!)</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> compose down <span class="at">-v</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Rebuild images after Dockerfile changes</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> compose build</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> compose up <span class="at">-d</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Docker Compose transforms local development by ensuring every developer runs identical environments. New team members can set up the entire application stack with a single command, eliminating hours of environment configuration.</p>
</section>
<section id="container-best-practices" class="level3" data-number="13.4.4">
<h3 data-number="13.4.4" class="anchored" data-anchor-id="container-best-practices"><span class="header-section-number">13.4.4</span> 11.3.4 Container Best Practices</h3>
<p>Building production-ready containers requires attention to security, size, and reliability:</p>
<pre><code>┌─────────────────────────────────────────────────────────────────────────┐
│                    CONTAINER BEST PRACTICES                             │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  SECURITY                                                               │
│  • Run as non-root user                                                 │
│  • Use minimal base images (Alpine, distroless)                         │
│  • Don't store secrets in images (use environment variables)            │
│  • Scan images for vulnerabilities                                      │
│  • Keep base images updated                                             │
│                                                                         │
│  SIZE OPTIMIZATION                                                      │
│  • Use multi-stage builds                                               │
│  • Choose small base images                                             │
│  • Minimize layer count (combine RUN commands)                          │
│  • Use .dockerignore to exclude unnecessary files                       │
│  • Remove package manager caches after installing                       │
│                                                                         │
│  RELIABILITY                                                            │
│  • Implement health checks                                              │
│  • Use specific version tags, not 'latest'                              │
│  • Make containers stateless (store state externally)                   │
│  • Handle signals properly (graceful shutdown)                          │
│  • Log to stdout/stderr (not files)                                     │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘</code></pre>
<p><strong>Image size matters</strong> more than you might think. Smaller images download faster, reducing deployment time. They also have fewer components that could contain vulnerabilities. A typical Node.js application on Alpine is around 100MB; on the full Debian-based image, it might be 1GB.</p>
<p><strong>Stateless containers</strong> are essential for scalability. If a container stores data locally (like file uploads), that data disappears when the container stops. Instead, store state in external services: databases for persistent data, Redis for sessions, S3 for file uploads. Stateless containers can be replaced freely, enabling scaling and rolling updates.</p>
<p><strong>Graceful shutdown</strong> ensures containers stop cleanly. When Docker sends SIGTERM to stop a container, your application should finish processing current requests before exiting. Here’s how to handle this in Node.js:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Graceful shutdown handler</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> server <span class="op">=</span> app<span class="op">.</span><span class="fu">listen</span>(<span class="dv">3000</span>)<span class="op">;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="bu">process</span><span class="op">.</span><span class="fu">on</span>(<span class="st">'SIGTERM'</span><span class="op">,</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">'SIGTERM received, starting graceful shutdown'</span>)<span class="op">;</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Stop accepting new requests</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  server<span class="op">.</span><span class="fu">close</span>(<span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">'HTTP server closed'</span>)<span class="op">;</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Close database connections</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> db<span class="op">.</span><span class="fu">destroy</span>()<span class="op">;</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">'Database connections closed'</span>)<span class="op">;</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Close Redis connection</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> redis<span class="op">.</span><span class="fu">quit</span>()<span class="op">;</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">'Redis connection closed'</span>)<span class="op">;</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">'Graceful shutdown complete'</span>)<span class="op">;</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>    <span class="bu">process</span><span class="op">.</span><span class="fu">exit</span>(<span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Force shutdown if graceful shutdown takes too long</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>  <span class="pp">setTimeout</span>(() <span class="kw">=&gt;</span> {</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">error</span>(<span class="st">'Forced shutdown after timeout'</span>)<span class="op">;</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>    <span class="bu">process</span><span class="op">.</span><span class="fu">exit</span>(<span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span> <span class="dv">30000</span>)<span class="op">;</span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Without graceful shutdown, in-flight requests fail when containers stop. This code stops accepting new connections, waits for existing requests to complete, closes database connections cleanly, and only then exits. The timeout ensures the process eventually terminates even if something hangs.</p>
<hr>
</section>
</section>
<section id="container-orchestration-with-kubernetes" class="level2" data-number="13.5">
<h2 data-number="13.5" class="anchored" data-anchor-id="container-orchestration-with-kubernetes"><span class="header-section-number">13.5</span> 11.4 Container Orchestration with Kubernetes</h2>
<p>Running a few containers manually is manageable. Running hundreds of containers across multiple servers, handling failures, scaling based on load, and performing rolling updates requires orchestration. <strong>Kubernetes</strong> (K8s) has become the standard platform for container orchestration.</p>
<section id="why-kubernetes" class="level3" data-number="13.5.1">
<h3 data-number="13.5.1" class="anchored" data-anchor-id="why-kubernetes"><span class="header-section-number">13.5.1</span> 11.4.1 Why Kubernetes?</h3>
<p>Consider the challenges of running containers at scale:</p>
<ul>
<li>How do you distribute containers across multiple servers?</li>
<li>What happens when a server fails? When a container crashes?</li>
<li>How do you update applications without downtime?</li>
<li>How do containers find and communicate with each other?</li>
<li>How do you scale up during high traffic and down when quiet?</li>
</ul>
<p>Kubernetes answers all these questions with a declarative model: you describe your desired state, and Kubernetes continuously works to achieve and maintain it.</p>
<pre><code>┌─────────────────────────────────────────────────────────────────────────┐
│                    KUBERNETES ARCHITECTURE                              │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  CONTROL PLANE (manages the cluster)                                    │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  API Server ←─── kubectl, CI/CD, other tools                    │   │
│  │      │                                                          │   │
│  │      ├── etcd (cluster state database)                          │   │
│  │      ├── Scheduler (assigns pods to nodes)                      │   │
│  │      └── Controller Manager (maintains desired state)           │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                              │                                          │
│                              ▼                                          │
│  WORKER NODES (run your applications)                                   │
│  ┌─────────────────────┐  ┌─────────────────────┐  ┌─────────────────┐ │
│  │      Node 1         │  │      Node 2         │  │      Node 3     │ │
│  │  ┌──────┐ ┌──────┐  │  │  ┌──────┐ ┌──────┐  │  │  ┌──────┐       │ │
│  │  │ Pod  │ │ Pod  │  │  │  │ Pod  │ │ Pod  │  │  │  │ Pod  │       │ │
│  │  │(app) │ │(app) │  │  │  │(app) │ │ (db) │  │  │  │(app) │       │ │
│  │  └──────┘ └──────┘  │  │  └──────┘ └──────┘  │  │  └──────┘       │ │
│  │                     │  │                     │  │                 │ │
│  │  kubelet (agent)    │  │  kubelet            │  │  kubelet        │ │
│  │  kube-proxy(network)│  │  kube-proxy         │  │  kube-proxy     │ │
│  └─────────────────────┘  └─────────────────────┘  └─────────────────┘ │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘</code></pre>
<p>The <strong>control plane</strong> is Kubernetes’ brain. The API Server is the central communication hub—all interactions go through it. etcd stores all cluster state (a distributed key-value database). The Scheduler decides which node should run each new pod. Controller managers watch the cluster state and work to match it to the desired state.</p>
<p><strong>Worker nodes</strong> run your applications. Each node runs kubelet (an agent that manages pods on that node) and kube-proxy (handles networking). Nodes can be physical servers or virtual machines.</p>
</section>
<section id="core-kubernetes-concepts" class="level3" data-number="13.5.2">
<h3 data-number="13.5.2" class="anchored" data-anchor-id="core-kubernetes-concepts"><span class="header-section-number">13.5.2</span> 11.4.2 Core Kubernetes Concepts</h3>
<p>Kubernetes introduces several abstractions for managing containerized applications:</p>
<p><strong>Pod</strong>: The smallest deployable unit in Kubernetes. A pod contains one or more containers that share storage and network. Containers in a pod can communicate via localhost. While pods can contain multiple containers, most pods contain just one—the application container.</p>
<p><strong>Deployment</strong>: Manages a set of identical pods. You specify a container image and how many replicas you want; the Deployment ensures that many pods are always running. Deployments handle rolling updates, scaling, and self-healing (restarting failed pods).</p>
<p><strong>Service</strong>: Provides a stable network endpoint for accessing pods. Pods come and go (they might be rescheduled to different nodes), but a Service maintains a consistent IP address and DNS name. Services also load-balance traffic across pod replicas.</p>
<p><strong>ConfigMap and Secret</strong>: Store configuration data separately from application code. ConfigMaps hold non-sensitive configuration; Secrets hold sensitive data like passwords and API keys (encrypted at rest).</p>
<p>Let’s define a complete application deployment:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># kubernetes/deployment.yaml</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Defines the desired state for our application pods</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> apps/v1</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Deployment</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> taskflow-api</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">labels</span><span class="kw">:</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">app</span><span class="kw">:</span><span class="at"> taskflow</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">component</span><span class="kw">:</span><span class="at"> api</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="co">  # Run 3 replicas for high availability</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">replicas</span><span class="kw">:</span><span class="at"> </span><span class="dv">3</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="co">  # How to identify pods managed by this Deployment</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">selector</span><span class="kw">:</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">matchLabels</span><span class="kw">:</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">app</span><span class="kw">:</span><span class="at"> taskflow</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">component</span><span class="kw">:</span><span class="at"> api</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a><span class="co">  # Strategy for updating pods</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">strategy</span><span class="kw">:</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">type</span><span class="kw">:</span><span class="at"> RollingUpdate</span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">rollingUpdate</span><span class="kw">:</span></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a><span class="co">      # During updates, allow up to 1 extra pod temporarily</span></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">maxSurge</span><span class="kw">:</span><span class="at"> </span><span class="dv">1</span></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a><span class="co">      # During updates, ensure at least 2 pods are always running</span></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">maxUnavailable</span><span class="kw">:</span><span class="at"> </span><span class="dv">1</span></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a><span class="co">  # Pod template - defines what each pod looks like</span></span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">template</span><span class="kw">:</span></span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">labels</span><span class="kw">:</span></span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">app</span><span class="kw">:</span><span class="at"> taskflow</span></span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">component</span><span class="kw">:</span><span class="at"> api</span></span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a><span class="co">      # Run pods on different nodes when possible (anti-affinity)</span></span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">affinity</span><span class="kw">:</span></span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">podAntiAffinity</span><span class="kw">:</span></span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">preferredDuringSchedulingIgnoredDuringExecution</span><span class="kw">:</span></span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="kw">-</span><span class="at"> </span><span class="fu">weight</span><span class="kw">:</span><span class="at"> </span><span class="dv">100</span></span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">podAffinityTerm</span><span class="kw">:</span></span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a><span class="at">                </span><span class="fu">labelSelector</span><span class="kw">:</span></span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a><span class="at">                  </span><span class="fu">matchLabels</span><span class="kw">:</span></span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a><span class="at">                    </span><span class="fu">app</span><span class="kw">:</span><span class="at"> taskflow</span></span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a><span class="at">                    </span><span class="fu">component</span><span class="kw">:</span><span class="at"> api</span></span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a><span class="at">                </span><span class="fu">topologyKey</span><span class="kw">:</span><span class="at"> kubernetes.io/hostname</span></span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a><span class="at">      </span></span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">containers</span><span class="kw">:</span></span>
<span id="cb19-50"><a href="#cb19-50" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> api</span></span>
<span id="cb19-51"><a href="#cb19-51" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">image</span><span class="kw">:</span><span class="at"> myregistry/taskflow-api:1.2.0</span></span>
<span id="cb19-52"><a href="#cb19-52" aria-hidden="true" tabindex="-1"></a><span class="at">          </span></span>
<span id="cb19-53"><a href="#cb19-53" aria-hidden="true" tabindex="-1"></a><span class="co">          # Resource limits and requests</span></span>
<span id="cb19-54"><a href="#cb19-54" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">resources</span><span class="kw">:</span></span>
<span id="cb19-55"><a href="#cb19-55" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">requests</span><span class="kw">:</span></span>
<span id="cb19-56"><a href="#cb19-56" aria-hidden="true" tabindex="-1"></a><span class="co">              # Minimum resources guaranteed</span></span>
<span id="cb19-57"><a href="#cb19-57" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">memory</span><span class="kw">:</span><span class="at"> </span><span class="st">"256Mi"</span></span>
<span id="cb19-58"><a href="#cb19-58" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">cpu</span><span class="kw">:</span><span class="at"> </span><span class="st">"250m"</span><span class="co">  # 250 millicores = 0.25 CPU</span></span>
<span id="cb19-59"><a href="#cb19-59" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">limits</span><span class="kw">:</span></span>
<span id="cb19-60"><a href="#cb19-60" aria-hidden="true" tabindex="-1"></a><span class="co">              # Maximum resources allowed</span></span>
<span id="cb19-61"><a href="#cb19-61" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">memory</span><span class="kw">:</span><span class="at"> </span><span class="st">"512Mi"</span></span>
<span id="cb19-62"><a href="#cb19-62" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">cpu</span><span class="kw">:</span><span class="at"> </span><span class="st">"500m"</span></span>
<span id="cb19-63"><a href="#cb19-63" aria-hidden="true" tabindex="-1"></a><span class="at">          </span></span>
<span id="cb19-64"><a href="#cb19-64" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb19-65"><a href="#cb19-65" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="kw">-</span><span class="at"> </span><span class="fu">containerPort</span><span class="kw">:</span><span class="at"> </span><span class="dv">3000</span></span>
<span id="cb19-66"><a href="#cb19-66" aria-hidden="true" tabindex="-1"></a><span class="at">          </span></span>
<span id="cb19-67"><a href="#cb19-67" aria-hidden="true" tabindex="-1"></a><span class="co">          # Environment variables from ConfigMap and Secrets</span></span>
<span id="cb19-68"><a href="#cb19-68" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">env</span><span class="kw">:</span></span>
<span id="cb19-69"><a href="#cb19-69" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> NODE_ENV</span></span>
<span id="cb19-70"><a href="#cb19-70" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">value</span><span class="kw">:</span><span class="at"> </span><span class="st">"production"</span></span>
<span id="cb19-71"><a href="#cb19-71" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> PORT</span></span>
<span id="cb19-72"><a href="#cb19-72" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">value</span><span class="kw">:</span><span class="at"> </span><span class="st">"3000"</span></span>
<span id="cb19-73"><a href="#cb19-73" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> DATABASE_URL</span></span>
<span id="cb19-74"><a href="#cb19-74" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">valueFrom</span><span class="kw">:</span></span>
<span id="cb19-75"><a href="#cb19-75" aria-hidden="true" tabindex="-1"></a><span class="at">                </span><span class="fu">secretKeyRef</span><span class="kw">:</span></span>
<span id="cb19-76"><a href="#cb19-76" aria-hidden="true" tabindex="-1"></a><span class="at">                  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> taskflow-secrets</span></span>
<span id="cb19-77"><a href="#cb19-77" aria-hidden="true" tabindex="-1"></a><span class="at">                  </span><span class="fu">key</span><span class="kw">:</span><span class="at"> database-url</span></span>
<span id="cb19-78"><a href="#cb19-78" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> REDIS_URL</span></span>
<span id="cb19-79"><a href="#cb19-79" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">valueFrom</span><span class="kw">:</span></span>
<span id="cb19-80"><a href="#cb19-80" aria-hidden="true" tabindex="-1"></a><span class="at">                </span><span class="fu">configMapKeyRef</span><span class="kw">:</span></span>
<span id="cb19-81"><a href="#cb19-81" aria-hidden="true" tabindex="-1"></a><span class="at">                  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> taskflow-config</span></span>
<span id="cb19-82"><a href="#cb19-82" aria-hidden="true" tabindex="-1"></a><span class="at">                  </span><span class="fu">key</span><span class="kw">:</span><span class="at"> redis-url</span></span>
<span id="cb19-83"><a href="#cb19-83" aria-hidden="true" tabindex="-1"></a><span class="at">          </span></span>
<span id="cb19-84"><a href="#cb19-84" aria-hidden="true" tabindex="-1"></a><span class="co">          # Readiness probe - is the pod ready to receive traffic?</span></span>
<span id="cb19-85"><a href="#cb19-85" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">readinessProbe</span><span class="kw">:</span></span>
<span id="cb19-86"><a href="#cb19-86" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">httpGet</span><span class="kw">:</span></span>
<span id="cb19-87"><a href="#cb19-87" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">path</span><span class="kw">:</span><span class="at"> /health/ready</span></span>
<span id="cb19-88"><a href="#cb19-88" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">port</span><span class="kw">:</span><span class="at"> </span><span class="dv">3000</span></span>
<span id="cb19-89"><a href="#cb19-89" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">initialDelaySeconds</span><span class="kw">:</span><span class="at"> </span><span class="dv">5</span></span>
<span id="cb19-90"><a href="#cb19-90" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">periodSeconds</span><span class="kw">:</span><span class="at"> </span><span class="dv">10</span></span>
<span id="cb19-91"><a href="#cb19-91" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">failureThreshold</span><span class="kw">:</span><span class="at"> </span><span class="dv">3</span></span>
<span id="cb19-92"><a href="#cb19-92" aria-hidden="true" tabindex="-1"></a><span class="at">          </span></span>
<span id="cb19-93"><a href="#cb19-93" aria-hidden="true" tabindex="-1"></a><span class="co">          # Liveness probe - is the pod still alive?</span></span>
<span id="cb19-94"><a href="#cb19-94" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">livenessProbe</span><span class="kw">:</span></span>
<span id="cb19-95"><a href="#cb19-95" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">httpGet</span><span class="kw">:</span></span>
<span id="cb19-96"><a href="#cb19-96" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">path</span><span class="kw">:</span><span class="at"> /health/live</span></span>
<span id="cb19-97"><a href="#cb19-97" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">port</span><span class="kw">:</span><span class="at"> </span><span class="dv">3000</span></span>
<span id="cb19-98"><a href="#cb19-98" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">initialDelaySeconds</span><span class="kw">:</span><span class="at"> </span><span class="dv">15</span></span>
<span id="cb19-99"><a href="#cb19-99" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">periodSeconds</span><span class="kw">:</span><span class="at"> </span><span class="dv">20</span></span>
<span id="cb19-100"><a href="#cb19-100" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">failureThreshold</span><span class="kw">:</span><span class="at"> </span><span class="dv">3</span></span>
<span id="cb19-101"><a href="#cb19-101" aria-hidden="true" tabindex="-1"></a><span class="at">          </span></span>
<span id="cb19-102"><a href="#cb19-102" aria-hidden="true" tabindex="-1"></a><span class="co">          # Startup probe - has the pod finished starting?</span></span>
<span id="cb19-103"><a href="#cb19-103" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">startupProbe</span><span class="kw">:</span></span>
<span id="cb19-104"><a href="#cb19-104" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">httpGet</span><span class="kw">:</span></span>
<span id="cb19-105"><a href="#cb19-105" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">path</span><span class="kw">:</span><span class="at"> /health/live</span></span>
<span id="cb19-106"><a href="#cb19-106" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">port</span><span class="kw">:</span><span class="at"> </span><span class="dv">3000</span></span>
<span id="cb19-107"><a href="#cb19-107" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">initialDelaySeconds</span><span class="kw">:</span><span class="at"> </span><span class="dv">0</span></span>
<span id="cb19-108"><a href="#cb19-108" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">periodSeconds</span><span class="kw">:</span><span class="at"> </span><span class="dv">5</span></span>
<span id="cb19-109"><a href="#cb19-109" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">failureThreshold</span><span class="kw">:</span><span class="at"> </span><span class="dv">30</span><span class="co">  # 30 * 5 = 150s max startup time</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This deployment specification is dense with important concepts:</p>
<p><strong>Resource requests and limits</strong> control how much CPU and memory pods can use. Requests are guarantees—the scheduler only places pods on nodes with enough available resources. Limits are caps—containers exceeding limits may be throttled (CPU) or killed (memory). Setting these correctly is crucial for cluster stability and cost management.</p>
<p><strong>Pod anti-affinity</strong> spreads replicas across different nodes. If all three replicas ran on the same node and that node failed, the entire application would be down. Anti-affinity preferences (not hard requirements) help Kubernetes distribute pods for better fault tolerance.</p>
<p><strong>Probes</strong> tell Kubernetes about pod health:</p>
<ul>
<li><strong>Readiness probe</strong>: Can this pod handle requests? Pods failing readiness are removed from service load balancing but not restarted.</li>
<li><strong>Liveness probe</strong>: Is this pod still functioning? Pods failing liveness are restarted.</li>
<li><strong>Startup probe</strong>: Has this pod finished starting? Until the startup probe succeeds, liveness and readiness probes are disabled, preventing premature restarts during slow startups.</li>
</ul>
<p>Now let’s define a Service to expose these pods:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># kubernetes/service.yaml</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Creates a stable network endpoint for the API pods</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Service</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> taskflow-api</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">labels</span><span class="kw">:</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">app</span><span class="kw">:</span><span class="at"> taskflow</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">component</span><span class="kw">:</span><span class="at"> api</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">type</span><span class="kw">:</span><span class="at"> ClusterIP</span><span class="co">  # Internal-only; use LoadBalancer for external access</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="co">  # Which pods receive traffic from this service</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">selector</span><span class="kw">:</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">app</span><span class="kw">:</span><span class="at"> taskflow</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">component</span><span class="kw">:</span><span class="at"> api</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> http</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">port</span><span class="kw">:</span><span class="at"> </span><span class="dv">80</span><span class="co">           # Port exposed by the service</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">targetPort</span><span class="kw">:</span><span class="at"> </span><span class="dv">3000</span><span class="co">   # Port on the pods</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">protocol</span><span class="kw">:</span><span class="at"> TCP</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>A ClusterIP service is accessible only within the cluster—other pods can reach it via <code>taskflow-api:80</code>. For external access, you’d use a LoadBalancer service (creates a cloud load balancer) or an Ingress (more flexible HTTP routing).</p>
<p>ConfigMaps and Secrets store configuration:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># kubernetes/configmap.yaml</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> ConfigMap</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> taskflow-config</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span><span class="kw">:</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">redis-url</span><span class="kw">:</span><span class="at"> </span><span class="st">"redis://redis-service:6379"</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">log-level</span><span class="kw">:</span><span class="at"> </span><span class="st">"info"</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="fu">  feature-flags</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>      "newDashboard": true,</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>      "betaFeatures": false</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="co"># kubernetes/secret.yaml</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: In practice, use sealed-secrets or external-secrets</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Never commit actual secrets to version control!</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> v1</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> Secret</span></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> taskflow-secrets</span></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a><span class="fu">type</span><span class="kw">:</span><span class="at"> Opaque</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span><span class="kw">:</span></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a><span class="co">  # Values are base64 encoded (NOT encrypted!)</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a><span class="co">  # Use: echo -n "value" | base64</span></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">database-url</span><span class="kw">:</span><span class="at"> cG9zdGdyZXNxbDovL3VzZXI6cGFzc0Bob3N0OjU0MzIvZGI=</span></span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">jwt-secret</span><span class="kw">:</span><span class="at"> c3VwZXItc2VjcmV0LWtleS1jaGFuZ2UtdGhpcw==</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Important security note</strong>: Base64 encoding is NOT encryption. Anyone with access to the Secret can decode the values. For production, use solutions like HashiCorp Vault, AWS Secrets Manager, or sealed-secrets that provide actual encryption.</p>
</section>
<section id="deploying-to-kubernetes" class="level3" data-number="13.5.3">
<h3 data-number="13.5.3" class="anchored" data-anchor-id="deploying-to-kubernetes"><span class="header-section-number">13.5.3</span> 11.4.3 Deploying to Kubernetes</h3>
<p>With our manifests defined, let’s deploy the application:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply all manifests in a directory</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> apply <span class="at">-f</span> kubernetes/</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Watch deployment progress</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> rollout status deployment/taskflow-api</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co"># View running pods</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> get pods <span class="at">-l</span> app=taskflow</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Example output:</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="co"># NAME                           READY   STATUS    RESTARTS   AGE</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="co"># taskflow-api-7d9f8c6b5-abc12   1/1     Running   0          2m</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="co"># taskflow-api-7d9f8c6b5-def34   1/1     Running   0          2m</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="co"># taskflow-api-7d9f8c6b5-ghi56   1/1     Running   0          2m</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="co"># View detailed pod information</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> describe pod taskflow-api-7d9f8c6b5-abc12</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a><span class="co"># View pod logs</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> logs taskflow-api-7d9f8c6b5-abc12</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Follow logs in real-time</span></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> logs <span class="at">-f</span> taskflow-api-7d9f8c6b5-abc12</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Execute a command in a running pod (for debugging)</span></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> exec <span class="at">-it</span> taskflow-api-7d9f8c6b5-abc12 <span class="at">--</span> /bin/sh</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Rolling updates</strong> happen automatically when you change the deployment:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Update to a new image version</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> set image deployment/taskflow-api api=myregistry/taskflow-api:1.3.0</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Or edit the manifest and apply again</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> apply <span class="at">-f</span> kubernetes/deployment.yaml</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Watch the rollout</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> rollout status deployment/taskflow-api</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="co"># If something goes wrong, rollback to previous version</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> rollout undo deployment/taskflow-api</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="co"># View rollout history</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="ex">kubectl</span> rollout history deployment/taskflow-api</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>During a rolling update, Kubernetes gradually replaces old pods with new ones, ensuring the service remains available throughout. The <code>maxSurge</code> and <code>maxUnavailable</code> settings control how aggressive the rollout is.</p>
</section>
<section id="horizontal-pod-autoscaling" class="level3" data-number="13.5.4">
<h3 data-number="13.5.4" class="anchored" data-anchor-id="horizontal-pod-autoscaling"><span class="header-section-number">13.5.4</span> 11.4.4 Horizontal Pod Autoscaling</h3>
<p>Kubernetes can automatically adjust the number of pod replicas based on observed metrics:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># kubernetes/hpa.yaml</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> autoscaling/v2</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">kind</span><span class="kw">:</span><span class="at"> HorizontalPodAutoscaler</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> taskflow-api-hpa</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="fu">spec</span><span class="kw">:</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">scaleTargetRef</span><span class="kw">:</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">apiVersion</span><span class="kw">:</span><span class="at"> apps/v1</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">kind</span><span class="kw">:</span><span class="at"> Deployment</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">name</span><span class="kw">:</span><span class="at"> taskflow-api</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="co">  # Scaling boundaries</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">minReplicas</span><span class="kw">:</span><span class="at"> </span><span class="dv">2</span><span class="co">    # Never scale below 2 for availability</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">maxReplicas</span><span class="kw">:</span><span class="at"> </span><span class="dv">10</span><span class="co">   # Never scale above 10 for cost control</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a><span class="co">  # Metrics that trigger scaling</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">metrics</span><span class="kw">:</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a><span class="co">    # Scale based on CPU utilization</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">type</span><span class="kw">:</span><span class="at"> Resource</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">resource</span><span class="kw">:</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">name</span><span class="kw">:</span><span class="at"> cpu</span></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">target</span><span class="kw">:</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">type</span><span class="kw">:</span><span class="at"> Utilization</span></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">averageUtilization</span><span class="kw">:</span><span class="at"> </span><span class="dv">70</span><span class="co">  # Target 70% CPU usage</span></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a><span class="at">    </span></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a><span class="co">    # Scale based on memory utilization</span></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">type</span><span class="kw">:</span><span class="at"> Resource</span></span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">resource</span><span class="kw">:</span></span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">name</span><span class="kw">:</span><span class="at"> memory</span></span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">target</span><span class="kw">:</span></span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">type</span><span class="kw">:</span><span class="at"> Utilization</span></span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">averageUtilization</span><span class="kw">:</span><span class="at"> </span><span class="dv">80</span><span class="co">  # Target 80% memory usage</span></span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a><span class="co">  # Scaling behavior customization</span></span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">behavior</span><span class="kw">:</span></span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">scaleDown</span><span class="kw">:</span></span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a><span class="co">      # Wait 5 minutes before scaling down (prevents flapping)</span></span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">stabilizationWindowSeconds</span><span class="kw">:</span><span class="at"> </span><span class="dv">300</span></span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">policies</span><span class="kw">:</span></span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="fu">type</span><span class="kw">:</span><span class="at"> Percent</span></span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">value</span><span class="kw">:</span><span class="at"> </span><span class="dv">50</span><span class="co">           # Remove at most 50% of pods</span></span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">periodSeconds</span><span class="kw">:</span><span class="at"> </span><span class="dv">60</span><span class="co">   # Per minute</span></span>
<span id="cb24-43"><a href="#cb24-43" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">scaleUp</span><span class="kw">:</span></span>
<span id="cb24-44"><a href="#cb24-44" aria-hidden="true" tabindex="-1"></a><span class="co">      # Scale up more aggressively than down</span></span>
<span id="cb24-45"><a href="#cb24-45" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">stabilizationWindowSeconds</span><span class="kw">:</span><span class="at"> </span><span class="dv">0</span></span>
<span id="cb24-46"><a href="#cb24-46" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">policies</span><span class="kw">:</span></span>
<span id="cb24-47"><a href="#cb24-47" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="fu">type</span><span class="kw">:</span><span class="at"> Percent</span></span>
<span id="cb24-48"><a href="#cb24-48" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">value</span><span class="kw">:</span><span class="at"> </span><span class="dv">100</span><span class="co">          # Can double pod count</span></span>
<span id="cb24-49"><a href="#cb24-49" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">periodSeconds</span><span class="kw">:</span><span class="at"> </span><span class="dv">60</span></span>
<span id="cb24-50"><a href="#cb24-50" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="fu">type</span><span class="kw">:</span><span class="at"> Pods</span></span>
<span id="cb24-51"><a href="#cb24-51" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">value</span><span class="kw">:</span><span class="at"> </span><span class="dv">4</span><span class="co">            # Or add up to 4 pods</span></span>
<span id="cb24-52"><a href="#cb24-52" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">periodSeconds</span><span class="kw">:</span><span class="at"> </span><span class="dv">60</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The HPA continuously monitors pod metrics. When average CPU utilization exceeds 70%, it adds replicas to reduce the load per pod. When utilization drops, it removes replicas to save resources. The stabilization window prevents rapid oscillation—you don’t want to scale down immediately after scaling up.</p>
<p>The <code>behavior</code> section provides fine-grained control. Scale-up is typically more aggressive (you want to handle traffic spikes quickly) while scale-down is conservative (you don’t want to remove capacity prematurely).</p>
</section>
<section id="managed-kubernetes-services" class="level3" data-number="13.5.5">
<h3 data-number="13.5.5" class="anchored" data-anchor-id="managed-kubernetes-services"><span class="header-section-number">13.5.5</span> 11.4.5 Managed Kubernetes Services</h3>
<p>Running Kubernetes yourself is complex—the control plane alone requires careful setup and maintenance. Cloud providers offer managed Kubernetes services that handle control plane management:</p>
<pre><code>┌─────────────────────────────────────────────────────────────────────────┐
│                    MANAGED KUBERNETES SERVICES                          │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  AWS: Amazon EKS (Elastic Kubernetes Service)                           │
│  • Integrates with AWS services (IAM, VPC, ALB, EBS)                    │
│  • EKS Anywhere for hybrid deployments                                  │
│  • Fargate option for serverless pods                                   │
│                                                                         │
│  GCP: Google Kubernetes Engine (GKE)                                    │
│  • Most mature managed Kubernetes (Google created K8s)                  │
│  • Autopilot mode for fully managed node pools                          │
│  • Excellent network performance and observability                      │
│                                                                         │
│  Azure: Azure Kubernetes Service (AKS)                                  │
│  • Strong enterprise integration (Active Directory)                     │
│  • Azure Arc for hybrid/multi-cloud                                     │
│  • Virtual nodes for serverless containers                              │
│                                                                         │
│  All managed services provide:                                          │
│  • Managed control plane (automatic updates, high availability)         │
│  • Integration with cloud networking and storage                        │
│  • IAM integration for security                                         │
│  • Monitoring and logging integration                                   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘</code></pre>
<p>For most teams, managed Kubernetes is the right choice. You get the power and flexibility of Kubernetes without the operational burden of managing the control plane. Your team focuses on deploying applications rather than maintaining infrastructure.</p>
<hr>
</section>
</section>
<section id="serverless-computing" class="level2" data-number="13.6">
<h2 data-number="13.6" class="anchored" data-anchor-id="serverless-computing"><span class="header-section-number">13.6</span> 11.5 Serverless Computing</h2>
<p>Serverless computing represents a further abstraction beyond containers. Instead of managing servers (or even containers), you deploy functions that run in response to events. The cloud provider handles all infrastructure—provisioning, scaling, and maintenance.</p>
<section id="what-is-serverless" class="level3" data-number="13.6.1">
<h3 data-number="13.6.1" class="anchored" data-anchor-id="what-is-serverless"><span class="header-section-number">13.6.1</span> 11.5.1 What is Serverless?</h3>
<p>Despite the name, servers still exist—you just don’t manage them. “Serverless” means:</p>
<ul>
<li><strong>No server management</strong>: You don’t provision, patch, or maintain servers</li>
<li><strong>Automatic scaling</strong>: Functions scale from zero to thousands of instances automatically</li>
<li><strong>Pay-per-use</strong>: You pay only when your code runs, billed by execution time</li>
<li><strong>Event-driven</strong>: Functions execute in response to triggers (HTTP requests, queue messages, file uploads, schedules)</li>
</ul>
<pre><code>┌─────────────────────────────────────────────────────────────────────────┐
│                    SERVERLESS CHARACTERISTICS                           │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ADVANTAGES                          CHALLENGES                         │
│  ├── No server management            ├── Cold starts (latency)          │
│  ├── Automatic scaling               ├── Execution time limits          │
│  ├── Pay only for usage              ├── Stateless (no local storage)   │
│  ├── High availability built-in      ├── Vendor lock-in concerns        │
│  └── Reduced operational burden      └── Debugging complexity           │
│                                                                         │
│  BEST FOR                            NOT IDEAL FOR                      │
│  ├── Event-driven workloads          ├── Long-running processes         │
│  ├── Unpredictable traffic           ├── Stateful applications          │
│  ├── Background processing           ├── Latency-critical applications  │
│  ├── APIs with variable load         ├── High-throughput computing      │
│  └── Scheduled tasks                 └── WebSocket connections          │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘</code></pre>
<p><strong>Cold starts</strong> are a key consideration. When a function hasn’t run recently, the cloud provider must spin up a new execution environment—loading your code, initializing dependencies. This “cold start” adds latency (typically 100ms to a few seconds depending on runtime and code size). Subsequent invocations while the environment is “warm” are much faster.</p>
</section>
<section id="aws-lambda" class="level3" data-number="13.6.2">
<h3 data-number="13.6.2" class="anchored" data-anchor-id="aws-lambda"><span class="header-section-number">13.6.2</span> 11.5.2 AWS Lambda</h3>
<p>AWS Lambda is the most widely used serverless platform. Let’s create a Lambda function for processing task updates:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">// lambda/processTaskUpdate.js</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Dependencies are bundled with the deployment package</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> { DynamoDB } <span class="op">=</span> <span class="pp">require</span>(<span class="st">'@aws-sdk/client-dynamodb'</span>)<span class="op">;</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> { SNS } <span class="op">=</span> <span class="pp">require</span>(<span class="st">'@aws-sdk/client-sns'</span>)<span class="op">;</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co">// Initialize clients outside the handler</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="co">// These are reused across invocations (when warm)</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> dynamodb <span class="op">=</span> <span class="kw">new</span> <span class="fu">DynamoDB</span>({ <span class="dt">region</span><span class="op">:</span> <span class="st">'us-east-1'</span> })<span class="op">;</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> sns <span class="op">=</span> <span class="kw">new</span> <span class="fu">SNS</span>({ <span class="dt">region</span><span class="op">:</span> <span class="st">'us-east-1'</span> })<span class="op">;</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="co"> * Lambda handler function</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="cv">{Object}</span><span class="co"> event - Trigger event data (structure depends on trigger type)</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@param</span><span class="co"> </span><span class="cv">{Object}</span><span class="co"> context - Runtime information (function name, timeout, etc.)</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@returns</span><span class="co"> {Object} Response (structure depends on trigger type)</span></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>exports<span class="op">.</span><span class="at">handler</span> <span class="op">=</span> <span class="kw">async</span> (<span class="bu">event</span><span class="op">,</span> context) <span class="kw">=&gt;</span> {</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">'Processing event:'</span><span class="op">,</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(<span class="bu">event</span><span class="op">,</span> <span class="kw">null</span><span class="op">,</span> <span class="dv">2</span>))<span class="op">;</span></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">'Remaining time:'</span><span class="op">,</span> context<span class="op">.</span><span class="fu">getRemainingTimeInMillis</span>()<span class="op">,</span> <span class="st">'ms'</span>)<span class="op">;</span></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>  <span class="cf">try</span> {</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Parse the incoming request (API Gateway format)</span></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> body <span class="op">=</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">parse</span>(<span class="bu">event</span><span class="op">.</span><span class="at">body</span>)<span class="op">;</span></span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> taskId <span class="op">=</span> <span class="bu">event</span><span class="op">.</span><span class="at">pathParameters</span><span class="op">?.</span><span class="at">taskId</span><span class="op">;</span></span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Validate input</span></span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>taskId <span class="op">||</span> <span class="op">!</span>body<span class="op">.</span><span class="at">status</span>) {</span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> {</span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>        <span class="dt">statusCode</span><span class="op">:</span> <span class="dv">400</span><span class="op">,</span></span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a>        <span class="dt">headers</span><span class="op">:</span> {</span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a>          <span class="st">'Content-Type'</span><span class="op">:</span> <span class="st">'application/json'</span><span class="op">,</span></span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a>          <span class="st">'Access-Control-Allow-Origin'</span><span class="op">:</span> <span class="st">'*'</span>  <span class="co">// CORS</span></span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a>        <span class="dt">body</span><span class="op">:</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>({ <span class="dt">error</span><span class="op">:</span> <span class="st">'Missing taskId or status'</span> })</span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a>      }<span class="op">;</span></span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-40"><a href="#cb27-40" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Update task in DynamoDB</span></span>
<span id="cb27-41"><a href="#cb27-41" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> updateResult <span class="op">=</span> <span class="cf">await</span> dynamodb<span class="op">.</span><span class="fu">updateItem</span>({</span>
<span id="cb27-42"><a href="#cb27-42" aria-hidden="true" tabindex="-1"></a>      <span class="dt">TableName</span><span class="op">:</span> <span class="bu">process</span><span class="op">.</span><span class="at">env</span><span class="op">.</span><span class="at">TASKS_TABLE</span><span class="op">,</span></span>
<span id="cb27-43"><a href="#cb27-43" aria-hidden="true" tabindex="-1"></a>      <span class="dt">Key</span><span class="op">:</span> {</span>
<span id="cb27-44"><a href="#cb27-44" aria-hidden="true" tabindex="-1"></a>        <span class="dt">taskId</span><span class="op">:</span> { <span class="dt">S</span><span class="op">:</span> taskId }</span>
<span id="cb27-45"><a href="#cb27-45" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb27-46"><a href="#cb27-46" aria-hidden="true" tabindex="-1"></a>      <span class="dt">UpdateExpression</span><span class="op">:</span> <span class="st">'SET #status = :status, updatedAt = :now'</span><span class="op">,</span></span>
<span id="cb27-47"><a href="#cb27-47" aria-hidden="true" tabindex="-1"></a>      <span class="dt">ExpressionAttributeNames</span><span class="op">:</span> {</span>
<span id="cb27-48"><a href="#cb27-48" aria-hidden="true" tabindex="-1"></a>        <span class="st">'#status'</span><span class="op">:</span> <span class="st">'status'</span>  <span class="co">// status is a reserved word</span></span>
<span id="cb27-49"><a href="#cb27-49" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb27-50"><a href="#cb27-50" aria-hidden="true" tabindex="-1"></a>      <span class="dt">ExpressionAttributeValues</span><span class="op">:</span> {</span>
<span id="cb27-51"><a href="#cb27-51" aria-hidden="true" tabindex="-1"></a>        <span class="st">':status'</span><span class="op">:</span> { <span class="dt">S</span><span class="op">:</span> body<span class="op">.</span><span class="at">status</span> }<span class="op">,</span></span>
<span id="cb27-52"><a href="#cb27-52" aria-hidden="true" tabindex="-1"></a>        <span class="st">':now'</span><span class="op">:</span> { <span class="dt">S</span><span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">.</span><span class="fu">toISOString</span>() }</span>
<span id="cb27-53"><a href="#cb27-53" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb27-54"><a href="#cb27-54" aria-hidden="true" tabindex="-1"></a>      <span class="dt">ReturnValues</span><span class="op">:</span> <span class="st">'ALL_NEW'</span></span>
<span id="cb27-55"><a href="#cb27-55" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb27-56"><a href="#cb27-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-57"><a href="#cb27-57" aria-hidden="true" tabindex="-1"></a>    <span class="co">// If task is completed, send notification</span></span>
<span id="cb27-58"><a href="#cb27-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (body<span class="op">.</span><span class="at">status</span> <span class="op">===</span> <span class="st">'done'</span>) {</span>
<span id="cb27-59"><a href="#cb27-59" aria-hidden="true" tabindex="-1"></a>      <span class="cf">await</span> sns<span class="op">.</span><span class="fu">publish</span>({</span>
<span id="cb27-60"><a href="#cb27-60" aria-hidden="true" tabindex="-1"></a>        <span class="dt">TopicArn</span><span class="op">:</span> <span class="bu">process</span><span class="op">.</span><span class="at">env</span><span class="op">.</span><span class="at">NOTIFICATIONS_TOPIC</span><span class="op">,</span></span>
<span id="cb27-61"><a href="#cb27-61" aria-hidden="true" tabindex="-1"></a>        <span class="dt">Message</span><span class="op">:</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>({</span>
<span id="cb27-62"><a href="#cb27-62" aria-hidden="true" tabindex="-1"></a>          <span class="dt">type</span><span class="op">:</span> <span class="st">'TASK_COMPLETED'</span><span class="op">,</span></span>
<span id="cb27-63"><a href="#cb27-63" aria-hidden="true" tabindex="-1"></a>          <span class="dt">taskId</span><span class="op">:</span> taskId<span class="op">,</span></span>
<span id="cb27-64"><a href="#cb27-64" aria-hidden="true" tabindex="-1"></a>          <span class="dt">timestamp</span><span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">.</span><span class="fu">toISOString</span>()</span>
<span id="cb27-65"><a href="#cb27-65" aria-hidden="true" tabindex="-1"></a>        })<span class="op">,</span></span>
<span id="cb27-66"><a href="#cb27-66" aria-hidden="true" tabindex="-1"></a>        <span class="dt">MessageAttributes</span><span class="op">:</span> {</span>
<span id="cb27-67"><a href="#cb27-67" aria-hidden="true" tabindex="-1"></a>          <span class="dt">eventType</span><span class="op">:</span> {</span>
<span id="cb27-68"><a href="#cb27-68" aria-hidden="true" tabindex="-1"></a>            <span class="dt">DataType</span><span class="op">:</span> <span class="st">'String'</span><span class="op">,</span></span>
<span id="cb27-69"><a href="#cb27-69" aria-hidden="true" tabindex="-1"></a>            <span class="dt">StringValue</span><span class="op">:</span> <span class="st">'TASK_COMPLETED'</span></span>
<span id="cb27-70"><a href="#cb27-70" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb27-71"><a href="#cb27-71" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb27-72"><a href="#cb27-72" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb27-73"><a href="#cb27-73" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb27-74"><a href="#cb27-74" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-75"><a href="#cb27-75" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Return success response</span></span>
<span id="cb27-76"><a href="#cb27-76" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb27-77"><a href="#cb27-77" aria-hidden="true" tabindex="-1"></a>      <span class="dt">statusCode</span><span class="op">:</span> <span class="dv">200</span><span class="op">,</span></span>
<span id="cb27-78"><a href="#cb27-78" aria-hidden="true" tabindex="-1"></a>      <span class="dt">headers</span><span class="op">:</span> {</span>
<span id="cb27-79"><a href="#cb27-79" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Content-Type'</span><span class="op">:</span> <span class="st">'application/json'</span><span class="op">,</span></span>
<span id="cb27-80"><a href="#cb27-80" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Access-Control-Allow-Origin'</span><span class="op">:</span> <span class="st">'*'</span></span>
<span id="cb27-81"><a href="#cb27-81" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb27-82"><a href="#cb27-82" aria-hidden="true" tabindex="-1"></a>      <span class="dt">body</span><span class="op">:</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>({</span>
<span id="cb27-83"><a href="#cb27-83" aria-hidden="true" tabindex="-1"></a>        <span class="dt">message</span><span class="op">:</span> <span class="st">'Task updated successfully'</span><span class="op">,</span></span>
<span id="cb27-84"><a href="#cb27-84" aria-hidden="true" tabindex="-1"></a>        <span class="dt">task</span><span class="op">:</span> <span class="fu">unmarshallDynamoItem</span>(updateResult<span class="op">.</span><span class="at">Attributes</span>)</span>
<span id="cb27-85"><a href="#cb27-85" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb27-86"><a href="#cb27-86" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb27-87"><a href="#cb27-87" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-88"><a href="#cb27-88" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">catch</span> (error) {</span>
<span id="cb27-89"><a href="#cb27-89" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">error</span>(<span class="st">'Error processing task update:'</span><span class="op">,</span> error)<span class="op">;</span></span>
<span id="cb27-90"><a href="#cb27-90" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-91"><a href="#cb27-91" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Return error response</span></span>
<span id="cb27-92"><a href="#cb27-92" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb27-93"><a href="#cb27-93" aria-hidden="true" tabindex="-1"></a>      <span class="dt">statusCode</span><span class="op">:</span> <span class="dv">500</span><span class="op">,</span></span>
<span id="cb27-94"><a href="#cb27-94" aria-hidden="true" tabindex="-1"></a>      <span class="dt">headers</span><span class="op">:</span> {</span>
<span id="cb27-95"><a href="#cb27-95" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Content-Type'</span><span class="op">:</span> <span class="st">'application/json'</span><span class="op">,</span></span>
<span id="cb27-96"><a href="#cb27-96" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Access-Control-Allow-Origin'</span><span class="op">:</span> <span class="st">'*'</span></span>
<span id="cb27-97"><a href="#cb27-97" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb27-98"><a href="#cb27-98" aria-hidden="true" tabindex="-1"></a>      <span class="dt">body</span><span class="op">:</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>({ <span class="dt">error</span><span class="op">:</span> <span class="st">'Internal server error'</span> })</span>
<span id="cb27-99"><a href="#cb27-99" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb27-100"><a href="#cb27-100" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb27-101"><a href="#cb27-101" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb27-102"><a href="#cb27-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-103"><a href="#cb27-103" aria-hidden="true" tabindex="-1"></a><span class="co">// Helper to convert DynamoDB item format to plain object</span></span>
<span id="cb27-104"><a href="#cb27-104" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">unmarshallDynamoItem</span>(item) {</span>
<span id="cb27-105"><a href="#cb27-105" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> result <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb27-106"><a href="#cb27-106" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">const</span> [key<span class="op">,</span> value] <span class="kw">of</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">entries</span>(item)) {</span>
<span id="cb27-107"><a href="#cb27-107" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (value<span class="op">.</span><span class="at">S</span>) result[key] <span class="op">=</span> value<span class="op">.</span><span class="at">S</span><span class="op">;</span></span>
<span id="cb27-108"><a href="#cb27-108" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> (value<span class="op">.</span><span class="at">N</span>) result[key] <span class="op">=</span> <span class="bu">Number</span>(value<span class="op">.</span><span class="at">N</span>)<span class="op">;</span></span>
<span id="cb27-109"><a href="#cb27-109" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> (value<span class="op">.</span><span class="at">BOOL</span> <span class="op">!==</span> <span class="kw">undefined</span>) result[key] <span class="op">=</span> value<span class="op">.</span><span class="at">BOOL</span><span class="op">;</span></span>
<span id="cb27-110"><a href="#cb27-110" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> (value<span class="op">.</span><span class="at">NULL</span>) result[key] <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb27-111"><a href="#cb27-111" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb27-112"><a href="#cb27-112" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> result<span class="op">;</span></span>
<span id="cb27-113"><a href="#cb27-113" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Several patterns in this code are Lambda-specific:</p>
<p><strong>Client initialization outside the handler</strong> is crucial for performance. The handler function runs on every invocation, but code outside it runs only when the container starts (cold start). By creating clients outside, they’re reused across invocations, dramatically reducing latency.</p>
<p><strong>The event structure</strong> depends on the trigger. API Gateway sends HTTP request data; S3 sends bucket and object information; SQS sends message bodies. Your code must handle the specific event format.</p>
<p><strong>Environment variables</strong> (<code>process.env.TASKS_TABLE</code>) configure the function without code changes. You can have different values for staging and production deployments.</p>
</section>
<section id="infrastructure-as-code-for-lambda" class="level3" data-number="13.6.3">
<h3 data-number="13.6.3" class="anchored" data-anchor-id="infrastructure-as-code-for-lambda"><span class="header-section-number">13.6.3</span> 11.5.3 Infrastructure as Code for Lambda</h3>
<p>Managing Lambda functions manually through the console doesn’t scale. Let’s define our serverless infrastructure using the Serverless Framework:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># serverless.yml</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Serverless Framework configuration</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="fu">service</span><span class="kw">:</span><span class="at"> taskflow-api</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Use this specific version to avoid breaking changes</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="fu">frameworkVersion</span><span class="kw">:</span><span class="at"> </span><span class="st">'3'</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="fu">provider</span><span class="kw">:</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> aws</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">runtime</span><span class="kw">:</span><span class="at"> nodejs20.x</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">region</span><span class="kw">:</span><span class="at"> us-east-1</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">stage</span><span class="kw">:</span><span class="at"> ${opt:stage, 'dev'}</span><span class="co">  # Default to 'dev' if not specified</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a><span class="co">  # Environment variables available to all functions</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">TASKS_TABLE</span><span class="kw">:</span><span class="at"> ${self:service}-tasks-${self:provider.stage}</span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">NOTIFICATIONS_TOPIC</span><span class="kw">:</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">Ref</span><span class="kw">:</span><span class="at"> NotificationsTopic</span><span class="co">  # Reference to CloudFormation resource</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a><span class="co">  # IAM permissions for functions</span></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">iam</span><span class="kw">:</span></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">role</span><span class="kw">:</span></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">statements</span><span class="kw">:</span></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="fu">Effect</span><span class="kw">:</span><span class="at"> Allow</span></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">Action</span><span class="kw">:</span></span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="kw">-</span><span class="at"> dynamodb:GetItem</span></span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="kw">-</span><span class="at"> dynamodb:PutItem</span></span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="kw">-</span><span class="at"> dynamodb:UpdateItem</span></span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="kw">-</span><span class="at"> dynamodb:DeleteItem</span></span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="kw">-</span><span class="at"> dynamodb:Query</span></span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="kw">-</span><span class="at"> dynamodb:Scan</span></span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">Resource</span><span class="kw">:</span></span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="kw">-</span><span class="at"> !GetAtt TasksTable.Arn</span></span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="kw">-</span><span class="at"> !Join ['/', [!GetAtt TasksTable.Arn, 'index/*']]</span></span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="fu">Effect</span><span class="kw">:</span><span class="at"> Allow</span></span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">Action</span><span class="kw">:</span></span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="kw">-</span><span class="at"> sns:Publish</span></span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">Resource</span><span class="kw">:</span></span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="kw">-</span><span class="at"> !Ref NotificationsTopic</span></span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Lambda functions</span></span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a><span class="fu">functions</span><span class="kw">:</span></span>
<span id="cb28-44"><a href="#cb28-44" aria-hidden="true" tabindex="-1"></a><span class="co">  # Create task</span></span>
<span id="cb28-45"><a href="#cb28-45" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">createTask</span><span class="kw">:</span></span>
<span id="cb28-46"><a href="#cb28-46" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">handler</span><span class="kw">:</span><span class="at"> src/handlers/tasks.create</span></span>
<span id="cb28-47"><a href="#cb28-47" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">events</span><span class="kw">:</span></span>
<span id="cb28-48"><a href="#cb28-48" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">http</span><span class="kw">:</span></span>
<span id="cb28-49"><a href="#cb28-49" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">path</span><span class="kw">:</span><span class="at"> tasks</span></span>
<span id="cb28-50"><a href="#cb28-50" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">method</span><span class="kw">:</span><span class="at"> post</span></span>
<span id="cb28-51"><a href="#cb28-51" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">cors</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb28-52"><a href="#cb28-52" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb28-53"><a href="#cb28-53" aria-hidden="true" tabindex="-1"></a><span class="co">  # Get task</span></span>
<span id="cb28-54"><a href="#cb28-54" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">getTask</span><span class="kw">:</span></span>
<span id="cb28-55"><a href="#cb28-55" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">handler</span><span class="kw">:</span><span class="at"> src/handlers/tasks.get</span></span>
<span id="cb28-56"><a href="#cb28-56" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">events</span><span class="kw">:</span></span>
<span id="cb28-57"><a href="#cb28-57" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">http</span><span class="kw">:</span></span>
<span id="cb28-58"><a href="#cb28-58" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">path</span><span class="kw">:</span><span class="at"> tasks/{taskId}</span></span>
<span id="cb28-59"><a href="#cb28-59" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">method</span><span class="kw">:</span><span class="at"> get</span></span>
<span id="cb28-60"><a href="#cb28-60" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">cors</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb28-61"><a href="#cb28-61" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb28-62"><a href="#cb28-62" aria-hidden="true" tabindex="-1"></a><span class="co">  # Update task</span></span>
<span id="cb28-63"><a href="#cb28-63" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">updateTask</span><span class="kw">:</span></span>
<span id="cb28-64"><a href="#cb28-64" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">handler</span><span class="kw">:</span><span class="at"> src/handlers/tasks.update</span></span>
<span id="cb28-65"><a href="#cb28-65" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">events</span><span class="kw">:</span></span>
<span id="cb28-66"><a href="#cb28-66" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">http</span><span class="kw">:</span></span>
<span id="cb28-67"><a href="#cb28-67" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">path</span><span class="kw">:</span><span class="at"> tasks/{taskId}</span></span>
<span id="cb28-68"><a href="#cb28-68" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">method</span><span class="kw">:</span><span class="at"> patch</span></span>
<span id="cb28-69"><a href="#cb28-69" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">cors</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb28-70"><a href="#cb28-70" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb28-71"><a href="#cb28-71" aria-hidden="true" tabindex="-1"></a><span class="co">  # Process notifications (triggered by SNS)</span></span>
<span id="cb28-72"><a href="#cb28-72" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">processNotification</span><span class="kw">:</span></span>
<span id="cb28-73"><a href="#cb28-73" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">handler</span><span class="kw">:</span><span class="at"> src/handlers/notifications.process</span></span>
<span id="cb28-74"><a href="#cb28-74" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">events</span><span class="kw">:</span></span>
<span id="cb28-75"><a href="#cb28-75" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">sns</span><span class="kw">:</span></span>
<span id="cb28-76"><a href="#cb28-76" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="fu">arn</span><span class="kw">:</span><span class="at"> !Ref NotificationsTopic</span></span>
<span id="cb28-77"><a href="#cb28-77" aria-hidden="true" tabindex="-1"></a><span class="co">    # Increase timeout for notification processing</span></span>
<span id="cb28-78"><a href="#cb28-78" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">timeout</span><span class="kw">:</span><span class="at"> </span><span class="dv">30</span></span>
<span id="cb28-79"><a href="#cb28-79" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb28-80"><a href="#cb28-80" aria-hidden="true" tabindex="-1"></a><span class="co">  # Scheduled cleanup of old tasks</span></span>
<span id="cb28-81"><a href="#cb28-81" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">cleanupOldTasks</span><span class="kw">:</span></span>
<span id="cb28-82"><a href="#cb28-82" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">handler</span><span class="kw">:</span><span class="at"> src/handlers/tasks.cleanup</span></span>
<span id="cb28-83"><a href="#cb28-83" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">events</span><span class="kw">:</span></span>
<span id="cb28-84"><a href="#cb28-84" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">schedule</span><span class="kw">:</span><span class="at"> rate(1 day)</span><span class="co">  # Run daily</span></span>
<span id="cb28-85"><a href="#cb28-85" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">timeout</span><span class="kw">:</span><span class="at"> </span><span class="dv">300</span><span class="co">  # 5 minutes for batch processing</span></span>
<span id="cb28-86"><a href="#cb28-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-87"><a href="#cb28-87" aria-hidden="true" tabindex="-1"></a><span class="co"># AWS resources to create</span></span>
<span id="cb28-88"><a href="#cb28-88" aria-hidden="true" tabindex="-1"></a><span class="fu">resources</span><span class="kw">:</span></span>
<span id="cb28-89"><a href="#cb28-89" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">Resources</span><span class="kw">:</span></span>
<span id="cb28-90"><a href="#cb28-90" aria-hidden="true" tabindex="-1"></a><span class="co">    # DynamoDB table for tasks</span></span>
<span id="cb28-91"><a href="#cb28-91" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">TasksTable</span><span class="kw">:</span></span>
<span id="cb28-92"><a href="#cb28-92" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">Type</span><span class="kw">:</span><span class="at"> AWS::DynamoDB::Table</span></span>
<span id="cb28-93"><a href="#cb28-93" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">Properties</span><span class="kw">:</span></span>
<span id="cb28-94"><a href="#cb28-94" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">TableName</span><span class="kw">:</span><span class="at"> ${self:provider.environment.TASKS_TABLE}</span></span>
<span id="cb28-95"><a href="#cb28-95" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">BillingMode</span><span class="kw">:</span><span class="at"> PAY_PER_REQUEST</span><span class="co">  # On-demand pricing</span></span>
<span id="cb28-96"><a href="#cb28-96" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">AttributeDefinitions</span><span class="kw">:</span></span>
<span id="cb28-97"><a href="#cb28-97" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="fu">AttributeName</span><span class="kw">:</span><span class="at"> taskId</span></span>
<span id="cb28-98"><a href="#cb28-98" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">AttributeType</span><span class="kw">:</span><span class="at"> S</span></span>
<span id="cb28-99"><a href="#cb28-99" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="fu">AttributeName</span><span class="kw">:</span><span class="at"> userId</span></span>
<span id="cb28-100"><a href="#cb28-100" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">AttributeType</span><span class="kw">:</span><span class="at"> S</span></span>
<span id="cb28-101"><a href="#cb28-101" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="fu">AttributeName</span><span class="kw">:</span><span class="at"> status</span></span>
<span id="cb28-102"><a href="#cb28-102" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">AttributeType</span><span class="kw">:</span><span class="at"> S</span></span>
<span id="cb28-103"><a href="#cb28-103" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">KeySchema</span><span class="kw">:</span></span>
<span id="cb28-104"><a href="#cb28-104" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="fu">AttributeName</span><span class="kw">:</span><span class="at"> taskId</span></span>
<span id="cb28-105"><a href="#cb28-105" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">KeyType</span><span class="kw">:</span><span class="at"> HASH</span></span>
<span id="cb28-106"><a href="#cb28-106" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">GlobalSecondaryIndexes</span><span class="kw">:</span></span>
<span id="cb28-107"><a href="#cb28-107" aria-hidden="true" tabindex="-1"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="fu">IndexName</span><span class="kw">:</span><span class="at"> userId-status-index</span></span>
<span id="cb28-108"><a href="#cb28-108" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">KeySchema</span><span class="kw">:</span></span>
<span id="cb28-109"><a href="#cb28-109" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="kw">-</span><span class="at"> </span><span class="fu">AttributeName</span><span class="kw">:</span><span class="at"> userId</span></span>
<span id="cb28-110"><a href="#cb28-110" aria-hidden="true" tabindex="-1"></a><span class="at">                </span><span class="fu">KeyType</span><span class="kw">:</span><span class="at"> HASH</span></span>
<span id="cb28-111"><a href="#cb28-111" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="kw">-</span><span class="at"> </span><span class="fu">AttributeName</span><span class="kw">:</span><span class="at"> status</span></span>
<span id="cb28-112"><a href="#cb28-112" aria-hidden="true" tabindex="-1"></a><span class="at">                </span><span class="fu">KeyType</span><span class="kw">:</span><span class="at"> RANGE</span></span>
<span id="cb28-113"><a href="#cb28-113" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">Projection</span><span class="kw">:</span></span>
<span id="cb28-114"><a href="#cb28-114" aria-hidden="true" tabindex="-1"></a><span class="at">              </span><span class="fu">ProjectionType</span><span class="kw">:</span><span class="at"> ALL</span></span>
<span id="cb28-115"><a href="#cb28-115" aria-hidden="true" tabindex="-1"></a><span class="at">    </span></span>
<span id="cb28-116"><a href="#cb28-116" aria-hidden="true" tabindex="-1"></a><span class="co">    # SNS topic for notifications</span></span>
<span id="cb28-117"><a href="#cb28-117" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">NotificationsTopic</span><span class="kw">:</span></span>
<span id="cb28-118"><a href="#cb28-118" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">Type</span><span class="kw">:</span><span class="at"> AWS::SNS::Topic</span></span>
<span id="cb28-119"><a href="#cb28-119" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">Properties</span><span class="kw">:</span></span>
<span id="cb28-120"><a href="#cb28-120" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">TopicName</span><span class="kw">:</span><span class="at"> ${self:service}-notifications-${self:provider.stage}</span></span>
<span id="cb28-121"><a href="#cb28-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-122"><a href="#cb28-122" aria-hidden="true" tabindex="-1"></a><span class="fu">plugins</span><span class="kw">:</span></span>
<span id="cb28-123"><a href="#cb28-123" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> serverless-offline</span><span class="co">  # Local development</span></span>
<span id="cb28-124"><a href="#cb28-124" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> serverless-webpack</span><span class="co">  # Bundle and minimize code</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This configuration demonstrates the power of infrastructure as code:</p>
<p><strong>Everything is defined declaratively</strong>: Functions, triggers, databases, and messaging. Deploy with a single command (<code>serverless deploy</code>), and the framework creates everything.</p>
<p><strong>IAM permissions follow least privilege</strong>: Functions can only access the specific DynamoDB table and SNS topic they need. This limits the blast radius if code is compromised.</p>
<p><strong>Multiple trigger types</strong> show serverless flexibility: HTTP endpoints for API calls, SNS for event processing, scheduled events for batch jobs.</p>
<p><strong>Stages enable environments</strong>: Deploy to dev with <code>serverless deploy --stage dev</code>, to production with <code>--stage prod</code>. Each stage gets its own resources.</p>
</section>
<section id="serverless-patterns" class="level3" data-number="13.6.4">
<h3 data-number="13.6.4" class="anchored" data-anchor-id="serverless-patterns"><span class="header-section-number">13.6.4</span> 11.5.4 Serverless Patterns</h3>
<p>Serverless architecture enables several powerful patterns:</p>
<pre><code>┌─────────────────────────────────────────────────────────────────────────┐
│                    SERVERLESS ARCHITECTURE PATTERNS                     │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  API BACKEND                                                            │
│  API Gateway → Lambda → DynamoDB                                        │
│  Perfect for: CRUD APIs, mobile backends, webhooks                      │
│                                                                         │
│  EVENT PROCESSING                                                       │
│  S3 upload → Lambda → Process → Store results                           │
│  Perfect for: Image processing, data transformation, ETL                │
│                                                                         │
│  STREAM PROCESSING                                                      │
│  Kinesis/SQS → Lambda → Process → Store/Forward                         │
│  Perfect for: Real-time analytics, log processing, IoT data             │
│                                                                         │
│  SCHEDULED JOBS                                                         │
│  CloudWatch Events → Lambda → Perform task                              │
│  Perfect for: Cleanup jobs, reports, data sync                          │
│                                                                         │
│  FAN-OUT PATTERN                                                        │
│  SNS → Multiple Lambda functions in parallel                            │
│  Perfect for: Notifications, multi-target processing                    │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘</code></pre>
<p>Let’s implement the event processing pattern for image uploads:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co">// lambda/processImageUpload.js</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> { S3 } <span class="op">=</span> <span class="pp">require</span>(<span class="st">'@aws-sdk/client-s3'</span>)<span class="op">;</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> sharp <span class="op">=</span> <span class="pp">require</span>(<span class="st">'sharp'</span>)<span class="op">;</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> s3 <span class="op">=</span> <span class="kw">new</span> <span class="fu">S3</span>({ <span class="dt">region</span><span class="op">:</span> <span class="st">'us-east-1'</span> })<span class="op">;</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="co">// Define thumbnail sizes</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> THUMBNAIL_SIZES <span class="op">=</span> [</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">'small'</span><span class="op">,</span> <span class="dt">width</span><span class="op">:</span> <span class="dv">150</span><span class="op">,</span> <span class="dt">height</span><span class="op">:</span> <span class="dv">150</span> }<span class="op">,</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">'medium'</span><span class="op">,</span> <span class="dt">width</span><span class="op">:</span> <span class="dv">300</span><span class="op">,</span> <span class="dt">height</span><span class="op">:</span> <span class="dv">300</span> }<span class="op">,</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">'large'</span><span class="op">,</span> <span class="dt">width</span><span class="op">:</span> <span class="dv">600</span><span class="op">,</span> <span class="dt">height</span><span class="op">:</span> <span class="dv">600</span> }</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>]<span class="op">;</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a><span class="co"> * Triggered when an image is uploaded to the source bucket</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a><span class="co"> * Creates thumbnails and stores them in the destination bucket</span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>exports<span class="op">.</span><span class="at">handler</span> <span class="op">=</span> <span class="kw">async</span> (<span class="bu">event</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">'Processing S3 event:'</span><span class="op">,</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(<span class="bu">event</span><span class="op">,</span> <span class="kw">null</span><span class="op">,</span> <span class="dv">2</span>))<span class="op">;</span></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>  <span class="co">// S3 events can contain multiple records (batch)</span></span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> results <span class="op">=</span> <span class="cf">await</span> <span class="bu">Promise</span><span class="op">.</span><span class="fu">all</span>(</span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>    <span class="bu">event</span><span class="op">.</span><span class="at">Records</span><span class="op">.</span><span class="fu">map</span>(record <span class="kw">=&gt;</span> <span class="fu">processImage</span>(record))</span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>    <span class="dt">processed</span><span class="op">:</span> results<span class="op">.</span><span class="at">length</span><span class="op">,</span></span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>    results</span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a><span class="kw">async</span> <span class="kw">function</span> <span class="fu">processImage</span>(record) {</span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> bucket <span class="op">=</span> record<span class="op">.</span><span class="at">s3</span><span class="op">.</span><span class="at">bucket</span><span class="op">.</span><span class="at">name</span><span class="op">;</span></span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> key <span class="op">=</span> <span class="pp">decodeURIComponent</span>(record<span class="op">.</span><span class="at">s3</span><span class="op">.</span><span class="at">object</span><span class="op">.</span><span class="at">key</span><span class="op">.</span><span class="fu">replace</span>(<span class="ss">/</span><span class="sc">\+</span><span class="ss">/g</span><span class="op">,</span> <span class="st">' '</span>))<span class="op">;</span></span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="vs">`Processing image: </span><span class="sc">${</span>bucket<span class="sc">}</span><span class="vs">/</span><span class="sc">${</span>key<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-39"><a href="#cb30-39" aria-hidden="true" tabindex="-1"></a>  <span class="cf">try</span> {</span>
<span id="cb30-40"><a href="#cb30-40" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Download original image</span></span>
<span id="cb30-41"><a href="#cb30-41" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> original <span class="op">=</span> <span class="cf">await</span> s3<span class="op">.</span><span class="fu">getObject</span>({</span>
<span id="cb30-42"><a href="#cb30-42" aria-hidden="true" tabindex="-1"></a>      <span class="dt">Bucket</span><span class="op">:</span> bucket<span class="op">,</span></span>
<span id="cb30-43"><a href="#cb30-43" aria-hidden="true" tabindex="-1"></a>      <span class="dt">Key</span><span class="op">:</span> key</span>
<span id="cb30-44"><a href="#cb30-44" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb30-45"><a href="#cb30-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-46"><a href="#cb30-46" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Read image data into buffer</span></span>
<span id="cb30-47"><a href="#cb30-47" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> imageBuffer <span class="op">=</span> <span class="cf">await</span> <span class="fu">streamToBuffer</span>(original<span class="op">.</span><span class="at">Body</span>)<span class="op">;</span></span>
<span id="cb30-48"><a href="#cb30-48" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-49"><a href="#cb30-49" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Generate thumbnails in parallel</span></span>
<span id="cb30-50"><a href="#cb30-50" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> thumbnails <span class="op">=</span> <span class="cf">await</span> <span class="bu">Promise</span><span class="op">.</span><span class="fu">all</span>(</span>
<span id="cb30-51"><a href="#cb30-51" aria-hidden="true" tabindex="-1"></a>      THUMBNAIL_SIZES<span class="op">.</span><span class="fu">map</span>(size <span class="kw">=&gt;</span> <span class="fu">generateThumbnail</span>(imageBuffer<span class="op">,</span> size))</span>
<span id="cb30-52"><a href="#cb30-52" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb30-53"><a href="#cb30-53" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-54"><a href="#cb30-54" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Upload thumbnails to destination bucket</span></span>
<span id="cb30-55"><a href="#cb30-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="bu">Promise</span><span class="op">.</span><span class="fu">all</span>(</span>
<span id="cb30-56"><a href="#cb30-56" aria-hidden="true" tabindex="-1"></a>      thumbnails<span class="op">.</span><span class="fu">map</span>((thumbnail<span class="op">,</span> index) <span class="kw">=&gt;</span> {</span>
<span id="cb30-57"><a href="#cb30-57" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> size <span class="op">=</span> THUMBNAIL_SIZES[index]<span class="op">;</span></span>
<span id="cb30-58"><a href="#cb30-58" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> thumbnailKey <span class="op">=</span> key<span class="op">.</span><span class="fu">replace</span>(</span>
<span id="cb30-59"><a href="#cb30-59" aria-hidden="true" tabindex="-1"></a>          <span class="ss">/</span><span class="sc">(\.[^.]+)$</span><span class="ss">/</span><span class="op">,</span></span>
<span id="cb30-60"><a href="#cb30-60" aria-hidden="true" tabindex="-1"></a>          <span class="vs">`-</span><span class="sc">${</span>size<span class="op">.</span><span class="at">name</span><span class="sc">}</span><span class="vs">$1`</span></span>
<span id="cb30-61"><a href="#cb30-61" aria-hidden="true" tabindex="-1"></a>        )<span class="op">;</span></span>
<span id="cb30-62"><a href="#cb30-62" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-63"><a href="#cb30-63" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> s3<span class="op">.</span><span class="fu">putObject</span>({</span>
<span id="cb30-64"><a href="#cb30-64" aria-hidden="true" tabindex="-1"></a>          <span class="dt">Bucket</span><span class="op">:</span> <span class="bu">process</span><span class="op">.</span><span class="at">env</span><span class="op">.</span><span class="at">DESTINATION_BUCKET</span><span class="op">,</span></span>
<span id="cb30-65"><a href="#cb30-65" aria-hidden="true" tabindex="-1"></a>          <span class="dt">Key</span><span class="op">:</span> thumbnailKey<span class="op">,</span></span>
<span id="cb30-66"><a href="#cb30-66" aria-hidden="true" tabindex="-1"></a>          <span class="dt">Body</span><span class="op">:</span> thumbnail<span class="op">,</span></span>
<span id="cb30-67"><a href="#cb30-67" aria-hidden="true" tabindex="-1"></a>          <span class="dt">ContentType</span><span class="op">:</span> <span class="st">'image/jpeg'</span></span>
<span id="cb30-68"><a href="#cb30-68" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb30-69"><a href="#cb30-69" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb30-70"><a href="#cb30-70" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb30-71"><a href="#cb30-71" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-72"><a href="#cb30-72" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="vs">`Successfully processed: </span><span class="sc">${</span>key<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb30-73"><a href="#cb30-73" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> { key<span class="op">,</span> <span class="dt">status</span><span class="op">:</span> <span class="st">'success'</span> }<span class="op">;</span></span>
<span id="cb30-74"><a href="#cb30-74" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-75"><a href="#cb30-75" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">catch</span> (error) {</span>
<span id="cb30-76"><a href="#cb30-76" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">error</span>(<span class="vs">`Error processing </span><span class="sc">${</span>key<span class="sc">}</span><span class="vs">:`</span><span class="op">,</span> error)<span class="op">;</span></span>
<span id="cb30-77"><a href="#cb30-77" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> { key<span class="op">,</span> <span class="dt">status</span><span class="op">:</span> <span class="st">'error'</span><span class="op">,</span> <span class="dt">error</span><span class="op">:</span> error<span class="op">.</span><span class="at">message</span> }<span class="op">;</span></span>
<span id="cb30-78"><a href="#cb30-78" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb30-79"><a href="#cb30-79" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-80"><a href="#cb30-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-81"><a href="#cb30-81" aria-hidden="true" tabindex="-1"></a><span class="kw">async</span> <span class="kw">function</span> <span class="fu">generateThumbnail</span>(imageBuffer<span class="op">,</span> { width<span class="op">,</span> height }) {</span>
<span id="cb30-82"><a href="#cb30-82" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">sharp</span>(imageBuffer)</span>
<span id="cb30-83"><a href="#cb30-83" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">resize</span>(width<span class="op">,</span> height<span class="op">,</span> {</span>
<span id="cb30-84"><a href="#cb30-84" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fit</span><span class="op">:</span> <span class="st">'cover'</span><span class="op">,</span></span>
<span id="cb30-85"><a href="#cb30-85" aria-hidden="true" tabindex="-1"></a>      <span class="dt">position</span><span class="op">:</span> <span class="st">'center'</span></span>
<span id="cb30-86"><a href="#cb30-86" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb30-87"><a href="#cb30-87" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">jpeg</span>({ <span class="dt">quality</span><span class="op">:</span> <span class="dv">80</span> })</span>
<span id="cb30-88"><a href="#cb30-88" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">toBuffer</span>()<span class="op">;</span></span>
<span id="cb30-89"><a href="#cb30-89" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-90"><a href="#cb30-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-91"><a href="#cb30-91" aria-hidden="true" tabindex="-1"></a><span class="kw">async</span> <span class="kw">function</span> <span class="fu">streamToBuffer</span>(stream) {</span>
<span id="cb30-92"><a href="#cb30-92" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> chunks <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb30-93"><a href="#cb30-93" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> <span class="cf">await</span> (<span class="kw">const</span> chunk <span class="kw">of</span> stream) {</span>
<span id="cb30-94"><a href="#cb30-94" aria-hidden="true" tabindex="-1"></a>    chunks<span class="op">.</span><span class="fu">push</span>(chunk)<span class="op">;</span></span>
<span id="cb30-95"><a href="#cb30-95" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb30-96"><a href="#cb30-96" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">Buffer</span><span class="op">.</span><span class="fu">concat</span>(chunks)<span class="op">;</span></span>
<span id="cb30-97"><a href="#cb30-97" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This function demonstrates the event processing pattern:</p>
<p><strong>Trigger</strong>: S3 fires an event when a file is uploaded. The event contains bucket name and object key.</p>
<p><strong>Processing</strong>: The function downloads the image, generates multiple thumbnail sizes using Sharp (a high-performance image library), and uploads results to a destination bucket.</p>
<p><strong>Parallel processing</strong>: We use <code>Promise.all</code> to generate and upload thumbnails concurrently, minimizing execution time (and cost, since Lambda charges by duration).</p>
<p><strong>Error handling</strong>: Each image is processed independently. If one fails, others still complete. Errors are logged for debugging and returned for monitoring.</p>
</section>
<section id="when-to-use-serverless" class="level3" data-number="13.6.5">
<h3 data-number="13.6.5" class="anchored" data-anchor-id="when-to-use-serverless"><span class="header-section-number">13.6.5</span> 11.5.5 When to Use Serverless</h3>
<p>Serverless shines in specific scenarios but isn’t always the best choice:</p>
<pre><code>┌─────────────────────────────────────────────────────────────────────────┐
│                    SERVERLESS DECISION FRAMEWORK                        │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  CHOOSE SERVERLESS WHEN:                                                │
│                                                                         │
│  ✓ Traffic is unpredictable or spiky                                    │
│    → Pay only for actual usage, automatic scaling                       │
│                                                                         │
│  ✓ You want minimal operational overhead                                │
│    → No servers to patch, no capacity planning                          │
│                                                                         │
│  ✓ Workloads are event-driven                                           │
│    → Natural fit for triggers (HTTP, S3, queues, schedules)             │
│                                                                         │
│  ✓ Execution time is short (&lt;15 minutes)                                │
│    → Lambda has a 15-minute maximum                                     │
│                                                                         │
│  ✓ Team is small and wants to focus on code                             │
│    → Reduces DevOps burden significantly                                │
│                                                                         │
│  CHOOSE CONTAINERS/VMS WHEN:                                            │
│                                                                         │
│  ✗ Workloads are long-running                                           │
│    → Lambda timeout limits; containers run indefinitely                 │
│                                                                         │
│  ✗ Latency is critical (sub-100ms consistently)                         │
│    → Cold starts add unpredictable latency                              │
│                                                                         │
│  ✗ Traffic is steady and predictable                                    │
│    → Reserved capacity is often cheaper                                 │
│                                                                         │
│  ✗ You need persistent connections (WebSockets)                         │
│    → Serverless functions are short-lived                               │
│                                                                         │
│  ✗ Vendor lock-in is a concern                                          │
│    → Containers are portable; Lambda code requires changes              │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘</code></pre>
<p>Many successful architectures combine approaches: a containerized core API for consistent latency with serverless functions for background processing, scheduled jobs, and traffic spikes.</p>
<hr>
</section>
</section>
<section id="infrastructure-as-code" class="level2" data-number="13.7">
<h2 data-number="13.7" class="anchored" data-anchor-id="infrastructure-as-code"><span class="header-section-number">13.7</span> 11.6 Infrastructure as Code</h2>
<p>We’ve seen bits of Infrastructure as Code (IaC) throughout this chapter—Docker Compose, Kubernetes manifests, Serverless Framework. IaC is the practice of managing infrastructure through code rather than manual processes. This approach brings software engineering practices to infrastructure: version control, code review, testing, and reproducibility.</p>
<section id="benefits-of-infrastructure-as-code" class="level3" data-number="13.7.1">
<h3 data-number="13.7.1" class="anchored" data-anchor-id="benefits-of-infrastructure-as-code"><span class="header-section-number">13.7.1</span> 11.6.1 Benefits of Infrastructure as Code</h3>
<pre><code>┌─────────────────────────────────────────────────────────────────────────┐
│                    INFRASTRUCTURE AS CODE BENEFITS                      │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  REPRODUCIBILITY                                                        │
│  Create identical environments every time. Development, staging, and    │
│  production are truly equivalent, eliminating "works on my machine."    │
│                                                                         │
│  VERSION CONTROL                                                        │
│  Track every infrastructure change. See who changed what, when, and     │
│  why. Roll back problematic changes by reverting commits.               │
│                                                                         │
│  CODE REVIEW                                                            │
│  Infrastructure changes go through pull requests. Team members review   │
│  changes before they're applied, catching mistakes early.               │
│                                                                         │
│  DOCUMENTATION                                                          │
│  The code IS the documentation. No more outdated wiki pages or          │
│  forgotten manual steps.                                                │
│                                                                         │
│  AUTOMATION                                                             │
│  Apply changes automatically through CI/CD. No more manual clicking     │
│  through consoles or running scripts by hand.                           │
│                                                                         │
│  DISASTER RECOVERY                                                      │
│  Recreate your entire infrastructure from code. If a region fails,      │
│  spin up everything in a new region quickly.                            │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘</code></pre>
</section>
<section id="terraform" class="level3" data-number="13.7.2">
<h3 data-number="13.7.2" class="anchored" data-anchor-id="terraform"><span class="header-section-number">13.7.2</span> 11.6.2 Terraform</h3>
<p><strong>Terraform</strong> is the most popular multi-cloud IaC tool. It uses a declarative language (HCL - HashiCorp Configuration Language) to define infrastructure that can be provisioned across AWS, GCP, Azure, and many other providers.</p>
<p>Let’s define a complete production infrastructure for our application:</p>
<pre class="hcl"><code># terraform/main.tf
# Terraform configuration for TaskFlow production infrastructure

terraform {
  required_version = "&gt;= 1.0"
  
  required_providers {
    aws = {
      source  = "hashicorp/aws"
      version = "~&gt; 5.0"
    }
  }
  
  # Store state remotely for team collaboration
  backend "s3" {
    bucket         = "taskflow-terraform-state"
    key            = "production/terraform.tfstate"
    region         = "us-east-1"
    encrypt        = true
    dynamodb_table = "terraform-locks"  # Prevent concurrent modifications
  }
}

provider "aws" {
  region = var.aws_region
  
  default_tags {
    tags = {
      Project     = "TaskFlow"
      Environment = var.environment
      ManagedBy   = "Terraform"
    }
  }
}

# Variables allow configuration without code changes
variable "aws_region" {
  description = "AWS region to deploy to"
  type        = string
  default     = "us-east-1"
}

variable "environment" {
  description = "Environment name (e.g., production, staging)"
  type        = string
}

variable "app_instance_type" {
  description = "EC2 instance type for application servers"
  type        = string
  default     = "t3.medium"
}

variable "db_instance_class" {
  description = "RDS instance class"
  type        = string
  default     = "db.t3.medium"
}</code></pre>
<p>This preamble establishes the Terraform configuration. The <strong>backend</strong> stores state remotely—essential for team collaboration. Without remote state, each team member would have their own view of what infrastructure exists. The <strong>DynamoDB table</strong> for locks prevents two people from modifying infrastructure simultaneously.</p>
<p>Now let’s define the networking:</p>
<pre class="hcl"><code># terraform/network.tf
# VPC and networking configuration

# Create a VPC with specified CIDR block
resource "aws_vpc" "main" {
  cidr_block           = "10.0.0.0/16"
  enable_dns_hostnames = true
  enable_dns_support   = true
  
  tags = {
    Name = "taskflow-${var.environment}-vpc"
  }
}

# Create public subnets in multiple availability zones
resource "aws_subnet" "public" {
  count                   = 2
  vpc_id                  = aws_vpc.main.id
  cidr_block              = "10.0.${count.index + 1}.0/24"
  availability_zone       = data.aws_availability_zones.available.names[count.index]
  map_public_ip_on_launch = true
  
  tags = {
    Name = "taskflow-${var.environment}-public-${count.index + 1}"
    Type = "Public"
  }
}

# Create private subnets for databases
resource "aws_subnet" "private" {
  count             = 2
  vpc_id            = aws_vpc.main.id
  cidr_block        = "10.0.${count.index + 10}.0/24"
  availability_zone = data.aws_availability_zones.available.names[count.index]
  
  tags = {
    Name = "taskflow-${var.environment}-private-${count.index + 1}"
    Type = "Private"
  }
}

# Internet gateway for public subnets
resource "aws_internet_gateway" "main" {
  vpc_id = aws_vpc.main.id
  
  tags = {
    Name = "taskflow-${var.environment}-igw"
  }
}

# Route table for public subnets
resource "aws_route_table" "public" {
  vpc_id = aws_vpc.main.id
  
  route {
    cidr_block = "0.0.0.0/0"
    gateway_id = aws_internet_gateway.main.id
  }
  
  tags = {
    Name = "taskflow-${var.environment}-public-rt"
  }
}

# Associate public subnets with route table
resource "aws_route_table_association" "public" {
  count          = length(aws_subnet.public)
  subnet_id      = aws_subnet.public[count.index].id
  route_table_id = aws_route_table.public.id
}

# Data source to get available AZs
data "aws_availability_zones" "available" {
  state = "available"
}</code></pre>
<p>This networking configuration creates a VPC spanning multiple availability zones with both public and private subnets. The <strong>count</strong> parameter creates multiple resources from a single definition—in this case, two public and two private subnets in different AZs.</p>
<p>Now the database:</p>
<pre class="hcl"><code># terraform/database.tf
# RDS PostgreSQL configuration

# Subnet group for RDS (must span multiple AZs)
resource "aws_db_subnet_group" "main" {
  name       = "taskflow-${var.environment}"
  subnet_ids = aws_subnet.private[*].id
  
  tags = {
    Name = "taskflow-${var.environment}-db-subnet-group"
  }
}

# Security group for RDS
resource "aws_security_group" "database" {
  name        = "taskflow-${var.environment}-db-sg"
  description = "Security group for RDS database"
  vpc_id      = aws_vpc.main.id
  
  # Allow PostgreSQL from application security group only
  ingress {
    from_port       = 5432
    to_port         = 5432
    protocol        = "tcp"
    security_groups = [aws_security_group.application.id]
  }
  
  # No egress rules needed for RDS
  
  tags = {
    Name = "taskflow-${var.environment}-db-sg"
  }
}

# RDS PostgreSQL instance
resource "aws_db_instance" "main" {
  identifier = "taskflow-${var.environment}"
  
  # Engine configuration
  engine               = "postgres"
  engine_version       = "15.4"
  instance_class       = var.db_instance_class
  
  # Storage configuration
  allocated_storage     = 20
  max_allocated_storage = 100  # Enable storage autoscaling
  storage_type          = "gp3"
  storage_encrypted     = true
  
  # Database configuration
  db_name  = "taskflow"
  username = "taskflow_admin"
  password = var.db_password  # From environment or secrets manager
  
  # Network configuration
  db_subnet_group_name   = aws_db_subnet_group.main.name
  vpc_security_group_ids = [aws_security_group.database.id]
  publicly_accessible    = false  # Only accessible from within VPC
  
  # Backup configuration
  backup_retention_period = 7
  backup_window          = "03:00-04:00"
  maintenance_window     = "Mon:04:00-Mon:05:00"
  
  # High availability
  multi_az = var.environment == "production" ? true : false
  
  # Performance insights (monitoring)
  performance_insights_enabled          = true
  performance_insights_retention_period = 7
  
  # Deletion protection
  deletion_protection = var.environment == "production" ? true : false
  skip_final_snapshot = var.environment != "production"
  
  tags = {
    Name = "taskflow-${var.environment}-db"
  }
}</code></pre>
<p>The database configuration shows Terraform’s expressiveness. Conditional expressions (<code>var.environment == "production" ? true : false</code>) configure different settings for different environments—production gets Multi-AZ for high availability and deletion protection; staging does not.</p>
<p>Finally, let’s output useful values:</p>
<pre class="hcl"><code># terraform/outputs.tf
# Values to expose after apply

output "vpc_id" {
  description = "ID of the VPC"
  value       = aws_vpc.main.id
}

output "database_endpoint" {
  description = "RDS instance endpoint"
  value       = aws_db_instance.main.endpoint
  sensitive   = false
}

output "database_connection_string" {
  description = "Database connection string"
  value       = "postgresql://${aws_db_instance.main.username}:PASSWORD@${aws_db_instance.main.endpoint}/${aws_db_instance.main.db_name}"
  sensitive   = true
}</code></pre>
</section>
<section id="terraform-workflow" class="level3" data-number="13.7.3">
<h3 data-number="13.7.3" class="anchored" data-anchor-id="terraform-workflow"><span class="header-section-number">13.7.3</span> 11.6.3 Terraform Workflow</h3>
<p>Using Terraform follows a consistent workflow:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize Terraform (download providers, set up backend)</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="ex">terraform</span> init</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview changes (don't apply yet)</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="ex">terraform</span> plan <span class="at">-var</span><span class="op">=</span><span class="st">"environment=production"</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="co"># The plan shows what will be created, modified, or destroyed:</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="co"># + aws_vpc.main will be created</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="co"># + aws_subnet.public[0] will be created</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="co"># + aws_subnet.public[1] will be created</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="co"># ...</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply changes (after reviewing plan)</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a><span class="ex">terraform</span> apply <span class="at">-var</span><span class="op">=</span><span class="st">"environment=production"</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Terraform prompts for confirmation before making changes</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Type 'yes' to proceed</span></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a><span class="co"># View current state</span></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a><span class="ex">terraform</span> show</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Destroy all resources (careful!)</span></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a><span class="ex">terraform</span> destroy <span class="at">-var</span><span class="op">=</span><span class="st">"environment=staging"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The <strong>plan</strong> step is crucial—always review what Terraform intends to do before applying. In CI/CD pipelines, you might run <code>plan</code> on pull requests (showing changes in PR comments) and <code>apply</code> only when merging to main.</p>
</section>
<section id="terraform-best-practices" class="level3" data-number="13.7.4">
<h3 data-number="13.7.4" class="anchored" data-anchor-id="terraform-best-practices"><span class="header-section-number">13.7.4</span> 11.6.4 Terraform Best Practices</h3>
<pre><code>┌─────────────────────────────────────────────────────────────────────────┐
│                    TERRAFORM BEST PRACTICES                             │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  STATE MANAGEMENT                                                       │
│  • Always use remote state (S3, GCS, Terraform Cloud)                   │
│  • Enable state locking to prevent concurrent modifications             │
│  • Never commit .tfstate files to version control                       │
│  • Use workspaces or separate state files for environments              │
│                                                                         │
│  CODE ORGANIZATION                                                      │
│  • Split large configurations into multiple files                       │
│  • Use modules for reusable components                                  │
│  • Keep provider configurations separate                                │
│  • Use consistent naming conventions                                    │
│                                                                         │
│  SECURITY                                                               │
│  • Never hardcode secrets in Terraform files                            │
│  • Use variables for sensitive values                                   │
│  • Mark sensitive outputs appropriately                                 │
│  • Use IAM roles with least privilege for Terraform execution           │
│                                                                         │
│  WORKFLOW                                                               │
│  • Always run plan before apply                                         │
│  • Use version constraints for providers                                │
│  • Tag all resources for cost tracking                                  │
│  • Document resource purposes in comments                               │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘</code></pre>
<hr>
</section>
</section>
<section id="cloud-security-best-practices" class="level2" data-number="13.8">
<h2 data-number="13.8" class="anchored" data-anchor-id="cloud-security-best-practices"><span class="header-section-number">13.8</span> 11.7 Cloud Security Best Practices</h2>
<p>Security in the cloud follows the “shared responsibility model”—the cloud provider secures the infrastructure; you secure your applications and data. Understanding this boundary is crucial.</p>
<section id="identity-and-access-management" class="level3" data-number="13.8.1">
<h3 data-number="13.8.1" class="anchored" data-anchor-id="identity-and-access-management"><span class="header-section-number">13.8.1</span> 11.7.1 Identity and Access Management</h3>
<p><strong>IAM</strong> controls who can access what resources. The principle of least privilege means granting only the permissions necessary for a task—no more.</p>
<pre><code>┌─────────────────────────────────────────────────────────────────────────┐
│                    IAM BEST PRACTICES                                   │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  USERS AND ROLES                                                        │
│  • Never use root account for daily operations                          │
│  • Create individual IAM users for each person                          │
│  • Use roles for applications (not access keys)                         │
│  • Require MFA for all human users                                      │
│                                                                         │
│  PERMISSIONS                                                            │
│  • Start with no permissions, add only what's needed                    │
│  • Use AWS managed policies where appropriate                           │
│  • Scope permissions to specific resources when possible                │
│  • Regularly audit and remove unused permissions                        │
│                                                                         │
│  CREDENTIALS                                                            │
│  • Rotate access keys regularly                                         │
│  • Never embed credentials in code                                      │
│  • Use temporary credentials (STS) when possible                        │
│  • Store secrets in Secrets Manager or Parameter Store                  │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘</code></pre>
<p>Here’s an example of a well-scoped IAM policy:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"Version"</span><span class="fu">:</span> <span class="st">"2012-10-17"</span><span class="fu">,</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"Statement"</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"Sid"</span><span class="fu">:</span> <span class="st">"AllowDynamoDBAccess"</span><span class="fu">,</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"Effect"</span><span class="fu">:</span> <span class="st">"Allow"</span><span class="fu">,</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"Action"</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"dynamodb:GetItem"</span><span class="ot">,</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">"dynamodb:PutItem"</span><span class="ot">,</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">"dynamodb:UpdateItem"</span><span class="ot">,</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">"dynamodb:DeleteItem"</span><span class="ot">,</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">"dynamodb:Query"</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>      <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"Resource"</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">"arn:aws:dynamodb:us-east-1:123456789012:table/taskflow-tasks"</span><span class="ot">,</span></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">"arn:aws:dynamodb:us-east-1:123456789012:table/taskflow-tasks/index/*"</span></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>      <span class="ot">]</span></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span></span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"Sid"</span><span class="fu">:</span> <span class="st">"AllowS3Access"</span><span class="fu">,</span></span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"Effect"</span><span class="fu">:</span> <span class="st">"Allow"</span><span class="fu">,</span></span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"Action"</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>        <span class="st">"s3:GetObject"</span><span class="ot">,</span></span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>        <span class="st">"s3:PutObject"</span></span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>      <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"Resource"</span><span class="fu">:</span> <span class="st">"arn:aws:s3:::taskflow-uploads/*"</span></span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span></span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This policy grants exactly what the application needs: read/write access to a specific DynamoDB table and its indexes, plus read/write access to objects in a specific S3 bucket. It cannot access other tables, other buckets, or perform administrative actions like deleting tables.</p>
</section>
<section id="secrets-management" class="level3" data-number="13.8.2">
<h3 data-number="13.8.2" class="anchored" data-anchor-id="secrets-management"><span class="header-section-number">13.8.2</span> 11.7.2 Secrets Management</h3>
<p>Never store secrets in code, environment files committed to git, or container images. Use dedicated secrets management services:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Using AWS Secrets Manager</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> { SecretsManager } <span class="op">=</span> <span class="pp">require</span>(<span class="st">'@aws-sdk/client-secrets-manager'</span>)<span class="op">;</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> secretsManager <span class="op">=</span> <span class="kw">new</span> <span class="fu">SecretsManager</span>({ <span class="dt">region</span><span class="op">:</span> <span class="st">'us-east-1'</span> })<span class="op">;</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="co">// Cache secrets to avoid repeated API calls</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> cachedSecrets <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> cacheExpiry <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> CACHE_DURATION <span class="op">=</span> <span class="dv">300000</span><span class="op">;</span> <span class="co">// 5 minutes</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="kw">async</span> <span class="kw">function</span> <span class="fu">getSecrets</span>() {</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Return cached secrets if still valid</span></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (cachedSecrets <span class="op">&amp;&amp;</span> <span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>() <span class="op">&lt;</span> cacheExpiry) {</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> cachedSecrets<span class="op">;</span></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Fetch secrets from Secrets Manager</span></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> secretsManager<span class="op">.</span><span class="fu">getSecretValue</span>({</span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>    <span class="dt">SecretId</span><span class="op">:</span> <span class="st">'taskflow/production'</span></span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Parse JSON secrets</span></span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>  cachedSecrets <span class="op">=</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">parse</span>(response<span class="op">.</span><span class="at">SecretString</span>)<span class="op">;</span></span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>  cacheExpiry <span class="op">=</span> <span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>() <span class="op">+</span> CACHE_DURATION<span class="op">;</span></span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> cachedSecrets<span class="op">;</span></span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a><span class="co">// Usage</span></span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a><span class="kw">async</span> <span class="kw">function</span> <span class="fu">connectToDatabase</span>() {</span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> secrets <span class="op">=</span> <span class="cf">await</span> <span class="fu">getSecrets</span>()<span class="op">;</span></span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="kw">new</span> <span class="fu">Pool</span>({</span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a>    <span class="dt">host</span><span class="op">:</span> secrets<span class="op">.</span><span class="at">DB_HOST</span><span class="op">,</span></span>
<span id="cb41-36"><a href="#cb41-36" aria-hidden="true" tabindex="-1"></a>    <span class="dt">database</span><span class="op">:</span> secrets<span class="op">.</span><span class="at">DB_NAME</span><span class="op">,</span></span>
<span id="cb41-37"><a href="#cb41-37" aria-hidden="true" tabindex="-1"></a>    <span class="dt">user</span><span class="op">:</span> secrets<span class="op">.</span><span class="at">DB_USER</span><span class="op">,</span></span>
<span id="cb41-38"><a href="#cb41-38" aria-hidden="true" tabindex="-1"></a>    <span class="dt">password</span><span class="op">:</span> secrets<span class="op">.</span><span class="at">DB_PASSWORD</span><span class="op">,</span></span>
<span id="cb41-39"><a href="#cb41-39" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ssl</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb41-40"><a href="#cb41-40" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb41-41"><a href="#cb41-41" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Secrets Manager provides several benefits: secrets are encrypted at rest, access is controlled via IAM, you can rotate secrets automatically, and there’s a complete audit trail of access.</p>
</section>
<section id="network-security" class="level3" data-number="13.8.3">
<h3 data-number="13.8.3" class="anchored" data-anchor-id="network-security"><span class="header-section-number">13.8.3</span> 11.7.3 Network Security</h3>
<p>Defense in depth means multiple security layers:</p>
<pre><code>┌─────────────────────────────────────────────────────────────────────────┐
│                    NETWORK SECURITY LAYERS                              │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  LAYER 1: VPC ISOLATION                                                 │
│  • Resources in private subnets have no public IP                       │
│  • NAT Gateway for outbound internet access only                        │
│  • VPC Flow Logs for traffic monitoring                                 │
│                                                                         │
│  LAYER 2: SECURITY GROUPS                                               │
│  • Stateful firewall at instance level                                  │
│  • Allow only required ports from required sources                      │
│  • Reference other security groups (not IP ranges when possible)        │
│                                                                         │
│  LAYER 3: NETWORK ACLS                                                  │
│  • Stateless firewall at subnet level                                   │
│  • Additional layer for sensitive subnets                               │
│  • Deny rules for known bad actors                                      │
│                                                                         │
│  LAYER 4: APPLICATION SECURITY                                          │
│  • TLS everywhere (even internal traffic)                               │
│  • Input validation                                                     │
│  • WAF for public endpoints                                             │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘</code></pre>
<hr>
</section>
</section>
<section id="cost-optimization" class="level2" data-number="13.9">
<h2 data-number="13.9" class="anchored" data-anchor-id="cost-optimization"><span class="header-section-number">13.9</span> 11.8 Cost Optimization</h2>
<p>Cloud costs can spiral out of control without attention. Understanding pricing models and implementing cost controls is essential.</p>
<section id="understanding-cloud-pricing" class="level3" data-number="13.9.1">
<h3 data-number="13.9.1" class="anchored" data-anchor-id="understanding-cloud-pricing"><span class="header-section-number">13.9.1</span> 11.8.1 Understanding Cloud Pricing</h3>
<p>Cloud providers charge for various dimensions:</p>
<ul>
<li><strong>Compute</strong>: Per hour (VMs) or per request/duration (serverless)</li>
<li><strong>Storage</strong>: Per GB-month stored plus data retrieval</li>
<li><strong>Data transfer</strong>: Egress (outbound) is expensive; ingress (inbound) is usually free</li>
<li><strong>Managed services</strong>: Per request, per hour, or per capacity unit</li>
</ul>
</section>
<section id="cost-optimization-strategies" class="level3" data-number="13.9.2">
<h3 data-number="13.9.2" class="anchored" data-anchor-id="cost-optimization-strategies"><span class="header-section-number">13.9.2</span> 11.8.2 Cost Optimization Strategies</h3>
<pre><code>┌─────────────────────────────────────────────────────────────────────────┐
│                    COST OPTIMIZATION STRATEGIES                         │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  RIGHT-SIZING                                                           │
│  • Monitor actual resource utilization                                  │
│  • Downsize over-provisioned instances                                  │
│  • Use auto-scaling instead of provisioning for peak                    │
│                                                                         │
│  PRICING MODELS                                                         │
│  • Spot instances for fault-tolerant workloads (70-90% savings)         │
│  • Reserved instances for steady workloads (30-60% savings)             │
│  • Savings Plans for flexible commitments                               │
│                                                                         │
│  ARCHITECTURE                                                           │
│  • Use serverless for variable workloads                                │
│  • Cache aggressively to reduce database load                           │
│  • Compress data to reduce storage and transfer costs                   │
│                                                                         │
│  GOVERNANCE                                                             │
│  • Tag resources for cost allocation                                    │
│  • Set up billing alerts                                                │
│  • Regular cost reviews                                                 │
│  • Delete unused resources automatically                                │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘</code></pre>
<p>Here’s a practical example of implementing cost controls:</p>
<pre class="hcl"><code># terraform/cost-controls.tf

# Create a budget alert
resource "aws_budgets_budget" "monthly" {
  name              = "taskflow-${var.environment}-monthly"
  budget_type       = "COST"
  limit_amount      = var.monthly_budget_limit
  limit_unit        = "USD"
  time_unit         = "MONTHLY"
  
  notification {
    comparison_operator       = "GREATER_THAN"
    threshold                 = 80
    threshold_type           = "PERCENTAGE"
    notification_type        = "ACTUAL"
    subscriber_email_addresses = var.alert_email_addresses
  }
  
  notification {
    comparison_operator       = "GREATER_THAN"
    threshold                 = 100
    threshold_type           = "PERCENTAGE"
    notification_type        = "FORECASTED"
    subscriber_email_addresses = var.alert_email_addresses
  }
}

# Lambda to clean up old resources
resource "aws_lambda_function" "cleanup" {
  function_name = "taskflow-resource-cleanup"
  handler       = "cleanup.handler"
  runtime       = "nodejs20.x"
  
  # Run weekly
  # (CloudWatch Events rule not shown)
  
  environment {
    variables = {
      MAX_SNAPSHOT_AGE_DAYS = "30"
      MAX_LOG_RETENTION_DAYS = "90"
    }
  }
}</code></pre>
<hr>
</section>
</section>
<section id="chapter-summary" class="level2" data-number="13.10">
<h2 data-number="13.10" class="anchored" data-anchor-id="chapter-summary"><span class="header-section-number">13.10</span> 11.9 Chapter Summary</h2>
<p>Cloud services and deployment have transformed how we build and operate software. This chapter covered the essential concepts and practices for leveraging cloud infrastructure effectively.</p>
<p>Key takeaways:</p>
<p><strong>Cloud computing</strong> provides on-demand, scalable infrastructure without upfront capital investment. Understanding service models (IaaS, PaaS, SaaS) helps you choose the right level of abstraction for your needs.</p>
<p><strong>Containerization with Docker</strong> packages applications with their dependencies, ensuring consistency across environments. Multi-stage builds, proper layer ordering, and security practices produce production-ready images.</p>
<p><strong>Kubernetes</strong> orchestrates containers at scale, handling deployment, scaling, self-healing, and service discovery. Declarative configuration lets you specify desired state while Kubernetes handles the implementation details.</p>
<p><strong>Serverless computing</strong> abstracts away servers entirely. Functions execute in response to events, scaling automatically and charging only for actual usage. Serverless excels at event-driven workloads but requires understanding cold starts and execution limits.</p>
<p><strong>Infrastructure as Code</strong> with Terraform enables reproducible, version-controlled infrastructure. Treating infrastructure like software brings engineering rigor to operations.</p>
<p><strong>Security and cost optimization</strong> require ongoing attention. The shared responsibility model, least-privilege access, secrets management, and network isolation protect your applications. Understanding pricing models and implementing controls keeps costs manageable.</p>
<hr>
</section>
<section id="key-terms" class="level2" data-number="13.11">
<h2 data-number="13.11" class="anchored" data-anchor-id="key-terms"><span class="header-section-number">13.11</span> 11.10 Key Terms</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Term</th>
<th>Definition</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>IaaS</strong></td>
<td>Infrastructure as a Service—virtual machines, storage, networking</td>
</tr>
<tr class="even">
<td><strong>PaaS</strong></td>
<td>Platform as a Service—managed platforms for deploying applications</td>
</tr>
<tr class="odd">
<td><strong>SaaS</strong></td>
<td>Software as a Service—complete applications delivered over the internet</td>
</tr>
<tr class="even">
<td><strong>Container</strong></td>
<td>Lightweight, isolated runtime environment packaging an application</td>
</tr>
<tr class="odd">
<td><strong>Docker</strong></td>
<td>Platform for building, running, and distributing containers</td>
</tr>
<tr class="even">
<td><strong>Kubernetes</strong></td>
<td>Container orchestration platform for automated deployment and scaling</td>
</tr>
<tr class="odd">
<td><strong>Pod</strong></td>
<td>Smallest deployable unit in Kubernetes; one or more containers</td>
</tr>
<tr class="even">
<td><strong>Deployment</strong></td>
<td>Kubernetes resource managing a set of identical pods</td>
</tr>
<tr class="odd">
<td><strong>Service</strong></td>
<td>Kubernetes resource providing stable network endpoint for pods</td>
</tr>
<tr class="even">
<td><strong>Serverless</strong></td>
<td>Computing model where provider manages infrastructure automatically</td>
</tr>
<tr class="odd">
<td><strong>Lambda</strong></td>
<td>AWS serverless computing service for running functions</td>
</tr>
<tr class="even">
<td><strong>Cold Start</strong></td>
<td>Latency when a serverless function starts from an inactive state</td>
</tr>
<tr class="odd">
<td><strong>IaC</strong></td>
<td>Infrastructure as Code—managing infrastructure through code</td>
</tr>
<tr class="even">
<td><strong>Terraform</strong></td>
<td>Multi-cloud infrastructure as code tool</td>
</tr>
<tr class="odd">
<td><strong>VPC</strong></td>
<td>Virtual Private Cloud—isolated network within cloud provider</td>
</tr>
</tbody>
</table>
<hr>
</section>
<section id="review-questions" class="level2" data-number="13.12">
<h2 data-number="13.12" class="anchored" data-anchor-id="review-questions"><span class="header-section-number">13.12</span> 11.11 Review Questions</h2>
<ol type="1">
<li><p>Explain the differences between IaaS, PaaS, and SaaS. Give an example of when you would use each.</p></li>
<li><p>What problems do containers solve? How do they differ from virtual machines?</p></li>
<li><p>Describe the purpose of multi-stage Docker builds. What benefits do they provide?</p></li>
<li><p>Explain the relationship between Pods, Deployments, and Services in Kubernetes.</p></li>
<li><p>What are readiness and liveness probes in Kubernetes? Why are both needed?</p></li>
<li><p>When would you choose serverless over containers? What are the trade-offs?</p></li>
<li><p>Explain the concept of cold starts in serverless computing. How can you mitigate their impact?</p></li>
<li><p>Why is Infrastructure as Code important? What benefits does it provide over manual configuration?</p></li>
<li><p>Describe the shared responsibility model in cloud security. What is the customer responsible for?</p></li>
<li><p>What strategies can you use to optimize cloud costs? How do reserved instances and spot instances differ?</p></li>
</ol>
<hr>
</section>
<section id="hands-on-exercises" class="level2" data-number="13.13">
<h2 data-number="13.13" class="anchored" data-anchor-id="hands-on-exercises"><span class="header-section-number">13.13</span> 11.12 Hands-On Exercises</h2>
<section id="exercise-11.1-containerize-your-application" class="level3" data-number="13.13.1">
<h3 data-number="13.13.1" class="anchored" data-anchor-id="exercise-11.1-containerize-your-application"><span class="header-section-number">13.13.1</span> Exercise 11.1: Containerize Your Application</h3>
<p>Create a production-ready Docker configuration:</p>
<ol type="1">
<li>Write a multi-stage Dockerfile for your project</li>
<li>Implement proper layer ordering for cache efficiency</li>
<li>Run as non-root user</li>
<li>Add health check</li>
<li>Create docker-compose.yml for local development</li>
<li>Measure and optimize image size</li>
</ol>
</section>
<section id="exercise-11.2-deploy-to-kubernetes" class="level3" data-number="13.13.2">
<h3 data-number="13.13.2" class="anchored" data-anchor-id="exercise-11.2-deploy-to-kubernetes"><span class="header-section-number">13.13.2</span> Exercise 11.2: Deploy to Kubernetes</h3>
<p>Deploy your containerized application to Kubernetes:</p>
<ol type="1">
<li>Create Deployment manifest with resource limits and probes</li>
<li>Create Service to expose the application</li>
<li>Create ConfigMap and Secret for configuration</li>
<li>Implement Horizontal Pod Autoscaler</li>
<li>Perform a rolling update with zero downtime</li>
<li>Test rollback functionality</li>
</ol>
</section>
<section id="exercise-11.3-serverless-function" class="level3" data-number="13.13.3">
<h3 data-number="13.13.3" class="anchored" data-anchor-id="exercise-11.3-serverless-function"><span class="header-section-number">13.13.3</span> Exercise 11.3: Serverless Function</h3>
<p>Implement a serverless component:</p>
<ol type="1">
<li>Create a Lambda function for background processing</li>
<li>Configure appropriate triggers (HTTP, S3, or scheduled)</li>
<li>Handle errors and implement retry logic</li>
<li>Set up CloudWatch logging and alerts</li>
<li>Measure cold start times and optimize</li>
</ol>
</section>
<section id="exercise-11.4-infrastructure-as-code" class="level3" data-number="13.13.4">
<h3 data-number="13.13.4" class="anchored" data-anchor-id="exercise-11.4-infrastructure-as-code"><span class="header-section-number">13.13.4</span> Exercise 11.4: Infrastructure as Code</h3>
<p>Define your infrastructure with Terraform:</p>
<ol type="1">
<li>Create VPC with public and private subnets</li>
<li>Provision managed database (RDS or equivalent)</li>
<li>Configure security groups with least-privilege access</li>
<li>Set up remote state storage</li>
<li>Implement different configurations for staging and production</li>
</ol>
</section>
<section id="exercise-11.5-security-audit" class="level3" data-number="13.13.5">
<h3 data-number="13.13.5" class="anchored" data-anchor-id="exercise-11.5-security-audit"><span class="header-section-number">13.13.5</span> Exercise 11.5: Security Audit</h3>
<p>Audit your cloud deployment for security:</p>
<ol type="1">
<li>Review IAM policies for least privilege</li>
<li>Check for hardcoded secrets in code and configurations</li>
<li>Verify network security (security groups, NACLs)</li>
<li>Ensure encryption at rest and in transit</li>
<li>Set up security monitoring and alerts</li>
</ol>
</section>
<section id="exercise-11.6-cost-analysis" class="level3" data-number="13.13.6">
<h3 data-number="13.13.6" class="anchored" data-anchor-id="exercise-11.6-cost-analysis"><span class="header-section-number">13.13.6</span> Exercise 11.6: Cost Analysis</h3>
<p>Analyze and optimize your cloud costs:</p>
<ol type="1">
<li>Tag all resources for cost allocation</li>
<li>Set up billing alerts</li>
<li>Identify right-sizing opportunities</li>
<li>Evaluate reserved instance or savings plan options</li>
<li>Document findings and recommendations</li>
</ol>
<hr>
</section>
</section>
<section id="further-reading" class="level2" data-number="13.14">
<h2 data-number="13.14" class="anchored" data-anchor-id="further-reading"><span class="header-section-number">13.14</span> 11.13 Further Reading</h2>
<p><strong>Books:</strong></p>
<ul>
<li>Morris, K. (2020). <em>Infrastructure as Code</em> (2nd Edition). O’Reilly Media.</li>
<li>Burns, B. (2019). <em>Designing Distributed Systems</em>. O’Reilly Media.</li>
<li>Wittig, A. &amp; Wittig, M. (2019). <em>Amazon Web Services in Action</em> (2nd Edition). Manning.</li>
</ul>
<p><strong>Online Resources:</strong></p>
<ul>
<li>Docker Documentation: https://docs.docker.com/</li>
<li>Kubernetes Documentation: https://kubernetes.io/docs/</li>
<li>AWS Well-Architected Framework: https://aws.amazon.com/architecture/well-architected/</li>
<li>Terraform Documentation: https://www.terraform.io/docs/</li>
<li>The Twelve-Factor App: https://12factor.net/</li>
</ul>
<hr>
</section>
<section id="references" class="level2" data-number="13.15">
<h2 data-number="13.15" class="anchored" data-anchor-id="references"><span class="header-section-number">13.15</span> References</h2>
<p>Burns, B., Grant, B., Oppenheimer, D., Brewer, E., &amp; Wilkes, J. (2016). Borg, Omega, and Kubernetes. <em>ACM Queue</em>, 14(1), 70-93.</p>
<p>Fowler, M. (2014). Microservices. Retrieved from https://martinfowler.com/articles/microservices.html</p>
<p>Merkel, D. (2014). Docker: Lightweight Linux containers for consistent development and deployment. <em>Linux Journal</em>, 2014(239), 2.</p>
<p>NIST. (2011). The NIST Definition of Cloud Computing. Special Publication 800-145.</p>
<p>Terraform. (2023). Terraform Language Documentation. Retrieved from https://www.terraform.io/docs/language/</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../chapters/10-data-management.html" class="pagination-link" aria-label="Chapter 10: Data Management and APIs">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Chapter 10: Data Management and APIs</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../chapters/12-security.html" class="pagination-link" aria-label="Chapter 12: Software Security">
        <span class="nav-page-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Chapter 12: Software Security</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>