<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>15&nbsp; Chapter 13: Software Maintenance and Evolution – The Complete Software Engineering Lifecycle</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../chapters/14-ethics-professionalism.html" rel="next">
<link href="../chapters/12-security.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-9b98f18118eee809be1c051eb5cc78e4.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/13-maintenance-evolution.html"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Chapter 13: Software Maintenance and Evolution</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">The Complete Software Engineering Lifecycle</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">The Complete Software Engineering Lifecycle</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Preface</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../acknowledgments.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Acknowledgments</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/01-introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Chapter 1: Introduction to Software Engineering</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/02-requirements-engineering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Chapter 2: Requirements Engineering</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/03-systems-modeling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Chapter 3: Systems Modeling and UML</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/04-software-architecture.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Chapter 4: Software Architecture and Design Patterns</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/05-ui-ux.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Chapter 5: UI/UX Design and Prototyping</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/06-agile-methodologies.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Chapter 6: Agile Methodologies and Project Management</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/07-version-control.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Chapter 7: Version Control Workflows</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/09-cicd.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Chapter 9: Continuous Integration and Continuous Deployment</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/10-data-management.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Chapter 10: Data Management and APIs</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/11-cloud-services.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Chapter 11: Cloud Services and Deployment</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/12-security.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Chapter 12: Software Security</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/13-maintenance-evolution.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Chapter 13: Software Maintenance and Evolution</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/14-ethics-professionalism.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Chapter 14: Professional Practice and Ethics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/15-final-project-integration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Chapter 15: Final Project Integration and Course Synthesis</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/glossary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Glossary</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#learning-objectives" id="toc-learning-objectives" class="nav-link active" data-scroll-target="#learning-objectives"><span class="header-section-number">15.1</span> Learning Objectives</a></li>
  <li><a href="#the-reality-of-software-maintenance" id="toc-the-reality-of-software-maintenance" class="nav-link" data-scroll-target="#the-reality-of-software-maintenance"><span class="header-section-number">15.2</span> 13.1 The Reality of Software Maintenance</a>
  <ul class="collapse">
  <li><a href="#types-of-software-maintenance" id="toc-types-of-software-maintenance" class="nav-link" data-scroll-target="#types-of-software-maintenance"><span class="header-section-number">15.2.1</span> 13.1.1 Types of Software Maintenance</a></li>
  <li><a href="#the-maintenance-mindset" id="toc-the-maintenance-mindset" class="nav-link" data-scroll-target="#the-maintenance-mindset"><span class="header-section-number">15.2.2</span> 13.1.2 The Maintenance Mindset</a></li>
  <li><a href="#measuring-maintainability" id="toc-measuring-maintainability" class="nav-link" data-scroll-target="#measuring-maintainability"><span class="header-section-number">15.2.3</span> 13.1.3 Measuring Maintainability</a></li>
  </ul></li>
  <li><a href="#technical-debt" id="toc-technical-debt" class="nav-link" data-scroll-target="#technical-debt"><span class="header-section-number">15.3</span> 13.2 Technical Debt</a>
  <ul class="collapse">
  <li><a href="#sources-of-technical-debt" id="toc-sources-of-technical-debt" class="nav-link" data-scroll-target="#sources-of-technical-debt"><span class="header-section-number">15.3.1</span> 13.2.1 Sources of Technical Debt</a></li>
  <li><a href="#manifestations-of-technical-debt" id="toc-manifestations-of-technical-debt" class="nav-link" data-scroll-target="#manifestations-of-technical-debt"><span class="header-section-number">15.3.2</span> 13.2.2 Manifestations of Technical Debt</a></li>
  <li><a href="#the-interest-payments" id="toc-the-interest-payments" class="nav-link" data-scroll-target="#the-interest-payments"><span class="header-section-number">15.3.3</span> 13.2.3 The Interest Payments</a></li>
  <li><a href="#managing-technical-debt" id="toc-managing-technical-debt" class="nav-link" data-scroll-target="#managing-technical-debt"><span class="header-section-number">15.3.4</span> 13.2.4 Managing Technical Debt</a></li>
  </ul></li>
  <li><a href="#refactoring" id="toc-refactoring" class="nav-link" data-scroll-target="#refactoring"><span class="header-section-number">15.4</span> 13.3 Refactoring</a>
  <ul class="collapse">
  <li><a href="#why-refactoring-matters" id="toc-why-refactoring-matters" class="nav-link" data-scroll-target="#why-refactoring-matters"><span class="header-section-number">15.4.1</span> 13.3.1 Why Refactoring Matters</a></li>
  <li><a href="#when-to-refactor" id="toc-when-to-refactor" class="nav-link" data-scroll-target="#when-to-refactor"><span class="header-section-number">15.4.2</span> 13.3.2 When to Refactor</a></li>
  <li><a href="#refactoring-techniques" id="toc-refactoring-techniques" class="nav-link" data-scroll-target="#refactoring-techniques"><span class="header-section-number">15.4.3</span> 13.3.3 Refactoring Techniques</a></li>
  <li><a href="#refactoring-safely" id="toc-refactoring-safely" class="nav-link" data-scroll-target="#refactoring-safely"><span class="header-section-number">15.4.4</span> 13.3.4 Refactoring Safely</a></li>
  </ul></li>
  <li><a href="#working-with-legacy-systems" id="toc-working-with-legacy-systems" class="nav-link" data-scroll-target="#working-with-legacy-systems"><span class="header-section-number">15.5</span> 13.4 Working with Legacy Systems</a>
  <ul class="collapse">
  <li><a href="#understanding-legacy-challenges" id="toc-understanding-legacy-challenges" class="nav-link" data-scroll-target="#understanding-legacy-challenges"><span class="header-section-number">15.5.1</span> 13.4.1 Understanding Legacy Challenges</a></li>
  <li><a href="#strategies-for-legacy-evolution" id="toc-strategies-for-legacy-evolution" class="nav-link" data-scroll-target="#strategies-for-legacy-evolution"><span class="header-section-number">15.5.2</span> 13.4.2 Strategies for Legacy Evolution</a></li>
  <li><a href="#managing-risk-during-legacy-evolution" id="toc-managing-risk-during-legacy-evolution" class="nav-link" data-scroll-target="#managing-risk-during-legacy-evolution"><span class="header-section-number">15.5.3</span> 13.4.3 Managing Risk During Legacy Evolution</a></li>
  </ul></li>
  <li><a href="#documentation" id="toc-documentation" class="nav-link" data-scroll-target="#documentation"><span class="header-section-number">15.6</span> 13.5 Documentation</a>
  <ul class="collapse">
  <li><a href="#types-of-documentation" id="toc-types-of-documentation" class="nav-link" data-scroll-target="#types-of-documentation"><span class="header-section-number">15.6.1</span> 13.5.1 Types of Documentation</a></li>
  <li><a href="#architectural-decision-records" id="toc-architectural-decision-records" class="nav-link" data-scroll-target="#architectural-decision-records"><span class="header-section-number">15.6.2</span> 13.5.2 Architectural Decision Records</a></li>
  <li><a href="#code-comments" id="toc-code-comments" class="nav-link" data-scroll-target="#code-comments"><span class="header-section-number">15.6.3</span> 13.5.3 Code Comments</a></li>
  <li><a href="#readme-files" id="toc-readme-files" class="nav-link" data-scroll-target="#readme-files"><span class="header-section-number">15.6.4</span> 13.5.4 README Files</a></li>
  </ul></li>
  <li><a href="#requirements" id="toc-requirements" class="nav-link" data-scroll-target="#requirements"><span class="header-section-number">15.7</span> Requirements</a></li>
  <li><a href="#project-structure" id="toc-project-structure" class="nav-link" data-scroll-target="#project-structure"><span class="header-section-number">15.8</span> Project Structure</a></li>
  <li><a href="#configuration" id="toc-configuration" class="nav-link" data-scroll-target="#configuration"><span class="header-section-number">15.9</span> Configuration</a></li>
  <li><a href="#api-documentation" id="toc-api-documentation" class="nav-link" data-scroll-target="#api-documentation"><span class="header-section-number">15.10</span> API Documentation</a></li>
  <li><a href="#development" id="toc-development" class="nav-link" data-scroll-target="#development"><span class="header-section-number">15.11</span> Development</a>
  <ul class="collapse">
  <li><a href="#running-tests" id="toc-running-tests" class="nav-link" data-scroll-target="#running-tests"><span class="header-section-number">15.11.1</span> Running Tests</a></li>
  <li><a href="#code-style" id="toc-code-style" class="nav-link" data-scroll-target="#code-style"><span class="header-section-number">15.11.2</span> Code Style</a></li>
  <li><a href="#commit-messages" id="toc-commit-messages" class="nav-link" data-scroll-target="#commit-messages"><span class="header-section-number">15.11.3</span> Commit Messages</a></li>
  </ul></li>
  <li><a href="#contributing" id="toc-contributing" class="nav-link" data-scroll-target="#contributing"><span class="header-section-number">15.12</span> Contributing</a></li>
  <li><a href="#license" id="toc-license" class="nav-link" data-scroll-target="#license"><span class="header-section-number">15.13</span> License</a>
  <ul class="collapse">
  <li><a href="#change-management" id="toc-change-management" class="nav-link" data-scroll-target="#change-management"><span class="header-section-number">15.13.1</span> 13.6.2 Change Management</a></li>
  <li><a href="#configuration-changes" id="toc-configuration-changes" class="nav-link" data-scroll-target="#configuration-changes"><span class="header-section-number">15.13.2</span> Configuration Changes</a></li>
  </ul></li>
  <li><a href="#deprecated-features-removed" id="toc-deprecated-features-removed" class="nav-link" data-scroll-target="#deprecated-features-removed"><span class="header-section-number">15.14</span> Deprecated Features Removed</a>
  <ul class="collapse">
  <li><a href="#api-versioning" id="toc-api-versioning" class="nav-link" data-scroll-target="#api-versioning"><span class="header-section-number">15.14.1</span> 13.6.4 API Versioning</a></li>
  </ul></li>
  <li><a href="#designing-for-maintainability" id="toc-designing-for-maintainability" class="nav-link" data-scroll-target="#designing-for-maintainability"><span class="header-section-number">15.15</span> 13.7 Designing for Maintainability</a>
  <ul class="collapse">
  <li><a href="#principles-for-maintainable-design" id="toc-principles-for-maintainable-design" class="nav-link" data-scroll-target="#principles-for-maintainable-design"><span class="header-section-number">15.15.1</span> 13.7.1 Principles for Maintainable Design</a></li>
  <li><a href="#structural-patterns-for-maintainability" id="toc-structural-patterns-for-maintainability" class="nav-link" data-scroll-target="#structural-patterns-for-maintainability"><span class="header-section-number">15.15.2</span> 13.7.2 Structural Patterns for Maintainability</a></li>
  <li><a href="#testing-for-maintainability" id="toc-testing-for-maintainability" class="nav-link" data-scroll-target="#testing-for-maintainability"><span class="header-section-number">15.15.3</span> 13.7.3 Testing for Maintainability</a></li>
  </ul></li>
  <li><a href="#chapter-summary" id="toc-chapter-summary" class="nav-link" data-scroll-target="#chapter-summary"><span class="header-section-number">15.16</span> 13.8 Chapter Summary</a></li>
  <li><a href="#key-terms" id="toc-key-terms" class="nav-link" data-scroll-target="#key-terms"><span class="header-section-number">15.17</span> 13.9 Key Terms</a></li>
  <li><a href="#review-questions" id="toc-review-questions" class="nav-link" data-scroll-target="#review-questions"><span class="header-section-number">15.18</span> 13.10 Review Questions</a></li>
  <li><a href="#hands-on-exercises" id="toc-hands-on-exercises" class="nav-link" data-scroll-target="#hands-on-exercises"><span class="header-section-number">15.19</span> 13.11 Hands-On Exercises</a>
  <ul class="collapse">
  <li><a href="#exercise-13.1-technical-debt-audit" id="toc-exercise-13.1-technical-debt-audit" class="nav-link" data-scroll-target="#exercise-13.1-technical-debt-audit"><span class="header-section-number">15.19.1</span> Exercise 13.1: Technical Debt Audit</a></li>
  <li><a href="#exercise-13.2-refactoring-practice" id="toc-exercise-13.2-refactoring-practice" class="nav-link" data-scroll-target="#exercise-13.2-refactoring-practice"><span class="header-section-number">15.19.2</span> Exercise 13.2: Refactoring Practice</a></li>
  <li><a href="#exercise-13.3-documentation-improvement" id="toc-exercise-13.3-documentation-improvement" class="nav-link" data-scroll-target="#exercise-13.3-documentation-improvement"><span class="header-section-number">15.19.3</span> Exercise 13.3: Documentation Improvement</a></li>
  <li><a href="#exercise-13.4-legacy-code-characterization" id="toc-exercise-13.4-legacy-code-characterization" class="nav-link" data-scroll-target="#exercise-13.4-legacy-code-characterization"><span class="header-section-number">15.19.4</span> Exercise 13.4: Legacy Code Characterization</a></li>
  <li><a href="#exercise-13.5-version-management" id="toc-exercise-13.5-version-management" class="nav-link" data-scroll-target="#exercise-13.5-version-management"><span class="header-section-number">15.19.5</span> Exercise 13.5: Version Management</a></li>
  <li><a href="#exercise-13.6-maintainability-metrics" id="toc-exercise-13.6-maintainability-metrics" class="nav-link" data-scroll-target="#exercise-13.6-maintainability-metrics"><span class="header-section-number">15.19.6</span> Exercise 13.6: Maintainability Metrics</a></li>
  </ul></li>
  <li><a href="#further-reading" id="toc-further-reading" class="nav-link" data-scroll-target="#further-reading"><span class="header-section-number">15.20</span> 13.12 Further Reading</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references"><span class="header-section-number">15.21</span> References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Chapter 13: Software Maintenance and Evolution</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="learning-objectives" class="level2" data-number="15.1">
<h2 data-number="15.1" class="anchored" data-anchor-id="learning-objectives"><span class="header-section-number">15.1</span> Learning Objectives</h2>
<p>By the end of this chapter, you will be able to:</p>
<ul>
<li>Explain why software maintenance constitutes the majority of software lifecycle costs</li>
<li>Identify and categorize different types of technical debt</li>
<li>Apply systematic refactoring techniques to improve code quality</li>
<li>Develop strategies for working with and modernizing legacy systems</li>
<li>Create and maintain effective documentation at multiple levels</li>
<li>Implement semantic versioning and change management practices</li>
<li>Design systems with maintainability as a primary concern</li>
<li>Balance the competing demands of new features, maintenance, and technical debt reduction</li>
<li>Establish metrics and processes for tracking software health over time</li>
</ul>
<hr>
</section>
<section id="the-reality-of-software-maintenance" class="level2" data-number="15.2">
<h2 data-number="15.2" class="anchored" data-anchor-id="the-reality-of-software-maintenance"><span class="header-section-number">15.2</span> 13.1 The Reality of Software Maintenance</h2>
<p>There’s a common misconception that software development is primarily about building new things. In reality, the vast majority of software work involves maintaining, modifying, and extending existing systems. Studies consistently show that 60-80% of software costs occur after initial development, during the maintenance phase that can span decades.</p>
<p>This reality surprises many new developers. The excitement of greenfield projects—building something from scratch with no constraints—captures imagination and dominates educational curricula. But most professional software work involves inheriting code written by others, understanding systems built years ago with different assumptions, and making changes without breaking existing functionality.</p>
<p>Understanding software maintenance isn’t just practical necessity; it fundamentally shapes how we should approach software development from the beginning. Code that’s easy to maintain provides value for years. Code that’s difficult to maintain becomes a liability that compounds over time, eventually requiring expensive rewrites or abandonment.</p>
<section id="types-of-software-maintenance" class="level3" data-number="15.2.1">
<h3 data-number="15.2.1" class="anchored" data-anchor-id="types-of-software-maintenance"><span class="header-section-number">15.2.1</span> 13.1.1 Types of Software Maintenance</h3>
<p>Software maintenance isn’t a single activity but a collection of different types of work, each with distinct motivations and challenges:</p>
<pre><code>┌─────────────────────────────────────────────────────────────────────────┐
│                    TYPES OF SOFTWARE MAINTENANCE                        │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  CORRECTIVE MAINTENANCE (≈20% of maintenance effort)                    │
│  Fixing defects discovered after deployment.                            │
│  • Bug fixes for incorrect behavior                                     │
│  • Security vulnerability patches                                       │
│  • Data corruption repairs                                              │
│  • Performance issue resolution                                         │
│                                                                         │
│  ADAPTIVE MAINTENANCE (≈25% of maintenance effort)                      │
│  Modifying software to work in changed environments.                    │
│  • Operating system upgrades                                            │
│  • Database version migrations                                          │
│  • Third-party API changes                                              │
│  • Hardware platform changes                                            │
│  • Regulatory compliance updates                                        │
│                                                                         │
│  PERFECTIVE MAINTENANCE (≈50% of maintenance effort)                    │
│  Enhancing software to meet new or changed requirements.                │
│  • New feature development                                              │
│  • Performance improvements                                             │
│  • Usability enhancements                                               │
│  • Capacity scaling                                                     │
│                                                                         │
│  PREVENTIVE MAINTENANCE (≈5% of maintenance effort)                     │
│  Improving maintainability to prevent future problems.                  │
│  • Code refactoring                                                     │
│  • Documentation updates                                                │
│  • Technical debt reduction                                             │
│  • Test coverage improvement                                            │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘</code></pre>
<p>The distribution of effort is telling. <strong>Perfective maintenance</strong>—adding new features and capabilities—dominates because successful software attracts requests for enhancement. Users want more functionality, business needs evolve, and competitive pressure demands improvement. This is actually a sign of success; software that nobody wants to enhance is software nobody uses.</p>
<p><strong>Adaptive maintenance</strong> is often underestimated during planning. Every dependency—operating systems, databases, frameworks, libraries, APIs—eventually changes. Even if your code is perfect, the world around it shifts. A payment gateway updates its API. A browser deprecates a feature your frontend relies on. A security vulnerability in a dependency requires immediate updates. These external forces create maintenance work regardless of your code quality.</p>
<p><strong>Corrective maintenance</strong> gets the most attention despite consuming a relatively small portion of effort. Bugs are visible, urgent, and embarrassing. They interrupt planned work and demand immediate response. Good practices (testing, code review, careful design) reduce but never eliminate corrective maintenance.</p>
<p><strong>Preventive maintenance</strong> is chronically underfunded despite offering the best long-term return. Refactoring code, improving documentation, and reducing technical debt don’t provide immediate visible value. Stakeholders struggle to justify spending time on improvements that don’t add features or fix bugs. Yet neglecting preventive maintenance steadily increases the cost of all other maintenance types.</p>
</section>
<section id="the-maintenance-mindset" class="level3" data-number="15.2.2">
<h3 data-number="15.2.2" class="anchored" data-anchor-id="the-maintenance-mindset"><span class="header-section-number">15.2.2</span> 13.1.2 The Maintenance Mindset</h3>
<p>Approaching software with maintenance in mind requires different thinking than building from scratch:</p>
<p><strong>You are not your code’s only audience.</strong> Future developers—including your future self—will need to understand, modify, and debug this code. They won’t have your current context or memory of decisions made. Code that’s clever but obscure creates problems; code that’s straightforward and well-documented enables ongoing development.</p>
<p><strong>Change is inevitable.</strong> Requirements will evolve. Assumptions will prove wrong. Technologies will be replaced. Designing for rigidity—assuming current requirements are final—creates brittle systems that resist necessary change. Designing for flexibility—anticipating that change will happen even if you don’t know what changes—creates resilient systems.</p>
<p><strong>Understanding existing code is harder than writing new code.</strong> Reading code requires reconstructing the mental model the author had when writing it. Without good structure, naming, and documentation, this reconstruction is slow and error-prone. Every hour spent improving clarity saves many hours of future confusion.</p>
<p><strong>Working software is the primary constraint.</strong> When modifying existing systems, you must preserve existing functionality. This is fundamentally different from greenfield development where you define functionality. Maintenance developers work within constraints established by previous decisions, for better or worse.</p>
</section>
<section id="measuring-maintainability" class="level3" data-number="15.2.3">
<h3 data-number="15.2.3" class="anchored" data-anchor-id="measuring-maintainability"><span class="header-section-number">15.2.3</span> 13.1.3 Measuring Maintainability</h3>
<p>How do you know if software is maintainable? Several metrics provide insight:</p>
<p><strong>Code Complexity Metrics</strong> measure structural complexity:</p>
<p><em>Cyclomatic complexity</em> counts independent paths through code. A function with many branches (if/else, switch, loops) has high cyclomatic complexity and is harder to understand and test. Generally, functions should have cyclomatic complexity below 10; above 20 indicates need for refactoring.</p>
<p><em>Lines of code</em> provides a rough size measure. Very long functions and files are harder to understand. However, raw line count is misleading—spreading logic across many tiny functions can also harm readability.</p>
<p><em>Coupling</em> measures how interconnected components are. High coupling means changes ripple across the system. Loose coupling allows changing one component without affecting others.</p>
<p><em>Cohesion</em> measures how focused a component is on a single purpose. High cohesion means a module does one thing well. Low cohesion means a module mixes unrelated responsibilities, making it harder to understand and modify.</p>
<p><strong>Process Metrics</strong> measure development outcomes:</p>
<p><em>Mean time to change</em> measures how long typical changes take. If small features consistently require weeks, something is wrong with maintainability.</p>
<p><em>Defect density</em> measures bugs per unit of code. High defect density indicates areas needing attention.</p>
<p><em>Code churn</em> measures how often code changes. Files that change frequently either represent active development or indicate instability requiring investigation.</p>
<p><strong>Developer Feedback</strong> provides qualitative insight:</p>
<p><em>Confidence in changes</em> reflects whether developers feel they can make changes without fear of breaking things. Low confidence indicates insufficient tests or overly complex code.</p>
<p><em>Onboarding time</em> measures how long new team members take to become productive. Long onboarding suggests documentation or complexity problems.</p>
<p><em>Frustration indicators</em> like “I hate working on this module” reveal maintenance problems that metrics might miss.</p>
<hr>
</section>
</section>
<section id="technical-debt" class="level2" data-number="15.3">
<h2 data-number="15.3" class="anchored" data-anchor-id="technical-debt"><span class="header-section-number">15.3</span> 13.2 Technical Debt</h2>
<p><strong>Technical debt</strong> is a metaphor introduced by Ward Cunningham to describe the accumulated cost of shortcuts, expedient decisions, and deferred work in software. Like financial debt, technical debt allows faster progress now in exchange for ongoing interest payments and eventual principal repayment.</p>
<p>The metaphor is powerful because it reframes discussions about code quality in business terms. Executives who dismiss “code cleanup” as developer self-indulgence understand that carrying debt has costs. Technical debt isn’t inherently bad—strategic debt can accelerate time-to-market—but unmanaged debt eventually overwhelms a project.</p>
<section id="sources-of-technical-debt" class="level3" data-number="15.3.1">
<h3 data-number="15.3.1" class="anchored" data-anchor-id="sources-of-technical-debt"><span class="header-section-number">15.3.1</span> 13.2.1 Sources of Technical Debt</h3>
<p>Technical debt accumulates through various mechanisms:</p>
<p><strong>Deliberate, Prudent Debt</strong> results from conscious decisions to take shortcuts with full awareness of consequences. “We know this won’t scale past 1,000 users, but we need to launch to validate the market.” This is debt taken strategically, with a plan to repay.</p>
<p><strong>Deliberate, Reckless Debt</strong> results from conscious decisions to ignore known best practices. “We don’t have time for tests.” This debt is taken irresponsibly, often by teams under pressure who underestimate long-term costs.</p>
<p><strong>Inadvertent, Prudent Debt</strong> results from learning that past decisions were suboptimal. “Now that we understand the domain better, we see that our data model should have been different.” This is unavoidable—you can’t know everything upfront—but it still requires eventual repayment.</p>
<p><strong>Inadvertent, Reckless Debt</strong> results from poor practices or inexperience. Code written without knowledge of good patterns accumulates debt the authors don’t even recognize. This is the most dangerous debt because it grows invisibly.</p>
<pre><code>┌─────────────────────────────────────────────────────────────────────────┐
│                    TECHNICAL DEBT QUADRANT                              │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│                        DELIBERATE                                       │
│             ┌─────────────────┬─────────────────┐                       │
│             │                 │                 │                       │
│             │   "We don't     │  "We must ship  │                       │
│   RECKLESS  │   have time     │  now and deal   │  PRUDENT              │
│             │   for design"   │  with the       │                       │
│             │                 │  consequences"  │                       │
│             │                 │                 │                       │
│             ├─────────────────┼─────────────────┤                       │
│             │                 │                 │                       │
│             │   "What's       │  "Now we know   │                       │
│   RECKLESS  │   layering?"    │  how we should  │  PRUDENT              │
│             │                 │  have done it"  │                       │
│             │                 │                 │                       │
│             │                 │                 │                       │
│             └─────────────────┴─────────────────┘                       │
│                        INADVERTENT                                      │
│                                                                         │
│  Prudent debt may be strategic. Reckless debt is always problematic.    │
│  Inadvertent debt requires learning; deliberate debt requires tracking. │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘</code></pre>
</section>
<section id="manifestations-of-technical-debt" class="level3" data-number="15.3.2">
<h3 data-number="15.3.2" class="anchored" data-anchor-id="manifestations-of-technical-debt"><span class="header-section-number">15.3.2</span> 13.2.2 Manifestations of Technical Debt</h3>
<p>Technical debt manifests in various recognizable patterns:</p>
<p><strong>Code Duplication</strong> occurs when similar logic appears in multiple places. Each copy must be maintained separately, and bugs fixed in one location may remain in others. Duplication often starts small—copying a few lines seems faster than extracting a function—but accumulates rapidly.</p>
<p><strong>Inadequate Test Coverage</strong> creates debt that compounds other debt. Without tests, developers fear making changes because they can’t verify correctness. This fear slows development and leads to more cautious (less aggressive) refactoring, allowing other debt to accumulate.</p>
<p><strong>Outdated Dependencies</strong> create security vulnerabilities and compatibility challenges. Each version behind current makes upgrading harder, as multiple versions of breaking changes accumulate. Eventually, upgrading requires massive effort or becomes impossible, forcing rewrites.</p>
<p><strong>Inconsistent Patterns</strong> force developers to learn multiple ways of doing the same thing. One module uses callbacks, another uses promises, a third uses async/await. One API returns errors in the response body, another throws exceptions. Inconsistency increases cognitive load and causes mistakes.</p>
<p><strong>Missing or Outdated Documentation</strong> slows onboarding and causes errors. Developers make incorrect assumptions about how code works. Documented knowledge that contradicts actual behavior is worse than no documentation—it actively misleads.</p>
<p><strong>Overly Complex Code</strong> takes longer to understand and modify. Complexity might result from premature optimization, unnecessary abstraction, or accumulated patches. Complex code harbors bugs because developers can’t fully reason about its behavior.</p>
<p><strong>Poor Architecture</strong> constrains future development. A monolith that should be microservices (or vice versa). Tight coupling that prevents independent deployment. Wrong database choice for the access patterns. Architectural debt is expensive to repay because fixes require substantial restructuring.</p>
</section>
<section id="the-interest-payments" class="level3" data-number="15.3.3">
<h3 data-number="15.3.3" class="anchored" data-anchor-id="the-interest-payments"><span class="header-section-number">15.3.3</span> 13.2.3 The Interest Payments</h3>
<p>Technical debt accrues interest in several forms:</p>
<p><strong>Slower Development</strong>: Changes that should take hours take days. Features that should be straightforward require extensive modifications across the codebase. Developers spend more time understanding existing code than writing new code.</p>
<p><strong>Increased Defects</strong>: Working in poorly structured code introduces bugs. Developers miss edge cases because they don’t fully understand the code. Changes in one area unexpectedly break another. Bug fixes introduce new bugs.</p>
<p><strong>Reduced Morale</strong>: Developers become frustrated working in problematic codebases. Job satisfaction decreases. Talented developers leave for better opportunities. Institutional knowledge walks out the door.</p>
<p><strong>Opportunity Cost</strong>: Time spent fighting the codebase is time not spent delivering value. Competitors with cleaner codebases move faster. Market windows close while your team struggles with maintenance.</p>
<p>Let’s visualize how technical debt compounds:</p>
<pre><code>┌─────────────────────────────────────────────────────────────────────────┐
│                    TECHNICAL DEBT COMPOUNDING                           │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  Year 1: Initial debt accumulated during rapid development              │
│  ──────────────────────────                                             │
│  [████████░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░] Debt: Low                   │
│  Feature Velocity: 100%                                                 │
│                                                                         │
│  Year 2: Debt starts affecting productivity                             │
│  ────────────────────────────────────                                   │
│  [████████████████░░░░░░░░░░░░░░░░░░░░░░░░] Debt: Moderate              │
│  Feature Velocity: 85%                                                  │
│                                                                         │
│  Year 3: Significant slowdown, more bugs                                │
│  ──────────────────────────────────────────────────                     │
│  [████████████████████████░░░░░░░░░░░░░░░░] Debt: High                  │
│  Feature Velocity: 60%                                                  │
│                                                                         │
│  Year 4: Team spends most time on maintenance                           │
│  ────────────────────────────────────────────────────────────           │
│  [████████████████████████████████░░░░░░░░] Debt: Critical              │
│  Feature Velocity: 35%                                                  │
│                                                                         │
│  Year 5: System becomes unmaintainable, rewrite discussions begin       │
│  ──────────────────────────────────────────────────────────────────     │
│  [████████████████████████████████████████] Debt: Overwhelming          │
│  Feature Velocity: 10%                                                  │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘</code></pre>
<p>This progression isn’t inevitable, but it’s common. Without active debt management, the trend is always toward accumulation. The later you address debt, the more expensive the fix.</p>
</section>
<section id="managing-technical-debt" class="level3" data-number="15.3.4">
<h3 data-number="15.3.4" class="anchored" data-anchor-id="managing-technical-debt"><span class="header-section-number">15.3.4</span> 13.2.4 Managing Technical Debt</h3>
<p>Effective debt management requires visibility, prioritization, and discipline:</p>
<p><strong>Make Debt Visible</strong>: You can’t manage what you don’t track. Document known debt in your issue tracker, code comments, or dedicated debt register. Include the debt’s source, impact, and estimated remediation effort.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">// </span><span class="al">TODO</span><span class="co">(tech-debt): This function has O(n²) complexity due to nested loops.</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co">// Acceptable for current scale (&lt;1000 items) but will need optimization</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">// if we exceed 10,000 items. Estimated fix: 4 hours.</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Ticket: TECH-234</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">// Added: 2024-01-15, Author: jsmith</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">findDuplicates</span>(items) {</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> duplicates <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> items<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> j <span class="op">=</span> i <span class="op">+</span> <span class="dv">1</span><span class="op">;</span> j <span class="op">&lt;</span> items<span class="op">.</span><span class="at">length</span><span class="op">;</span> j<span class="op">++</span>) {</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (items[i]<span class="op">.</span><span class="at">id</span> <span class="op">===</span> items[j]<span class="op">.</span><span class="at">id</span>) {</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>        duplicates<span class="op">.</span><span class="fu">push</span>(items[i])<span class="op">;</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> duplicates<span class="op">;</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This comment does several important things: it identifies the debt (O(n²) complexity), explains why it’s currently acceptable (scale), specifies when it becomes problematic (&gt;10,000 items), estimates remediation effort, and links to a tracking ticket. Future developers have context to make informed decisions.</p>
<p><strong>Prioritize Based on Impact</strong>: Not all debt is equally urgent. Consider:</p>
<ul>
<li>How often do developers encounter this debt?</li>
<li>How much does it slow down work?</li>
<li>What’s the risk if it’s not addressed?</li>
<li>How hard is it to fix?</li>
</ul>
<p>Debt in frequently-modified, high-risk areas deserves priority. Debt in stable, rarely-touched code can wait.</p>
<p><strong>Allocate Capacity for Debt Reduction</strong>: If 100% of development time goes to features, debt never decreases. Many teams reserve a percentage of each sprint for technical improvements—perhaps 20% of capacity. Others dedicate entire sprints periodically to debt reduction. The specific approach matters less than consistency.</p>
<p><strong>Pay Down Debt Incrementally</strong>: Large debt items can be addressed in pieces. Each time you touch code near the debt, improve it slightly. Over time, incremental improvements accumulate. This “Boy Scout Rule” (leave the code better than you found it) maintains steady progress without dedicated debt sprints.</p>
<p><strong>Avoid Adding New Debt Unnecessarily</strong>: The best debt management is not accumulating debt in the first place. Code review should catch debt introduction. “Quick hacks” should require explicit acknowledgment and tracking. Pressure to cut corners should be met with clear communication about long-term costs.</p>
<hr>
</section>
</section>
<section id="refactoring" class="level2" data-number="15.4">
<h2 data-number="15.4" class="anchored" data-anchor-id="refactoring"><span class="header-section-number">15.4</span> 13.3 Refactoring</h2>
<p><strong>Refactoring</strong> is the process of restructuring existing code without changing its external behavior. The goal is improving internal structure—making code more readable, maintainable, and extensible—while preserving what the code does.</p>
<p>This definition is precise and important. Refactoring is not adding features. Refactoring is not fixing bugs. Those activities change behavior. Refactoring changes structure only. This distinction matters because behavior-preserving changes can be made with high confidence; tests that passed before should pass after.</p>
<section id="why-refactoring-matters" class="level3" data-number="15.4.1">
<h3 data-number="15.4.1" class="anchored" data-anchor-id="why-refactoring-matters"><span class="header-section-number">15.4.1</span> 13.3.1 Why Refactoring Matters</h3>
<p>Code structure degrades over time even with the best intentions. Initial designs make assumptions that prove incorrect. Features are added in ways that weren’t anticipated. Different developers bring different styles. Rushed work introduces shortcuts. Without deliberate effort to improve structure, entropy wins.</p>
<p>Refactoring is the antidote. It allows code to evolve alongside understanding. As you learn more about the domain, you can restructure code to reflect that knowledge. As patterns emerge, you can consolidate them. As complexity accumulates, you can simplify.</p>
<p>The alternative to refactoring is eventual rewriting. Codebases that never refactor eventually become unmaintainable and require replacement—a far more expensive proposition than ongoing maintenance.</p>
</section>
<section id="when-to-refactor" class="level3" data-number="15.4.2">
<h3 data-number="15.4.2" class="anchored" data-anchor-id="when-to-refactor"><span class="header-section-number">15.4.2</span> 13.3.2 When to Refactor</h3>
<p>Refactoring opportunities appear constantly during regular development:</p>
<p><strong>Before adding a feature</strong>: If the code isn’t structured to accommodate the new feature cleanly, refactor first. “Make the change easy, then make the easy change.” This preparation refactoring often saves more time than it costs.</p>
<p><strong>After understanding code</strong>: When you finally understand how confusing code works, refactor it to express that understanding. Your insight is valuable; encode it in the structure before you forget.</p>
<p><strong>When you see duplication</strong>: The second time you write similar code, consider extracting a shared abstraction. The third time makes this urgent.</p>
<p><strong>During code review</strong>: Reviews often reveal opportunities that the original author missed. “This would be clearer if…” suggestions should be followed up, not just acknowledged.</p>
<p><strong>When tests are difficult to write</strong>: Difficulty testing often indicates structural problems. Code that’s hard to test is usually hard to understand and modify. Refactor to improve testability.</p>
</section>
<section id="refactoring-techniques" class="level3" data-number="15.4.3">
<h3 data-number="15.4.3" class="anchored" data-anchor-id="refactoring-techniques"><span class="header-section-number">15.4.3</span> 13.3.3 Refactoring Techniques</h3>
<p>Martin Fowler’s catalog of refactorings provides a vocabulary for discussing code improvements. Let’s explore several fundamental techniques with detailed examples.</p>
<section id="extract-function" class="level4" data-number="15.4.3.1">
<h4 data-number="15.4.3.1" class="anchored" data-anchor-id="extract-function"><span class="header-section-number">15.4.3.1</span> Extract Function</h4>
<p>When a code fragment can be grouped and named, extract it into its own function. This is perhaps the most common refactoring, applicable whenever code is doing too much or when a comment explains what a block does (the function name can replace the comment).</p>
<p><strong>Before</strong>: A function that does many things, requiring readers to understand all steps to understand any step.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">processOrder</span>(order) {</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Validate order items</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>order<span class="op">.</span><span class="at">items</span> <span class="op">||</span> order<span class="op">.</span><span class="at">items</span><span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">0</span>) {</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="st">'Order must have at least one item'</span>)<span class="op">;</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">const</span> item <span class="kw">of</span> order<span class="op">.</span><span class="at">items</span>) {</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>item<span class="op">.</span><span class="at">productId</span> <span class="op">||</span> <span class="op">!</span>item<span class="op">.</span><span class="at">quantity</span> <span class="op">||</span> item<span class="op">.</span><span class="at">quantity</span> <span class="op">&lt;=</span> <span class="dv">0</span>) {</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>      <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="st">'Invalid order item'</span>)<span class="op">;</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> product <span class="op">=</span> productCatalog<span class="op">.</span><span class="fu">find</span>(p <span class="kw">=&gt;</span> p<span class="op">.</span><span class="at">id</span> <span class="op">===</span> item<span class="op">.</span><span class="at">productId</span>)<span class="op">;</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>product) {</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>      <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="vs">`Product </span><span class="sc">${</span>item<span class="op">.</span><span class="at">productId</span><span class="sc">}</span><span class="vs"> not found`</span>)<span class="op">;</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (product<span class="op">.</span><span class="at">inventory</span> <span class="op">&lt;</span> item<span class="op">.</span><span class="at">quantity</span>) {</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>      <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="vs">`Insufficient inventory for </span><span class="sc">${</span>product<span class="op">.</span><span class="at">name</span><span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Calculate totals</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> subtotal <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">const</span> item <span class="kw">of</span> order<span class="op">.</span><span class="at">items</span>) {</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> product <span class="op">=</span> productCatalog<span class="op">.</span><span class="fu">find</span>(p <span class="kw">=&gt;</span> p<span class="op">.</span><span class="at">id</span> <span class="op">===</span> item<span class="op">.</span><span class="at">productId</span>)<span class="op">;</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>    subtotal <span class="op">+=</span> product<span class="op">.</span><span class="at">price</span> <span class="op">*</span> item<span class="op">.</span><span class="at">quantity</span><span class="op">;</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> tax <span class="op">=</span> subtotal <span class="op">*</span> <span class="fl">0.08</span><span class="op">;</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> shipping <span class="op">=</span> subtotal <span class="op">&gt;</span> <span class="dv">100</span> <span class="op">?</span> <span class="dv">0</span> <span class="op">:</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> total <span class="op">=</span> subtotal <span class="op">+</span> tax <span class="op">+</span> shipping<span class="op">;</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Create order record</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> orderRecord <span class="op">=</span> {</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>    <span class="dt">id</span><span class="op">:</span> <span class="fu">generateOrderId</span>()<span class="op">,</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>    <span class="dt">customerId</span><span class="op">:</span> order<span class="op">.</span><span class="at">customerId</span><span class="op">,</span></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>    <span class="dt">items</span><span class="op">:</span> order<span class="op">.</span><span class="at">items</span><span class="op">.</span><span class="fu">map</span>(item <span class="kw">=&gt;</span> ({</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>      <span class="dt">productId</span><span class="op">:</span> item<span class="op">.</span><span class="at">productId</span><span class="op">,</span></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>      <span class="dt">quantity</span><span class="op">:</span> item<span class="op">.</span><span class="at">quantity</span><span class="op">,</span></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>      <span class="dt">price</span><span class="op">:</span> productCatalog<span class="op">.</span><span class="fu">find</span>(p <span class="kw">=&gt;</span> p<span class="op">.</span><span class="at">id</span> <span class="op">===</span> item<span class="op">.</span><span class="at">productId</span>)<span class="op">.</span><span class="at">price</span></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>    }))<span class="op">,</span></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>    subtotal<span class="op">,</span></span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>    tax<span class="op">,</span></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>    shipping<span class="op">,</span></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>    total<span class="op">,</span></span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>    <span class="dt">status</span><span class="op">:</span> <span class="st">'pending'</span><span class="op">,</span></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>    <span class="dt">createdAt</span><span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>()</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Update inventory</span></span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">const</span> item <span class="kw">of</span> order<span class="op">.</span><span class="at">items</span>) {</span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> product <span class="op">=</span> productCatalog<span class="op">.</span><span class="fu">find</span>(p <span class="kw">=&gt;</span> p<span class="op">.</span><span class="at">id</span> <span class="op">===</span> item<span class="op">.</span><span class="at">productId</span>)<span class="op">;</span></span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>    product<span class="op">.</span><span class="at">inventory</span> <span class="op">-=</span> item<span class="op">.</span><span class="at">quantity</span><span class="op">;</span></span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Save and return</span></span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>  orders<span class="op">.</span><span class="fu">push</span>(orderRecord)<span class="op">;</span></span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> orderRecord<span class="op">;</span></span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This function is 60 lines long and does five distinct things: validation, calculation, record creation, inventory update, and persistence. Understanding any part requires reading the whole function. Testing individual behaviors requires testing the entire function.</p>
<p><strong>After</strong>: Each responsibility becomes its own function with a clear name expressing its purpose.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">processOrder</span>(order) {</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">validateOrder</span>(order)<span class="op">;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> pricing <span class="op">=</span> <span class="fu">calculateOrderPricing</span>(order<span class="op">.</span><span class="at">items</span>)<span class="op">;</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> orderRecord <span class="op">=</span> <span class="fu">createOrderRecord</span>(order<span class="op">,</span> pricing)<span class="op">;</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reserveInventory</span>(order<span class="op">.</span><span class="at">items</span>)<span class="op">;</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveOrder</span>(orderRecord)<span class="op">;</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> orderRecord<span class="op">;</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">validateOrder</span>(order) {</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>order<span class="op">.</span><span class="at">items</span> <span class="op">||</span> order<span class="op">.</span><span class="at">items</span><span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">0</span>) {</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="st">'Order must have at least one item'</span>)<span class="op">;</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">const</span> item <span class="kw">of</span> order<span class="op">.</span><span class="at">items</span>) {</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">validateOrderItem</span>(item)<span class="op">;</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">validateOrderItem</span>(item) {</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>item<span class="op">.</span><span class="at">productId</span> <span class="op">||</span> <span class="op">!</span>item<span class="op">.</span><span class="at">quantity</span> <span class="op">||</span> item<span class="op">.</span><span class="at">quantity</span> <span class="op">&lt;=</span> <span class="dv">0</span>) {</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="st">'Invalid order item'</span>)<span class="op">;</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> product <span class="op">=</span> <span class="fu">findProduct</span>(item<span class="op">.</span><span class="at">productId</span>)<span class="op">;</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (product<span class="op">.</span><span class="at">inventory</span> <span class="op">&lt;</span> item<span class="op">.</span><span class="at">quantity</span>) {</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="vs">`Insufficient inventory for </span><span class="sc">${</span>product<span class="op">.</span><span class="at">name</span><span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">findProduct</span>(productId) {</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> product <span class="op">=</span> productCatalog<span class="op">.</span><span class="fu">find</span>(p <span class="kw">=&gt;</span> p<span class="op">.</span><span class="at">id</span> <span class="op">===</span> productId)<span class="op">;</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>product) {</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="vs">`Product </span><span class="sc">${</span>productId<span class="sc">}</span><span class="vs"> not found`</span>)<span class="op">;</span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> product<span class="op">;</span></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">calculateOrderPricing</span>(items) {</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> subtotal <span class="op">=</span> items<span class="op">.</span><span class="fu">reduce</span>((sum<span class="op">,</span> item) <span class="kw">=&gt;</span> {</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> product <span class="op">=</span> <span class="fu">findProduct</span>(item<span class="op">.</span><span class="at">productId</span>)<span class="op">;</span></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> sum <span class="op">+</span> (product<span class="op">.</span><span class="at">price</span> <span class="op">*</span> item<span class="op">.</span><span class="at">quantity</span>)<span class="op">;</span></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> tax <span class="op">=</span> <span class="fu">calculateTax</span>(subtotal)<span class="op">;</span></span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> shipping <span class="op">=</span> <span class="fu">calculateShipping</span>(subtotal)<span class="op">;</span></span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> total <span class="op">=</span> subtotal <span class="op">+</span> tax <span class="op">+</span> shipping<span class="op">;</span></span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> { subtotal<span class="op">,</span> tax<span class="op">,</span> shipping<span class="op">,</span> total }<span class="op">;</span></span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">calculateTax</span>(subtotal) {</span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> subtotal <span class="op">*</span> <span class="fl">0.08</span><span class="op">;</span></span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">calculateShipping</span>(subtotal) {</span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> subtotal <span class="op">&gt;</span> <span class="dv">100</span> <span class="op">?</span> <span class="dv">0</span> <span class="op">:</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">createOrderRecord</span>(order<span class="op">,</span> pricing) {</span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a>    <span class="dt">id</span><span class="op">:</span> <span class="fu">generateOrderId</span>()<span class="op">,</span></span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a>    <span class="dt">customerId</span><span class="op">:</span> order<span class="op">.</span><span class="at">customerId</span><span class="op">,</span></span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a>    <span class="dt">items</span><span class="op">:</span> order<span class="op">.</span><span class="at">items</span><span class="op">.</span><span class="fu">map</span>(item <span class="kw">=&gt;</span> ({</span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a>      <span class="dt">productId</span><span class="op">:</span> item<span class="op">.</span><span class="at">productId</span><span class="op">,</span></span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a>      <span class="dt">quantity</span><span class="op">:</span> item<span class="op">.</span><span class="at">quantity</span><span class="op">,</span></span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a>      <span class="dt">price</span><span class="op">:</span> <span class="fu">findProduct</span>(item<span class="op">.</span><span class="at">productId</span>)<span class="op">.</span><span class="at">price</span></span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a>    }))<span class="op">,</span></span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span>pricing<span class="op">,</span></span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a>    <span class="dt">status</span><span class="op">:</span> <span class="st">'pending'</span><span class="op">,</span></span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a>    <span class="dt">createdAt</span><span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>()</span>
<span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb6-77"><a href="#cb6-77" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-79"><a href="#cb6-79" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">reserveInventory</span>(items) {</span>
<span id="cb6-80"><a href="#cb6-80" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">const</span> item <span class="kw">of</span> items) {</span>
<span id="cb6-81"><a href="#cb6-81" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> product <span class="op">=</span> <span class="fu">findProduct</span>(item<span class="op">.</span><span class="at">productId</span>)<span class="op">;</span></span>
<span id="cb6-82"><a href="#cb6-82" aria-hidden="true" tabindex="-1"></a>    product<span class="op">.</span><span class="at">inventory</span> <span class="op">-=</span> item<span class="op">.</span><span class="at">quantity</span><span class="op">;</span></span>
<span id="cb6-83"><a href="#cb6-83" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-84"><a href="#cb6-84" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-85"><a href="#cb6-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-86"><a href="#cb6-86" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">saveOrder</span>(orderRecord) {</span>
<span id="cb6-87"><a href="#cb6-87" aria-hidden="true" tabindex="-1"></a>  orders<span class="op">.</span><span class="fu">push</span>(orderRecord)<span class="op">;</span></span>
<span id="cb6-88"><a href="#cb6-88" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The main function now reads like a high-level description of what processing an order means: validate, calculate pricing, create a record, reserve inventory, save. Each extracted function is small, focused, and independently testable. Changes to tax calculation don’t risk breaking inventory management.</p>
<p>This refactoring also revealed opportunities for further improvement. The <code>findProduct</code> function centralizes product lookup, eliminating repeated searches. <code>calculateTax</code> and <code>calculateShipping</code> are now easy to modify or test independently.</p>
</section>
<section id="replace-conditional-with-polymorphism" class="level4" data-number="15.4.3.2">
<h4 data-number="15.4.3.2" class="anchored" data-anchor-id="replace-conditional-with-polymorphism"><span class="header-section-number">15.4.3.2</span> Replace Conditional with Polymorphism</h4>
<p>When you have a conditional that chooses different behavior based on type, consider replacing it with polymorphism. The conditional becomes implicit in which implementation is used.</p>
<p><strong>Before</strong>: A function with type-checking conditionals that must be updated for every new type.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">calculateShippingCost</span>(shipment) {</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">switch</span> (shipment<span class="op">.</span><span class="at">type</span>) {</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="st">'standard'</span><span class="op">:</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> shipment<span class="op">.</span><span class="at">weight</span> <span class="op">*</span> <span class="fl">0.5</span> <span class="op">+</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="st">'express'</span><span class="op">:</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> shipment<span class="op">.</span><span class="at">weight</span> <span class="op">*</span> <span class="fl">1.0</span> <span class="op">+</span> <span class="dv">15</span><span class="op">;</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="st">'overnight'</span><span class="op">:</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> shipment<span class="op">.</span><span class="at">weight</span> <span class="op">*</span> <span class="fl">2.0</span> <span class="op">+</span> <span class="dv">25</span><span class="op">;</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="st">'international'</span><span class="op">:</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> baseRate <span class="op">=</span> shipment<span class="op">.</span><span class="at">weight</span> <span class="op">*</span> <span class="fl">3.0</span><span class="op">;</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> customsFee <span class="op">=</span> <span class="dv">20</span><span class="op">;</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> distanceMultiplier <span class="op">=</span> <span class="fu">getDistanceMultiplier</span>(shipment<span class="op">.</span><span class="at">destination</span>)<span class="op">;</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> (baseRate <span class="op">+</span> customsFee) <span class="op">*</span> distanceMultiplier<span class="op">;</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">default</span><span class="op">:</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>      <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="vs">`Unknown shipment type: </span><span class="sc">${</span>shipment<span class="op">.</span><span class="at">type</span><span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">getEstimatedDelivery</span>(shipment) {</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>  <span class="cf">switch</span> (shipment<span class="op">.</span><span class="at">type</span>) {</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="st">'standard'</span><span class="op">:</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="fu">addBusinessDays</span>(<span class="kw">new</span> <span class="bu">Date</span>()<span class="op">,</span> <span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="st">'express'</span><span class="op">:</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="fu">addBusinessDays</span>(<span class="kw">new</span> <span class="bu">Date</span>()<span class="op">,</span> <span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="st">'overnight'</span><span class="op">:</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="fu">addBusinessDays</span>(<span class="kw">new</span> <span class="bu">Date</span>()<span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="st">'international'</span><span class="op">:</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="fu">addBusinessDays</span>(<span class="kw">new</span> <span class="bu">Date</span>()<span class="op">,</span> <span class="dv">14</span>)<span class="op">;</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">default</span><span class="op">:</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>      <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="vs">`Unknown shipment type: </span><span class="sc">${</span>shipment<span class="op">.</span><span class="at">type</span><span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a><span class="co">// Every function dealing with shipments needs these switch statements</span></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a><span class="co">// Adding a new shipment type requires modifying every function</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The problem with this structure is that it scatters the definition of each shipment type across multiple functions. To understand “standard shipping,” you must find all the switch statements that handle it. To add a new type, you must find and modify all those switch statements—and missing one creates bugs.</p>
<p><strong>After</strong>: Each shipment type becomes a class that encapsulates its own behavior.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Base class defines the interface</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ShippingMethod {</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">constructor</span>(shipment) {</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">shipment</span> <span class="op">=</span> shipment<span class="op">;</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">calculateCost</span>() {</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="st">'Subclass must implement calculateCost'</span>)<span class="op">;</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">getEstimatedDelivery</span>() {</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="st">'Subclass must implement getEstimatedDelivery'</span>)<span class="op">;</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> StandardShipping <span class="kw">extends</span> ShippingMethod {</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">calculateCost</span>() {</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="at">shipment</span><span class="op">.</span><span class="at">weight</span> <span class="op">*</span> <span class="fl">0.5</span> <span class="op">+</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">getEstimatedDelivery</span>() {</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">addBusinessDays</span>(<span class="kw">new</span> <span class="bu">Date</span>()<span class="op">,</span> <span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ExpressShipping <span class="kw">extends</span> ShippingMethod {</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">calculateCost</span>() {</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="at">shipment</span><span class="op">.</span><span class="at">weight</span> <span class="op">*</span> <span class="fl">1.0</span> <span class="op">+</span> <span class="dv">15</span><span class="op">;</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">getEstimatedDelivery</span>() {</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">addBusinessDays</span>(<span class="kw">new</span> <span class="bu">Date</span>()<span class="op">,</span> <span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> OvernightShipping <span class="kw">extends</span> ShippingMethod {</span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">calculateCost</span>() {</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="at">shipment</span><span class="op">.</span><span class="at">weight</span> <span class="op">*</span> <span class="fl">2.0</span> <span class="op">+</span> <span class="dv">25</span><span class="op">;</span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">getEstimatedDelivery</span>() {</span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">addBusinessDays</span>(<span class="kw">new</span> <span class="bu">Date</span>()<span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> InternationalShipping <span class="kw">extends</span> ShippingMethod {</span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">calculateCost</span>() {</span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> baseRate <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">shipment</span><span class="op">.</span><span class="at">weight</span> <span class="op">*</span> <span class="fl">3.0</span><span class="op">;</span></span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> customsFee <span class="op">=</span> <span class="dv">20</span><span class="op">;</span></span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> distanceMultiplier <span class="op">=</span> <span class="fu">getDistanceMultiplier</span>(<span class="kw">this</span><span class="op">.</span><span class="at">shipment</span><span class="op">.</span><span class="at">destination</span>)<span class="op">;</span></span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (baseRate <span class="op">+</span> customsFee) <span class="op">*</span> distanceMultiplier<span class="op">;</span></span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">getEstimatedDelivery</span>() {</span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">addBusinessDays</span>(<span class="kw">new</span> <span class="bu">Date</span>()<span class="op">,</span> <span class="dv">14</span>)<span class="op">;</span></span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a><span class="co">// Factory creates the appropriate shipping method</span></span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">createShippingMethod</span>(shipment) {</span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> methods <span class="op">=</span> {</span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a>    <span class="st">'standard'</span><span class="op">:</span> StandardShipping<span class="op">,</span></span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a>    <span class="st">'express'</span><span class="op">:</span> ExpressShipping<span class="op">,</span></span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a>    <span class="st">'overnight'</span><span class="op">:</span> OvernightShipping<span class="op">,</span></span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a>    <span class="st">'international'</span><span class="op">:</span> InternationalShipping</span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> MethodClass <span class="op">=</span> methods[shipment<span class="op">.</span><span class="at">type</span>]<span class="op">;</span></span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>MethodClass) {</span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a>    <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="vs">`Unknown shipment type: </span><span class="sc">${</span>shipment<span class="op">.</span><span class="at">type</span><span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="kw">new</span> <span class="fu">MethodClass</span>(shipment)<span class="op">;</span></span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a><span class="co">// Usage is clean and type-agnostic</span></span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">processShipment</span>(shipment) {</span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> method <span class="op">=</span> <span class="fu">createShippingMethod</span>(shipment)<span class="op">;</span></span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a>    <span class="dt">cost</span><span class="op">:</span> method<span class="op">.</span><span class="fu">calculateCost</span>()<span class="op">,</span></span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a>    <span class="dt">estimatedDelivery</span><span class="op">:</span> method<span class="op">.</span><span class="fu">getEstimatedDelivery</span>()</span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb8-84"><a href="#cb8-84" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now each shipping type is defined in one place. All behaviors for standard shipping are in <code>StandardShipping</code>. Adding a new type means creating a new class and registering it in the factory—no existing code needs modification (Open-Closed Principle).</p>
<p>This structure also makes testing easier. You can test <code>InternationalShipping</code> in isolation without setting up scenarios for all shipping types.</p>
</section>
<section id="introduce-parameter-object" class="level4" data-number="15.4.3.3">
<h4 data-number="15.4.3.3" class="anchored" data-anchor-id="introduce-parameter-object"><span class="header-section-number">15.4.3.3</span> Introduce Parameter Object</h4>
<p>When multiple parameters frequently appear together, group them into an object. This simplifies function signatures, makes relationships explicit, and provides a home for behavior that operates on those parameters.</p>
<p><strong>Before</strong>: Functions with many parameters, some of which always appear together.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">createEvent</span>(title<span class="op">,</span> description<span class="op">,</span> startDate<span class="op">,</span> startTime<span class="op">,</span> endDate<span class="op">,</span> endTime<span class="op">,</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>                     location<span class="op">,</span> isVirtual<span class="op">,</span> meetingUrl<span class="op">,</span> attendees<span class="op">,</span> reminderMinutes) {</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Validate dates</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> start <span class="op">=</span> <span class="fu">combineDateAndTime</span>(startDate<span class="op">,</span> startTime)<span class="op">;</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> end <span class="op">=</span> <span class="fu">combineDateAndTime</span>(endDate<span class="op">,</span> endTime)<span class="op">;</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (end <span class="op">&lt;=</span> start) {</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="st">'End must be after start'</span>)<span class="op">;</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Validate location</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (isVirtual <span class="op">&amp;&amp;</span> <span class="op">!</span>meetingUrl) {</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="st">'Virtual events require a meeting URL'</span>)<span class="op">;</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ... rest of creation logic</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">updateEvent</span>(eventId<span class="op">,</span> title<span class="op">,</span> description<span class="op">,</span> startDate<span class="op">,</span> startTime<span class="op">,</span> endDate<span class="op">,</span> </span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>                     endTime<span class="op">,</span> location<span class="op">,</span> isVirtual<span class="op">,</span> meetingUrl<span class="op">,</span> attendees<span class="op">,</span> reminderMinutes) {</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Same parameters repeated</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">isEventConflicting</span>(existingEvent<span class="op">,</span> startDate<span class="op">,</span> startTime<span class="op">,</span> endDate<span class="op">,</span> endTime) {</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Subset of parameters for time checking</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Long parameter lists are hard to read and error-prone. Which parameter is which? What if you swap <code>startDate</code> and <code>endDate</code>? The relationship between <code>startDate</code> and <code>startTime</code> (they form a datetime) isn’t explicit.</p>
<p><strong>After</strong>: Related parameters grouped into meaningful objects.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Time range as a distinct concept</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> TimeRange {</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">constructor</span>(start<span class="op">,</span> end) {</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>(start <span class="kw">instanceof</span> <span class="bu">Date</span>) <span class="op">||</span> <span class="op">!</span>(end <span class="kw">instanceof</span> <span class="bu">Date</span>)) {</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>      <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="st">'Start and end must be Date objects'</span>)<span class="op">;</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (end <span class="op">&lt;=</span> start) {</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>      <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="st">'End must be after start'</span>)<span class="op">;</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">start</span> <span class="op">=</span> start<span class="op">;</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">end</span> <span class="op">=</span> end<span class="op">;</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  <span class="kw">get</span> <span class="fu">durationMinutes</span>() {</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (<span class="kw">this</span><span class="op">.</span><span class="at">end</span> <span class="op">-</span> <span class="kw">this</span><span class="op">.</span><span class="at">start</span>) <span class="op">/</span> (<span class="dv">1000</span> <span class="op">*</span> <span class="dv">60</span>)<span class="op">;</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">overlaps</span>(other) {</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="at">start</span> <span class="op">&lt;</span> other<span class="op">.</span><span class="at">end</span> <span class="op">&amp;&amp;</span> other<span class="op">.</span><span class="at">start</span> <span class="op">&lt;</span> <span class="kw">this</span><span class="op">.</span><span class="at">end</span><span class="op">;</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">contains</span>(date) {</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> date <span class="op">&gt;=</span> <span class="kw">this</span><span class="op">.</span><span class="at">start</span> <span class="op">&amp;&amp;</span> date <span class="op">&lt;=</span> <span class="kw">this</span><span class="op">.</span><span class="at">end</span><span class="op">;</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a><span class="co">// Location as a distinct concept</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> EventLocation {</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">constructor</span>({ venue<span class="op">,</span> address<span class="op">,</span> isVirtual<span class="op">,</span> meetingUrl }) {</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">venue</span> <span class="op">=</span> venue<span class="op">;</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">address</span> <span class="op">=</span> address<span class="op">;</span></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">isVirtual</span> <span class="op">=</span> isVirtual<span class="op">;</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">meetingUrl</span> <span class="op">=</span> meetingUrl<span class="op">;</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="fu">validate</span>()<span class="op">;</span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">validate</span>() {</span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="kw">this</span><span class="op">.</span><span class="at">isVirtual</span> <span class="op">&amp;&amp;</span> <span class="op">!</span><span class="kw">this</span><span class="op">.</span><span class="at">meetingUrl</span>) {</span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>      <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="st">'Virtual events require a meeting URL'</span>)<span class="op">;</span></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>  <span class="kw">get</span> <span class="fu">displayString</span>() {</span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="kw">this</span><span class="op">.</span><span class="at">isVirtual</span>) {</span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="vs">`Virtual: </span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">meetingUrl</span><span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="at">address</span> <span class="op">?</span> <span class="vs">`</span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">venue</span><span class="sc">}</span><span class="vs">, </span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">address</span><span class="sc">}</span><span class="vs">`</span> <span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="at">venue</span><span class="op">;</span></span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a><span class="co">// Event creation with parameter objects</span></span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">createEvent</span>({ title<span class="op">,</span> description<span class="op">,</span> timeRange<span class="op">,</span> location<span class="op">,</span> attendees<span class="op">,</span> reminderMinutes }) {</span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Validation is already done in TimeRange and EventLocation constructors</span></span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>    <span class="dt">id</span><span class="op">:</span> <span class="fu">generateEventId</span>()<span class="op">,</span></span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a>    title<span class="op">,</span></span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a>    description<span class="op">,</span></span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a>    timeRange<span class="op">,</span></span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a>    location<span class="op">,</span></span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a>    <span class="dt">attendees</span><span class="op">:</span> attendees <span class="op">||</span> []<span class="op">,</span></span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a>    <span class="dt">reminderMinutes</span><span class="op">:</span> reminderMinutes <span class="op">||</span> <span class="dv">30</span><span class="op">,</span></span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a>    <span class="dt">createdAt</span><span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>()</span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a><span class="co">// Usage is clearer</span></span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> <span class="bu">event</span> <span class="op">=</span> <span class="fu">createEvent</span>({</span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a>  <span class="dt">title</span><span class="op">:</span> <span class="st">'Team Standup'</span><span class="op">,</span></span>
<span id="cb10-72"><a href="#cb10-72" aria-hidden="true" tabindex="-1"></a>  <span class="dt">description</span><span class="op">:</span> <span class="st">'Daily sync meeting'</span><span class="op">,</span></span>
<span id="cb10-73"><a href="#cb10-73" aria-hidden="true" tabindex="-1"></a>  <span class="dt">timeRange</span><span class="op">:</span> <span class="kw">new</span> <span class="fu">TimeRange</span>(</span>
<span id="cb10-74"><a href="#cb10-74" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="bu">Date</span>(<span class="st">'2024-03-15T09:00:00'</span>)<span class="op">,</span></span>
<span id="cb10-75"><a href="#cb10-75" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="bu">Date</span>(<span class="st">'2024-03-15T09:15:00'</span>)</span>
<span id="cb10-76"><a href="#cb10-76" aria-hidden="true" tabindex="-1"></a>  )<span class="op">,</span></span>
<span id="cb10-77"><a href="#cb10-77" aria-hidden="true" tabindex="-1"></a>  <span class="dt">location</span><span class="op">:</span> <span class="kw">new</span> <span class="fu">EventLocation</span>({</span>
<span id="cb10-78"><a href="#cb10-78" aria-hidden="true" tabindex="-1"></a>    <span class="dt">isVirtual</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb10-79"><a href="#cb10-79" aria-hidden="true" tabindex="-1"></a>    <span class="dt">meetingUrl</span><span class="op">:</span> <span class="st">'https://zoom.us/j/123456'</span></span>
<span id="cb10-80"><a href="#cb10-80" aria-hidden="true" tabindex="-1"></a>  })<span class="op">,</span></span>
<span id="cb10-81"><a href="#cb10-81" aria-hidden="true" tabindex="-1"></a>  <span class="dt">attendees</span><span class="op">:</span> [<span class="st">'alice@example.com'</span><span class="op">,</span> <span class="st">'bob@example.com'</span>]</span>
<span id="cb10-82"><a href="#cb10-82" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb10-83"><a href="#cb10-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-84"><a href="#cb10-84" aria-hidden="true" tabindex="-1"></a><span class="co">// Conflict checking is now clean</span></span>
<span id="cb10-85"><a href="#cb10-85" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">isEventConflicting</span>(existingEvent<span class="op">,</span> proposedTimeRange) {</span>
<span id="cb10-86"><a href="#cb10-86" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> existingEvent<span class="op">.</span><span class="at">timeRange</span><span class="op">.</span><span class="fu">overlaps</span>(proposedTimeRange)<span class="op">;</span></span>
<span id="cb10-87"><a href="#cb10-87" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The parameter objects aren’t just containers—they include validation and behavior. <code>TimeRange</code> validates that end comes after start and provides useful methods like <code>overlaps()</code> and <code>durationMinutes</code>. This behavior would otherwise be scattered or duplicated.</p>
</section>
</section>
<section id="refactoring-safely" class="level3" data-number="15.4.4">
<h3 data-number="15.4.4" class="anchored" data-anchor-id="refactoring-safely"><span class="header-section-number">15.4.4</span> 13.3.4 Refactoring Safely</h3>
<p>Refactoring’s promise—changing structure without changing behavior—requires discipline to keep. Without care, “refactoring” becomes “changing stuff and hoping for the best.”</p>
<p><strong>Tests are essential.</strong> Before refactoring, ensure adequate test coverage. Tests verify that behavior is preserved. Run tests after every small change. If tests fail, you either introduced a bug or your tests were catching on implementation details rather than behavior (both useful to know).</p>
<p><strong>Take small steps.</strong> Large refactorings are risky. Break them into many small steps, each testable and committable. If something goes wrong, you lose only the last small change, not hours of work.</p>
<p><strong>Refactor or change behavior, never both simultaneously.</strong> When adding features, get the feature working first (even if the code is ugly), then refactor. Don’t try to improve structure while also figuring out new behavior.</p>
<p><strong>Use automated refactoring tools.</strong> Modern IDEs can perform many refactorings automatically: extract function, rename symbol, move to file, change function signature. Automated refactorings are safer than manual editing because the tool ensures all references are updated.</p>
<p><strong>Commit frequently.</strong> Each successful refactoring step should be committed. This creates a safety net—you can always return to the last good state. It also creates documentation of your refactoring process.</p>
<hr>
</section>
</section>
<section id="working-with-legacy-systems" class="level2" data-number="15.5">
<h2 data-number="15.5" class="anchored" data-anchor-id="working-with-legacy-systems"><span class="header-section-number">15.5</span> 13.4 Working with Legacy Systems</h2>
<p><strong>Legacy systems</strong> are existing systems that remain valuable but are difficult to work with. They might use outdated technologies, lack documentation, have minimal tests, or suffer from years of accumulated technical debt. Yet they continue running critical business processes.</p>
<p>The term “legacy” often carries negative connotations, but it’s worth recognizing that legacy systems exist because they were successful. They solved real problems well enough that they became essential. The challenge isn’t that they’re bad systems—it’s that they’ve outlived their architectural assumptions.</p>
<section id="understanding-legacy-challenges" class="level3" data-number="15.5.1">
<h3 data-number="15.5.1" class="anchored" data-anchor-id="understanding-legacy-challenges"><span class="header-section-number">15.5.1</span> 13.4.1 Understanding Legacy Challenges</h3>
<p>Legacy systems present unique challenges:</p>
<p><strong>Missing Knowledge</strong>: Original developers have moved on. Documentation is incomplete or outdated. Why certain decisions were made is unknown. The system’s behavior is defined by its code, but understanding that code requires context that’s lost.</p>
<p><strong>Fear of Change</strong>: Without comprehensive tests, changes are risky. Developers are afraid to modify code because they can’t verify their changes don’t break something. This fear leads to more patches and workarounds rather than proper fixes, worsening technical debt.</p>
<p><strong>Obsolete Technologies</strong>: The system might use languages, frameworks, or platforms that are no longer mainstream. Finding developers with relevant skills is difficult. Security patches may no longer be available.</p>
<p><strong>Integration Complexity</strong>: Other systems depend on the legacy system. Its interfaces, data formats, and behaviors are assumed by downstream systems. Changes have ripple effects that are hard to predict.</p>
<p><strong>Business Criticality</strong>: Despite its problems, the system keeps the business running. Taking it offline for replacement isn’t feasible. Changes must be made carefully, incrementally, and without disruption.</p>
</section>
<section id="strategies-for-legacy-evolution" class="level3" data-number="15.5.2">
<h3 data-number="15.5.2" class="anchored" data-anchor-id="strategies-for-legacy-evolution"><span class="header-section-number">15.5.2</span> 13.4.2 Strategies for Legacy Evolution</h3>
<p>Different strategies suit different situations. The choice depends on the system’s condition, business criticality, available resources, and organizational tolerance for risk.</p>
<p><strong>The Strangler Fig Pattern</strong> gradually replaces a legacy system by building new functionality alongside it, progressively routing traffic to the new system until the legacy system can be retired.</p>
<pre><code>┌─────────────────────────────────────────────────────────────────────────┐
│                    STRANGLER FIG PATTERN                                │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  Phase 1: New system handles edge functionality                         │
│                                                                         │
│  ┌─────────┐     ┌───────────────────────────────────────┐              │
│  │ Clients │────▶│              Facade/Router            │              │
│  └─────────┘     └───────────────┬───────────────────────┘              │
│                           │               │                             │
│                           ▼               ▼                             │
│                    ┌──────────┐    ┌─────────────┐                      │
│                    │   New    │    │   Legacy    │                      │
│                    │  System  │    │   System    │                      │
│                    │   (5%)   │    │   (95%)     │                      │
│                    └──────────┘    └─────────────┘                      │
│                                                                         │
│  Phase 2: New system takes over more functionality                      │
│                                                                         │
│                    ┌──────────┐    ┌─────────────┐                      │
│                    │   New    │    │   Legacy    │                      │
│                    │  System  │    │   System    │                      │
│                    │   (60%)  │    │   (40%)     │                      │
│                    └──────────┘    └─────────────┘                      │
│                                                                         │
│  Phase 3: Legacy system retired                                         │
│                                                                         │
│                    ┌──────────────────────────┐                         │
│                    │       New System         │                         │
│                    │         (100%)           │                         │
│                    └──────────────────────────┘                         │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘</code></pre>
<p>The name comes from strangler fig trees that grow around host trees, eventually replacing them. For software, the approach works like this:</p>
<ol type="1">
<li>Place a facade in front of the legacy system that routes all requests</li>
<li>Implement new functionality in a new system</li>
<li>Update the facade to route requests for new functionality to the new system</li>
<li>Gradually re-implement legacy functionality in the new system</li>
<li>Update routing as functionality moves</li>
<li>Eventually, no requests go to the legacy system, which can be retired</li>
</ol>
<p>This pattern’s strength is its incrementalism. At every stage, the system works. Risk is limited to the functionality being migrated. You can pause or reverse if problems arise.</p>
<p><strong>The Branch by Abstraction Pattern</strong> creates an abstraction layer within the codebase, allowing old and new implementations to coexist while gradually transitioning.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Step 1: Identify the component to replace</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co">// Original code directly uses the legacy payment processor</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> OrderService {</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">checkout</span>(order) {</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Direct dependency on legacy system</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> result <span class="op">=</span> <span class="cf">await</span> LegacyPaymentSystem<span class="op">.</span><span class="fu">processPayment</span>({</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>      <span class="dt">amount</span><span class="op">:</span> order<span class="op">.</span><span class="at">total</span><span class="op">,</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>      <span class="dt">cardNumber</span><span class="op">:</span> order<span class="op">.</span><span class="at">paymentDetails</span><span class="op">.</span><span class="at">cardNumber</span><span class="op">,</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>      <span class="dt">expiry</span><span class="op">:</span> order<span class="op">.</span><span class="at">paymentDetails</span><span class="op">.</span><span class="at">expiry</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result<span class="op">;</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="co">// Step 2: Create an abstraction</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> PaymentProcessor {</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">processPayment</span>(<span class="dt">amount</span><span class="op">:</span> number<span class="op">,</span> <span class="dt">paymentDetails</span><span class="op">:</span> PaymentDetails)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span>PaymentResult<span class="op">&gt;;</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="co">// Step 3: Wrap legacy system in the abstraction</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> LegacyPaymentProcessor <span class="kw">implements</span> PaymentProcessor {</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">processPayment</span>(amount<span class="op">,</span> paymentDetails) {</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> LegacyPaymentSystem<span class="op">.</span><span class="fu">processPayment</span>({</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>      amount<span class="op">,</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>      <span class="dt">cardNumber</span><span class="op">:</span> paymentDetails<span class="op">.</span><span class="at">cardNumber</span><span class="op">,</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>      <span class="dt">expiry</span><span class="op">:</span> paymentDetails<span class="op">.</span><span class="at">expiry</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a><span class="co">// Step 4: Update consumers to use abstraction</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> OrderService {</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">constructor</span>(<span class="dt">paymentProcessor</span><span class="op">:</span> PaymentProcessor) {</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">paymentProcessor</span> <span class="op">=</span> paymentProcessor<span class="op">;</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">checkout</span>(order) {</span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="at">paymentProcessor</span><span class="op">.</span><span class="fu">processPayment</span>(</span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>      order<span class="op">.</span><span class="at">total</span><span class="op">,</span></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>      order<span class="op">.</span><span class="at">paymentDetails</span></span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a><span class="co">// Step 5: Create new implementation</span></span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> StripePaymentProcessor <span class="kw">implements</span> PaymentProcessor {</span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">processPayment</span>(amount<span class="op">,</span> paymentDetails) {</span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>    <span class="co">// New, modern implementation</span></span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> stripe<span class="op">.</span><span class="at">charges</span><span class="op">.</span><span class="fu">create</span>({</span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>      <span class="dt">amount</span><span class="op">:</span> amount <span class="op">*</span> <span class="dv">100</span><span class="op">,</span>  <span class="co">// Stripe uses cents</span></span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a>      <span class="dt">currency</span><span class="op">:</span> <span class="st">'usd'</span><span class="op">,</span></span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a>      <span class="dt">source</span><span class="op">:</span> paymentDetails<span class="op">.</span><span class="at">stripeToken</span></span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a><span class="co">// Step 6: Gradually transition</span></span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> PaymentProcessorFactory {</span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a>  <span class="kw">static</span> <span class="fu">create</span>(merchant) {</span>
<span id="cb12-60"><a href="#cb12-60" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Feature flag controls which implementation to use</span></span>
<span id="cb12-61"><a href="#cb12-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (featureFlags<span class="op">.</span><span class="fu">isEnabled</span>(<span class="st">'new-payment-system'</span><span class="op">,</span> merchant<span class="op">.</span><span class="at">id</span>)) {</span>
<span id="cb12-62"><a href="#cb12-62" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="kw">new</span> <span class="fu">StripePaymentProcessor</span>()<span class="op">;</span></span>
<span id="cb12-63"><a href="#cb12-63" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb12-64"><a href="#cb12-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">new</span> <span class="fu">LegacyPaymentProcessor</span>()<span class="op">;</span></span>
<span id="cb12-65"><a href="#cb12-65" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb12-66"><a href="#cb12-66" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This pattern works well when you need to replace internal components without affecting the overall system architecture. The abstraction provides the seam for transitioning.</p>
<p><strong>Characterization Testing</strong> captures existing behavior when you don’t have tests. Rather than specifying what the system <em>should</em> do, characterization tests document what it <em>actually does</em>:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Characterization test process:</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co">// 1. Call the system with various inputs</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co">// 2. Record actual outputs</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co">// 3. Write tests that verify these outputs</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="fu">describe</span>(<span class="st">'LegacyPricingEngine (characterization)'</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">// We don't know if these prices are "correct" - we're documenting behavior</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">test</span>(<span class="st">'basic item pricing'</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> price <span class="op">=</span> LegacyPricingEngine<span class="op">.</span><span class="fu">calculate</span>({</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>      <span class="dt">itemCode</span><span class="op">:</span> <span class="st">'ABC123'</span><span class="op">,</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>      <span class="dt">quantity</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>      <span class="dt">customerType</span><span class="op">:</span> <span class="st">'retail'</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">// This is what the system currently returns</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">// If we change it, we need to consciously decide if the new behavior is better</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expect</span>(price)<span class="op">.</span><span class="fu">toBe</span>(<span class="fl">29.99</span>)<span class="op">;</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">test</span>(<span class="st">'bulk discount calculation'</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> price <span class="op">=</span> LegacyPricingEngine<span class="op">.</span><span class="fu">calculate</span>({</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>      <span class="dt">itemCode</span><span class="op">:</span> <span class="st">'ABC123'</span><span class="op">,</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>      <span class="dt">quantity</span><span class="op">:</span> <span class="dv">100</span><span class="op">,</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>      <span class="dt">customerType</span><span class="op">:</span> <span class="st">'retail'</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Documents current bulk discount behavior</span></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expect</span>(price)<span class="op">.</span><span class="fu">toBe</span>(<span class="fl">2499.15</span>)<span class="op">;</span>  <span class="co">// Not exactly 100 * 29.99</span></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">test</span>(<span class="st">'wholesale pricing'</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> price <span class="op">=</span> LegacyPricingEngine<span class="op">.</span><span class="fu">calculate</span>({</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>      <span class="dt">itemCode</span><span class="op">:</span> <span class="st">'ABC123'</span><span class="op">,</span></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>      <span class="dt">quantity</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>      <span class="dt">customerType</span><span class="op">:</span> <span class="st">'wholesale'</span></span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Documents the wholesale discount</span></span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expect</span>(price)<span class="op">.</span><span class="fu">toBe</span>(<span class="fl">22.49</span>)<span class="op">;</span>  <span class="co">// 25% discount from retail</span></span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Edge cases we discovered through exploration</span></span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">test</span>(<span class="st">'handles negative quantity by returning zero'</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> price <span class="op">=</span> LegacyPricingEngine<span class="op">.</span><span class="fu">calculate</span>({</span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>      <span class="dt">itemCode</span><span class="op">:</span> <span class="st">'ABC123'</span><span class="op">,</span></span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>      <span class="dt">quantity</span><span class="op">:</span> <span class="op">-</span><span class="dv">5</span><span class="op">,</span></span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a>      <span class="dt">customerType</span><span class="op">:</span> <span class="st">'retail'</span></span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expect</span>(price)<span class="op">.</span><span class="fu">toBe</span>(<span class="dv">0</span>)<span class="op">;</span>  <span class="co">// Surprising but this is current behavior</span></span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Characterization tests don’t claim the behavior is correct; they document it. Once documented, you can safely refactor—if tests break, you’ve changed behavior and need to decide if that’s acceptable.</p>
</section>
<section id="managing-risk-during-legacy-evolution" class="level3" data-number="15.5.3">
<h3 data-number="15.5.3" class="anchored" data-anchor-id="managing-risk-during-legacy-evolution"><span class="header-section-number">15.5.3</span> 13.4.3 Managing Risk During Legacy Evolution</h3>
<p>Legacy evolution is inherently risky. These practices help manage that risk:</p>
<p><strong>Parallel Running</strong>: Run old and new systems simultaneously, comparing outputs. Discrepancies reveal behavioral differences before they affect users.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">async</span> <span class="kw">function</span> <span class="fu">processWithComparison</span>(input) {</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Run both systems</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> [legacyResult<span class="op">,</span> newResult] <span class="op">=</span> <span class="cf">await</span> <span class="bu">Promise</span><span class="op">.</span><span class="fu">all</span>([</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    legacySystem<span class="op">.</span><span class="fu">process</span>(input)<span class="op">,</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    newSystem<span class="op">.</span><span class="fu">process</span>(input)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  ])<span class="op">;</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Compare results</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> match <span class="op">=</span> <span class="fu">deepEqual</span>(legacyResult<span class="op">,</span> newResult)<span class="op">;</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>match) {</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Log for investigation but don't fail</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    logger<span class="op">.</span><span class="fu">warn</span>(<span class="st">'Result mismatch'</span><span class="op">,</span> {</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>      input<span class="op">,</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>      legacyResult<span class="op">,</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>      newResult</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    metrics<span class="op">.</span><span class="fu">increment</span>(<span class="st">'result_mismatch'</span>)<span class="op">;</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Return legacy result for safety</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> legacyResult<span class="op">;</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This approach is expensive (running everything twice) but provides high confidence. Mismatches can be investigated before the new system becomes authoritative.</p>
<p><strong>Feature Flags</strong>: Control which system handles requests per user, region, or percentage of traffic. Gradually increase new system exposure while monitoring for problems.</p>
<p><strong>Comprehensive Monitoring</strong>: Instrument both systems extensively. Track latency, error rates, and business metrics. Anomalies might indicate behavioral differences.</p>
<p><strong>Rollback Capability</strong>: Always maintain the ability to return to the previous state. Don’t decommission the legacy system until the new system has proven itself in production.</p>
<hr>
</section>
</section>
<section id="documentation" class="level2" data-number="15.6">
<h2 data-number="15.6" class="anchored" data-anchor-id="documentation"><span class="header-section-number">15.6</span> 13.5 Documentation</h2>
<p>Documentation is often treated as an afterthought—something done reluctantly after “real work” is complete. This attitude is counterproductive. Documentation is a force multiplier that enables others to use, maintain, and extend your work. Time spent on documentation saves multiples of that time in reduced questions, faster onboarding, and fewer misunderstandings.</p>
<section id="types-of-documentation" class="level3" data-number="15.6.1">
<h3 data-number="15.6.1" class="anchored" data-anchor-id="types-of-documentation"><span class="header-section-number">15.6.1</span> 13.5.1 Types of Documentation</h3>
<p>Different audiences need different documentation:</p>
<pre><code>┌─────────────────────────────────────────────────────────────────────────┐
│                    DOCUMENTATION TYPES                                  │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  USER DOCUMENTATION                                                     │
│  Audience: End users of the software                                    │
│  Purpose: Enable effective use of the software                          │
│  Examples: User guides, tutorials, FAQs, help text                      │
│                                                                         │
│  API DOCUMENTATION                                                      │
│  Audience: Developers integrating with your system                      │
│  Purpose: Enable correct integration                                    │
│  Examples: API reference, authentication guide, examples, SDKs          │
│                                                                         │
│  ARCHITECTURAL DOCUMENTATION                                            │
│  Audience: Developers working on the system                             │
│  Purpose: Enable understanding of system structure and decisions        │
│  Examples: Architecture diagrams, design documents, ADRs                │
│                                                                         │
│  CODE DOCUMENTATION                                                     │
│  Audience: Developers reading and modifying code                        │
│  Purpose: Enable understanding of implementation details                │
│  Examples: Comments, docstrings, README files                           │
│                                                                         │
│  OPERATIONAL DOCUMENTATION                                              │
│  Audience: Operations team, on-call engineers                           │
│  Purpose: Enable running and troubleshooting the system                 │
│  Examples: Runbooks, deployment guides, monitoring guides               │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘</code></pre>
</section>
<section id="architectural-decision-records" class="level3" data-number="15.6.2">
<h3 data-number="15.6.2" class="anchored" data-anchor-id="architectural-decision-records"><span class="header-section-number">15.6.2</span> 13.5.2 Architectural Decision Records</h3>
<p><strong>Architectural Decision Records (ADRs)</strong> capture the reasoning behind significant decisions. Unlike most documentation that describes <em>what</em> the system is, ADRs explain <em>why</em> it became that way.</p>
<p>The value of ADRs becomes apparent when you face a decision that seems already settled. “Why don’t we use GraphQL?” Without an ADR, you’ll spend time re-evaluating a decision that was already carefully considered. With an ADR, you can quickly understand the original context and reasoning—and determine if circumstances have changed enough to warrant revisiting.</p>
<p>A good ADR follows a consistent template:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># ADR 0012: Use PostgreSQL as Primary Database</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">## Status</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>Accepted (2024-01-15)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="fu">## Context</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>We need to select a primary database for the TaskFlow application. The </span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>application requires:</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Strong consistency for financial transactions</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Complex querying capabilities for reporting</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>JSON storage for flexible user preferences</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Full-text search for task descriptions</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Expected scale: 100,000 users, 10 million tasks</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>We considered: PostgreSQL, MySQL, MongoDB, and CockroachDB.</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="fu">## Decision</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>We will use PostgreSQL as our primary database.</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a><span class="fu">## Rationale</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>**Why PostgreSQL over MySQL:**</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Superior JSON support (JSONB with indexing)</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Better full-text search capabilities</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>More advanced indexing options (GIN, GiST)</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Stronger standards compliance</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>**Why PostgreSQL over MongoDB:**</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Strong consistency required for task state transitions</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Complex reporting queries span multiple collections</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Team has more SQL experience than MongoDB experience</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>PostgreSQL's JSONB provides document flexibility where needed</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>**Why PostgreSQL over CockroachDB:**</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>CockroachDB's distributed architecture is premature for our scale</span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>PostgreSQL has larger ecosystem and more operational tooling</span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We can migrate to CockroachDB later if horizontal scaling is needed</span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a><span class="fu">## Consequences</span></span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>**Positive:**</span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Single database handles relational data, JSON, and full-text search</span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Strong ecosystem of tools, libraries, and hosting options</span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Team familiarity reduces learning curve</span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a>**Negative:**</span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Single-node PostgreSQL limits horizontal scaling</span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Must implement application-level sharding if we exceed single-node capacity</span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Some MongoDB-native patterns won't apply</span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a>**Risks:**</span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>If we grow beyond 10M tasks significantly, we may need to migrate to </span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a>  distributed database or implement sharding</span>
<span id="cb16-54"><a href="#cb16-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-55"><a href="#cb16-55" aria-hidden="true" tabindex="-1"></a><span class="fu">## Alternatives Considered</span></span>
<span id="cb16-56"><a href="#cb16-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-57"><a href="#cb16-57" aria-hidden="true" tabindex="-1"></a>See comparison matrix in Appendix A.</span>
<span id="cb16-58"><a href="#cb16-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-59"><a href="#cb16-59" aria-hidden="true" tabindex="-1"></a><span class="fu">## Related Decisions</span></span>
<span id="cb16-60"><a href="#cb16-60" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>ADR 0015: Use read replicas for reporting queries</span>
<span id="cb16-61"><a href="#cb16-61" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>ADR 0018: Implement Redis caching layer</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Notice the structure: the context explains the problem and constraints, the decision states the choice clearly, the rationale explains why this choice over alternatives, and the consequences acknowledge both benefits and drawbacks. This honest assessment of tradeoffs is crucial—every decision has downsides, and pretending otherwise undermines trust in the documentation.</p>
</section>
<section id="code-comments" class="level3" data-number="15.6.3">
<h3 data-number="15.6.3" class="anchored" data-anchor-id="code-comments"><span class="header-section-number">15.6.3</span> 13.5.3 Code Comments</h3>
<p>Comments in code are often misused. Bad comments restate what code does, becoming noise that readers learn to ignore. Good comments explain what code <em>can’t</em> say: the why, the context, the warnings.</p>
<p><strong>Comments to avoid:</strong></p>
<div class="sourceCode" id="cb17"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Bad: Restates the obvious</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> count <span class="op">=</span> <span class="dv">0</span><span class="op">;</span>  <span class="co">// Initialize count to zero</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Bad: Explains what, not why</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co">// Loop through users</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (<span class="kw">const</span> user <span class="kw">of</span> users) {</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Check if user is active</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (user<span class="op">.</span><span class="at">isActive</span>) {</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Increment count</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    count<span class="op">++;</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="co">// Bad: Outdated comment contradicting code</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="co">// Send email notification</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="cf">await</span> <span class="fu">sendSmsNotification</span>(user)<span class="op">;</span>  <span class="co">// Comment says email, code sends SMS</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Comments that add value:</strong></p>
<div class="sourceCode" id="cb18"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Good: Explains why, not what</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co">// We process in batches of 100 to avoid overwhelming the email service</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co">// rate limits (max 200 requests/minute). See incident INC-234.</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> BATCH_SIZE <span class="op">=</span> <span class="dv">100</span><span class="op">;</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co">// Good: Documents non-obvious behavior</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co">// Returns null instead of throwing for missing users because</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co">// the caller often doesn't care if the user exists (e.g., </span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co">// permission checks for anonymous users)</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">findUser</span>(id) {</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> users<span class="op">.</span><span class="fu">get</span>(id) <span class="op">||</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="co">// Good: Warns about surprising behavior</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="co">// </span><span class="al">WARNING</span><span class="co">: This function modifies the input array in place for performance.</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="co">// Clone before calling if you need to preserve the original.</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">sortByPriority</span>(tasks) {</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> tasks<span class="op">.</span><span class="fu">sort</span>((a<span class="op">,</span> b) <span class="kw">=&gt;</span> b<span class="op">.</span><span class="at">priority</span> <span class="op">-</span> a<span class="op">.</span><span class="at">priority</span>)<span class="op">;</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a><span class="co">// Good: Provides context that code can't express</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a><span class="co">// This calculation matches the formula in Section 4.2 of the </span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a><span class="co">// ISO 4217 currency specification. Don't "simplify" without </span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a><span class="co">// verifying against the spec.</span></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">roundCurrency</span>(amount<span class="op">,</span> currency) {</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> decimals <span class="op">=</span> currencyDecimals[currency] <span class="op">??</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> factor <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">pow</span>(<span class="dv">10</span><span class="op">,</span> decimals)<span class="op">;</span></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(amount <span class="op">*</span> factor) <span class="op">/</span> factor<span class="op">;</span></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a><span class="co">// Good: Explains workaround for external issue</span></span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a><span class="co">// </span><span class="al">HACK</span><span class="co">: The Stripe API sometimes returns duplicate webhook events.</span></span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a><span class="co">// We deduplicate by tracking processed event IDs for 24 hours.</span></span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a><span class="co">// Remove this when Stripe fixes the issue (reported: 2024-01-10)</span></span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> processedEventIds <span class="op">=</span> <span class="kw">new</span> <span class="bu">Set</span>()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The best code needs minimal comments because it’s self-explanatory. But some things can’t be expressed in code: business context, historical reasons, external constraints, and warnings about non-obvious behavior. These deserve comments.</p>
</section>
<section id="readme-files" class="level3" data-number="15.6.4">
<h3 data-number="15.6.4" class="anchored" data-anchor-id="readme-files"><span class="header-section-number">15.6.4</span> 13.5.4 README Files</h3>
<p>Every project needs a README that answers basic questions: What is this? How do I run it? How do I contribute? A good README makes the difference between a project others can use and one that sits unused.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># TaskFlow API</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>A RESTful API for task management with real-time collaboration features.</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="fu">## Quick Start</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="in">```bash</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Clone repository</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> clone https://github.com/example/taskflow-api</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> taskflow-api</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Install dependencies</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> install</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up environment</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="fu">cp</span> .env.example .env</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Edit .env with your configuration</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Start development server</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> run dev</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Run tests</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> test</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="requirements" class="level2" data-number="15.7">
<h2 data-number="15.7" class="anchored" data-anchor-id="requirements"><span class="header-section-number">15.7</span> Requirements</h2>
<ul>
<li>Node.js 20+</li>
<li>PostgreSQL 15+</li>
<li>Redis 7+</li>
</ul>
</section>
<section id="project-structure" class="level2" data-number="15.8">
<h2 data-number="15.8" class="anchored" data-anchor-id="project-structure"><span class="header-section-number">15.8</span> Project Structure</h2>
<pre><code>src/
├── api/           # Route handlers and middleware
├── services/      # Business logic
├── repositories/  # Database access
├── models/        # Data models and validation
└── utils/         # Shared utilities

tests/
├── unit/          # Unit tests
├── integration/   # Integration tests
└── e2e/           # End-to-end tests</code></pre>
</section>
<section id="configuration" class="level2" data-number="15.9">
<h2 data-number="15.9" class="anchored" data-anchor-id="configuration"><span class="header-section-number">15.9</span> Configuration</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 22%">
<col style="width: 41%">
<col style="width: 36%">
</colgroup>
<thead>
<tr class="header">
<th>Variable</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>DATABASE_URL</code></td>
<td>PostgreSQL connection string</td>
<td>Required</td>
</tr>
<tr class="even">
<td><code>REDIS_URL</code></td>
<td>Redis connection string</td>
<td><code>redis://localhost:6379</code></td>
</tr>
<tr class="odd">
<td><code>JWT_SECRET</code></td>
<td>Secret for JWT signing</td>
<td>Required</td>
</tr>
<tr class="even">
<td><code>PORT</code></td>
<td>Server port</td>
<td><code>3000</code></td>
</tr>
</tbody>
</table>
<p>See <a href="https://claude.ai/chat/docs/configuration.md">Configuration Guide</a> for complete details.</p>
</section>
<section id="api-documentation" class="level2" data-number="15.10">
<h2 data-number="15.10" class="anchored" data-anchor-id="api-documentation"><span class="header-section-number">15.10</span> API Documentation</h2>
<p>Interactive API documentation available at <code>/api/docs</code> when running locally.</p>
<p>See <a href="https://claude.ai/chat/docs/api-reference.md">API Reference</a> for complete endpoint documentation.</p>
</section>
<section id="development" class="level2" data-number="15.11">
<h2 data-number="15.11" class="anchored" data-anchor-id="development"><span class="header-section-number">15.11</span> Development</h2>
<section id="running-tests" class="level3" data-number="15.11.1">
<h3 data-number="15.11.1" class="anchored" data-anchor-id="running-tests"><span class="header-section-number">15.11.1</span> Running Tests</h3>
<div class="sourceCode" id="cb21"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># All tests</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> test</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Unit tests only</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> run test:unit</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co"># With coverage</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> run test:coverage</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="code-style" class="level3" data-number="15.11.2">
<h3 data-number="15.11.2" class="anchored" data-anchor-id="code-style"><span class="header-section-number">15.11.2</span> Code Style</h3>
<p>We use ESLint and Prettier. Run <code>npm run lint</code> to check, <code>npm run lint:fix</code> to auto-fix.</p>
</section>
<section id="commit-messages" class="level3" data-number="15.11.3">
<h3 data-number="15.11.3" class="anchored" data-anchor-id="commit-messages"><span class="header-section-number">15.11.3</span> Commit Messages</h3>
<p>Follow <a href="https://www.conventionalcommits.org/">Conventional Commits</a>:</p>
<ul>
<li><code>feat: add user authentication</code></li>
<li><code>fix: resolve race condition in task updates</code></li>
<li><code>docs: update API examples</code></li>
</ul>
</section>
</section>
<section id="contributing" class="level2" data-number="15.12">
<h2 data-number="15.12" class="anchored" data-anchor-id="contributing"><span class="header-section-number">15.12</span> Contributing</h2>
<p>See <a href="https://claude.ai/chat/CONTRIBUTING.md">CONTRIBUTING.md</a> for guidelines.</p>
</section>
<section id="license" class="level2" data-number="15.13">
<h2 data-number="15.13" class="anchored" data-anchor-id="license"><span class="header-section-number">15.13</span> License</h2>
<p>MIT - see <a href="https://claude.ai/chat/LICENSE">LICENSE</a></p>
<pre><code>
A README should get someone from zero to productive quickly. Start with the minimum: what it is, how to run it, how to test it. Add more documentation as the project grows, but keep the README focused on getting started.

### 13.5.5 Keeping Documentation Current

Outdated documentation is worse than no documentation—it actively misleads. Keeping documentation current requires treating it as part of the codebase, not a separate artifact.

**Documentation as code:** Store documentation in the repository alongside code. Changes to code and documentation can happen in the same commit. Review documentation changes in pull requests just like code changes.

**Automate what you can:** Generate API documentation from code annotations. Generate architecture diagrams from code structure. Automated documentation can't become outdated because it's derived from the source of truth.

**Test documentation:** Verify that code examples in documentation actually work. Ensure links aren't broken. Check that described behaviors match actual behaviors.

**Include documentation in Definition of Done:** Features aren't complete until documented. This prevents documentation debt from accumulating.

**Regular review:** Periodically audit documentation for accuracy. This might be quarterly or when preparing releases. Assign documentation ownership to ensure someone is responsible.

---

## 13.6 Version Management

Software changes constantly, and managing those changes requires careful versioning. Good versioning communicates change impact, enables safe upgrades, and provides rollback capability.

### 13.6.1 Semantic Versioning

**Semantic Versioning (SemVer)** encodes compatibility information in version numbers. A version number MAJOR.MINOR.PATCH communicates the nature of changes:</code></pre>
<p>┌─────────────────────────────────────────────────────────────────────────┐ │ SEMANTIC VERSIONING │ ├─────────────────────────────────────────────────────────────────────────┤ │ │ │ Version Format: MAJOR.MINOR.PATCH (e.g., 2.4.1) │ │ │ │ MAJOR (2.x.x → 3.0.0) │ │ Increment for incompatible API changes. │ │ Users may need to modify their code. │ │ Examples: │ │ • Removing a public function │ │ • Changing function signatures │ │ • Changing default behaviors │ │ • Dropping support for old Node.js versions │ │ │ │ MINOR (2.4.x → 2.5.0) │ │ Increment for backwards-compatible new features. │ │ Users can upgrade without modification. │ │ Examples: │ │ • Adding new functions │ │ • Adding optional parameters │ │ • Adding new configuration options │ │ • Deprecating (not removing) existing features │ │ │ │ PATCH (2.4.1 → 2.4.2) │ │ Increment for backwards-compatible bug fixes. │ │ Users should upgrade when convenient. │ │ Examples: │ │ • Fixing incorrect behavior │ │ • Performance improvements │ │ • Security patches │ │ • Documentation corrections │ │ │ │ Pre-release versions: 1.0.0-alpha.1, 1.0.0-beta.2, 1.0.0-rc.1 │ │ Build metadata: 1.0.0+20240115, 1.0.0+build.123 │ │ │ └─────────────────────────────────────────────────────────────────────────┘</p>
<pre><code>
The power of SemVer is in the promises it makes. Users can trust that upgrading from 2.4.0 to 2.5.0 won't break their code. They can automate minor and patch updates with confidence. They know to approach major updates with care and testing.

**Before 1.0.0**: The project is in initial development. Anything may change at any time. The public API should not be considered stable. Many projects stay below 1.0.0 forever, which unfortunately makes SemVer less useful.

**Deprecation before removal**: SemVer etiquette requires warning users before removing features. Mark features as deprecated in a minor release, give users time to migrate, then remove in the next major release.

```javascript
/**
 * @deprecated Use `fetchUsers({ includeInactive: true })` instead.
 * Will be removed in version 3.0.0.
 */
function getAllUsersIncludingInactive() {
  console.warn(
    'getAllUsersIncludingInactive is deprecated. ' +
    'Use fetchUsers({ includeInactive: true }) instead.'
  );
  return fetchUsers({ includeInactive: true });
}</code></pre>
<section id="change-management" class="level3" data-number="15.13.1">
<h3 data-number="15.13.1" class="anchored" data-anchor-id="change-management"><span class="header-section-number">15.13.1</span> 13.6.2 Change Management</h3>
<p>Beyond version numbers, managing changes requires process and communication:</p>
<p><strong>Changelogs</strong> document what changed in each version. A good changelog groups changes by type and highlights breaking changes:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Changelog</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">## [2.5.0] - 2024-03-15</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="fu">### Added</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>New <span class="in">`batchCreate`</span> method for creating multiple tasks efficiently</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Support for task templates</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Webhook notifications for task status changes</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="fu">### Changed</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Improved performance of task queries with new index strategy</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Updated dependencies to latest versions</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a><span class="fu">### Deprecated</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`createMultiple`</span> method - use <span class="in">`batchCreate`</span> instead</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a><span class="fu">### Fixed</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Race condition when updating task status concurrently</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Memory leak in long-running websocket connections</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a><span class="fu">## [2.4.1] - 2024-03-01</span></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a><span class="fu">### Security</span></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Fixed XSS vulnerability in task description rendering (CVE-2024-1234)</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a><span class="fu">### Fixed</span></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Incorrect due date calculation for recurring tasks</span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a><span class="fu">## [2.4.0] - 2024-02-15</span></span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Migration guides</strong> help users upgrade across major versions:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Migrating from v2 to v3</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">## Breaking Changes</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="fu">### Authentication API Changes</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>The authentication methods have been restructured for consistency.</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>**Before (v2):**</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="in">```javascript</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> token <span class="op">=</span> await auth<span class="op">.</span><span class="fu">login</span><span class="op">(</span>email<span class="op">,</span> password<span class="op">);</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> user <span class="op">=</span> await auth<span class="op">.</span><span class="fu">verifyToken</span><span class="op">(</span>token<span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>After (v3):</strong></p>
<div class="sourceCode" id="cb26"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> { token<span class="op">,</span> user } <span class="op">=</span> <span class="cf">await</span> auth<span class="op">.</span><span class="fu">authenticate</span>({ email<span class="op">,</span> password })<span class="op">;</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co">// Token verification is now automatic in middleware</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="configuration-changes" class="level3" data-number="15.13.2">
<h3 data-number="15.13.2" class="anchored" data-anchor-id="configuration-changes"><span class="header-section-number">15.13.2</span> Configuration Changes</h3>
<p>The configuration format has changed to support multiple environments.</p>
<p><strong>Before (v2):</strong></p>
<div class="sourceCode" id="cb27"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> config <span class="op">=</span> <span class="pp">require</span>(<span class="st">'./config'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>After (v3):</strong></p>
<div class="sourceCode" id="cb28"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> config <span class="op">=</span> <span class="pp">require</span>(<span class="st">'./config'</span>)[<span class="bu">process</span><span class="op">.</span><span class="at">env</span><span class="op">.</span><span class="at">NODE_ENV</span>]<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>See <a href="https://claude.ai/chat/scripts/migrate-config.js">migration script</a> for automated conversion.</p>
</section>
</section>
<section id="deprecated-features-removed" class="level2" data-number="15.14">
<h2 data-number="15.14" class="anchored" data-anchor-id="deprecated-features-removed"><span class="header-section-number">15.14</span> Deprecated Features Removed</h2>
<p>The following deprecated features have been removed:</p>
<ul>
<li><code>getAllUsersIncludingInactive()</code> - use <code>fetchUsers({ includeInactive: true })</code></li>
<li><code>Task.complete()</code> - use <code>Task.updateStatus('completed')</code></li>
</ul>
<pre><code>
**Release branches** allow maintaining multiple versions simultaneously. While you develop version 3, you might need to release security patches for version 2:</code></pre>
<p>main ──●──●──●──●──●──────────────────▶ (v3 development)<br>
release/v2.x ●──●──●───────────────▶ (v2 maintenance) │ │ v2.4.1 v2.4.2 (security patches)</p>
<pre><code>
### 13.6.3 Database Migrations

Code versioning is relatively simple—you deploy new code, it runs. Data versioning is harder. Databases persist across deployments, and changing schemas requires careful migration.

**Migration files** describe schema changes as code:

```javascript
// migrations/20240315_001_add_task_priority.js

exports.up = async function(knex) {
  // Add new column with default value
  await knex.schema.alterTable('tasks', table =&gt; {
    table.integer('priority').defaultTo(0).notNullable();
    table.index('priority');  // Index for sorting by priority
  });
  
  // Backfill existing tasks based on business rules
  await knex.raw(`
    UPDATE tasks 
    SET priority = CASE
      WHEN due_date &lt; NOW() THEN 3        -- Overdue = high priority
      WHEN due_date &lt; NOW() + INTERVAL '1 day' THEN 2  -- Due soon
      ELSE 0                               -- Default
    END
  `);
};

exports.down = async function(knex) {
  await knex.schema.alterTable('tasks', table =&gt; {
    table.dropColumn('priority');
  });
};</code></pre>
<p>Each migration has an <code>up</code> function (apply the change) and a <code>down</code> function (revert the change). Migrations run in order based on their filenames, and the system tracks which migrations have been applied.</p>
<p><strong>Migration best practices:</strong></p>
<ul>
<li><strong>Test migrations on production data</strong>: Run against a copy of production before deploying</li>
<li><strong>Make migrations reversible</strong>: Always implement <code>down</code> functions</li>
<li><strong>Keep migrations small</strong>: Large migrations are risky and hard to debug</li>
<li><strong>Never modify existing migrations</strong>: If a migration is wrong, create a new migration to fix it</li>
<li><strong>Handle data carefully</strong>: Migrations that modify data need extra scrutiny</li>
</ul>
<section id="api-versioning" class="level3" data-number="15.14.1">
<h3 data-number="15.14.1" class="anchored" data-anchor-id="api-versioning"><span class="header-section-number">15.14.1</span> 13.6.4 API Versioning</h3>
<p>APIs require special versioning consideration because changes affect external consumers who you don’t control:</p>
<p><strong>URL path versioning</strong> is explicit and visible:</p>
<pre><code>GET /api/v1/tasks
GET /api/v2/tasks</code></pre>
<p><strong>Header versioning</strong> keeps URLs clean but is less discoverable:</p>
<pre><code>GET /api/tasks
Accept: application/vnd.taskflow.v2+json</code></pre>
<p><strong>Query parameter versioning</strong> is simple but clutters URLs:</p>
<pre><code>GET /api/tasks?version=2</code></pre>
<p>Regardless of mechanism, the principles are similar:</p>
<p><strong>Support multiple versions simultaneously.</strong> When you release v2, keep v1 running for a deprecation period. This gives consumers time to migrate.</p>
<p><strong>Version at the right granularity.</strong> Versioning the entire API means all endpoints change together. Versioning individual endpoints provides more flexibility but more complexity.</p>
<p><strong>Document version differences.</strong> Make it easy for consumers to understand what changed and how to migrate.</p>
<p><strong>Sunset versions gracefully.</strong> Announce deprecation well in advance. Provide migration guidance. Monitor usage of deprecated versions. Only retire versions when usage is minimal.</p>
<hr>
</section>
</section>
<section id="designing-for-maintainability" class="level2" data-number="15.15">
<h2 data-number="15.15" class="anchored" data-anchor-id="designing-for-maintainability"><span class="header-section-number">15.15</span> 13.7 Designing for Maintainability</h2>
<p>The best time to make software maintainable is when you first build it. Retrofitting maintainability into existing systems is expensive. This section explores how to design systems that remain maintainable as they grow.</p>
<section id="principles-for-maintainable-design" class="level3" data-number="15.15.1">
<h3 data-number="15.15.1" class="anchored" data-anchor-id="principles-for-maintainable-design"><span class="header-section-number">15.15.1</span> 13.7.1 Principles for Maintainable Design</h3>
<p><strong>Single Responsibility Principle</strong>: Each module should have one reason to change. When a module has multiple responsibilities, changes to one responsibility risk breaking another. Focused modules are easier to understand, test, and modify.</p>
<p><strong>Open-Closed Principle</strong>: Software should be open for extension but closed for modification. Add new behavior by adding new code, not changing existing code. This reduces risk—existing, tested code remains untouched.</p>
<p><strong>Dependency Inversion</strong>: High-level modules shouldn’t depend on low-level modules; both should depend on abstractions. This decoupling allows substituting implementations without changing consumers.</p>
<p><strong>Separation of Concerns</strong>: Different aspects of functionality should be separated into distinct sections. UI logic shouldn’t be mixed with business logic. Database access shouldn’t be mixed with validation. Separation makes each concern easier to understand and modify independently.</p>
</section>
<section id="structural-patterns-for-maintainability" class="level3" data-number="15.15.2">
<h3 data-number="15.15.2" class="anchored" data-anchor-id="structural-patterns-for-maintainability"><span class="header-section-number">15.15.2</span> 13.7.2 Structural Patterns for Maintainability</h3>
<p><strong>Layered Architecture</strong> separates concerns into distinct layers with clear responsibilities:</p>
<pre><code>┌─────────────────────────────────────────────────────────────────────────┐
│                    LAYERED ARCHITECTURE                                 │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                    PRESENTATION LAYER                            │   │
│  │  Handles HTTP requests, formats responses, manages sessions      │   │
│  │  Express routes, controllers, middleware, view rendering         │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                              │                                          │
│                              ▼                                          │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                    APPLICATION LAYER                             │   │
│  │  Orchestrates use cases, coordinates between services            │   │
│  │  Application services, use case handlers, DTOs                   │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                              │                                          │
│                              ▼                                          │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                    DOMAIN LAYER                                  │   │
│  │  Core business logic, rules, and entities                        │   │
│  │  Domain models, business rules, domain services                  │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                              │                                          │
│                              ▼                                          │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                    INFRASTRUCTURE LAYER                          │   │
│  │  External concerns: database, APIs, file system, messaging       │   │
│  │  Repositories, API clients, queue handlers                       │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  Dependencies flow downward. Each layer only knows about the layer     │
│  immediately below it.                                                  │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘</code></pre>
<p>This separation means you can change the database (infrastructure layer) without affecting business logic (domain layer). You can replace the web framework (presentation layer) without affecting how tasks are created (application layer).</p>
<p><strong>Modular Structure</strong> organizes code by feature rather than by technical role:</p>
<pre><code># Traditional structure (by technical role)
# Finding all code for "tasks" requires looking everywhere
src/
├── controllers/
│   ├── taskController.js
│   ├── userController.js
│   └── projectController.js
├── services/
│   ├── taskService.js
│   ├── userService.js
│   └── projectService.js
├── repositories/
│   ├── taskRepository.js
│   └── ...
└── models/
    └── ...

# Modular structure (by feature)
# All task-related code is together
src/
├── tasks/
│   ├── taskController.js
│   ├── taskService.js
│   ├── taskRepository.js
│   ├── taskModel.js
│   └── taskRoutes.js
├── users/
│   ├── userController.js
│   └── ...
├── projects/
│   └── ...
└── shared/
    ├── database.js
    ├── auth.js
    └── errors.js</code></pre>
<p>Modular structure makes it easy to understand a feature in isolation. All the code for tasks is in one folder. Adding a feature means working in one area rather than touching files across the codebase.</p>
</section>
<section id="testing-for-maintainability" class="level3" data-number="15.15.3">
<h3 data-number="15.15.3" class="anchored" data-anchor-id="testing-for-maintainability"><span class="header-section-number">15.15.3</span> 13.7.3 Testing for Maintainability</h3>
<p>Comprehensive tests make refactoring safe. Without tests, changes are risky because you can’t verify behavior is preserved. With tests, you can refactor confidently—if tests pass, behavior is preserved.</p>
<p><strong>Test at multiple levels:</strong></p>
<pre><code>┌─────────────────────────────────────────────────────────────────────────┐
│                    TESTING PYRAMID                                      │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│                           ╱╲                                            │
│                          ╱  ╲                                           │
│                         ╱ E2E╲     Few, slow, test real user flows      │
│                        ╱──────╲                                         │
│                       ╱        ╲                                        │
│                      ╱Integration╲  Some, test component integration    │
│                     ╱────────────╲                                      │
│                    ╱              ╲                                     │
│                   ╱   Unit Tests   ╲  Many, fast, test individual       │
│                  ╱──────────────────╲ functions in isolation            │
│                 ╱                    ╲                                  │
│                ╱──────────────────────╲                                 │
│                                                                         │
│  Good test coverage enables confident refactoring.                      │
│  Bad tests (testing implementation) make refactoring painful.           │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘</code></pre>
<p><strong>Test behavior, not implementation.</strong> Tests that verify <em>what</em> code does enable refactoring. Tests that verify <em>how</em> code works break when you refactor:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Bad: Tests implementation details</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">test</span>(<span class="st">'task service calls repository'</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> mockRepo <span class="op">=</span> { <span class="dt">create</span><span class="op">:</span> jest<span class="op">.</span><span class="fu">fn</span>() }<span class="op">;</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> service <span class="op">=</span> <span class="kw">new</span> <span class="fu">TaskService</span>(mockRepo)<span class="op">;</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  service<span class="op">.</span><span class="fu">createTask</span>({ <span class="dt">title</span><span class="op">:</span> <span class="st">'Test'</span> })<span class="op">;</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">// This breaks if we change how TaskService is implemented</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect</span>(mockRepo<span class="op">.</span><span class="at">create</span>)<span class="op">.</span><span class="fu">toHaveBeenCalled</span>()<span class="op">;</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="co">// Good: Tests observable behavior</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="fu">test</span>(<span class="st">'createTask returns created task with id'</span><span class="op">,</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> service <span class="op">=</span> <span class="kw">new</span> <span class="fu">TaskService</span>(realRepository)<span class="op">;</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> task <span class="op">=</span> <span class="cf">await</span> service<span class="op">.</span><span class="fu">createTask</span>({ <span class="dt">title</span><span class="op">:</span> <span class="st">'Test'</span> })<span class="op">;</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Tests what matters to callers, not internal implementation</span></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect</span>(task<span class="op">.</span><span class="at">id</span>)<span class="op">.</span><span class="fu">toBeDefined</span>()<span class="op">;</span></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect</span>(task<span class="op">.</span><span class="at">title</span>)<span class="op">.</span><span class="fu">toBe</span>(<span class="st">'Test'</span>)<span class="op">;</span></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect</span>(task<span class="op">.</span><span class="at">status</span>)<span class="op">.</span><span class="fu">toBe</span>(<span class="st">'pending'</span>)<span class="op">;</span></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<hr>
</section>
</section>
<section id="chapter-summary" class="level2" data-number="15.16">
<h2 data-number="15.16" class="anchored" data-anchor-id="chapter-summary"><span class="header-section-number">15.16</span> 13.8 Chapter Summary</h2>
<p>Software maintenance is the dominant phase of the software lifecycle, consuming 60-80% of total costs. Understanding maintenance isn’t optional—it’s central to professional software development.</p>
<p>Key takeaways:</p>
<p><strong>Maintenance types</strong> include corrective (fixing bugs), adaptive (responding to environment changes), perfective (adding features), and preventive (improving maintainability). Perfective maintenance dominates, but preventive maintenance is chronically underfunded despite offering the best long-term returns.</p>
<p><strong>Technical debt</strong> is a useful metaphor for discussing code quality in business terms. Debt can be strategic (prudent) or reckless, deliberate or inadvertent. Unmanaged debt compounds, eventually overwhelming projects. Effective management requires visibility, prioritization, and consistent allocation of effort to debt reduction.</p>
<p><strong>Refactoring</strong> improves code structure without changing behavior. Common techniques include extracting functions, replacing conditionals with polymorphism, and introducing parameter objects. Safe refactoring requires tests, small steps, and discipline to separate structural changes from behavioral changes.</p>
<p><strong>Legacy systems</strong> require special strategies. The Strangler Fig pattern gradually replaces systems by routing traffic to new implementations. Branch by Abstraction enables internal component replacement. Characterization testing documents existing behavior when specifications are unavailable.</p>
<p><strong>Documentation</strong> is a force multiplier. Different audiences (users, integrators, developers, operators) need different documentation. Architectural Decision Records capture the reasoning behind significant decisions. Code comments should explain why, not what. README files enable quick starts. Keeping documentation current requires treating it as code.</p>
<p><strong>Version management</strong> communicates change impact. Semantic versioning (MAJOR.MINOR.PATCH) encodes compatibility promises. Changelogs document what changed. Migration guides help users upgrade. Database migrations version schema changes as code.</p>
<p><strong>Designing for maintainability</strong> from the start is far easier than retrofitting later. Principles like single responsibility, separation of concerns, and dependency inversion guide design. Layered and modular architectures separate concerns. Comprehensive tests enable confident changes.</p>
<p>Software that’s easy to maintain provides value for years. Software that’s difficult to maintain becomes a liability. The practices in this chapter transform maintenance from a burden into an opportunity for continuous improvement.</p>
<hr>
</section>
<section id="key-terms" class="level2" data-number="15.17">
<h2 data-number="15.17" class="anchored" data-anchor-id="key-terms"><span class="header-section-number">15.17</span> 13.9 Key Terms</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Term</th>
<th>Definition</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Technical Debt</strong></td>
<td>Accumulated cost of shortcuts and deferred work in software</td>
</tr>
<tr class="even">
<td><strong>Refactoring</strong></td>
<td>Restructuring code without changing external behavior</td>
</tr>
<tr class="odd">
<td><strong>Legacy System</strong></td>
<td>Existing system that remains valuable but is difficult to work with</td>
</tr>
<tr class="even">
<td><strong>Semantic Versioning</strong></td>
<td>Version numbering scheme (MAJOR.MINOR.PATCH) encoding compatibility</td>
</tr>
<tr class="odd">
<td><strong>ADR</strong></td>
<td>Architectural Decision Record—document capturing reasoning behind decisions</td>
</tr>
<tr class="even">
<td><strong>Strangler Fig</strong></td>
<td>Pattern for gradually replacing legacy systems</td>
</tr>
<tr class="odd">
<td><strong>Characterization Test</strong></td>
<td>Test that documents actual behavior of existing code</td>
</tr>
<tr class="even">
<td><strong>Migration</strong></td>
<td>Script that transforms database schema or data from one version to another</td>
</tr>
<tr class="odd">
<td><strong>Cyclomatic Complexity</strong></td>
<td>Metric measuring number of independent paths through code</td>
</tr>
<tr class="even">
<td><strong>Cohesion</strong></td>
<td>Degree to which elements of a module belong together</td>
</tr>
<tr class="odd">
<td><strong>Coupling</strong></td>
<td>Degree of interdependence between modules</td>
</tr>
<tr class="even">
<td><strong>Deprecation</strong></td>
<td>Marking a feature as scheduled for removal in a future version</td>
</tr>
<tr class="odd">
<td><strong>Changelog</strong></td>
<td>Document recording what changed in each version</td>
</tr>
<tr class="even">
<td><strong>Runbook</strong></td>
<td>Operational documentation for running and troubleshooting systems</td>
</tr>
</tbody>
</table>
<hr>
</section>
<section id="review-questions" class="level2" data-number="15.18">
<h2 data-number="15.18" class="anchored" data-anchor-id="review-questions"><span class="header-section-number">15.18</span> 13.10 Review Questions</h2>
<ol type="1">
<li><p>Why does software maintenance typically consume more resources than initial development? What factors contribute to this?</p></li>
<li><p>Explain the four types of software maintenance. Which type typically consumes the most effort and why?</p></li>
<li><p>What is technical debt? Describe the difference between prudent and reckless technical debt.</p></li>
<li><p>How do tests enable safe refactoring? What makes a test good or bad for refactoring purposes?</p></li>
<li><p>Describe the Strangler Fig pattern. When is it appropriate to use?</p></li>
<li><p>What is the purpose of Architectural Decision Records? What should they contain?</p></li>
<li><p>Explain Semantic Versioning. What do the MAJOR, MINOR, and PATCH numbers communicate?</p></li>
<li><p>Why is it important to test behavior rather than implementation when writing tests for maintainability?</p></li>
<li><p>Describe three code smells that indicate refactoring opportunities. For each, explain what the smell indicates and how to address it.</p></li>
<li><p>How can documentation be kept current? What practices prevent documentation from becoming outdated?</p></li>
</ol>
<hr>
</section>
<section id="hands-on-exercises" class="level2" data-number="15.19">
<h2 data-number="15.19" class="anchored" data-anchor-id="hands-on-exercises"><span class="header-section-number">15.19</span> 13.11 Hands-On Exercises</h2>
<section id="exercise-13.1-technical-debt-audit" class="level3" data-number="15.19.1">
<h3 data-number="15.19.1" class="anchored" data-anchor-id="exercise-13.1-technical-debt-audit"><span class="header-section-number">15.19.1</span> Exercise 13.1: Technical Debt Audit</h3>
<p>Conduct a technical debt audit of your project:</p>
<ol type="1">
<li>Identify at least 10 instances of technical debt</li>
<li>Classify each as deliberate/inadvertent and prudent/reckless</li>
<li>Estimate the impact (how much does this slow development?)</li>
<li>Estimate remediation effort</li>
<li>Prioritize the debt items</li>
<li>Create tickets for the top 3 items</li>
</ol>
</section>
<section id="exercise-13.2-refactoring-practice" class="level3" data-number="15.19.2">
<h3 data-number="15.19.2" class="anchored" data-anchor-id="exercise-13.2-refactoring-practice"><span class="header-section-number">15.19.2</span> Exercise 13.2: Refactoring Practice</h3>
<p>Take a complex function (at least 50 lines) and refactor it:</p>
<ol type="1">
<li>Write characterization tests that capture current behavior</li>
<li>Apply Extract Function to break down the function</li>
<li>Identify any duplicated code and extract shared functions</li>
<li>Apply Introduce Parameter Object if appropriate</li>
<li>Verify all tests still pass</li>
<li>Document the refactoring in a brief write-up</li>
</ol>
</section>
<section id="exercise-13.3-documentation-improvement" class="level3" data-number="15.19.3">
<h3 data-number="15.19.3" class="anchored" data-anchor-id="exercise-13.3-documentation-improvement"><span class="header-section-number">15.19.3</span> Exercise 13.3: Documentation Improvement</h3>
<p>Improve documentation for a project:</p>
<ol type="1">
<li>Write or update the README with quick start instructions</li>
<li>Create at least one Architectural Decision Record for a significant decision</li>
<li>Review code comments—remove unhelpful comments, add valuable ones</li>
<li>Create a CONTRIBUTING.md with development guidelines</li>
<li>Set up automated documentation generation if applicable</li>
</ol>
</section>
<section id="exercise-13.4-legacy-code-characterization" class="level3" data-number="15.19.4">
<h3 data-number="15.19.4" class="anchored" data-anchor-id="exercise-13.4-legacy-code-characterization"><span class="header-section-number">15.19.4</span> Exercise 13.4: Legacy Code Characterization</h3>
<p>For a piece of undocumented legacy code:</p>
<ol type="1">
<li>Write characterization tests that document current behavior</li>
<li>Identify at least 3 edge cases through exploration</li>
<li>Document any surprising behaviors discovered</li>
<li>Create a brief architecture description</li>
<li>Identify opportunities for improvement</li>
</ol>
</section>
<section id="exercise-13.5-version-management" class="level3" data-number="15.19.5">
<h3 data-number="15.19.5" class="anchored" data-anchor-id="exercise-13.5-version-management"><span class="header-section-number">15.19.5</span> Exercise 13.5: Version Management</h3>
<p>Implement proper versioning for your project:</p>
<ol type="1">
<li>Set up Semantic Versioning</li>
<li>Create a CHANGELOG following Keep a Changelog format</li>
<li>Implement database migrations for schema changes</li>
<li>Create a release process document</li>
<li>Tag a release in version control</li>
</ol>
</section>
<section id="exercise-13.6-maintainability-metrics" class="level3" data-number="15.19.6">
<h3 data-number="15.19.6" class="anchored" data-anchor-id="exercise-13.6-maintainability-metrics"><span class="header-section-number">15.19.6</span> Exercise 13.6: Maintainability Metrics</h3>
<p>Measure and improve maintainability:</p>
<ol type="1">
<li>Run a code complexity analysis tool (e.g., ESLint complexity rule)</li>
<li>Identify the 5 most complex functions</li>
<li>Measure test coverage</li>
<li>Create a maintainability dashboard or report</li>
<li>Set targets for improvement</li>
</ol>
<hr>
</section>
</section>
<section id="further-reading" class="level2" data-number="15.20">
<h2 data-number="15.20" class="anchored" data-anchor-id="further-reading"><span class="header-section-number">15.20</span> 13.12 Further Reading</h2>
<p><strong>Books:</strong></p>
<ul>
<li>Fowler, M. (2018). <em>Refactoring: Improving the Design of Existing Code</em> (2nd Edition). Addison-Wesley.</li>
<li>Feathers, M. (2004). <em>Working Effectively with Legacy Code</em>. Prentice Hall.</li>
<li>Martin, R. C. (2008). <em>Clean Code: A Handbook of Agile Software Craftsmanship</em>. Prentice Hall.</li>
</ul>
<p><strong>Online Resources:</strong></p>
<ul>
<li>Refactoring.guru: https://refactoring.guru/</li>
<li>Conventional Commits: https://www.conventionalcommits.org/</li>
<li>Keep a Changelog: https://keepachangelog.com/</li>
<li>Semantic Versioning: https://semver.org/</li>
</ul>
<hr>
</section>
<section id="references" class="level2" data-number="15.21">
<h2 data-number="15.21" class="anchored" data-anchor-id="references"><span class="header-section-number">15.21</span> References</h2>
<p>Fowler, M. (2018). <em>Refactoring: Improving the Design of Existing Code</em> (2nd Edition). Addison-Wesley.</p>
<p>Cunningham, W. (1992). The WyCash Portfolio Management System. OOPSLA ’92 Experience Report.</p>
<p>Feathers, M. (2004). <em>Working Effectively with Legacy Code</em>. Prentice Hall.</p>
<p>Martin, R. C. (2008). <em>Clean Code: A Handbook of Agile Software Craftsmanship</em>. Prentice Hall.</p>
<p>Lehman, M. M. (1980). Programs, Life Cycles, and Laws of Software Evolution. <em>Proceedings of the IEEE</em>, 68(9), 1060-1076.</p>
<p>Pressman, R. S., &amp; Maxim, B. R. (2019). <em>Software Engineering: A Practitioner’s Approach</em> (9th Edition). McGraw-Hill.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../chapters/12-security.html" class="pagination-link" aria-label="Chapter 12: Software Security">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Chapter 12: Software Security</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../chapters/14-ethics-professionalism.html" class="pagination-link" aria-label="Chapter 14: Professional Practice and Ethics">
        <span class="nav-page-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Chapter 14: Professional Practice and Ethics</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>